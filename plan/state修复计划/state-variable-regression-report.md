# State变量回归报告（模板）

## 文档信息

- 项目：DXC
- 报告版本：v0.1
- 测试负责人：
- 测试日期：
- 对应计划：`plan/state-variable-repair-phase-checklist.md`
- 对应清单：`plan/state-variable-inventory.md`

## 回归范围

- [ ] 四服务分工校验：`story/state/memory/map`
- [ ] `memory` 独立性校验（不回退）
- [ ] legacy path 业务写入拦截
- [ ] 世界/论坛 cadence 与 UI 配置一致性
- [ ] 关键变量最小必填集（MRS）完整性
- [ ] 失败可观测性（系统日志/调试信息）

## 测试环境

| 项目 | 值 |
|---|---|
| 分支 |  |
| Commit |  |
| 运行环境 |  |
| 浏览器/客户端 |  |
| 数据集 |  |
| 测试方式 | 手工 + 自动化 |

## 基线对比

| 指标 | 修复前 | 修复后 | 目标 | 结论 |
|---|---:|---:|---:|---|
| 关键变量缺失率 |  |  | <= 2% |  |
| legacy拦截命中可见率 |  |  | 100% |  |
| memory误路由率 |  |  | 0% |  |
| world/forum轮次一致率 |  |  | 100% |  |

## 用例矩阵

| 用例ID | 类别 | 用例描述 | 前置条件 | 步骤摘要 | 预期结果 | 实际结果 | 结论 | 证据 |
|---|---|---|---|---|---|---|---|---|
| CFG-001 | 配置隔离 | memory 未配置时不回退到 state | state 已配置，memory 未配置 | 触发 memory 链路请求 | memory 失败且仅影响 memory |  |  |  |
| CFG-002 | 配置隔离 | story/state/map 任一缺配置不串岗 | 仅配置其余三服务 | 触发对应链路 | 仅该链路报未配置 |  |  |  |
| CMD-001 | 写入入口 | legacy 业务写入被拦截 | 开启严格模式 | 下发 set gameState.任务.* | 拦截并产生系统日志 |  |  |  |
| CMD-002 | 写入入口 | UI瞬态路径允许写入 | 开启严格模式 | 写入 gameState.处理中.* | 允许写入 |  |  |  |
| CAD-001 | 轮次 | 世界更新按 interval 触发 | interval=2 | 推进回合至到点 | 到点更新并重排 nextTurn |  |  |  |
| CAD-002 | 轮次 | interval=0 时不自动更新 | interval=0 | 推进多个回合 | 不自动更新，状态可见 |  |  |  |
| CAD-003 | 轮次 | 论坛更新与世界策略一致 | 配置默认 | 推进回合 | 论坛无漂移 |  |  |  |
| VAR-001 | 完整性 | MRS 字段齐全 | 基线数据就绪 | 执行完整回合链路 | 必填字段全部可取 |  |  |  |
| OBS-001 | 可观测性 | 写入失败原因标准化 | 注入失败场景 | 触发缺字段/拦截 | 记录标准错误码 |  |  |  |

## 自动化执行记录

| 任务 | 命令 | 结果 | 备注 |
|---|---|---|---|
| 单元测试 |  |  |  |
| 集成测试 |  |  |  |
| 静态检查 |  |  |  |

## 失败明细

| 失败ID | 用例ID | 失败现象 | 影响范围 | 根因定位 | 修复建议 | 优先级 | 负责人 | 状态 |
|---|---|---|---|---|---|---|---|---|
| FAIL-001 |  |  |  |  |  |  |  | 待处理 |

## 结论

- 总用例数：
- 通过数：
- 失败数：
- 阻塞数：
- 是否满足上线门槛：`是 / 否`

## 上线门槛核对

- [ ] `memory` 不回退。
- [ ] legacy 业务写入全部被拦截并可见。
- [ ] 世界/论坛轮次与 UI 配置一致。
- [ ] 关键变量 MRS 达标。
- [ ] 无 P0/P1 未关闭问题。

## 关联资料

- 计划：`plan/state-variable-repair-phase-checklist.md`
- 清单：`plan/state-variable-inventory.md`
- 灰度日志：`plan/state-variable-rollout-log.md`

## 变更记录

| 日期 | 修改人 | 变更内容 |
|---|---|---|
|  |  | 初始化模板 |
