{
  "type": "script",
  "enabled": true,
  "name": "DNDæ²‰æµ¸å¼ä»ªè¡¨ç›˜ v1.9.0",
  "id": "91f68acc-9252-43d5-9f45-04b3c09e30ea",
  "content": "// ==UserScript==\n// @name         DND æ²‰æµ¸å¼ä»ªè¡¨ç›˜\n// @namespace    http://tampermonkey.net/\n// @version      1.9.0\n// @description  ä¸“ä¸º DND æ¨¡æ¿è®¾è®¡çš„æ¸¸æˆé£æ ¼ä»ªè¡¨ç›˜\n// @author       Niccole\n// @match        */*\n// @grant        none\n// ==/UserScript==\n(()=>{\"use strict\";const n={level:4,prefix:\"[DND Dashboard]\",error:(...t)=>{n.level>=1&&console.error(n.prefix,\"âŒ ERROR:\",...t)},warn:(...t)=>{n.level>=2&&console.warn(n.prefix,\"âš ï¸ WARN:\",...t)},info:(...t)=>{n.level>=3&&console.info(n.prefix,\"ğŸ“‹ INFO:\",...t)},debug:(...t)=>{n.level>=4&&console.log(n.prefix,\"ğŸ” DEBUG:\",...t)},diagnose:()=>{console.group(n.prefix+\" ğŸ”¬ ç¯å¢ƒè¯Šæ–­\"),console.log(\"window.jQuery:\",typeof window.jQuery,window.jQuery?window.jQuery.fn.jquery:\"N/A\");try{const n=window.parent?.jQuery;console.log(\"window.parent.jQuery:\",typeof n,n?n.fn.jquery:\"N/A\")}catch(n){console.log(\"window.parent.jQuery: è®¿é—®è¢«é˜»æ­¢ (è·¨åŸŸ)\",n.message)}console.log(\"document.body:\",!!document.body),console.log(\"#dnd-toggle-btn å­˜åœ¨:\",!!document.getElementById(\"dnd-toggle-btn\")),console.log(\"#dnd-dashboard-root å­˜åœ¨:\",!!document.getElementById(\"dnd-dashboard-root\")),console.log(\"#dnd-mini-hud å­˜åœ¨:\",!!document.getElementById(\"dnd-mini-hud\")),console.log(\"window.AutoCardUpdaterAPI:\",typeof window.AutoCardUpdaterAPI);try{console.log(\"parent.AutoCardUpdaterAPI:\",typeof window.parent?.AutoCardUpdaterAPI)}catch(n){console.log(\"parent.AutoCardUpdaterAPI: è®¿é—®è¢«é˜»æ­¢\")}console.log(\"åœ¨ iframe ä¸­:\",window!==window.top),console.log(\"window.location:\",window.location.href.substring(0,100)),console.groupEnd()}};window.DND_Dashboard_Logger=n;const t={dbName:\"DND_Immersive_DB\",storeName:\"avatars\",settingsStore:\"settings\",svgStore:\"svg_maps\",version:7,db:null,_openPromise:null,init:()=>t.db?Promise.resolve(t.db):(t._openPromise||(t._openPromise=new Promise((n,e)=>{const a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!a)return console.error(\"[DND DB] Browser does not support IndexedDB\"),t._openPromise=null,e(\"IndexedDB not supported\");const r=setTimeout(()=>{t._openPromise&&(console.warn(\"[DND DB] Connection timed out. Using fallback.\"),t._openPromise=null,e(\"Connection timeout\"))},2e3),o=a.open(t.dbName,t.version);o.onblocked=n=>{console.warn(\"[DND DB] Database blocked. Please close other tabs.\")},o.onerror=n=>{clearTimeout(r),console.error(\"[DND DB] Open Error:\",n.target.error),t._openPromise=null,e(n.target.error)},o.onsuccess=e=>{clearTimeout(r);const a=e.target.result;t.db=a,a.onclose=()=>{console.warn(\"[DND DB] Database connection closed unexpectedly.\"),t.db=null,t._openPromise=null},a.onversionchange=()=>{console.warn(\"[DND DB] Database version changed. Closing connection.\"),a.close(),t.db=null,t._openPromise=null},n(a)},o.onupgradeneeded=n=>{const e=n.target.result;e.objectStoreNames.contains(t.storeName)||e.createObjectStore(t.storeName),e.objectStoreNames.contains(t.settingsStore)||e.createObjectStore(t.settingsStore),e.objectStoreNames.contains(t.svgStore)||e.createObjectStore(t.svgStore)}})),t._openPromise),_op:async(n,e,a)=>{try{let r=await t.init();return new Promise((o,i)=>{let d;try{d=r.transaction([n],e)}catch(r){return console.warn(\"[DND DB] Transaction creation failed, retrying connection...\",r),t.db=null,t._openPromise=null,void t.init().then(t=>{try{d=t.transaction([n],e);const r=d.objectStore(n),s=a(r);s.onsuccess=n=>o(n.target.result),s.onerror=n=>i(n.target.error)}catch(n){console.error(\"[DND DB] Retry failed:\",n),i(n)}}).catch(n=>{console.error(\"[DND DB] Re-init failed:\",n),i(n)})}const s=d.objectStore(n),l=a(s);l.onsuccess=n=>o(n.target.result),l.onerror=t=>{console.error(`[DND DB] Op Error (${n}):`,t.target.error),i(t.target.error)}})}catch(t){return void console.error(`[DND DB] Operation Failed (${n}):`,t)}},put:async(n,e)=>t._op(t.storeName,\"readwrite\",t=>t.put(e,n)),get:async n=>t._op(t.storeName,\"readonly\",t=>t.get(n)),setSetting:async(n,e)=>t._op(t.settingsStore,\"readwrite\",t=>t.put(e,n)),setSVG:async(n,e)=>t._op(t.svgStore,\"readwrite\",t=>t.put(e,n)),getSVG:async n=>t._op(t.svgStore,\"readonly\",t=>t.get(n)),getSetting:async n=>{try{let e=await t._op(t.settingsStore,\"readonly\",t=>t.get(n));if(null!=e)return e}catch(n){console.warn(\"DB Get failed\",n)}try{const t=localStorage.getItem(n);if(t)return t}catch(n){}return null},delete:async n=>t._op(t.storeName,\"readwrite\",t=>t.delete(n)),clearStore:async n=>t._op(n,\"readwrite\",n=>n.clear()),clearAvatars:async()=>t.clearStore(t.storeName),clearMaps:async()=>t.clearStore(t.svgStore),migrateFromLocalStorage:async()=>{const n=Object.keys(localStorage);let e=0;for(const a of n)if(a.startsWith(\"dnd_\")){const n=localStorage.getItem(a);if(n)try{a.startsWith(\"dnd_avatar_\")?(await t.put(a.replace(\"dnd_avatar_\",\"\"),n),localStorage.removeItem(a),e++):await t.setSetting(a,n)}catch(n){console.warn(\"Migration failed for\",a)}}e>0&&console.log(`[DND Storage] Migrated ${e} items to DB.`)},analyzeStorage:()=>{let n=0;const t={},e=[];for(let a in localStorage){if(!localStorage.hasOwnProperty(a))continue;const r=2*(localStorage[a].length+a.length);n+=r;let o=\"Other\";a.startsWith(\"dnd_\")?o=\"DND Script\":a.startsWith(\"SillyTavern\")||a.startsWith(\"settings\")?o=\"SillyTavern System\":a.includes(\"chat\")?o=\"Chats/Logs\":a.includes(\"character\")&&(o=\"Characters\"),t[o]=(t[o]||0)+r,e.push({key:a,size:r})}return e.sort((n,t)=>t.size-n.size),{totalBytes:n,totalMB:(n/1024/1024).toFixed(2),breakdown:t,topKeys:e.slice(0,5)}}},e={EXTENSION_NAME:\"dnd_dashboard\",SYNC_QUEUE_KEY:\"dnd_sync_queue\",_tavernAvailable:null,_previousState:null,_syncInterval:null,_notifyCallback:null,setNotifyCallback:function(n){this._notifyCallback=n},_notify:function(t,e,a=\"\"){\"info\"!==t||!a.includes(\"äº‘åŒæ­¥\")&&!a.includes(\"åŒæ­¥ä¸­\")?(this._notifyCallback&&this._notifyCallback(t,e,a),n.info(`[TavernSettingsSync] ${t}: ${a} - ${e}`)):n.info(`[TavernSettingsSync] (Silent) ${t}: ${a} - ${e}`)},init:async function(){if(this._syncInterval&&clearInterval(this._syncInterval),this._tavernAvailable=this._checkTavernAvailable(),this._previousState=this._tavernAvailable,this._tavernAvailable){n.info(\"[TavernSettingsSync] â˜ï¸ äº‘åŒæ­¥å·²å¯ç”¨\");try{const n=await this._getSyncQueue(),t=Object.keys(n).length;t>0&&(this._notify(\"info\",`æ­£åœ¨åŒæ­¥ ${t} é¡¹æœ¬åœ°æ›´æ”¹...`,\"ğŸ”„ åŒæ­¥ä¸­\"),await this._processSyncQueue())}catch(t){n.error(\"[TavernSettingsSync] Initial sync failed:\",t)}}else this._notify(\"warning\",\"æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼Œè¿æ¥é…’é¦†åå°†è‡ªåŠ¨åŒæ­¥\",\"ğŸ“´ ç¦»çº¿æ¨¡å¼\");return this._syncInterval=setInterval(()=>this._backgroundCheck(),3e4),this._tavernAvailable},_backgroundCheck:async function(){const n=this._checkTavernAvailable();n!==this._previousState&&(n&&!this._previousState?(this._notify(\"success\",\"æ­£åœ¨åŒæ­¥æœ¬åœ°æ›´æ”¹...\",\"ğŸ”— å·²é‡æ–°è¿æ¥é…’é¦†\"),await this._processSyncQueue()):!n&&this._previousState&&this._notify(\"warning\",\"æ•°æ®å°†æš‚å­˜æœ¬åœ°ï¼Œæ¢å¤è¿æ¥åè‡ªåŠ¨åŒæ­¥\",\"ğŸ“´ é…’é¦†è¿æ¥å·²æ–­å¼€\"),this._previousState=n),this._tavernAvailable=n,n&&await this._processSyncQueue()},_checkTavernAvailable:function(){try{const n=window.parent||window;if(n.SillyTavern&&\"function\"==typeof n.SillyTavern.getContext){const t=n.SillyTavern.getContext();return!(!t||!t.extensionSettings)}return!1}catch(n){return!1}},_getExtensionSettings:function(){try{const n=window.parent||window;if(!n.SillyTavern?.getContext)return null;const t=n.SillyTavern.getContext();return t?.extensionSettings?(t.extensionSettings[this.EXTENSION_NAME]||(t.extensionSettings[this.EXTENSION_NAME]={}),t.extensionSettings[this.EXTENSION_NAME]):null}catch(t){return n.warn(\"[TavernSettingsSync] Failed to get extension settings:\",t),null}},_getChatMetadata:function(){try{const n=window.parent||window;if(n.chat_metadata)return n.chat_metadata;if(n.SillyTavern?.getContext){const t=n.SillyTavern.getContext();if(t.chatMetadata)return t.chatMetadata}return null}catch(n){return null}},_saveChatMetadata:async function(){try{const n=window.parent||window;if(\"function\"==typeof n.saveChatDebounced)return n.saveChatDebounced(),!0;if(n.SillyTavern?.getContext){const t=n.SillyTavern.getContext();if(\"function\"==typeof t.saveChatDebounced)return t.saveChatDebounced(),!0}return!1}catch(n){return!1}},saveToChat:async function(t,e){try{const n=this._getChatMetadata();if(n)return n.extensions||(n.extensions={}),n.extensions[this.EXTENSION_NAME]||(n.extensions[this.EXTENSION_NAME]={}),n.extensions[this.EXTENSION_NAME][t]=e,await this._saveChatMetadata()}catch(t){n.warn(\"[TavernSettingsSync] Save to chat failed:\",t)}return!1},getFromChat:function(n){try{const t=this._getChatMetadata();if(t?.extensions?.[this.EXTENSION_NAME])return t.extensions[this.EXTENSION_NAME][n]}catch(n){}},deleteFromChat:async function(n){try{const t=this._getChatMetadata();if(t?.extensions?.[this.EXTENSION_NAME])return delete t.extensions[this.EXTENSION_NAME][n],await this._saveChatMetadata()}catch(n){}return!1},syncToTavern:async function(t,e){if(!this._tavernAvailable)return await this._addToSyncQueue(t,e),!1;try{const n=this._getExtensionSettings();if(n){n[t]=e;if(await this._saveTavernSettings())return await this._removeFromSyncQueue(t),!0}}catch(t){n.warn(\"[TavernSettingsSync] Sync to tavern failed:\",t)}return await this._addToSyncQueue(t,e),!1},_saveTavernSettings:async function(){try{const n=window.parent||window;if(!n.SillyTavern?.getContext)return!1;const t=n.SillyTavern.getContext().saveSettingsDebounced;return\"function\"==typeof t&&(t(),!0)}catch(t){return n.warn(\"[TavernSettingsSync] Failed to save Tavern settings:\",t),!1}},getSetting:async function(n,e=null){if(this._tavernAvailable){const e=this._getExtensionSettings();if(e&&void 0!==e[n]){try{const a=await t.getSetting(n);JSON.stringify(a)!==JSON.stringify(e[n])&&await t.setSetting(n,e[n])}catch(a){await t.setSetting(n,e[n])}return e[n]}}const a=await t.getSetting(n);return null!=a?a:e},setSetting:async function(e,a){if(await t.setSetting(e,a),this._tavernAvailable){try{const n=this._getExtensionSettings();if(n){n[e]=a;if(await this._saveTavernSettings())return await this._removeFromSyncQueue(e),!0}}catch(t){n.warn(\"[TavernSettingsSync] Tavern save failed:\",t)}await this._addToSyncQueue(e,a)}else await this._addToSyncQueue(e,a);return!1},_addToSyncQueue:async function(e,a){try{let n=await this._getSyncQueue();n[e]={value:a,timestamp:Date.now()},await t.setSetting(this.SYNC_QUEUE_KEY,JSON.stringify(n))}catch(t){n.error(\"[TavernSettingsSync] Failed to add to sync queue:\",t)}},_removeFromSyncQueue:async function(e){try{let n=await this._getSyncQueue();n[e]&&(delete n[e],await t.setSetting(this.SYNC_QUEUE_KEY,JSON.stringify(n)))}catch(t){n.error(\"[TavernSettingsSync] Failed to remove from sync queue:\",t)}},_getSyncQueue:async function(){try{const n=await t.getSetting(this.SYNC_QUEUE_KEY);return n?\"string\"==typeof n?JSON.parse(n):n:{}}catch(n){return{}}},_processSyncQueue:async function(){if(!this._tavernAvailable)return;const e=await this._getSyncQueue(),a=Object.keys(e);if(0===a.length)return;n.info(`[TavernSettingsSync] Processing ${a.length} pending items...`);let r=0;try{const o=this._getExtensionSettings();if(!o)throw new Error(\"Extension settings not accessible\");for(const n of a){const{value:t}=e[n];o[n]=t,r++}await this._saveTavernSettings()?(await t.setSetting(this.SYNC_QUEUE_KEY,\"{}\"),this._notify(\"success\",`${r} é¡¹è®¾ç½®å·²åŒæ­¥åˆ°é…’é¦†`,\"âœ… åŒæ­¥å®Œæˆ\")):n.warn(\"[TavernSettingsSync] Save triggered but returned false\")}catch(t){n.error(\"[TavernSettingsSync] Sync processing failed:\",t),this._notify(\"error\",\"è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\",\"âŒ åŒæ­¥å¤±è´¥\")}},forceSync:async function(){return this._tavernAvailable=this._checkTavernAvailable(),!!this._tavernAvailable&&(await this._processSyncQueue(),!0)},getStatus:async function(){const n=await this._getSyncQueue(),t=Object.keys(n).length;return{connected:this._tavernAvailable,pendingSync:t,statusText:this._tavernAvailable?t>0?`â˜ï¸ åœ¨çº¿ (${t} å¾…åŒæ­¥)`:\"â˜ï¸ åœ¨çº¿åŒæ­¥\":\"ğŸ“´ ç¦»çº¿æ¨¡å¼\",statusClass:this._tavernAvailable?t>0?\"warning\":\"success\":\"warning\"}}},a=()=>{try{const n=window.parent||window,t=window.jQuery,e=n.jQuery;return{window:n,$:t||e,getDB:()=>n.AutoCardUpdaterAPI||window.AutoCardUpdaterAPI}}catch(n){return console.error(\"[DND Dashboard] getCore Error:\",n),{window:window,$:window.jQuery,getDB:()=>window.AutoCardUpdaterAPI}}},r=async(n,t)=>{await e.setSetting(n,t)},o={Z_INDEX:{TOGGLE_BTN:2147483641,MINI_HUD:2147483640,DASHBOARD:2147483642,CHAR_DETAIL:2147483643,POPUP_BACKDROP:2147483644,POPUP:2147483645,AVATAR_DIALOG:2147483650},SIZE:{TOGGLE_BTN:40,MINI_HUD_WIDTH:350,CHAR_CARD_WIDTH:380,MINIMAP_SIZE:180,AVATAR_DEFAULT:40,AVATAR_LARGE:48},ANIMATION:{FADE_DURATION:200,SLIDE_DURATION:300,DEBOUNCE_DELAY:150},DICE_POOL:{MIN_ROWS:6,TARGET_ROWS:20,REFILL_COOLDOWN:3e3},STORAGE_KEYS:{TOGGLE_POS:\"dnd_toggle_pos\",PARTY_EXPANDED:\"dnd_party_expanded\",THEME:\"dnd_theme\",CUSTOM_THEME:\"dnd_custom_theme\",MAP_ZOOM:\"dnd_map_zoom\",PRESET_CONFIG:\"dnd_preset_config\",QUICK_SLOTS:\"dnd_quick_slots\",SYNC_QUEUE:\"dnd_sync_queue\",UI_SCALE:\"dnd_ui_scale\",DYNAMIC_BG:\"dnd_dynamic_bg\",CURRENT_STYLE:\"dnd_current_style\",CUSTOM_STYLES:\"dnd_custom_styles\"},UI_SCALE:{MIN:.5,MAX:2,DEFAULT:1,STEP:.1},DYNAMIC_BG:{enabled:!0,type:\"particles\",intensity:1},MAP_ZOOM:{MIN:.5,MAX:3,DEFAULT:1,STEP:.15},THEMES:{dark:{name:\"æš—é»‘åŸå ¡\",icon:\"ğŸ°\",vars:{\"--dnd-bg-main\":\"#0f0b0a\",\"--dnd-bg-panel-start\":\"#2b1b17\",\"--dnd-bg-panel-end\":\"#1a100e\",\"--dnd-bg-card-start\":\"#242424\",\"--dnd-bg-card-end\":\"#1a1a1c\",\"--dnd-bg-panel\":\"linear-gradient(to bottom, #2b1b17, #1a100e)\",\"--dnd-bg-card\":\"linear-gradient(135deg, #242424 0%, #1a1a1c 100%)\",\"--dnd-bg-hud\":\"linear-gradient(to bottom, #2b1b17, #1a100e)\",\"--dnd-bg-popup\":\"linear-gradient(to bottom, rgba(28, 28, 30, 0.99), rgba(18, 18, 20, 0.99))\",\"--dnd-bg-item\":\"rgba(255,255,255,0.03)\",\"--dnd-border-gold\":\"#9d8b6c\",\"--dnd-border-inner\":\"#5c4b35\",\"--dnd-text-main\":\"#dcd0c0\",\"--dnd-text-header\":\"#e6dcca\",\"--dnd-text-highlight\":\"#ffdb85\",\"--dnd-text-dim\":\"#888\",\"--dnd-accent-red\":\"#8a2c2c\",\"--dnd-accent-green\":\"#3a6b4a\",\"--dnd-accent-blue\":\"#2c4c8a\",\"--dnd-shadow\":\"0 5px 20px rgba(0,0,0,0.8)\"}},forest:{name:\"ç²¾çµæ£®æ—\",icon:\"ğŸŒ²\",vars:{\"--dnd-bg-main\":\"#0c1210\",\"--dnd-bg-panel-start\":\"#1a2b22\",\"--dnd-bg-panel-end\":\"#0e1a14\",\"--dnd-bg-card-start\":\"#1c2e24\",\"--dnd-bg-card-end\":\"#0f1c16\",\"--dnd-bg-panel\":\"linear-gradient(to bottom, #1a2b22, #0e1a14)\",\"--dnd-bg-card\":\"linear-gradient(135deg, #1c2e24 0%, #0f1c16 100%)\",\"--dnd-bg-hud\":\"linear-gradient(to bottom, #1a2b22, #0e1a14)\",\"--dnd-bg-popup\":\"linear-gradient(to bottom, rgba(20, 32, 26, 0.99), rgba(10, 20, 16, 0.99))\",\"--dnd-bg-item\":\"rgba(255,255,255,0.05)\",\"--dnd-border-gold\":\"#5a8a6a\",\"--dnd-border-inner\":\"#2c4a3a\",\"--dnd-text-main\":\"#c0dcd0\",\"--dnd-text-header\":\"#cae6da\",\"--dnd-text-highlight\":\"#85ffb5\",\"--dnd-text-dim\":\"#6a8a7a\",\"--dnd-accent-red\":\"#8a4a4a\",\"--dnd-accent-green\":\"#3a8b5a\",\"--dnd-accent-blue\":\"#2c6c8a\",\"--dnd-shadow\":\"0 5px 20px rgba(0,20,10,0.8)\"}},crimson:{name:\"è¡€è‰²æ·±æ¸Š\",icon:\"ğŸ”¥\",vars:{\"--dnd-bg-main\":\"#120808\",\"--dnd-bg-panel-start\":\"#2b1717\",\"--dnd-bg-panel-end\":\"#1a0e0e\",\"--dnd-bg-card-start\":\"#2e1c1c\",\"--dnd-bg-card-end\":\"#1c0f0f\",\"--dnd-bg-panel\":\"linear-gradient(to bottom, #2b1717, #1a0e0e)\",\"--dnd-bg-card\":\"linear-gradient(135deg, #2e1c1c 0%, #1c0f0f 100%)\",\"--dnd-bg-hud\":\"linear-gradient(to bottom, #2b1717, #1a0e0e)\",\"--dnd-bg-popup\":\"linear-gradient(to bottom, rgba(32, 20, 20, 0.99), rgba(20, 10, 10, 0.99))\",\"--dnd-bg-item\":\"rgba(255,200,200,0.03)\",\"--dnd-border-gold\":\"#8a5a5a\",\"--dnd-border-inner\":\"#4a2c2c\",\"--dnd-text-main\":\"#dcc0c0\",\"--dnd-text-header\":\"#e6cada\",\"--dnd-text-highlight\":\"#ff8585\",\"--dnd-text-dim\":\"#8a6a6a\",\"--dnd-accent-red\":\"#a82c2c\",\"--dnd-accent-green\":\"#4a6b4a\",\"--dnd-accent-blue\":\"#4a2c8a\",\"--dnd-shadow\":\"0 5px 20px rgba(20,0,0,0.8)\"}},arcane:{name:\"å¥¥æœ¯å¡”æ¥¼\",icon:\"ğŸ”®\",vars:{\"--dnd-bg-main\":\"#0a0a14\",\"--dnd-bg-panel-start\":\"#1a1a2e\",\"--dnd-bg-panel-end\":\"#0e0e1a\",\"--dnd-bg-card-start\":\"#1c1c2e\",\"--dnd-bg-card-end\":\"#0f0f1c\",\"--dnd-bg-panel\":\"linear-gradient(to bottom, #1a1a2e, #0e0e1a)\",\"--dnd-bg-card\":\"linear-gradient(135deg, #1c1c2e 0%, #0f0f1c 100%)\",\"--dnd-bg-hud\":\"linear-gradient(to bottom, #1a1a2e, #0e0e1a)\",\"--dnd-bg-popup\":\"linear-gradient(to bottom, rgba(20, 20, 36, 0.99), rgba(10, 10, 20, 0.99))\",\"--dnd-bg-item\":\"rgba(200,200,255,0.03)\",\"--dnd-border-gold\":\"#6a6a9d\",\"--dnd-border-inner\":\"#3a3a5a\",\"--dnd-text-main\":\"#c0c0dc\",\"--dnd-text-header\":\"#cacaE6\",\"--dnd-text-highlight\":\"#b585ff\",\"--dnd-text-dim\":\"#6a6a8a\",\"--dnd-accent-red\":\"#8a2c6c\",\"--dnd-accent-green\":\"#2c6b8a\",\"--dnd-accent-blue\":\"#3a5a8b\",\"--dnd-shadow\":\"0 5px 20px rgba(10,10,30,0.8)\"}}},PRESET_SWITCHING:{COMBAT_PRESET:\"æˆ˜æ–—æ¨è¿›\",EXPLORE_PRESET:\"å¥¶é¾™æ¨è¿›\",ENABLED:!0}},i=\"dnd_immersive_dashboard\",d=()=>{const{$:n}=a();if(!n)return;if(n(`#${i}-styles`).length)return;n(\"head\").append(`<style id=\"${i}-styles\">\\n        :root {\\n            /* ====== é¢œè‰²å˜é‡ ====== */\\n            --dnd-bg-main: #0f0b0a;\\n            --dnd-bg-panel-start: #2b1b17;\\n            --dnd-bg-panel-end: #1a100e;\\n            --dnd-bg-card-start: #242424;\\n            --dnd-bg-card-end: #1a1a1c;\\n            --dnd-bg-panel: linear-gradient(to bottom, var(--dnd-bg-panel-start), var(--dnd-bg-panel-end));\\n            --dnd-bg-card: linear-gradient(135deg, var(--dnd-bg-card-start) 0%, var(--dnd-bg-card-end) 100%);\\n            --dnd-bg-hud: linear-gradient(to bottom, var(--dnd-bg-panel-start), var(--dnd-bg-panel-end));\\n            --dnd-bg-popup: linear-gradient(to bottom, rgba(28, 28, 30, 0.99), rgba(18, 18, 20, 0.99));\\n            --dnd-bg-item: rgba(255,255,255,0.03);\\n            --dnd-bg-slot: rgba(0, 0, 0, 0.5);\\n            --dnd-border-gold: #9d8b6c;\\n            --dnd-border-inner: #5c4b35;\\n            --dnd-text-main: #dcd0c0;\\n            --dnd-text-header: #e6dcca;\\n            --dnd-text-highlight: #ffdb85;\\n            --dnd-text-dim: #888;\\n            --dnd-accent-red: #8a2c2c;\\n            --dnd-accent-green: #3a6b4a;\\n            --dnd-accent-blue: #2c4c8a;\\n            --dnd-shadow: 0 0 10px rgba(0,0,0,0.8);\\n            \\n            /* ====== å­—ä½“å˜é‡ ====== */\\n            --dnd-font-serif: 'Times New Roman', 'Songti SC', 'SimSun', serif;\\n            --dnd-font-sans: 'Segoe UI', 'Microsoft YaHei', sans-serif;\\n            --dnd-font-size-xs: 10px;\\n            --dnd-font-size-sm: 12px;\\n            --dnd-font-size-md: 14px;\\n            --dnd-font-size-lg: 16px;\\n            --dnd-font-size-xl: 18px;\\n            \\n            /* ====== åœ†è§’å˜é‡ ====== */\\n            --dnd-radius-sm: 4px;\\n            --dnd-radius-md: 6px;\\n            --dnd-radius-lg: 8px;\\n            \\n            /* ====== é—´è·å˜é‡ ====== */\\n            --dnd-spacing-xs: 4px;\\n            --dnd-spacing-sm: 8px;\\n            --dnd-spacing-md: 12px;\\n            --dnd-spacing-lg: 20px;\\n            \\n            /* ====== é˜´å½±å˜é‡ ====== */\\n            --dnd-shadow-sm: 0 2px 5px rgba(0,0,0,0.4);\\n            --dnd-shadow-md: 0 4px 15px rgba(0,0,0,0.5);\\n            --dnd-shadow-lg: 0 8px 25px rgba(0,0,0,0.6);\\n            \\n            /* ====== è¿‡æ¸¡åŠ¨ç”»å˜é‡ ====== */\\n            --dnd-transition-fast: 0.15s ease;\\n            --dnd-transition-normal: 0.25s ease;\\n            --dnd-transition-slow: 0.4s ease;\\n            \\n            /* ====== å½¢æ€å˜é‡ (Morphology) ====== */\\n            /* è¾¹æ¡†å½¢æ€ */\\n            --dnd-border-style: solid;\\n            --dnd-border-width: 1px;\\n            --dnd-border-double-width: 3px;\\n            --dnd-border-outer-style: solid;\\n            \\n            /* è§’éƒ¨å½¢æ€: 'rounded' | 'chamfer' | 'notched' | 'angular' */\\n            --dnd-corner-clip: none;\\n            --dnd-card-clip-path: none;\\n            \\n            /* å¡ç‰‡å½¢æ€ */\\n            --dnd-card-shape: rectangle;\\n            --dnd-card-aspect-ratio: auto;\\n            --dnd-card-skew: 0deg;\\n            --dnd-card-perspective: none;\\n            --dnd-card-decoration: none;\\n            \\n            /* è£…é¥°å…ƒç´  */\\n            --dnd-corner-ornament: none;\\n            --dnd-divider-style: solid;\\n            --dnd-divider-ornament: none;\\n            --dnd-header-decoration: none;\\n            \\n            /* ç‰¹æ•ˆå±‚ */\\n            --dnd-effect-overlay: none;\\n            --dnd-effect-inner-glow: none;\\n            --dnd-effect-border-glow: none;\\n            --dnd-effect-emboss: none;\\n            --dnd-effect-texture: none;\\n            \\n            /* å¸ƒå±€å¯†åº¦ */\\n            --dnd-layout-density: normal;\\n            --dnd-card-min-width: 280px;\\n            --dnd-card-max-width: 1fr;\\n            --dnd-grid-gap: 15px;\\n            \\n            /* å›¾æ ‡å®¹å™¨å½¢æ€ */\\n            --dnd-icon-shape: circle;\\n            --dnd-icon-border-style: solid;\\n            --dnd-avatar-shape: circle;\\n            \\n            /* æŒ‰é’®å½¢æ€ */\\n            --dnd-btn-shape: rounded;\\n            --dnd-btn-style: filled;\\n            \\n            /* è¿›åº¦æ¡å½¢æ€ */\\n            --dnd-bar-shape: rounded;\\n            --dnd-bar-style: gradient;\\n            --dnd-bar-segments: 0;\\n            \\n            /* ====== åŠŸèƒ½æ€§é¢œè‰²å˜é‡ ====== */\\n            /* è¿›åº¦æ¡é¢œè‰² */\\n            --dnd-bar-hp-start: #8a2c2c;\\n            --dnd-bar-hp-end: #c0392b;\\n            --dnd-bar-exp-start: #8e44ad;\\n            --dnd-bar-exp-end: #9b59b6;\\n            --dnd-bar-bg: #222;\\n            \\n            /* è£…é¥°å…ƒç´ é¢œè‰² */\\n            --dnd-ornament-color: var(--dnd-border-gold);\\n            --dnd-logo-bg-start: #2a2a2e;\\n            --dnd-logo-bg-end: #1a1a1c;\\n            \\n            /* æ¬¡è¦èƒŒæ™¯è‰² */\\n            --dnd-bg-secondary: #222;\\n            --dnd-bg-tertiary: #333;\\n            --dnd-bg-input: #1a1a1c;\\n            --dnd-border-subtle: #444;\\n            \\n            /* ç¨€æœ‰åº¦é¢œè‰² */\\n            --dnd-rarity-common-bg: #555;\\n            --dnd-rarity-common-text: #ccc;\\n            --dnd-rarity-uncommon-bg: #1a5c1a;\\n            --dnd-rarity-uncommon-text: #5f5;\\n            --dnd-rarity-rare-bg: #1a3a6c;\\n            --dnd-rarity-rare-text: #5af;\\n            --dnd-rarity-veryrare-bg: #5c1a5c;\\n            --dnd-rarity-veryrare-text: #f5f;\\n            --dnd-rarity-legendary-bg: #6c4a1a;\\n            --dnd-rarity-legendary-text: #fa5;\\n            \\n            /* Toast/é€šçŸ¥é¢œè‰² */\\n            --dnd-toast-info: #3498db;\\n            --dnd-toast-success: #2ecc71;\\n            --dnd-toast-warning: #f39c12;\\n            --dnd-toast-error: #e74c3c;\\n            \\n            /* åè‰²æ–‡æœ¬ (ç”¨äºäº®èƒŒæ™¯) */\\n            --dnd-text-inverse: #000;\\n            --dnd-text-inverse-dark: #2b1b17;\\n            \\n            /* ====== äº¤äº’çŠ¶æ€å˜é‡ (Interactive States) ====== */\\n            /* æ‚¬æµ®æ•ˆæœ (Hover) */\\n            --dnd-hover-brightness: 1.1;\\n            --dnd-hover-scale: 1.02;\\n            --dnd-hover-lift: -3px;\\n            --dnd-hover-shadow: 0 8px 25px rgba(0,0,0,0.4);\\n            --dnd-hover-border-color: var(--dnd-border-gold);\\n            --dnd-hover-glow: none;\\n            --dnd-hover-transition: var(--dnd-transition-normal);\\n            \\n            /* å¡ç‰‡æ‚¬æµ® */\\n            --dnd-card-hover-transform: translateY(-8px) rotateX(3deg) rotateY(-2deg) scale(1.02);\\n            --dnd-card-hover-shadow: 0 20px 40px rgba(0,0,0,0.5), 0 0 30px rgba(157, 139, 108, 0.15);\\n            --dnd-card-hover-border-color: var(--dnd-border-gold);\\n            \\n            /* æŒ‰é’®æ‚¬æµ® */\\n            --dnd-btn-hover-brightness: 1.15;\\n            --dnd-btn-hover-transform: translateY(-2px);\\n            --dnd-btn-hover-shadow: 0 4px 12px rgba(0,0,0,0.3);\\n            \\n            /* ç‚¹å‡»æ•ˆæœ (Active/Pressed) */\\n            --dnd-active-scale: 0.96;\\n            --dnd-active-brightness: 0.95;\\n            --dnd-active-transform: translateY(1px) scale(0.96);\\n            --dnd-active-shadow: 0 2px 5px rgba(0,0,0,0.3);\\n            \\n            /* æŒ‰é’®ç‚¹å‡» */\\n            --dnd-btn-active-transform: translateY(0) scale(0.98);\\n            --dnd-btn-active-shadow: 0 1px 3px rgba(0,0,0,0.2);\\n            \\n            /* é€‰ä¸­çŠ¶æ€ (Selected/Active Class) */\\n            --dnd-selected-bg: linear-gradient(90deg, rgba(157, 139, 108, 0.2), transparent);\\n            --dnd-selected-border-color: var(--dnd-text-highlight);\\n            --dnd-selected-border-width: 2px;\\n            --dnd-selected-glow: 0 0 10px rgba(157, 139, 108, 0.3);\\n            --dnd-selected-text-color: var(--dnd-text-highlight);\\n            \\n            /* å¯¼èˆªé€‰ä¸­ */\\n            --dnd-nav-active-bg: linear-gradient(90deg, rgba(157, 139, 108, 0.2), transparent);\\n            --dnd-nav-active-border: 3px solid var(--dnd-text-highlight);\\n            --dnd-nav-active-indicator: var(--dnd-text-highlight);\\n            \\n            /* èšç„¦çŠ¶æ€ (Focus) */\\n            --dnd-focus-border-color: var(--dnd-border-gold);\\n            --dnd-focus-shadow: 0 0 0 3px rgba(157, 139, 108, 0.2);\\n            --dnd-focus-outline: none;\\n            \\n            /* ç¦ç”¨çŠ¶æ€ (Disabled) */\\n            --dnd-disabled-opacity: 0.5;\\n            --dnd-disabled-cursor: not-allowed;\\n            --dnd-disabled-filter: grayscale(0.5);\\n            \\n            /* å›¾æ ‡æ‚¬æµ®å…‰æ™• */\\n            --dnd-icon-hover-glow: drop-shadow(0 0 5px currentColor);\\n            --dnd-icon-hover-scale: 1.1;\\n            \\n            /* è¾“å…¥æ¡†èšç„¦ */\\n            --dnd-input-focus-border: var(--dnd-border-gold);\\n            --dnd-input-focus-shadow: 0 0 0 2px rgba(157, 139, 108, 0.15);\\n        }\\n\\n        /* ç½‘æ ¼å¸ƒå±€ */\\n        .dnd-grid {\\n            display: grid !important;\\n            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;\\n            gap: 15px !important;\\n            padding: 10px !important;\\n        }\\n\\n        /* å¡ç‰‡é€šç”¨æ ·å¼ */\\n        .dnd-char-card {\\n            background: var(--dnd-bg-card) !important;\\n            /* Morphology: Border */\\n            border: var(--dnd-border-width, 1px) var(--dnd-border-style, solid) var(--dnd-border-inner) !important;\\n            outline: var(--dnd-border-outer-style, none) !important; /* Outer border simulation */\\n            border-radius: var(--dnd-radius-md, 6px) !important;\\n            overflow: hidden !important;\\n            transition: all var(--dnd-transition-normal, 0.2s) !important;\\n            /* Combine standard shadow with glow effects */\\n            box-shadow: var(--dnd-shadow-md, 0 4px 15px rgba(0,0,0,0.3)), var(--dnd-effect-border-glow, none), var(--dnd-effect-inner-glow, none) !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            \\n            /* Morphology: Shape & Transform */\\n            clip-path: var(--dnd-card-clip-path, none) !important;\\n            transform: var(--dnd-card-transform, none) !important;\\n            position: relative !important;\\n        }\\n        \\n        /* Morphology: Texture & Effects Layer */\\n        .dnd-char-card::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0;\\n            background: var(--dnd-effect-texture, none) !important;\\n            opacity: 1 !important;\\n            pointer-events: none !important;\\n            z-index: 0 !important;\\n            mix-blend-mode: overlay !important;\\n        }\\n        .dnd-char-card::after {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0;\\n            background: var(--dnd-effect-overlay, none) !important;\\n            opacity: 1 !important;\\n            pointer-events: none !important;\\n            z-index: 1 !important;\\n        }\\n        \\n        .dnd-char-card:hover {\\n            border-color: var(--dnd-card-hover-border-color, var(--dnd-border-gold)) !important;\\n            /* Preserve transform but allow hover lift if not using complex transform */\\n            transform: var(--dnd-card-hover-transform, translateY(-4px)) !important;\\n            box-shadow: var(--dnd-card-hover-shadow, 0 8px 25px rgba(0,0,0,0.5)) !important;\\n            z-index: 10 !important;\\n        }\\n\\n        /* é£æ ¼é€‰æ‹©å¡ç‰‡ - æ”¯æŒ Morphology */\\n        .dnd-style-card {\\n            padding: 12px !important;\\n            background: rgba(0,0,0,0.3) !important;\\n            /* Morphology Support */\\n            border: var(--dnd-border-width, 1px) var(--dnd-border-style, solid) var(--dnd-border-subtle) !important;\\n            border-radius: var(--dnd-radius-md, 6px) !important;\\n            cursor: pointer !important;\\n            text-align: center !important;\\n            transition: all 0.2s !important;\\n            position: relative !important;\\n            overflow: hidden !important;\\n            \\n            /* Morphology Shape */\\n            clip-path: var(--dnd-card-clip-path, none) !important;\\n            transform: var(--dnd-card-transform, none) !important;\\n        }\\n        \\n        /* çº¹ç†å åŠ  */\\n        .dnd-style-card::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0;\\n            background: var(--dnd-effect-texture, none) !important;\\n            opacity: 0.5 !important;\\n            pointer-events: none !important;\\n            z-index: 0 !important;\\n            mix-blend-mode: overlay !important;\\n        }\\n        \\n        .dnd-style-card.active {\\n            background: rgba(157, 139, 108, 0.2) !important;\\n            border-color: var(--dnd-border-gold) !important;\\n        }\\n        \\n        .dnd-style-card:hover {\\n            border-color: var(--dnd-border-gold) !important;\\n            transform: var(--dnd-card-transform, none) translateY(-2px) !important;\\n        }\\n\\n        .dnd-card-header {\\n            padding: 10px 12px !important;\\n            background: rgba(255,255,255,0.03) !important;\\n            border-bottom: 1px var(--dnd-divider-style, solid) var(--dnd-border-inner) !important;\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            position: relative !important;\\n            z-index: 2 !important; /* Ensure content is above effects */\\n        }\\n        .dnd-char-name {\\n            font-family: var(--dnd-font-serif) !important;\\n            font-size: 16px !important;\\n            font-weight: bold !important;\\n            color: var(--dnd-text-header) !important;\\n            text-shadow: 0 0 5px rgba(0,0,0,0.5) !important;\\n        }\\n        .dnd-char-lvl {\\n            font-size: 11px !important;\\n            color: var(--dnd-text-dim) !important;\\n            margin-top: 2px !important;\\n        }\\n\\n        .dnd-card-body {\\n            padding: 12px !important;\\n            flex: 1 !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            gap: 8px !important;\\n            color: var(--dnd-text-main) !important;\\n            font-size: 13px !important;\\n            position: relative !important;\\n            z-index: 2 !important; /* Ensure content is above effects */\\n        }\\n\\n        /* å±æ€§è¡Œ */\\n        .dnd-stat-row {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            padding: 4px 8px !important;\\n            background: rgba(0,0,0,0.2) !important;\\n            border-radius: 4px !important;\\n        }\\n        .dnd-stat-label { color: var(--dnd-text-dim) !important; font-size: 12px !important; }\\n        .dnd-stat-val { font-weight: bold !important; color: var(--dnd-text-highlight) !important; }\\n\\n        /* è¿›åº¦æ¡ */\\n        .dnd-bar-container {\\n            height: 6px !important;\\n            background: rgba(0,0,0,0.5) !important;\\n            border-radius: 3px !important;\\n            overflow: hidden !important;\\n            margin-top: 2px !important;\\n        }\\n        .dnd-bar-fill { height: 100% !important; border-radius: 3px !important; transition: width 0.3s !important; }\\n        .dnd-bar-hp .dnd-bar-fill { background: linear-gradient(90deg, var(--dnd-bar-hp-start), var(--dnd-bar-hp-end)) !important; }\\n        .dnd-bar-exp .dnd-bar-fill { background: linear-gradient(90deg, var(--dnd-bar-exp-start), var(--dnd-bar-exp-end)) !important; }\\n\\n        /* å¯¼èˆªä¾§è¾¹æ  */\\n        .dnd-nav-sidebar {\\n            width: 200px !important;\\n            background: var(--dnd-bg-hud) !important;\\n            border-right: var(--dnd-border-width, 1px) var(--dnd-divider-style, solid) var(--dnd-border-inner) !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            padding: 10px 0 !important;\\n            flex-shrink: 0 !important;\\n            position: relative !important;\\n            \\n            /* Morphology support */\\n            background-image: var(--dnd-effect-texture, none) !important;\\n        }\\n        \\n        /* ä¾§è¾¹æ çº¹ç†å±‚ */\\n        .dnd-nav-sidebar::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0 !important;\\n            background: var(--dnd-effect-overlay, none) !important;\\n            pointer-events: none !important;\\n            z-index: 0 !important;\\n        }\\n        \\n        .dnd-nav-item {\\n            padding: 12px 20px !important;\\n            cursor: pointer !important;\\n            color: var(--dnd-text-main) !important;\\n            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n            border-left: var(--dnd-border-width, 3px) solid transparent !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            gap: 10px !important;\\n            font-size: 14px !important;\\n            position: relative !important;\\n            z-index: 1 !important;\\n            overflow: hidden !important;\\n            \\n            /* Morphology support */\\n            border-radius: 0 var(--dnd-radius-md, 6px) var(--dnd-radius-md, 6px) 0 !important;\\n            margin-bottom: 2px !important;\\n        }\\n        \\n        /* å¯¼èˆªé¡¹æ‚¬åœ - æ›´åŠ æ˜æ˜¾çš„æ»‘åŠ¨å…‰æ•ˆ */\\n        .dnd-nav-item::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; bottom: 0; right: 0;\\n            background: linear-gradient(90deg, rgba(157, 139, 108, 0.15), transparent) !important;\\n            transform: translateX(-100%) !important;\\n            transition: transform 0.3s ease-out !important;\\n            z-index: -1 !important;\\n        }\\n        .dnd-nav-item:hover::before {\\n            transform: translateX(0) !important;\\n        }\\n        \\n        .dnd-nav-item:hover {\\n            color: var(--dnd-selected-text-color, var(--dnd-text-highlight)) !important;\\n            padding-left: 25px !important; /* æ‚¬åœæ—¶è½»å¾®å³ç§» */\\n            text-shadow: 0 0 8px rgba(255, 219, 133, 0.4) !important;\\n        }\\n        \\n        .dnd-nav-item.active {\\n            background: var(--dnd-nav-active-bg, linear-gradient(90deg, rgba(157, 139, 108, 0.2), transparent)) !important;\\n            border-left-color: var(--dnd-nav-active-indicator, var(--dnd-border-gold)) !important;\\n            color: var(--dnd-selected-text-color, var(--dnd-text-highlight)) !important;\\n            text-shadow: 0 0 10px rgba(255, 219, 133, 0.6) !important;\\n            font-weight: bold !important;\\n        }\\n        \\n        /* é€‰ä¸­çŠ¶æ€çš„å…‰æ™• */\\n        .dnd-nav-item.active::after {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            left: 0; top: 0; bottom: 0;\\n            width: 4px;\\n            background: var(--dnd-nav-active-indicator, var(--dnd-border-gold)) !important;\\n            box-shadow: var(--dnd-selected-glow, 0 0 15px var(--dnd-border-gold)) !important;\\n        }\\n\\n        /* å†…å®¹åŒºåŸŸ */\\n        .dnd-content-area {\\n            flex: 1 !important;\\n            overflow-y: auto !important;\\n            padding: 20px !important;\\n            background: radial-gradient(circle at center, rgba(30,30,35,0.8) 0%, rgba(10,10,12,0.9) 100%) !important;\\n        }\\n\\n        /* æ»šåŠ¨æ¡ç¾åŒ– */\\n        .dnd-detail-body::-webkit-scrollbar,\\n        .dnd-content-area::-webkit-scrollbar,\\n        .dnd-hud-party-stats::-webkit-scrollbar,\\n        .dnd-party-list::-webkit-scrollbar,\\n        .dnd-hud-minimap::-webkit-scrollbar {\\n            width: 6px !important;\\n            height: 6px !important;\\n        }\\n        .dnd-detail-body::-webkit-scrollbar-track,\\n        .dnd-content-area::-webkit-scrollbar-track,\\n        .dnd-hud-party-stats::-webkit-scrollbar-track,\\n        .dnd-party-list::-webkit-scrollbar-track,\\n        .dnd-hud-minimap::-webkit-scrollbar-track {\\n            background: rgba(0,0,0,0.2) !important;\\n        }\\n        .dnd-detail-body::-webkit-scrollbar-thumb,\\n        .dnd-content-area::-webkit-scrollbar-thumb,\\n        .dnd-hud-party-stats::-webkit-scrollbar-thumb,\\n        .dnd-party-list::-webkit-scrollbar-thumb,\\n        .dnd-hud-minimap::-webkit-scrollbar-thumb {\\n            background: var(--dnd-border-inner) !important;\\n            border-radius: 3px !important;\\n        }\\n        .dnd-detail-body::-webkit-scrollbar-thumb:hover,\\n        .dnd-content-area::-webkit-scrollbar-thumb:hover,\\n        .dnd-hud-party-stats::-webkit-scrollbar-thumb:hover,\\n        .dnd-party-list::-webkit-scrollbar-thumb:hover,\\n        .dnd-hud-minimap::-webkit-scrollbar-thumb:hover {\\n            background: var(--dnd-border-gold) !important;\\n        }\\n\\n        /* è§’è‰²è¯¦æƒ…å¡å…¥åœºåŠ¨ç”» */\\n        @keyframes dnd-card-in {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.92) translateY(-15px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n        \\n        /* [æ–°å¢] æ·¡å‡ºåŠ¨ç”» */\\n        @keyframes dnd-fade-out {\\n            0% {\\n                opacity: 1;\\n                transform: scale(1);\\n            }\\n            100% {\\n                opacity: 0;\\n                transform: scale(0.95);\\n            }\\n        }\\n        \\n        @keyframes dnd-slide-out-left {\\n            0% {\\n                opacity: 1;\\n                transform: translateX(0);\\n            }\\n            100% {\\n                opacity: 0;\\n                transform: translateX(-30px);\\n            }\\n        }\\n\\n        /* è§’è‰²è¯¦æƒ…å¡ - åŠ¨æ€å®šä½ç‰ˆæœ¬ (ä½¿ç”¨ block å¸ƒå±€) */\\n        .dnd-char-detail-card {\\n            position: fixed !important;\\n            /* ä¸å†ä½¿ç”¨å›ºå®šçš„ top/leftï¼Œç”± JS åŠ¨æ€è®¾ç½® */\\n            width: 380px !important;\\n            max-width: 92vw !important;\\n            max-height: 85vh !important;\\n            background: var(--dnd-bg-popup) !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            border-radius: 8px !important;\\n            box-shadow: var(--dnd-shadow) !important;\\n            z-index: 2147483643 !important; /* Raised above Dashboard */\\n            color: var(--dnd-text-main) !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            overflow: hidden !important;\\n            \\n            display: none; /* é»˜è®¤éšè—ï¼Œä½¿ç”¨ display none/block æ–¹å¼ */\\n        }\\n        .dnd-char-detail-card.visible {\\n            display: block !important;\\n            animation: dnd-card-in 0.25s ease-out forwards !important;\\n        }\\n\\n        .dnd-detail-header {\\n            padding: 10px 15px !important;\\n            background: linear-gradient(to right, var(--dnd-bg-card-end), var(--dnd-bg-main)) !important;\\n            border-bottom: 1px solid var(--dnd-border-inner) !important;\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n        }\\n        .dnd-detail-close {\\n            cursor: pointer !important;\\n            padding: 5px !important;\\n            color: var(--dnd-text-dim) !important;\\n        }\\n        .dnd-detail-close:hover { color: var(--dnd-text-highlight) !important; }\\n\\n        .dnd-detail-info {\\n            flex: 1 !important;\\n            overflow: hidden !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            justify-content: center !important;\\n        }\\n        .dnd-detail-name {\\n            font-size: 18px !important;\\n            font-weight: bold !important;\\n            color: var(--dnd-text-highlight) !important;\\n            font-family: var(--dnd-font-serif) !important;\\n            white-space: nowrap !important;\\n            overflow: hidden !important;\\n            text-overflow: ellipsis !important;\\n        }\\n        .dnd-detail-sub {\\n            font-size: 12px !important;\\n            color: var(--dnd-text-dim) !important;\\n            white-space: nowrap !important;\\n            overflow: hidden !important;\\n            text-overflow: ellipsis !important;\\n        }\\n        .dnd-detail-stats-row {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            font-size: 13px !important;\\n            text-align: center !important;\\n            margin-bottom: 10px !important;\\n            padding: 0 10px !important;\\n        }\\n\\n        .dnd-detail-body {\\n            padding: 15px !important;\\n            overflow-y: auto !important;\\n            flex: 1 !important;\\n        }\\n        \\n        .dnd-attr-grid {\\n            display: grid !important;\\n            grid-template-columns: repeat(6, 1fr) !important;\\n            gap: 5px !important;\\n            margin: 15px 0 !important;\\n            background: rgba(0,0,0,0.3) !important;\\n            padding: 8px !important;\\n            border-radius: 4px !important;\\n        }\\n        .dnd-attr-box {\\n            text-align: center !important;\\n        }\\n        .dnd-attr-val { font-size: 14px !important; font-weight: bold !important; color: var(--dnd-text-header) !important; }\\n        .dnd-attr-mod { font-size: 10px !important; color: var(--dnd-text-dim) !important; }\\n        .dnd-attr-lbl { font-size: 9px !important; color: var(--dnd-text-dim) !important; margin-top: 2px !important; }\\n\\n        .dnd-detail-section { margin-bottom: 15px !important; }\\n        .dnd-detail-title {\\n            font-size: 12px !important;\\n            color: var(--dnd-text-highlight) !important;\\n            border-bottom: 1px solid var(--dnd-border-inner) !important;\\n            padding-bottom: 3px !important;\\n            margin-bottom: 8px !important;\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            cursor: pointer !important;\\n        }\\n        \\n        .dnd-tag-list { display: flex !important; flex-wrap: wrap !important; gap: 5px !important; }\\n        .dnd-tag {\\n            background: rgba(255,255,255,0.08) !important;\\n            padding: 4px 8px !important;\\n            border-radius: 4px !important;\\n            font-size: 12px !important;\\n            cursor: pointer !important;\\n            border: 1px solid transparent !important;\\n            transition: all 0.2s !important;\\n        }\\n        .dnd-tag:hover, .dnd-tag.active {\\n            background: rgba(197, 160, 89, 0.2) !important;\\n            border-color: var(--dnd-border-gold) !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n\\n        /* å…¥åœºåŠ¨ç”» keyframes */\\n        @keyframes dnd-fade-scale-in {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.9) translateY(-10px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n        \\n        @keyframes dnd-popup-in {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.85) translateY(-8px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n\\n        /* è¯¦æƒ…æ‚¬æµ®çª—é®ç½©å±‚ - ç”¨äºæ•è·ç‚¹å‡»å…³é—­ */\\n        .dnd-popup-backdrop {\\n            position: fixed !important;\\n            top: 0 !important;\\n            left: 0 !important;\\n            width: 100vw !important;\\n            height: 100vh !important;\\n            background: transparent !important;\\n            z-index: 2147483644 !important;\\n            display: none;\\n        }\\n        .dnd-popup-backdrop.visible {\\n            display: block !important;\\n        }\\n\\n        /* è¯¦æƒ…æ‚¬æµ®çª— */\\n        .dnd-detail-popup {\\n            position: fixed !important;\\n            background: var(--dnd-bg-panel) !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            padding: 12px !important;\\n            z-index: 2147483645 !important; /* Highest priority */\\n            box-shadow: 0 5px 25px rgba(0,0,0,0.9), var(--dnd-effect-border-glow, none) !important;\\n            width: auto !important;\\n            min-width: 200px !important;\\n            max-width: 90vw !important;\\n            color: var(--dnd-text-main) !important;\\n            border-radius: 4px !important;\\n            font-size: 13px !important;\\n            display: none; /* é»˜è®¤éšè—ï¼Œä¸ä½¿ç”¨ !important ä»¥ä¾¿ JS æ§åˆ¶ */\\n        }\\n        .dnd-detail-popup.visible {\\n            display: block !important;\\n            animation: dnd-popup-in 0.2s ease-out forwards !important;\\n        }\\n        .dnd-detail-popup.dnd-measuring {\\n            display: block !important;\\n        }\\n\\n        /* å…¨å±€é‡ç½® (é’ˆå¯¹ HUD å†…éƒ¨) */\\n        #dnd-dashboard-root *, \\n        #dnd-mini-hud *,\\n        #dnd-tooltip * {\\n            box-sizing: border-box !important;\\n        }\\n\\n        /* ä¸»å®¹å™¨ - æµ®åŠ¨åœ¨é¡µé¢ä¸Š */\\n        #dnd-dashboard-root {\\n            position: fixed !important;\\n            top: 0;\\n            left: 0;\\n            width: 100vw;\\n            height: 100vh;\\n            background: rgba(0,0,0,0.85) !important;\\n            z-index: 2147483642 !important;\\n            display: none;\\n            flex-direction: column;\\n            color: var(--dnd-text-main) !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            backdrop-filter: blur(5px);\\n        }\\n\\n        #dnd-dashboard-root.visible {\\n            display: flex !important;\\n        }\\n        \\n        #dnd-dashboard-root .dnd-main-container {\\n            display: flex !important;\\n            flex: 1 !important;\\n            overflow: hidden !important;\\n            width: 100% !important;\\n        }\\n\\n        /* ç‰©å“åˆ—è¡¨é¢æ¿ */\\n        .dnd-inventory-panel {\\n            position: fixed !important;\\n            background: var(--dnd-bg-panel) !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            border-radius: 6px !important;\\n            padding: 10px !important;\\n            z-index: 2147483645 !important;\\n            box-shadow: 0 5px 25px rgba(0,0,0,0.9) !important;\\n            width: 250px !important;\\n            max-width: 90vw !important;\\n            max-height: 60vh !important;\\n            overflow-y: auto !important;\\n            display: none;\\n            flex-direction: column !important;\\n            gap: 5px !important;\\n        }\\n        .dnd-inventory-panel.visible {\\n            display: flex !important;\\n            animation: dnd-popup-in 0.2s ease-out forwards !important;\\n        }\\n        .dnd-inv-panel-header {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            border-bottom: 1px solid var(--dnd-border-inner) !important;\\n            padding-bottom: 5px !important;\\n            margin-bottom: 5px !important;\\n            font-weight: bold !important;\\n            color: var(--dnd-text-header) !important;\\n        }\\n        .dnd-inv-list-item {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            padding: 6px 8px !important;\\n            background: var(--dnd-bg-item) !important;\\n            border-radius: 4px !important;\\n            cursor: pointer !important;\\n            transition: background 0.2s !important;\\n            font-size: 13px !important;\\n        }\\n        .dnd-inv-list-item:hover {\\n            background: rgba(255,255,255,0.1) !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n        .dnd-inv-btn {\\n            background: rgba(0,0,0,0.3) !important;\\n            border: 1px solid var(--dnd-border-inner) !important;\\n            color: var(--dnd-text-main) !important;\\n            padding: 6px 12px !important;\\n            border-radius: 4px !important;\\n            cursor: pointer !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            gap: 6px !important;\\n            font-size: 12px !important;\\n            flex: 1 !important;\\n            justify-content: center !important;\\n            transition: all 0.2s !important;\\n        }\\n        .dnd-inv-btn:hover {\\n            background: rgba(255,255,255,0.1) !important;\\n            border-color: var(--dnd-border-gold) !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n\\n        /* åŠ¿åŠ›å£°æœ›é¢æ¿ */\\n        .dnd-faction-item {\\n            background: rgba(255,255,255,0.03) !important;\\n            border-bottom: 1px solid rgba(255,255,255,0.05) !important;\\n            padding: 10px !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            gap: 5px !important;\\n        }\\n        .dnd-faction-item:last-child { border-bottom: none !important; }\\n        .dnd-faction-header {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            font-weight: bold !important;\\n        }\\n        .dnd-faction-rep-bar {\\n            height: 4px !important;\\n            background: var(--dnd-bar-bg) !important;\\n            border-radius: 2px !important;\\n            overflow: hidden !important;\\n            position: relative !important;\\n            margin-top: 4px !important;\\n        }\\n        .dnd-faction-rep-fill {\\n            height: 100% !important;\\n            transition: width 0.3s !important;\\n        }\\n\\n        /* ç®€ç•¥ç‰ˆ HUD */\\n        #dnd-mini-hud {\\n            position: fixed !important;\\n            /* ç§»é™¤ !important ä»¥ä¾¿ JS è¦†ç›–ï¼Œè®¾ç½®å›é€€å€¼ */\\n            top: 60px;\\n            left: 10px;\\n            width: 480px !important; /* æ¡Œé¢ç«¯å›ºå®šå®½åº¦ */\\n            max-width: 90vw !important;\\n            max-height: 85vh !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            \\n            background: var(--dnd-bg-hud) !important;\\n            \\n            /* Morphology: Border */\\n            border: var(--dnd-border-width, 2px) var(--dnd-border-style, solid) var(--dnd-border-inner) !important;\\n            border-radius: var(--dnd-radius-lg, 8px) !important;\\n            box-shadow: 0 0 0 2px rgba(0,0,0,0.5), 0 0 0 4px var(--dnd-border-gold), var(--dnd-shadow), var(--dnd-effect-border-glow, none), var(--dnd-effect-inner-glow, none) !important;\\n            \\n            /* Morphology: Shape */\\n            clip-path: var(--dnd-card-clip-path, none) !important;\\n            \\n            overflow: visible !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            z-index: 2147483640 !important; /* Lower than Dashboard */\\n            \\n            /* åŠ¨ç”»åˆå§‹çŠ¶æ€ */\\n            opacity: 0 !important;\\n            transform: translateX(-30px) !important;\\n            pointer-events: none !important;\\n            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;\\n            \\n            color: var(--dnd-text-main) !important;\\n            margin: 0 !important;\\n        }\\n        \\n        /* HUD çº¹ç†å±‚ */\\n        #dnd-mini-hud > .dnd-hud-body::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0 !important;\\n            background: var(--dnd-effect-texture, none) !important;\\n            opacity: 0.5 !important;\\n            pointer-events: none !important;\\n            z-index: 0 !important;\\n            mix-blend-mode: overlay !important;\\n        }\\n        #dnd-mini-hud::before {\\n            content: 'â–';\\n            position: absolute;\\n            top: 4px;\\n            left: 4px;\\n            color: var(--dnd-ornament-color);\\n            font-size: 14px;\\n            pointer-events: none;\\n            z-index: 10;\\n        }\\n        #dnd-mini-hud::after {\\n            content: 'â–';\\n            position: absolute;\\n            top: 4px;\\n            right: 4px;\\n            color: var(--dnd-ornament-color);\\n            font-size: 14px;\\n            pointer-events: none;\\n            z-index: 10;\\n        }\\n        #dnd-mini-hud.visible {\\n            opacity: 1 !important;\\n            transform: translateX(0) !important;\\n            pointer-events: auto !important;\\n        }\\n        \\n        /* ä»»åŠ¡æ‚¬æµ®è¯¦æƒ… */\\n        .dnd-quest-tooltip {\\n            position: fixed !important;\\n            background: var(--dnd-bg-panel) !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            padding: 15px !important;\\n            z-index: 2147483645 !important; /* Highest priority */\\n            box-shadow: 0 5px 25px rgba(0,0,0,0.9) !important;\\n            width: 300px !important;\\n            max-width: 90vw !important;\\n            display: none !important;\\n            color: var(--dnd-text-main) !important;\\n            border-radius: 4px !important;\\n        }\\n        .dnd-quest-tooltip.visible { \\n            display: block !important; \\n            animation: dnd-popup-in 0.2s ease-out forwards !important;\\n        }\\n\\n        /* HUD é¡¶éƒ¨æ  */\\n        .dnd-hud-header {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important; /* æ”¹ä¸ºå±…ä¸­å¯¹é½ï¼Œæ›´ç¾è§‚ */\\n            padding: 10px 15px !important; /* å¢åŠ å†…è¾¹è· */\\n            background: linear-gradient(to right, rgba(var(--dnd-border-inner-rgb, 92, 75, 53), 0.1), transparent) !important;\\n            border-bottom: 1px solid var(--dnd-border-inner) !important;\\n            font-size: 14px !important;\\n            color: var(--dnd-text-main) !important;\\n            line-height: normal !important;\\n            flex-shrink: 0 !important;\\n            transition: all 0.3s ease !important;\\n            box-shadow: 0 2px 10px rgba(0,0,0,0.2) !important; /* å¢åŠ é˜´å½± */\\n        }\\n        .dnd-hud-status { \\n            display: flex !important; \\n            flex-direction: column !important; \\n            gap: 2px !important; \\n            flex: 1 !important; \\n            overflow: hidden !important; \\n            min-width: 0 !important; \\n            margin-left: 12px !important; /* ä¸ Logo ä¿æŒè·ç¦» */\\n        }\\n        \\n        /* Logo å®¹å™¨ */\\n        #dnd-logo-container {\\n            width: 42px !important;\\n            height: 42px !important;\\n            border-radius: 50% !important;\\n            background: linear-gradient(135deg, var(--dnd-logo-bg-start) 0%, var(--dnd-logo-bg-end) 100%) !important;\\n            border: 2px solid var(--dnd-border-gold) !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            justify-content: center !important;\\n            box-shadow: 0 0 10px rgba(157, 139, 108, 0.3) !important;\\n            cursor: pointer !important;\\n            transition: all 0.3s ease !important;\\n            flex-shrink: 0 !important;\\n        }\\n        #dnd-logo-container:hover {\\n            transform: scale(1.05) rotate(5deg) !important;\\n            box-shadow: 0 0 15px rgba(157, 139, 108, 0.6) !important;\\n            border-color: var(--dnd-text-highlight) !important;\\n        }\\n        #dnd-logo-container:active {\\n            transform: scale(0.95) !important;\\n        }\\n        .dnd-logo-text {\\n            font-family: var(--dnd-font-serif) !important;\\n            font-weight: bold !important;\\n            font-size: 20px !important;\\n            color: var(--dnd-text-highlight) !important;\\n            text-shadow: 0 2px 4px rgba(0,0,0,0.8) !important;\\n        }\\n        \\n        /* ä½ç½®æ–‡æœ¬æ ·å¼ä¼˜åŒ– */\\n        .dnd-location-text {\\n            font-weight: bold !important;\\n            color: var(--dnd-text-highlight) !important;\\n            display: -webkit-box !important;\\n            -webkit-line-clamp: 1;\\n            -webkit-box-orient: vertical;\\n            overflow: hidden !important;\\n            text-overflow: ellipsis !important;\\n            line-height: 1.4 !important;\\n            max-height: 1.4em !important;\\n            transition: max-height 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;\\n            word-break: break-word !important;\\n        }\\n        .dnd-location-text.dnd-expanded {\\n            -webkit-line-clamp: unset !important;\\n            max-height: 10em !important;\\n        }\\n\\n        .dnd-hud-info-row {\\n            display: flex !important;\\n            align-items: center !important;\\n            font-size: 12px !important;\\n            color: var(--dnd-text-main) !important;\\n            white-space: nowrap !important;\\n            overflow: hidden !important;\\n            opacity: 0.9 !important;\\n        }\\n        \\n        .dnd-hud-expand-btn {\\n            background: transparent !important;\\n            border: 1px solid transparent !important;\\n            color: var(--dnd-text-highlight) !important;\\n            cursor: pointer !important;\\n            font-size: 12px !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            gap: 5px !important;\\n            padding: 2px 8px !important;\\n            margin: 0 !important;\\n            line-height: normal !important;\\n            text-decoration: none !important;\\n            box-shadow: none !important;\\n            height: auto !important;\\n            width: auto !important;\\n        }\\n        .dnd-hud-expand-btn:hover {\\n            background: rgba(255, 255, 255, 0.1) !important;\\n            border-color: var(--dnd-border-inner) !important;\\n            text-decoration: none !important;\\n        }\\n\\n        /* HUD å†…å®¹åŒº */\\n        .dnd-hud-body { \\n            padding: 10px 10px 0 10px !important; \\n            overflow-y: auto !important; /* å†…å®¹è¶…é•¿æ—¶æ»šåŠ¨ */\\n            flex: 1 !important;          /* å æ®å‰©ä½™ç©ºé—´ */\\n        }\\n        \\n        /* HUD åº•éƒ¨å¸¸é©»èµ„æºæ  */\\n        .dnd-hud-footer {\\n            padding: 8px 10px !important;\\n            background: rgba(0,0,0,0.4) !important;\\n            border-top: 1px solid rgba(255,255,255,0.1) !important;\\n            font-size: 11px !important;\\n            display: flex !important;\\n            flex-wrap: wrap !important;\\n            gap: 10px !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n        }\\n        .dnd-res-item { display: flex !important; align-items: center !important; gap: 4px !important; }\\n        .dnd-res-icon { opacity: 0.7 !important; }\\n        \\n        /* é˜Ÿä¼æŠ˜å é¢æ¿ */\\n        .dnd-hud-party-collapse {\\n            background: rgba(0,0,0,0.2) !important;\\n            border-top: 1px solid rgba(255,255,255,0.1) !important;\\n        }\\n        .dnd-party-header {\\n            padding: 5px 10px !important;\\n            cursor: pointer !important;\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            font-size: 11px !important;\\n            color: var(--dnd-text-dim) !important;\\n        }\\n        .dnd-party-header:hover { background: rgba(255,255,255,0.05) !important; color: var(--dnd-text-main) !important; }\\n        \\n        .dnd-party-list {\\n            padding: 5px 10px 10px 10px !important;\\n            display: none; /* é»˜è®¤æŠ˜å  */\\n        }\\n        .dnd-party-list.expanded { display: block !important; }\\n        \\n        .dnd-party-detail-row {\\n            display: flex !important;\\n            align-items: center !important;\\n            gap: 10px !important;\\n            padding: 4px 0 !important;\\n            border-bottom: 1px dashed rgba(255,255,255,0.05) !important;\\n            font-size: 11px !important;\\n        }\\n        .dnd-party-detail-row:last-child { border-bottom: none !important; }\\n\\n        /* æˆ˜æ–—æ¨¡å¼å¸ƒå±€ */\\n        .dnd-hud-combat-layout { display: flex !important; width: 100% !important; gap: 15px !important; }\\n        .dnd-hud-minimap {\\n            width: 180px !important;\\n            height: 180px !important;\\n            background: var(--dnd-bg-main) !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            border-radius: 6px !important;\\n            position: relative !important;\\n            flex-shrink: 0 !important;\\n            overflow: hidden !important;\\n            box-shadow: inset 0 0 10px rgba(0,0,0,0.5) !important;\\n        }\\n        \\n        /* [æ–°å¢] åœ°å›¾å†…éƒ¨å®¹å™¨æ ·å¼ */\\n        .dnd-minimap-inner {\\n            box-shadow: inset 0 0 40px rgba(0,0,0,0.9);\\n            transition: transform 0.2s ease-out;\\n        }\\n        .dnd-minimap-grid {\\n            opacity: 0.3;\\n            pointer-events: none;\\n        }\\n\\n        /* [ä¿®æ”¹] æˆ˜æ–—åˆ—è¡¨é™åˆ¶é«˜åº¦ä¸åœ°å›¾ä¸€è‡´ï¼Œå…è®¸æ»šåŠ¨ */\\n        .dnd-hud-party-stats {\\n            flex: 1 !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            gap: 5px !important;\\n            overflow-y: auto !important;\\n            min-width: 200px !important;\\n            max-height: 240px !important; /* é™åˆ¶é«˜åº¦ä¸åœ°å›¾ç»„ä»¶è¿‘ä¼¼ */\\n        }\\n\\n        /* è¿·ä½ åœ°å›¾ Token å¢å¼º */\\n        .dnd-minimap-token {\\n            position: absolute;\\n            border-radius: 50%;\\n            cursor: pointer;\\n            z-index: 10;\\n            /* å¹³æ»‘ç§»åŠ¨è¿‡æ¸¡ */\\n            transition: left 0.4s cubic-bezier(0.22, 1, 0.36, 1),\\n                        top 0.4s cubic-bezier(0.22, 1, 0.36, 1),\\n                        width 0.3s, height 0.3s,\\n                        transform 0.2s;\\n            box-shadow: 0 3px 6px rgba(0,0,0,0.5);\\n            display: flex !important;\\n            align-items: center !important;\\n            justify-content: center !important;\\n            overflow: hidden !important;\\n            font-family: sans-serif !important;\\n        }\\n        .dnd-minimap-token:hover {\\n            transform: scale(1.2);\\n            z-index: 20;\\n            box-shadow: 0 6px 12px rgba(0,0,0,0.8);\\n        }\\n        \\n        /* å½“å‰è¡ŒåŠ¨è€…å…‰ç¯ç‰¹æ•ˆ */\\n        .dnd-minimap-token.active::after {\\n            content: '';\\n            position: absolute;\\n            top: -6px; left: -6px; right: -6px; bottom: -6px;\\n            border: 1px dashed var(--dnd-border-gold);\\n            border-radius: 50%;\\n            animation: dnd-spin-slow 10s linear infinite;\\n            pointer-events: none;\\n        }\\n        .dnd-minimap-token.active::before {\\n            content: '';\\n            position: absolute;\\n            top: 0; left: 0; right: 0; bottom: 0;\\n            border-radius: 50%;\\n            box-shadow: 0 0 15px rgba(255, 219, 133, 0.6);\\n            animation: dnd-pulse-opacity 2s infinite;\\n            pointer-events: none;\\n        }\\n        \\n        @keyframes dnd-spin-slow {\\n            0% { transform: rotate(0deg); }\\n            100% { transform: rotate(360deg); }\\n        }\\n        @keyframes dnd-spin {\\n            0% { transform: rotate(0deg); }\\n            100% { transform: rotate(360deg); }\\n        }\\n        @keyframes dnd-pulse-opacity {\\n            0%, 100% { opacity: 0.4; }\\n            50% { opacity: 0.8; }\\n        }\\n\\n        /* ç‚¹å‡»æ³¢çº¹ */\\n        @keyframes dnd-map-ripple {\\n            0% { transform: scale(0); opacity: 0.8; border-width: 4px; }\\n            100% { transform: scale(2.5); opacity: 0; border-width: 0; }\\n        }\\n        .dnd-map-ripple {\\n            position: absolute;\\n            border-radius: 50%;\\n            border: 2px solid var(--dnd-text-highlight);\\n            background: rgba(255, 255, 255, 0.1);\\n            pointer-events: none;\\n            z-index: 50;\\n            animation: dnd-map-ripple 0.6s ease-out forwards;\\n            transform-origin: center center;\\n        }\\n        \\n        /* æ¢ç´¢æ¨¡å¼å¸ƒå±€ */\\n        .dnd-hud-explore-layout { display: flex !important; flex-direction: column !important; width: 100% !important; gap: 10px !important; }\\n        .dnd-hud-quests {\\n            background: linear-gradient(to right, rgba(92, 75, 53, 0.2), transparent) !important;\\n            padding: 8px !important;\\n            border-radius: 4px !important;\\n            border-left: 2px solid var(--dnd-border-gold) !important;\\n        }\\n        .dnd-hud-quest-item {\\n            display: flex !important; justify-content: space-between !important; font-size: 13px !important;\\n            padding: 4px 0 !important; border-bottom: 1px dashed var(--dnd-border-inner) !important;\\n            cursor: pointer !important;\\n        }\\n        .dnd-hud-quest-item:hover { color: var(--dnd-text-highlight) !important; background: rgba(157, 139, 108, 0.1) !important; }\\n\\n        /* è¡ŒåŠ¨æŒ‰é’®æ ·å¼è¦†ç›– */\\n        .dnd-action-btn {\\n            background: linear-gradient(to right, rgba(92, 75, 53, 0.4), rgba(40, 30, 20, 0.4)) !important;\\n            border: 1px solid var(--dnd-border-inner) !important;\\n            color: var(--dnd-text-header) !important;\\n            border-left: 3px solid var(--dnd-border-gold) !important;\\n            border-radius: 4px !important;\\n            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n            font-family: var(--dnd-font-serif) !important;\\n            position: relative !important;\\n            overflow: hidden !important;\\n            box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important;\\n        }\\n        \\n        /* æŒ‰é’®å…‰æ³½æ‰«è¿‡æ•ˆæœ */\\n        .dnd-action-btn::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: -100%; width: 100%; height: 100%;\\n            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent) !important;\\n            transition: left 0.5s !important;\\n        }\\n        .dnd-action-btn:hover::before {\\n            left: 100% !important;\\n        }\\n\\n        .dnd-action-btn:hover {\\n            background: linear-gradient(to right, rgba(157, 139, 108, 0.3), rgba(60, 50, 40, 0.3)) !important;\\n            border-color: var(--dnd-text-highlight) !important;\\n            transform: translateX(4px) scale(1.02) !important;\\n            box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 10px rgba(157, 139, 108, 0.2) !important;\\n            text-shadow: 0 0 5px rgba(255, 219, 133, 0.5) !important;\\n        }\\n        \\n        .dnd-action-btn:active {\\n            transform: translateX(2px) scale(0.98) !important;\\n            box-shadow: 0 2px 5px rgba(0,0,0,0.4) !important;\\n        }\\n        \\n        .dnd-hud-party-row { display: flex !important; gap: 10px !important; overflow-x: auto !important; padding-bottom: 5px !important; }\\n        \\n        /* è¿·ä½ è§’è‰²æ¡ */\\n        .dnd-mini-char {\\n            display: flex !important; align-items: center !important; gap: 10px !important;\\n            background: linear-gradient(to right, rgba(92, 75, 53, 0.3), transparent) !important;\\n            padding: 5px 10px !important; border-radius: 4px !important;\\n            border-left: 3px solid transparent !important;\\n            cursor: pointer !important;\\n            transition: background 0.2s !important;\\n            margin-bottom: 5px !important;\\n            border: 1px solid transparent !important;\\n        }\\n        .dnd-mini-char:hover {\\n            background: linear-gradient(to right, rgba(157, 139, 108, 0.2), transparent) !important;\\n            border-color: var(--dnd-border-gold) !important;\\n        }\\n        .dnd-mini-char.active {\\n            border-left-color: var(--dnd-text-highlight) !important;\\n            background: linear-gradient(to right, rgba(157, 139, 108, 0.4), transparent) !important;\\n        }\\n        \\n        .dnd-mini-char-avatar {\\n            width: 36px !important; height: 36px !important; border-radius: 50% !important; background: var(--dnd-bg-secondary) !important;\\n            border: 2px solid var(--dnd-border-gold) !important; display: flex !important; align-items: center !important; justify-content: center !important;\\n            font-size: 14px !important; color: var(--dnd-text-highlight) !important;\\n            flex-shrink: 0 !important;\\n            box-shadow: 0 0 5px rgba(0,0,0,0.5) !important;\\n        }\\n\\n        .dnd-mini-char-info { flex: 1 !important; min-width: 120px !important; }\\n        .dnd-mini-name { font-size: 13px !important; font-weight: bold !important; color: var(--dnd-text-main) !important; }\\n        .dnd-mini-sub { font-size: 11px !important; color: var(--dnd-text-dim) !important; display: flex !important; gap: 8px !important; }\\n\\n        .dnd-mini-bars { width: 80px !important; display: flex !important; flex-direction: column !important; gap: 3px !important; flex-shrink: 0 !important; }\\n        .dnd-micro-bar { height: 4px !important; background: var(--dnd-bar-bg) !important; border-radius: 2px !important; overflow: hidden !important; position: relative !important; }\\n        .dnd-micro-bar-fill { height: 100% !important; transition: width 0.3s !important; }\\n        .dnd-micro-bar.hp .dnd-micro-bar-fill { background: var(--dnd-accent-red) !important; }\\n        \\n        /* é¡¶éƒ¨æ  */\\n        .dnd-top-bar {\\n            height: 60px !important;\\n            background: var(--dnd-bg-hud) !important;\\n            border-bottom: 2px solid var(--dnd-border-gold) !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            padding: 0 20px !important;\\n            justify-content: space-between !important;\\n            box-shadow: 0 2px 10px rgba(0,0,0,0.5) !important;\\n        }\\n        .dnd-title {\\n            font-family: var(--dnd-font-serif) !important;\\n            font-size: 24px !important;\\n            color: var(--dnd-text-highlight) !important;\\n            text-transform: uppercase !important;\\n            letter-spacing: 2px !important;\\n            text-shadow: 0 0 5px rgba(255, 219, 133, 0.3) !important;\\n        }\\n        .dnd-close-btn {\\n            background: transparent !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            color: var(--dnd-text-main) !important;\\n            padding: 5px 15px !important;\\n            cursor: pointer !important;\\n            transition: all 0.2s !important;\\n            font-family: var(--dnd-font-serif) !important;\\n        }\\n        .dnd-close-btn:hover {\\n            background: var(--dnd-border-gold) !important;\\n            color: var(--dnd-text-inverse) !important;\\n        }\\n\\n            /* æ‚¬æµ®æŒ‰é’® - å·¦ä¸Šè§’ + åŠ¨ç”» */\\n                #dnd-toggle-btn {\\n                    position: fixed !important;\\n                    top: 10px !important;\\n                    left: 10px !important;\\n                    bottom: auto !important; right: auto !important;\\n                    \\n                    width: 42px !important;\\n                    height: 42px !important;\\n                    background: var(--dnd-bg-hud) !important;\\n                    border: 2px solid var(--dnd-border-gold) !important;\\n                    border-radius: 50% !important;\\n                    color: var(--dnd-border-gold) !important;\\n                    display: flex !important;\\n                    align-items: center !important;\\n                    justify-content: center !important;\\n                    cursor: pointer !important;\\n                    z-index: 2147483641 !important;\\n                    box-shadow: 0 0 15px rgba(0,0,0,0.9), inset 0 0 10px rgba(0,0,0,0.5) !important;\\n                    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;\\n                    font-size: 22px !important;\\n                    \\n                    opacity: 1 !important;\\n                    transform: scale(1) !important;\\n                    pointer-events: auto !important;\\n                    touch-action: none !important; /* ç¦æ­¢æµè§ˆå™¨é»˜è®¤è§¦æ‘¸è¡Œä¸ºï¼Œç¡®ä¿æ‹–æ‹½æµç•… */\\n                    user-select: none !important; /* ç¦æ­¢æ–‡å­—é€‰æ‹© */\\n                    -webkit-user-select: none !important;\\n                }\\n            #dnd-toggle-btn:hover {\\n                background: var(--dnd-border-gold) !important;\\n                color: var(--dnd-text-inverse-dark) !important;\\n                transform: scale(1.1) rotate(90deg) !important;\\n                box-shadow: 0 0 20px rgba(157, 139, 108, 0.6) !important;\\n            }\\n        #dnd-toggle-btn.dnd-hidden {\\n            opacity: 0 !important;\\n            transform: scale(0) !important;\\n            pointer-events: none !important;\\n        }\\n\\n        /* ç§»åŠ¨ç«¯è§’è‰²å¡ç‰‡å…¥åœºåŠ¨ç”» */\\n        @keyframes dnd-card-in-mobile {\\n            0% {\\n                opacity: 0;\\n                transform: translateX(-50%) scale(0.92) translateY(-15px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: translateX(-50%) scale(1) translateY(0);\\n            }\\n        }\\n\\n        /* === æ–°å¢äº’åŠ¨åŠ¨æ•ˆ === */\\n        \\n        /* 1. åˆ—è¡¨é¡¹çº§è”å…¥åœº */\\n        @keyframes dnd-slide-up-fade {\\n            0% { opacity: 0; transform: translateY(10px); }\\n            100% { opacity: 1; transform: translateY(0); }\\n        }\\n        .dnd-anim-entry {\\n            opacity: 0; /* åˆå§‹éšè—ï¼Œç­‰å¾…åŠ¨ç”» */\\n            animation: dnd-slide-up-fade 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;\\n        }\\n\\n        /* HUD ä¸“ç”¨å¾®åŠ¨æ•ˆ */\\n        @keyframes dnd-hud-pop-in {\\n            0% { opacity: 0; transform: scale(0.95) translateY(5px); }\\n            60% { transform: scale(1.02); }\\n            100% { opacity: 1; transform: scale(1) translateY(0); }\\n        }\\n        .dnd-hud-entry {\\n            opacity: 0;\\n            animation: dnd-hud-pop-in 0.3s ease-out forwards;\\n        }\\n        \\n        /* å‘¼å¸å…‰ç¯ (ç”¨äºå½“å‰è¡ŒåŠ¨è€…) */\\n        @keyframes dnd-pulse-border {\\n            0% { box-shadow: 0 0 0 0 rgba(255, 219, 133, 0.4); border-color: rgba(255, 219, 133, 0.6); }\\n            70% { box-shadow: 0 0 0 6px rgba(255, 219, 133, 0); border-color: rgba(255, 219, 133, 1); }\\n            100% { box-shadow: 0 0 0 0 rgba(255, 219, 133, 0); border-color: rgba(255, 219, 133, 0.6); }\\n        }\\n        .dnd-active-turn {\\n            animation: dnd-pulse-border 2s infinite !important;\\n        }\\n        \\n\\n        /* çŠ¶æ€æ¡æµå…‰æ•ˆæœ */\\n        @keyframes dnd-shimmer {\\n            0% { background-position: -200% 0; }\\n            100% { background-position: 200% 0; }\\n        }\\n        .dnd-bar-shimmer .dnd-micro-bar-fill, \\n        .dnd-bar-shimmer .dnd-bar-fill {\\n            position: relative;\\n            overflow: hidden;\\n        }\\n        .dnd-bar-shimmer .dnd-micro-bar-fill::after,\\n        .dnd-bar-shimmer .dnd-bar-fill::after {\\n            content: \"\";\\n            position: absolute;\\n            top: 0; left: 0; width: 200%; height: 100%;\\n            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0) 100%);\\n            animation: dnd-shimmer 10s infinite linear;\\n            transform: skewX(-20deg);\\n        }\\n\\n        /* 2. ç‚¹å‡»æ³¢çº¹/å›å¼¹åé¦ˆ */\\n        @keyframes dnd-pop-click {\\n            0% { transform: scale(1); }\\n            40% { transform: scale(0.95); }\\n            100% { transform: scale(1); }\\n        }\\n        .dnd-clicking {\\n            animation: dnd-pop-click 0.2s ease-out !important;\\n        }\\n        \\n        /* é€šç”¨å¯ç‚¹å‡»å…ƒç´ æ•ˆæœ (CSS active æ€) */\\n        .dnd-clickable {\\n            transition: transform var(--dnd-hover-transition, 0.15s ease), background 0.2s, box-shadow 0.2s, border-color 0.2s !important;\\n            cursor: pointer !important;\\n        }\\n        .dnd-clickable:active {\\n            transform: var(--dnd-active-transform, scale(0.96)) !important;\\n        }\\n        .dnd-clickable:hover {\\n            filter: brightness(var(--dnd-hover-brightness, 1.1));\\n        }\\n\\n        /* 3. é¢æ¿åˆ‡æ¢è¿‡æ¸¡ */\\n        @keyframes dnd-panel-in {\\n            0% { opacity: 0; transform: translateX(10px); }\\n            100% { opacity: 1; transform: translateX(0); }\\n        }\\n        .dnd-panel-transition {\\n            animation: dnd-panel-in 0.3s ease-out;\\n        }\\n\\n        /* ç§»åŠ¨ç«¯/çª„å±é€‚é… */\\n        @media (max-width: 768px) {\\n            .dnd-char-detail-card {\\n                width: 94vw !important;\\n                max-height: calc(100vh - 20px) !important;\\n                /* ç§»åŠ¨ç«¯å›ºå®šå®šä½ï¼šé¡¶éƒ¨10pxï¼Œæ°´å¹³å±…ä¸­ */\\n                top: 10px !important;\\n                left: 50% !important;\\n                transform: translateX(-50%) !important;\\n                right: auto !important;\\n                bottom: auto !important;\\n            }\\n            .dnd-char-detail-card.visible {\\n                animation: dnd-card-in-mobile 0.25s ease-out forwards !important;\\n            }\\n            \\n            /* ç§»åŠ¨ç«¯æ‚¬æµ®è¯¦æƒ…çª— */\\n            .dnd-detail-popup {\\n                width: calc(100vw - 20px) !important;\\n                max-width: none !important;\\n                left: 10px !important;\\n                right: 10px !important;\\n                max-height: 80vh !important;\\n            }\\n            .dnd-attr-grid {\\n                grid-template-columns: repeat(3, 1fr) !important;\\n            }\\n            .dnd-detail-body {\\n                padding: 10px !important;\\n                font-size: 12px !important;\\n            }\\n            .dnd-detail-header {\\n                padding: 8px 12px !important;\\n            }\\n            \\n            #dnd-dashboard-root .dnd-main-container {\\n                flex-direction: column !important;\\n            }\\n            .dnd-nav-sidebar {\\n                width: 100% !important;\\n                flex-direction: row !important;\\n                overflow-x: auto !important;\\n                padding: 5px !important;\\n                border-right: none !important;\\n                border-bottom: 1px solid var(--dnd-border-inner) !important;\\n                flex-shrink: 0 !important;\\n            }\\n            .dnd-nav-item {\\n                padding: 8px 12px !important;\\n                font-size: 14px !important;\\n                border-left: none !important;\\n                border-bottom: 3px solid transparent !important;\\n                white-space: nowrap !important;\\n                flex-shrink: 0 !important;\\n            }\\n            .dnd-nav-item.active {\\n                border-bottom-color: var(--dnd-border-gold) !important;\\n                background: rgba(197, 160, 89, 0.1) !important;\\n            }\\n            .dnd-content-area {\\n                padding: 15px !important;\\n            }\\n            \\n            #dnd-mini-hud {\\n                /* ç§»åŠ¨ç«¯å¼ºåˆ¶å±…ä¸­é ä¸Š */\\n                top: 10px !important;\\n                left: 50% !important;\\n                transform: translateX(-50%) !important;\\n                width: 95vw !important;\\n                min-width: 0 !important;\\n            }\\n            #dnd-mini-hud.visible {\\n                transform: translateX(-50%) !important;\\n            }\\n        }\\n\\n        /* å®½å±ä¼˜åŒ– */\\n        @media (min-width: 769px) {\\n            .dnd-attr-grid {\\n                grid-template-columns: repeat(6, 1fr) !important;\\n            }\\n            /* ç¡®ä¿ä¾§è¾¹æ å›ºå®šå®½åº¦ */\\n            .dnd-nav-sidebar {\\n                min-width: 200px !important;\\n                max-width: 200px !important;\\n            }\\n            /* ç¡®ä¿å†…å®¹åŒºåŸŸå¡«å……å‰©ä½™ç©ºé—´ */\\n            .dnd-content-area {\\n                flex: 1 !important;\\n                min-width: 0 !important; /* é˜²æ­¢å†…å®¹æº¢å‡º */\\n            }\\n        }\\n\\n        /* Quick Access Bar - Attached to MiniHUD Right Border */\\n        .dnd-quick-trigger {\\n            position: absolute !important;\\n            left: 100%; /* Right of HUD */\\n            top: 60px;\\n            width: 16px;\\n            height: 40px;\\n            background: var(--dnd-bg-panel);\\n            border: 1px solid var(--dnd-border-gold);\\n            border-left: none;\\n            border-radius: 0 8px 8px 0;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            cursor: pointer;\\n            z-index: 2147483639;\\n            font-size: 10px;\\n            color: var(--dnd-border-gold);\\n        }\\n        .dnd-quick-trigger:hover {\\n            background: var(--dnd-border-gold);\\n            color: #000;\\n        }\\n\\n        .dnd-quick-bar {\\n            position: absolute !important;\\n            top: 0;\\n            left: 100%; /* Right border of HUD */\\n            width: 50px;\\n            height: auto;\\n            max-height: 100%;\\n            background: var(--dnd-bg-panel);\\n            border: 1px solid var(--dnd-border-gold);\\n            border-left: none;\\n            border-radius: 0 8px 8px 0;\\n            display: flex;\\n            flex-direction: column;\\n            padding: 5px;\\n            gap: 5px;\\n            overflow-y: auto;\\n            overflow-x: hidden;\\n            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);\\n            transform-origin: left center;\\n            transform: scaleX(0); /* Start hidden */\\n            opacity: 0;\\n            z-index: 2147483638;\\n        }\\n        \\n        .dnd-quick-bar.visible {\\n            transform: scaleX(1);\\n            opacity: 1;\\n        }\\n\\n        /* Mobile Quick Bar Adjustment: Overlay from Right */\\n        @media (max-width: 768px) {\\n            .dnd-quick-bar {\\n                left: auto !important;\\n                right: 0 !important;\\n                transform-origin: right center !important;\\n                border-left: 1px solid var(--dnd-border-gold) !important;\\n                border-right: none !important;\\n                border-radius: 8px 0 0 8px !important;\\n                z-index: 2147483642 !important;\\n            }\\n            \\n            .dnd-quick-trigger {\\n                left: auto !important;\\n                right: 0 !important;\\n                border-left: 1px solid var(--dnd-border-gold) !important;\\n                border-right: none !important;\\n                border-radius: 4px 0 0 4px !important;\\n                transition: right 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;\\n                z-index: 2147483643 !important;\\n                /* Flip arrow direction on mobile */\\n                transform: rotate(180deg) !important;\\n            }\\n            \\n            .dnd-quick-bar.visible + .dnd-quick-trigger {\\n                right: 50px !important;\\n            }\\n        }\\n\\n        /* HUD Party Bar */\\n        .dnd-hud-party-bar {\\n            display: flex !important;\\n            gap: 15px !important;\\n            overflow-x: auto !important;\\n            padding: 12px 10px !important;\\n            border-top: 1px solid rgba(255,255,255,0.1) !important;\\n            background: rgba(0,0,0,0.2) !important;\\n        }\\n        .party-bar-item {\\n            display: flex !important;\\n            flex-direction: column !important;\\n            align-items: center !important;\\n            gap: 4px !important;\\n            cursor: pointer !important;\\n            min-width: 48px !important;\\n            position: relative !important;\\n        }\\n        .party-avatar-container {\\n            width: 40px !important;\\n            height: 40px !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            border-radius: 50% !important;\\n            overflow: hidden !important;\\n            background: linear-gradient(135deg, var(--dnd-logo-bg-start) 0%, var(--dnd-logo-bg-end) 100%) !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            justify-content: center !important;\\n        }\\n        .party-lvl-badge {\\n            position: absolute !important;\\n            bottom: -2px !important;\\n            right: -4px !important;\\n            background: var(--dnd-bg-tertiary) !important;\\n            border: 1px solid var(--dnd-border-gold) !important;\\n            color: var(--dnd-text-main) !important;\\n            font-size: 9px !important;\\n            padding: 0 3px !important;\\n            border-radius: 3px !important;\\n            font-weight: bold !important;\\n        }\\n        \\n        .party-control-btn {\\n            position: absolute;\\n            top: -5px;\\n            left: -5px;\\n            width: 18px;\\n            height: 18px;\\n            background: rgba(0,0,0,0.7);\\n            border: 1px solid var(--dnd-border-subtle);\\n            border-radius: 50%;\\n            font-size: 10px;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            cursor: pointer;\\n            opacity: 0;\\n            transition: opacity 0.2s;\\n            z-index: 10;\\n        }\\n        .party-bar-item:hover .party-control-btn {\\n            opacity: 1;\\n        }\\n        .party-control-btn.active {\\n            opacity: 1;\\n            border-color: var(--dnd-border-gold);\\n            background: rgba(197, 160, 89, 0.3);\\n        }\\n\\n        .dnd-item-damage {\\n            color: var(--dnd-accent-red);\\n            font-weight: bold;\\n            font-size: 12px;\\n        }\\n        .dnd-item-props {\\n            color: var(--dnd-text-dim);\\n            font-size: 11px;\\n            font-style: italic;\\n            white-space: nowrap;\\n            overflow: hidden;\\n            text-overflow: ellipsis;\\n        }\\n        .dnd-item-rarity {\\n            font-size: 10px;\\n            padding: 2px 6px;\\n            border-radius: 3px;\\n            display: inline-block;\\n            margin-top: 2px;\\n        }\\n        .rarity-æ™®é€š, .rarity-common { background: var(--dnd-rarity-common-bg); color: var(--dnd-rarity-common-text); }\\n        .rarity-éå‡¡, .rarity-uncommon { background: var(--dnd-rarity-uncommon-bg); color: var(--dnd-rarity-uncommon-text); }\\n        .rarity-ç¨€æœ‰, .rarity-rare { background: var(--dnd-rarity-rare-bg); color: var(--dnd-rarity-rare-text); }\\n        .rarity-æç¨€æœ‰, .rarity-veryrare { background: var(--dnd-rarity-veryrare-bg); color: var(--dnd-rarity-veryrare-text); }\\n        .rarity-ä¼ è¯´, .rarity-legendary { background: var(--dnd-rarity-legendary-bg); color: var(--dnd-rarity-legendary-text); }\\n\\n        .dnd-item-detail-row {\\n            display: flex;\\n            align-items: center;\\n            gap: 8px;\\n            padding: 4px 0;\\n            border-bottom: 1px dashed rgba(255,255,255,0.1);\\n        }\\n        .dnd-item-detail-icon { width: 20px; text-align: center; }\\n        .dnd-item-detail-label { color: var(--dnd-text-dim); min-width: 60px; }\\n        .dnd-item-detail-value { color: var(--dnd-text-main); flex: 1; }\\n        \\n        .party-control-btn {\\n            position: absolute;\\n            top: -5px;\\n            left: -5px;\\n            width: 18px;\\n            height: 18px;\\n            background: rgba(0,0,0,0.7);\\n            border: 1px solid var(--dnd-border-subtle);\\n            border-radius: 50%;\\n            font-size: 10px;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            cursor: pointer;\\n            opacity: 0;\\n            transition: opacity 0.2s;\\n            z-index: 10;\\n        }\\n        .party-bar-item:hover .party-control-btn {\\n            opacity: 1;\\n        }\\n        .party-control-btn.active {\\n            opacity: 1;\\n            border-color: var(--dnd-border-gold);\\n            background: rgba(197, 160, 89, 0.3);\\n        }\\n\\n        /* Dice Grid */\\n        .dnd-dice-grid {\\n            display: grid !important;\\n            grid-template-columns: repeat(4, 1fr) !important;\\n            gap: var(--dnd-spacing-sm, 6px) !important;\\n        }\\n        .dnd-dice-btn {\\n            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)) !important;\\n            /* Morphology: Border */\\n            border: var(--dnd-border-width, 1px) var(--dnd-border-style, solid) #444 !important;\\n            color: #ccc !important;\\n            padding: 10px 5px !important;\\n            /* Morphology: Radius */\\n            border-radius: var(--dnd-radius-sm, 4px) !important;\\n            cursor: pointer !important;\\n            transition: all 0.2s !important;\\n            font-size: 13px !important;\\n            font-weight: bold !important;\\n            text-align: center !important;\\n            position: relative !important;\\n            overflow: hidden !important;\\n            \\n            /* Morphology: Shape */\\n            clip-path: var(--dnd-card-clip-path, none) !important;\\n        }\\n        \\n        /* éª°å­æŒ‰é’®çº¹ç† */\\n        .dnd-dice-btn::after {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0 !important;\\n            background: var(--dnd-effect-texture, none) !important;\\n            opacity: 0.3 !important;\\n            pointer-events: none !important;\\n            mix-blend-mode: overlay !important;\\n        }\\n        \\n        .dnd-dice-btn:hover {\\n            border-color: var(--dnd-text-highlight) !important;\\n            color: var(--dnd-text-highlight) !important;\\n            transform: scale(1.05) !important;\\n        }\\n\\n        .dnd-quick-slot {\\n            width: 48px;\\n            height: 48px;\\n            background: rgba(0,0,0,0.5);\\n            /* Morphology: Border */\\n            border: var(--dnd-border-width, 1px) var(--dnd-border-style, solid) var(--dnd-border-inner);\\n            /* Morphology: Radius */\\n            border-radius: var(--dnd-radius-sm, 4px);\\n            flex-shrink: 0;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            cursor: pointer;\\n            position: relative;\\n            font-size: 12px;\\n            font-weight: bold;\\n            color: var(--dnd-text-main);\\n            transition: all 0.2s;\\n            overflow: hidden;\\n            white-space: nowrap;\\n            text-align: center;\\n            \\n            /* Morphology: Shape */\\n            clip-path: var(--dnd-card-clip-path, none);\\n        }\\n        \\n        /* å¿«æ·æ§½çº¹ç† */\\n        .dnd-quick-slot::before {\\n            content: \"\";\\n            position: absolute;\\n            top: 0; left: 0; right: 0; bottom: 0;\\n            background: var(--dnd-effect-texture, none);\\n            opacity: 0.3;\\n            pointer-events: none;\\n            mix-blend-mode: overlay;\\n            z-index: 0;\\n        }\\n        \\n        .dnd-quick-slot:hover {\\n            border-color: var(--dnd-text-highlight);\\n            background: rgba(255,255,255,0.1);\\n        }\\n        .dnd-quick-slot.add-btn {\\n            border: 1px dashed rgba(255,255,255,0.3) !important;\\n            color: rgba(255,255,255,0.6) !important;\\n            font-weight: bold;\\n            font-size: 24px;\\n        }\\n        .dnd-quick-slot.add-btn:hover {\\n            border-color: var(--dnd-text-highlight) !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n        \\n        .dnd-quick-slot-remove {\\n            position: absolute;\\n            top: -5px;\\n            right: -5px;\\n            width: 16px;\\n            height: 16px;\\n            background: var(--dnd-accent-red);\\n            border-radius: 50%;\\n            font-size: 10px;\\n            color: white;\\n            display: flex;\\n            align-items: center;\\n            justify-content: center;\\n            opacity: 0;\\n            transition: opacity 0.2s;\\n        }\\n        .dnd-quick-slot:hover .dnd-quick-slot-remove {\\n            opacity: 1;\\n        }\\n\\n        /* Custom Dice Area */\\n        .dnd-dice-custom-area {\\n            margin-top: 10px !important;\\n            padding-top: 10px !important;\\n            border-top: 1px dashed var(--dnd-border-subtle) !important;\\n        }\\n        .dnd-dice-input-row {\\n            display: flex !important;\\n            gap: 5px !important;\\n        }\\n        .dnd-dice-input {\\n            flex: 1 !important;\\n            background: var(--dnd-bg-input) !important;\\n            border: 1px solid var(--dnd-border-subtle) !important;\\n            color: var(--dnd-text-main) !important;\\n            padding: 6px 10px !important;\\n            border-radius: 4px !important;\\n            font-size: 12px !important;\\n        }\\n        .dnd-dice-submit-btn {\\n            background: var(--dnd-border-gold) !important;\\n            border: none !important;\\n            color: var(--dnd-text-inverse) !important;\\n            padding: 6px 12px !important;\\n            border-radius: 4px !important;\\n            cursor: pointer !important;\\n            font-weight: bold !important;\\n        }\\n        .dnd-dice-submit-btn:hover {\\n            filter: brightness(1.1) !important;\\n        }\\n\\n        /* Markdown Styles */\\n        .dnd-md-h1 { font-size: 1.5em !important; font-weight: bold !important; color: var(--dnd-text-highlight) !important; margin: 0.5em 0 !important; }\\n        .dnd-md-h2 { font-size: 1.3em !important; font-weight: bold !important; color: var(--dnd-text-header) !important; margin: 0.4em 0 !important; }\\n        .dnd-md-h3 { font-size: 1.1em !important; font-weight: bold !important; color: var(--dnd-text-main) !important; margin: 0.3em 0 !important; }\\n        .dnd-md-pre { background: rgba(0,0,0,0.3) !important; padding: 10px !important; border-radius: 4px !important; overflow-x: auto !important; font-family: monospace !important; margin: 5px 0 !important; }\\n        .dnd-md-code { background: rgba(255,255,255,0.1) !important; padding: 2px 4px !important; border-radius: 3px !important; font-family: monospace !important; }\\n        .dnd-md-li { margin-left: 20px !important; list-style-type: disc !important; display: list-item !important; }\\n\\n        /* ============================================\\n           è‡ªå®šä¹‰é€šçŸ¥ç³»ç»Ÿæ ·å¼\\n           ============================================ */\\n        \\n        /* é€šçŸ¥å®¹å™¨ */\\n        #dnd-notification-container {\\n            position: fixed !important;\\n            top: 20px !important;\\n            right: 20px !important;\\n            z-index: 2147483647 !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            gap: 10px !important;\\n            pointer-events: none !important;\\n            max-width: 400px !important;\\n        }\\n\\n        /* Toast é€šçŸ¥æ ·å¼ */\\n        .dnd-toast {\\n            display: flex !important;\\n            align-items: flex-start !important;\\n            gap: 12px !important;\\n            padding: 14px 16px !important;\\n            background: var(--dnd-bg-popup) !important;\\n            border: 1px solid var(--dnd-border-inner) !important;\\n            border-radius: 8px !important;\\n            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6), 0 2px 8px rgba(0, 0, 0, 0.4) !important;\\n            color: var(--dnd-text-main) !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            font-size: 14px !important;\\n            pointer-events: auto !important;\\n            transform: translateX(120%) !important;\\n            opacity: 0 !important;\\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;\\n            backdrop-filter: blur(10px) !important;\\n        }\\n        .dnd-toast-visible {\\n            transform: translateX(0) !important;\\n            opacity: 1 !important;\\n        }\\n        .dnd-toast-exit {\\n            transform: translateX(120%) !important;\\n            opacity: 0 !important;\\n        }\\n\\n        /* Toast ç±»å‹è¾¹æ¡†é¢œè‰² */\\n        .dnd-toast-info { border-left: 4px solid var(--dnd-toast-info) !important; }\\n        .dnd-toast-success { border-left: 4px solid var(--dnd-toast-success) !important; }\\n        .dnd-toast-warning { border-left: 4px solid var(--dnd-toast-warning) !important; }\\n        .dnd-toast-error { border-left: 4px solid var(--dnd-toast-error) !important; }\\n\\n        .dnd-toast-icon {\\n            font-size: 20px !important;\\n            flex-shrink: 0 !important;\\n            line-height: 1 !important;\\n        }\\n\\n        .dnd-toast-content {\\n            flex: 1 !important;\\n            min-width: 0 !important;\\n        }\\n\\n        .dnd-toast-title {\\n            font-weight: bold !important;\\n            color: var(--dnd-text-header) !important;\\n            margin-bottom: 4px !important;\\n        }\\n\\n        .dnd-toast-message {\\n            color: var(--dnd-text-main) !important;\\n            line-height: 1.4 !important;\\n            word-break: break-word !important;\\n        }\\n\\n        .dnd-toast-close {\\n            background: transparent !important;\\n            border: none !important;\\n            color: var(--dnd-text-dim) !important;\\n            font-size: 18px !important;\\n            cursor: pointer !important;\\n            padding: 0 !important;\\n            line-height: 1 !important;\\n            opacity: 0.6 !important;\\n            transition: opacity 0.2s !important;\\n        }\\n        .dnd-toast-close:hover {\\n            opacity: 1 !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†å®¹å™¨ */\\n        #dnd-dialog-container {\\n            position: fixed !important;\\n            top: 0 !important;\\n            left: 0 !important;\\n            width: 100vw !important;\\n            height: 100vh !important;\\n            z-index: 2147483646 !important;\\n            pointer-events: none !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†èƒŒæ™¯é®ç½© */\\n        .dnd-dialog-backdrop {\\n            position: fixed !important;\\n            top: 0 !important;\\n            left: 0 !important;\\n            width: 100vw !important;\\n            height: 100vh !important;\\n            background: rgba(0, 0, 0, 0.7) !important;\\n            backdrop-filter: blur(3px) !important;\\n            opacity: 0 !important;\\n            transition: opacity 0.2s ease !important;\\n            pointer-events: auto !important;\\n        }\\n        .dnd-dialog-backdrop-visible {\\n            opacity: 1 !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†ä¸»ä½“ */\\n        .dnd-dialog {\\n            position: fixed !important;\\n            top: 50% !important;\\n            left: 50% !important;\\n            transform: translate(-50%, -50%) scale(0.9) !important;\\n            min-width: 320px !important;\\n            max-width: 90vw !important;\\n            max-height: 80vh !important;\\n            background: var(--dnd-bg-popup) !important;\\n            /* Morphology: Border */\\n            border: var(--dnd-border-width, 1px) var(--dnd-border-style, solid) var(--dnd-border-gold) !important;\\n            /* Morphology: Radius */\\n            border-radius: var(--dnd-radius-lg, 10px) !important;\\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 40px rgba(157, 139, 108, 0.1), var(--dnd-effect-border-glow, none) !important;\\n            color: var(--dnd-text-main) !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            opacity: 0 !important;\\n            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;\\n            pointer-events: auto !important;\\n            overflow: hidden !important;\\n            \\n            /* Morphology: Shape */\\n            clip-path: var(--dnd-card-clip-path, none) !important;\\n        }\\n        \\n        /* å¯¹è¯æ¡†çº¹ç†å±‚ */\\n        .dnd-dialog::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0 !important;\\n            background: var(--dnd-effect-texture, none) !important;\\n            opacity: 0.3 !important;\\n            pointer-events: none !important;\\n            z-index: 0 !important;\\n            mix-blend-mode: overlay !important;\\n        }\\n        .dnd-dialog-visible {\\n            transform: translate(-50%, -50%) scale(1) !important;\\n            opacity: 1 !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†ç±»å‹ */\\n        .dnd-dialog-warning .dnd-dialog-header {\\n            border-bottom-color: var(--dnd-toast-warning) !important;\\n        }\\n        .dnd-dialog-danger .dnd-dialog-header {\\n            border-bottom-color: var(--dnd-toast-error) !important;\\n        }\\n        .dnd-dialog-danger .dnd-dialog-btn-confirm {\\n            background: linear-gradient(135deg, var(--dnd-toast-error), #c0392b) !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†å¤´éƒ¨ */\\n        .dnd-dialog-header {\\n            display: flex !important;\\n            justify-content: space-between !important;\\n            align-items: center !important;\\n            padding: 16px 20px !important;\\n            background: rgba(0, 0, 0, 0.3) !important;\\n            border-bottom: 1px solid var(--dnd-border-gold) !important;\\n        }\\n\\n        .dnd-dialog-title {\\n            font-size: 16px !important;\\n            font-weight: bold !important;\\n            color: var(--dnd-text-highlight) !important;\\n            font-family: var(--dnd-font-serif) !important;\\n        }\\n\\n        .dnd-dialog-close {\\n            background: transparent !important;\\n            border: none !important;\\n            color: var(--dnd-text-dim) !important;\\n            font-size: 24px !important;\\n            cursor: pointer !important;\\n            padding: 0 !important;\\n            line-height: 1 !important;\\n            transition: color 0.2s !important;\\n        }\\n        .dnd-dialog-close:hover {\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†å†…å®¹ */\\n        .dnd-dialog-body {\\n            padding: 20px !important;\\n        }\\n\\n        .dnd-dialog-message {\\n            font-size: 14px !important;\\n            line-height: 1.6 !important;\\n            color: var(--dnd-text-main) !important;\\n            margin: 0 0 15px 0 !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†è¾“å…¥æ¡† */\\n        .dnd-dialog-input {\\n            width: 100% !important;\\n            padding: 10px 14px !important;\\n            background: rgba(0, 0, 0, 0.4) !important;\\n            border: 1px solid var(--dnd-border-inner) !important;\\n            border-radius: 6px !important;\\n            color: var(--dnd-text-main) !important;\\n            font-size: 14px !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            outline: none !important;\\n            transition: border-color 0.2s, box-shadow 0.2s !important;\\n        }\\n        .dnd-dialog-input:focus {\\n            border-color: var(--dnd-border-gold) !important;\\n            box-shadow: 0 0 0 3px rgba(157, 139, 108, 0.2) !important;\\n        }\\n        .dnd-dialog-input::placeholder {\\n            color: var(--dnd-text-dim) !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†åº•éƒ¨ */\\n        .dnd-dialog-footer {\\n            display: flex !important;\\n            justify-content: flex-end !important;\\n            gap: 10px !important;\\n            padding: 16px 20px !important;\\n            background: rgba(0, 0, 0, 0.2) !important;\\n            border-top: 1px solid rgba(255, 255, 255, 0.05) !important;\\n        }\\n\\n        /* å¯¹è¯æ¡†æŒ‰é’® */\\n        .dnd-dialog-btn {\\n            padding: 10px 20px !important;\\n            border-radius: 6px !important;\\n            font-size: 14px !important;\\n            font-weight: 500 !important;\\n            cursor: pointer !important;\\n            transition: all 0.2s !important;\\n            border: none !important;\\n        }\\n\\n        .dnd-dialog-btn-cancel {\\n            background: rgba(255, 255, 255, 0.08) !important;\\n            color: var(--dnd-text-main) !important;\\n            border: 1px solid var(--dnd-border-inner) !important;\\n        }\\n        .dnd-dialog-btn-cancel:hover {\\n            background: rgba(255, 255, 255, 0.15) !important;\\n            border-color: var(--dnd-border-gold) !important;\\n        }\\n\\n        .dnd-dialog-btn-confirm {\\n            background: linear-gradient(135deg, var(--dnd-border-gold), #7a6b52) !important;\\n            color: var(--dnd-text-inverse) !important;\\n        }\\n        .dnd-dialog-btn-confirm:hover {\\n            filter: brightness(1.1) !important;\\n            transform: translateY(-1px) !important;\\n            box-shadow: 0 4px 12px rgba(157, 139, 108, 0.4) !important;\\n        }\\n        .dnd-dialog-btn-confirm:active {\\n            transform: translateY(0) !important;\\n        }\\n\\n        /* ç§»åŠ¨ç«¯é€‚é… */\\n        @media (max-width: 768px) {\\n            #dnd-notification-container {\\n                left: 10px !important;\\n                right: 10px !important;\\n                max-width: none !important;\\n            }\\n            \\n            .dnd-toast {\\n                transform: translateY(-100%) !important;\\n            }\\n            .dnd-toast-visible {\\n                transform: translateY(0) !important;\\n            }\\n            .dnd-toast-exit {\\n                transform: translateY(-100%) !important;\\n            }\\n            \\n            .dnd-dialog {\\n                min-width: 0 !important;\\n                width: calc(100vw - 40px) !important;\\n            }\\n        }\\n\\n        /* ============================================\\n           NPCè¯¦æƒ…æ¨¡æ€æ¡† (Modal Overlay)\\n           ============================================ */\\n        \\n        /* æ¨¡æ€æ¡†é®ç½©å±‚ */\\n        .dnd-modal-overlay {\\n            position: fixed !important;\\n            top: 0 !important;\\n            left: 0 !important;\\n            width: 100vw !important;\\n            height: 100vh !important;\\n            background: rgba(0, 0, 0, 0.85) !important;\\n            backdrop-filter: blur(5px) !important;\\n            z-index: 2147483646 !important;\\n            display: none !important;\\n            justify-content: center !important;\\n            align-items: center !important;\\n            padding: 20px !important;\\n        }\\n        .dnd-modal-overlay.active {\\n            display: flex !important;\\n        }\\n        \\n        /* æ¨¡æ€æ¡†ä¸»ä½“ */\\n        .dnd-modal {\\n            background: var(--dnd-bg-popup) !important;\\n            /* Morphology: Border */\\n            border: var(--dnd-border-width, 1px) var(--dnd-border-style, solid) var(--dnd-border-gold) !important;\\n            /* Morphology: Radius */\\n            border-radius: var(--dnd-radius-lg, 10px) !important;\\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 40px rgba(157, 139, 108, 0.1), var(--dnd-effect-border-glow, none) !important;\\n            color: var(--dnd-text-main) !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            width: 420px !important;\\n            max-width: 90vw !important;\\n            max-height: 80vh !important;\\n            overflow: hidden !important;\\n            display: flex !important;\\n            flex-direction: column !important;\\n            animation: dnd-modal-in 0.25s ease-out !important;\\n            position: relative !important;\\n            \\n            /* Morphology: Shape */\\n            clip-path: var(--dnd-card-clip-path, none) !important;\\n        }\\n        \\n        /* æ¨¡æ€æ¡†çº¹ç†å±‚ */\\n        .dnd-modal::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: 0; right: 0; bottom: 0 !important;\\n            background: var(--dnd-effect-texture, none) !important;\\n            opacity: 0.3 !important;\\n            pointer-events: none !important;\\n            z-index: 0 !important;\\n            mix-blend-mode: overlay !important;\\n        }\\n        \\n        @keyframes dnd-modal-in {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.9) translateY(-20px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n        \\n        /* æ¨¡æ€æ¡†å¤´éƒ¨ */\\n        .dnd-modal-header {\\n            padding: 16px 20px !important;\\n            background: rgba(0, 0, 0, 0.3) !important;\\n            border-bottom: 1px solid var(--dnd-border-gold) !important;\\n            flex-shrink: 0 !important;\\n        }\\n        \\n        /* æ¨¡æ€æ¡†å…³é—­æŒ‰é’® */\\n        .dnd-modal-close {\\n            cursor: pointer !important;\\n            font-size: 20px !important;\\n            color: var(--dnd-text-dim) !important;\\n            width: 28px !important;\\n            height: 28px !important;\\n            display: flex !important;\\n            align-items: center !important;\\n            justify-content: center !important;\\n            border-radius: 4px !important;\\n            transition: all 0.2s !important;\\n            flex-shrink: 0 !important;\\n        }\\n        .dnd-modal-close:hover {\\n            background: rgba(255, 255, 255, 0.1) !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n        \\n        /* æ¨¡æ€æ¡†å†…å®¹åŒº */\\n        .dnd-modal-body {\\n            padding: 20px !important;\\n            overflow-y: auto !important;\\n            flex: 1 !important;\\n        }\\n        \\n        /* ç§»åŠ¨ç«¯é€‚é… */\\n        @media (max-width: 768px) {\\n            .dnd-modal {\\n                width: calc(100vw - 40px) !important;\\n                max-height: 85vh !important;\\n            }\\n        }\\n\\n        /* ============================================\\n           SVG Icon Enhancements (FontAwesome)\\n           ============================================ */\\n        .svg-inline--fa {\\n            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;\\n            display: inline-block !important;\\n            vertical-align: -0.125em !important; /* Fix alignment */\\n        }\\n        \\n        /* æ‚¬åœå…‰æ™•æ•ˆæœ */\\n        .dnd-clickable:hover .svg-inline--fa,\\n        .dnd-btn:hover .svg-inline--fa,\\n        .dnd-nav-item:hover .svg-inline--fa,\\n        .dnd-footer-btn:hover .svg-inline--fa,\\n        .dnd-icon-hover:hover {\\n            filter: drop-shadow(0 0 5px currentColor) !important;\\n            transform: scale(1.2) !important;\\n        }\\n        \\n        /* ç‰¹å®šé¢œè‰²çš„å›¾æ ‡å…‰æ™•å¢å¼º */\\n        .dnd-text-highlight .svg-inline--fa {\\n            filter: drop-shadow(0 0 2px rgba(255, 219, 133, 0.3));\\n        }\\n\\n        /* çŠ¶æ€æç¤ºç‰¹æ•ˆ */\\n        @keyframes dnd-icon-bounce {\\n            0%, 100% { transform: translateY(0); }\\n            50% { transform: translateY(-3px); }\\n        }\\n        .dnd-icon-bounce {\\n            animation: dnd-icon-bounce 1s infinite ease-in-out !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n\\n        @keyframes dnd-icon-pulse-gold {\\n            0% { filter: drop-shadow(0 0 0 rgba(255, 219, 133, 0)); }\\n            50% { filter: drop-shadow(0 0 8px rgba(255, 219, 133, 0.8)); }\\n            100% { filter: drop-shadow(0 0 0 rgba(255, 219, 133, 0)); }\\n        }\\n        .dnd-icon-notify {\\n            animation: dnd-icon-pulse-gold 2s infinite !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n\\n        /* æ‚¬åœæµ®èµ·æ•ˆæœ (Moved to end for precedence) */\\n        .dnd-hover-lift {\\n            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1),\\n                        box-shadow 0.4s,\\n                        filter 0.4s,\\n                        background 0.4s,\\n                        border-color 0.4s,\\n                        color 0.4s !important;\\n        }\\n        .dnd-hover-lift:hover {\\n            transform: translateY(-3px) scale(1.02) !important;\\n            box-shadow: 0 5px 15px rgba(0,0,0,0.5) !important;\\n            filter: brightness(1.1) !important;\\n            z-index: 10 !important;\\n        }\\n\\n        /* ============================================\\n           ğŸ¨ é«˜çº§åŠ¨ç”»ç¾åŒ–ç³»ç»Ÿ - ç‚«é…·çµåŠ¨æ•ˆæœ\\n           ============================================ */\\n\\n        /* === 1. æ‚¬æµ®çƒ (Toggle Button) å¢å¼ºåŠ¨æ•ˆ === */\\n        \\n        /* å‘¼å¸å…‰ç¯åŠ¨ç”» */\\n        @keyframes dnd-breathe-glow {\\n            0%, 100% {\\n                box-shadow: 0 0 15px rgba(0,0,0,0.9),\\n                            inset 0 0 10px rgba(0,0,0,0.5),\\n                            0 0 20px rgba(157, 139, 108, 0.2),\\n                            0 0 40px rgba(157, 139, 108, 0.1);\\n            }\\n            50% {\\n                box-shadow: 0 0 15px rgba(0,0,0,0.9),\\n                            inset 0 0 10px rgba(0,0,0,0.5),\\n                            0 0 30px rgba(157, 139, 108, 0.4),\\n                            0 0 60px rgba(157, 139, 108, 0.2);\\n            }\\n        }\\n        \\n        /* ç¯å½¢æ‰«å…‰åŠ¨ç”» */\\n        @keyframes dnd-ring-sweep {\\n            0% { transform: rotate(0deg); }\\n            100% { transform: rotate(360deg); }\\n        }\\n        \\n        /* æ‚¬æµ®çƒå‘¼å¸å…‰æ•ˆ - ä»…æ·»åŠ åŠ¨ç”»ï¼Œä¸è¦†ç›–å…¶ä»–æ ·å¼ */\\n        #dnd-toggle-btn:not(.dnd-hidden):not(:hover) {\\n            animation: dnd-breathe-glow 3s ease-in-out infinite;\\n        }\\n        \\n        /* æ‚¬æµ®çƒæ‚¬åœå¢å¼º - å¢å¼ºåŸæœ‰æ•ˆæœ */\\n        #dnd-toggle-btn:hover {\\n            box-shadow: 0 0 20px rgba(157, 139, 108, 0.6),\\n                        0 0 40px rgba(157, 139, 108, 0.3),\\n                        inset 0 0 10px rgba(255, 219, 133, 0.15) !important;\\n        }\\n\\n        /* === 2. HUD é¢æ¿å¢å¼ºæ•ˆæœ === */\\n        \\n        /* æ¯›ç»ç’ƒ + è¾¹æ¡†å…‰æ•ˆ */\\n        @keyframes dnd-border-flow {\\n            0% { background-position: 0% 50%; }\\n            50% { background-position: 100% 50%; }\\n            100% { background-position: 0% 50%; }\\n        }\\n        \\n        #dnd-mini-hud {\\n            backdrop-filter: blur(12px) saturate(150%) !important;\\n            -webkit-backdrop-filter: blur(12px) saturate(150%) !important;\\n        }\\n        \\n        #dnd-mini-hud::after {\\n            animation: dnd-icon-pulse-gold 3s ease-in-out infinite !important;\\n        }\\n        \\n        /* HUD è¾¹æ¡†åŠ¨æ€å…‰æ•ˆ */\\n        #dnd-mini-hud.visible {\\n            position: relative;\\n        }\\n\\n        /* === 3. è§’è‰²å¡ç‰‡ 3D æ‚¬æµ®æ•ˆæœ === */\\n        \\n        .dnd-char-card {\\n            transform-style: preserve-3d !important;\\n            perspective: 1000px !important;\\n            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n        }\\n        \\n        .dnd-char-card:hover {\\n            transform: translateY(-8px) rotateX(3deg) rotateY(-2deg) scale(1.02) !important;\\n            box-shadow:\\n                0 20px 40px rgba(0, 0, 0, 0.5),\\n                0 0 20px rgba(157, 139, 108, 0.2),\\n                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;\\n        }\\n        \\n        /* å¡ç‰‡è¾¹æ¡†å‘å…‰å‘¼å¸ */\\n        @keyframes dnd-card-glow {\\n            0%, 100% {\\n                border-color: var(--dnd-border-inner);\\n                box-shadow: 0 4px 15px rgba(0,0,0,0.3);\\n            }\\n            50% {\\n                border-color: rgba(157, 139, 108, 0.6);\\n                box-shadow: 0 4px 20px rgba(157, 139, 108, 0.15);\\n            }\\n        }\\n        \\n        .dnd-char-card.dnd-highlight-card {\\n            animation: dnd-card-glow 2s ease-in-out infinite !important;\\n        }\\n\\n        /* å¤´åƒå…‰åœˆæ•ˆæœ */\\n        .dnd-avatar-container {\\n            position: relative !important;\\n            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n        }\\n        \\n        .dnd-avatar-container::after {\\n            content: '';\\n            position: absolute;\\n            top: -2px;\\n            left: -2px;\\n            right: -2px;\\n            bottom: -2px;\\n            border-radius: 50%;\\n            background: conic-gradient(\\n                from 0deg,\\n                transparent,\\n                rgba(157, 139, 108, 0.5),\\n                transparent,\\n                rgba(255, 219, 133, 0.3),\\n                transparent\\n            );\\n            opacity: 0;\\n            transition: opacity 0.3s;\\n            z-index: -1;\\n            animation: dnd-ring-sweep 3s linear infinite;\\n        }\\n        \\n        .dnd-avatar-container:hover::after {\\n            opacity: 1;\\n        }\\n        \\n        .dnd-avatar-container:hover {\\n            transform: scale(1.1) !important;\\n            box-shadow: 0 0 15px rgba(157, 139, 108, 0.5) !important;\\n        }\\n\\n        /* === 4. éª°å­æŒ‰é’® 3D ç¿»è½¬æ•ˆæœ === */\\n        \\n        .dnd-dice-btn {\\n            position: relative !important;\\n            transform-style: preserve-3d !important;\\n            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n            overflow: hidden !important;\\n        }\\n        \\n        .dnd-dice-btn::before {\\n            content: '';\\n            position: absolute;\\n            top: 50%;\\n            left: 50%;\\n            width: 0;\\n            height: 0;\\n            background: radial-gradient(circle, rgba(255, 219, 133, 0.4) 0%, transparent 70%);\\n            transition: all 0.4s ease;\\n            transform: translate(-50%, -50%);\\n            border-radius: 50%;\\n        }\\n        \\n        .dnd-dice-btn:hover::before {\\n            width: 150%;\\n            height: 150%;\\n        }\\n        \\n        .dnd-dice-btn:hover {\\n            transform: translateY(-3px) rotateX(-10deg) scale(1.08) !important;\\n            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4),\\n                        0 0 15px rgba(255, 219, 133, 0.3) !important;\\n        }\\n        \\n        .dnd-dice-btn:active {\\n            transform: translateY(0) rotateX(0) scale(0.95) !important;\\n            transition: all 0.1s !important;\\n        }\\n        \\n        /* éª°å­æ»šåŠ¨åŠ¨ç”» */\\n        @keyframes dnd-dice-roll {\\n            0% { transform: rotateY(0deg) rotateX(0deg); }\\n            25% { transform: rotateY(90deg) rotateX(90deg); }\\n            50% { transform: rotateY(180deg) rotateX(180deg); }\\n            75% { transform: rotateY(270deg) rotateX(90deg); }\\n            100% { transform: rotateY(360deg) rotateX(0deg); }\\n        }\\n        \\n        .dnd-dice-rolling {\\n            animation: dnd-dice-roll 0.5s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n        }\\n        \\n        /* éª°å­ç»“æœç‰¹æ•ˆ - NAT20 å‘å…‰è„‰å†² */\\n        @keyframes dnd-nat20-glow {\\n            0% {\\n                text-shadow: 0 0 30px rgba(46, 204, 113, 0.8),\\n                             0 0 60px rgba(46, 204, 113, 0.4);\\n                transform: scale(1);\\n            }\\n            100% {\\n                text-shadow: 0 0 50px rgba(46, 204, 113, 1),\\n                             0 0 100px rgba(46, 204, 113, 0.6),\\n                             0 0 150px rgba(46, 204, 113, 0.3);\\n                transform: scale(1.05);\\n            }\\n        }\\n        \\n        /* éª°å­ç»“æœç‰¹æ•ˆ - NAT1 æŠ–åŠ¨ */\\n        @keyframes dnd-shake {\\n            0%, 100% { transform: translateX(0) rotate(0); }\\n            10% { transform: translateX(-8px) rotate(-5deg); }\\n            20% { transform: translateX(8px) rotate(5deg); }\\n            30% { transform: translateX(-6px) rotate(-3deg); }\\n            40% { transform: translateX(6px) rotate(3deg); }\\n            50% { transform: translateX(-4px) rotate(-2deg); }\\n            60% { transform: translateX(4px) rotate(2deg); }\\n            70% { transform: translateX(-2px) rotate(-1deg); }\\n            80% { transform: translateX(2px) rotate(1deg); }\\n            90% { transform: translateX(-1px) rotate(0); }\\n        }\\n        \\n        .dnd-nat20-result {\\n            background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(39, 174, 96, 0.1)) !important;\\n            border-color: rgba(46, 204, 113, 0.6) !important;\\n        }\\n        \\n        .dnd-nat1-result {\\n            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(192, 57, 43, 0.1)) !important;\\n            border-color: rgba(231, 76, 60, 0.6) !important;\\n        }\\n        \\n        /* éª°å­ç»“æœæ•°å­—å¼¹è·³å…¥åœº */\\n        @keyframes dnd-result-bounce {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.3) translateY(-50px);\\n            }\\n            50% {\\n                opacity: 1;\\n                transform: scale(1.1) translateY(10px);\\n            }\\n            70% {\\n                transform: scale(0.95) translateY(-5px);\\n            }\\n            100% {\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n        \\n        .dnd-dice-result-number {\\n            animation: dnd-result-bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;\\n        }\\n\\n        /* === 5. è¿›åº¦æ¡æµåŠ¨å…‰æ•ˆå¢å¼º === */\\n        \\n        @keyframes dnd-bar-flow {\\n            0% {\\n                background-position: -200% center;\\n            }\\n            100% {\\n                background-position: 200% center;\\n            }\\n        }\\n        \\n        .dnd-bar-fill,\\n        .dnd-micro-bar-fill {\\n            position: relative !important;\\n            overflow: hidden !important;\\n        }\\n        \\n        .dnd-bar-fill::after,\\n        .dnd-micro-bar-fill::after {\\n            content: '';\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            right: 0;\\n            bottom: 0;\\n            background: linear-gradient(\\n                90deg,\\n                transparent 0%,\\n                rgba(255, 255, 255, 0.3) 25%,\\n                rgba(255, 255, 255, 0.5) 50%,\\n                rgba(255, 255, 255, 0.3) 75%,\\n                transparent 100%\\n            );\\n            background-size: 200% 100%;\\n            animation: dnd-bar-flow 8s linear infinite;\\n        }\\n        \\n        /* HP æ¡ç‰¹æ•ˆ - ä½è¡€é‡è­¦å‘Šé—ªçƒ */\\n        @keyframes dnd-hp-critical {\\n            0%, 100% {\\n                box-shadow: 0 0 5px rgba(231, 76, 60, 0.5);\\n                opacity: 1;\\n            }\\n            50% {\\n                box-shadow: 0 0 15px rgba(231, 76, 60, 0.8);\\n                opacity: 0.7;\\n            }\\n        }\\n        \\n        .dnd-bar-hp.dnd-critical .dnd-bar-fill {\\n            animation: dnd-hp-critical 1s ease-in-out infinite !important;\\n        }\\n\\n        /* === 6. æŒ‰é’®æ¶Ÿæ¼ªæ•ˆæœ === */\\n        \\n        @keyframes dnd-ripple {\\n            0% {\\n                transform: scale(0);\\n                opacity: 0.5;\\n            }\\n            100% {\\n                transform: scale(4);\\n                opacity: 0;\\n            }\\n        }\\n        \\n        .dnd-btn-ripple {\\n            position: relative !important;\\n            overflow: hidden !important;\\n        }\\n        \\n        .dnd-btn-ripple .dnd-ripple-effect {\\n            position: absolute;\\n            border-radius: 50%;\\n            background: radial-gradient(circle, rgba(255, 219, 133, 0.6) 0%, rgba(255, 219, 133, 0) 70%); /* æ›´æŸ”å’Œçš„å¾„å‘æ¸å˜ */\\n            pointer-events: none;\\n            animation: dnd-ripple 0.6s ease-out forwards;\\n            mix-blend-mode: screen; /* æ··åˆæ¨¡å¼è®©å…‰æ•ˆæ›´äº® */\\n        }\\n        \\n        /* æ–°å¢ï¼šé€šç”¨æŒ‰é’®æ ·å¼ (ç”¨äºå†…éƒ¨ç»„ä»¶) */\\n        .dnd-btn-primary, .dnd-btn-secondary {\\n            padding: 6px 14px !important;\\n            border-radius: 4px !important;\\n            font-size: 13px !important;\\n            cursor: pointer !important;\\n            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n            display: inline-flex !important;\\n            align-items: center !important;\\n            justify-content: center !important;\\n            gap: 6px !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            border: 1px solid transparent !important;\\n            position: relative !important;\\n            overflow: hidden !important;\\n        }\\n        \\n        .dnd-btn-primary {\\n            background: linear-gradient(135deg, var(--dnd-border-gold), #7a6b52) !important;\\n            color: var(--dnd-text-inverse) !important;\\n            box-shadow: 0 4px 10px rgba(0,0,0,0.3) !important;\\n            font-weight: bold !important;\\n        }\\n        .dnd-btn-primary:hover {\\n            filter: brightness(var(--dnd-btn-hover-brightness, 1.15)) !important;\\n            transform: var(--dnd-btn-hover-transform, translateY(-2px)) !important;\\n            box-shadow: var(--dnd-btn-hover-shadow, 0 6px 15px rgba(157, 139, 108, 0.4)) !important;\\n        }\\n        .dnd-btn-primary:active {\\n            transform: var(--dnd-btn-active-transform, translateY(0) scale(0.98)) !important;\\n            box-shadow: var(--dnd-btn-active-shadow, 0 2px 5px rgba(0,0,0,0.3)) !important;\\n        }\\n        \\n        .dnd-btn-secondary {\\n            background: rgba(255, 255, 255, 0.05) !important;\\n            border: 1px solid var(--dnd-border-inner) !important;\\n            color: var(--dnd-text-main) !important;\\n        }\\n        .dnd-btn-secondary:hover {\\n            background: rgba(255, 255, 255, 0.1) !important;\\n            border-color: var(--dnd-hover-border-color, var(--dnd-border-gold)) !important;\\n            color: var(--dnd-selected-text-color, var(--dnd-text-highlight)) !important;\\n            transform: var(--dnd-btn-hover-transform, translateY(-1px)) !important;\\n        }\\n\\n        /* æ ‡ç­¾é¡µ Tab æŒ‰é’® */\\n        .dnd-tab-btn {\\n            padding: 8px 16px !important;\\n            background: transparent !important;\\n            border: none !important;\\n            border-bottom: 2px solid transparent !important;\\n            color: var(--dnd-text-dim) !important;\\n            cursor: pointer !important;\\n            font-family: var(--dnd-font-serif) !important;\\n            font-size: 14px !important;\\n            transition: all var(--dnd-hover-transition, 0.3s) !important;\\n            position: relative !important;\\n        }\\n        .dnd-tab-btn:hover {\\n            color: var(--dnd-text-main) !important;\\n        }\\n        .dnd-tab-btn.active {\\n            color: var(--dnd-selected-text-color, var(--dnd-text-highlight)) !important;\\n            border-bottom-color: var(--dnd-nav-active-indicator, var(--dnd-border-gold)) !important;\\n        }\\n        .dnd-tab-btn.active::after {\\n            content: \"â—†\" !important;\\n            position: absolute !important;\\n            bottom: -6px !important;\\n            left: 50% !important;\\n            transform: translateX(-50%) !important;\\n            font-size: 10px !important;\\n            color: var(--dnd-nav-active-indicator, var(--dnd-border-gold)) !important;\\n            text-shadow: 0 0 5px var(--dnd-nav-active-indicator, var(--dnd-border-gold)) !important;\\n        }\\n\\n        /* === 7. å¯¼èˆªé¡¹æ»‘åŠ¨æŒ‡ç¤ºå™¨ === */\\n        \\n        .dnd-nav-item {\\n            position: relative !important;\\n            overflow: hidden !important;\\n        }\\n        \\n        .dnd-nav-item::before {\\n            content: '';\\n            position: absolute;\\n            left: 0;\\n            top: 0;\\n            bottom: 0;\\n            width: 0;\\n            background: linear-gradient(90deg,\\n                rgba(157, 139, 108, 0.3) 0%,\\n                transparent 100%);\\n            transition: width 0.3s ease;\\n        }\\n        \\n        .dnd-nav-item:hover::before {\\n            width: 100%;\\n        }\\n        \\n        .dnd-nav-item.active::before {\\n            width: 100%;\\n            background: linear-gradient(90deg,\\n                rgba(157, 139, 108, 0.4) 0%,\\n                transparent 100%);\\n        }\\n        \\n        .dnd-nav-item::after {\\n            content: '';\\n            position: absolute;\\n            left: 0;\\n            bottom: 0;\\n            width: 0;\\n            height: 2px;\\n            background: linear-gradient(90deg,\\n                var(--dnd-border-gold),\\n                transparent);\\n            transition: width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\\n        }\\n        \\n        .dnd-nav-item:hover::after,\\n        .dnd-nav-item.active::after {\\n            width: 100%;\\n        }\\n\\n        /* === 8. å¼¹çª—å…¥åœºåŠ¨ç”»å¢å¼º === */\\n        \\n        /* æµç•…çš„å¼¹çª—å…¥åœºåŠ¨ç”»ï¼ˆæ— æœå†»å¼¹è·³ï¼‰ */\\n        @keyframes dnd-popup-smooth-in {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.92) translateY(-8px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n        \\n        /* ä¿ç•™åŸå§‹å¼¹è·³åŠ¨ç”»ä¾›å…¶ä»–åœºæ™¯ä½¿ç”¨ */\\n        @keyframes dnd-popup-bounce-in {\\n            0% {\\n                opacity: 0;\\n                transform: scale(0.3) translateY(-20px);\\n            }\\n            50% {\\n                transform: scale(1.05) translateY(5px);\\n            }\\n            70% {\\n                transform: scale(0.95) translateY(-2px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: scale(1) translateY(0);\\n            }\\n        }\\n        \\n        @keyframes dnd-popup-slide-up {\\n            0% {\\n                opacity: 0;\\n                transform: translateY(20px) scale(0.96);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: translateY(0) scale(1);\\n            }\\n        }\\n        \\n        .dnd-detail-popup.visible,\\n        .dnd-quest-tooltip.visible {\\n            animation: dnd-popup-smooth-in 0.22s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;\\n        }\\n        \\n        .dnd-char-detail-card.visible {\\n            animation: dnd-popup-slide-up 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;\\n        }\\n\\n        /* === 9. è¿·ä½ è§’è‰²æ¡æ‚¬æµ®å¢å¼º === */\\n        \\n        .dnd-mini-char {\\n            position: relative !important;\\n            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n        }\\n        \\n        .dnd-mini-char::before {\\n            content: '';\\n            position: absolute;\\n            left: 0;\\n            top: 0;\\n            bottom: 0;\\n            width: 3px;\\n            background: transparent;\\n            transition: all 0.3s ease;\\n        }\\n        \\n        .dnd-mini-char:hover::before {\\n            background: linear-gradient(180deg,\\n                transparent,\\n                var(--dnd-border-gold),\\n                transparent);\\n            box-shadow: 0 0 10px rgba(157, 139, 108, 0.5);\\n        }\\n        \\n        .dnd-mini-char:hover {\\n            transform: translateX(5px) !important;\\n            background: linear-gradient(90deg,\\n                rgba(157, 139, 108, 0.25) 0%,\\n                rgba(157, 139, 108, 0.1) 30%,\\n                transparent 100%) !important;\\n        }\\n        \\n        .dnd-mini-char.active {\\n            background: linear-gradient(90deg,\\n                rgba(255, 219, 133, 0.3) 0%,\\n                rgba(157, 139, 108, 0.15) 30%,\\n                transparent 100%) !important;\\n        }\\n        \\n        .dnd-mini-char.active::before {\\n            background: linear-gradient(180deg,\\n                rgba(255, 219, 133, 0.3),\\n                var(--dnd-text-highlight),\\n                rgba(255, 219, 133, 0.3)) !important;\\n            box-shadow: 0 0 15px rgba(255, 219, 133, 0.6);\\n        }\\n\\n        /* === 10. å¿«æ·æ  3D æ•ˆæœ === */\\n        \\n        .dnd-quick-slot {\\n            transform-style: preserve-3d !important;\\n            transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n            position: relative !important;\\n        }\\n        \\n        .dnd-quick-slot::before {\\n            content: '';\\n            position: absolute;\\n            inset: 0;\\n            background: linear-gradient(135deg,\\n                rgba(255, 255, 255, 0.1) 0%,\\n                transparent 50%,\\n                rgba(0, 0, 0, 0.2) 100%);\\n            opacity: 0;\\n            transition: opacity 0.3s;\\n            border-radius: inherit;\\n        }\\n        \\n        .dnd-quick-slot:hover::before {\\n            opacity: 1;\\n        }\\n        \\n        .dnd-quick-slot:hover {\\n            transform: translateY(-5px) scale(1.1) rotateX(-5deg) !important;\\n            box-shadow:\\n                0 10px 20px rgba(0, 0, 0, 0.4),\\n                0 0 15px rgba(255, 219, 133, 0.3),\\n                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;\\n        }\\n\\n        /* === 11. èµ„æºæ åŠ¨æ€æ•ˆæœ === */\\n        \\n        .dnd-res-item {\\n            transition: all 0.2s ease !important;\\n        }\\n        \\n        .dnd-res-item:hover {\\n            transform: scale(1.1) !important;\\n            color: var(--dnd-text-highlight) !important;\\n        }\\n        \\n        .dnd-res-item:hover .dnd-res-icon {\\n            opacity: 1 !important;\\n            filter: drop-shadow(0 0 5px currentColor);\\n        }\\n\\n        /* === 12. ç²’å­/æ˜Ÿå°˜èƒŒæ™¯æ•ˆæœ (å¯é€‰å¼€å¯) === */\\n        \\n        @keyframes dnd-float-particle {\\n            0%, 100% {\\n                transform: translateY(0) translateX(0) rotate(0deg);\\n                opacity: 0;\\n            }\\n            10% {\\n                opacity: 0.8;\\n            }\\n            90% {\\n                opacity: 0.8;\\n            }\\n            100% {\\n                transform: translateY(-100px) translateX(20px) rotate(360deg);\\n                opacity: 0;\\n            }\\n        }\\n        \\n        .dnd-particles-enabled::before {\\n            content: '';\\n            position: absolute;\\n            width: 4px;\\n            height: 4px;\\n            background: var(--dnd-border-gold);\\n            border-radius: 50%;\\n            animation: dnd-float-particle 5s ease-in-out infinite;\\n            pointer-events: none;\\n        }\\n\\n        /* === 13. çŠ¶æ€å¾½ç« å¼¹è·³æ•ˆæœ === */\\n        \\n        @keyframes dnd-badge-bounce {\\n            0%, 100% { transform: scale(1); }\\n            50% { transform: scale(1.2); }\\n        }\\n        \\n        .dnd-status-badge {\\n            animation: dnd-badge-bounce 2s ease-in-out infinite !important;\\n        }\\n        \\n        .dnd-status-badge.urgent {\\n            animation: dnd-badge-bounce 0.5s ease-in-out infinite !important;\\n            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5) !important;\\n        }\\n\\n        /* === 14. æˆ˜æ–—æ¨¡å¼ç‰¹æ®Šæ•ˆæœ === */\\n        \\n        @keyframes dnd-combat-pulse {\\n            0%, 100% {\\n                border-color: rgba(138, 44, 44, 0.6);\\n                box-shadow: 0 0 0 2px rgba(0,0,0,0.5),\\n                            0 0 0 4px rgba(138, 44, 44, 0.4),\\n                            0 0 20px rgba(138, 44, 44, 0.2);\\n            }\\n            50% {\\n                border-color: rgba(192, 57, 43, 0.8);\\n                box-shadow: 0 0 0 2px rgba(0,0,0,0.5),\\n                            0 0 0 4px rgba(192, 57, 43, 0.6),\\n                            0 0 30px rgba(192, 57, 43, 0.4);\\n            }\\n        }\\n        \\n        #dnd-mini-hud.dnd-combat-mode {\\n            animation: dnd-combat-pulse 2s ease-in-out infinite !important;\\n        }\\n        \\n        #dnd-mini-hud.dnd-combat-mode .dnd-hud-header {\\n            background: linear-gradient(to right,\\n                rgba(138, 44, 44, 0.3),\\n                rgba(92, 75, 53, 0.1),\\n                transparent) !important;\\n        }\\n\\n        /* === 15. æ–‡å­—æ¸æ˜¾æ•ˆæœ === */\\n        \\n        @keyframes dnd-text-reveal {\\n            0% {\\n                opacity: 0;\\n                transform: translateY(10px);\\n                filter: blur(5px);\\n            }\\n            100% {\\n                opacity: 1;\\n                transform: translateY(0);\\n                filter: blur(0);\\n            }\\n        }\\n        \\n        .dnd-text-reveal {\\n            animation: dnd-text-reveal 0.5s ease-out forwards !important;\\n        }\\n        \\n        .dnd-text-reveal-delay-1 { animation-delay: 0.1s !important; }\\n        .dnd-text-reveal-delay-2 { animation-delay: 0.2s !important; }\\n        .dnd-text-reveal-delay-3 { animation-delay: 0.3s !important; }\\n\\n        /* === 16. Logo å®¹å™¨å¢å¼º === */\\n        \\n        #dnd-logo-container {\\n            position: relative !important;\\n        }\\n        \\n        #dnd-logo-container::before {\\n            content: '';\\n            position: absolute;\\n            inset: -4px;\\n            border-radius: 50%;\\n            background: conic-gradient(\\n                from 0deg,\\n                transparent 0deg,\\n                rgba(255, 219, 133, 0.4) 45deg,\\n                transparent 90deg,\\n                transparent 180deg,\\n                rgba(157, 139, 108, 0.3) 225deg,\\n                transparent 270deg\\n            );\\n            animation: dnd-ring-sweep 6s linear infinite;\\n            opacity: 0;\\n            transition: opacity 0.3s;\\n        }\\n        \\n        #dnd-logo-container:hover::before {\\n            opacity: 1;\\n        }\\n        \\n        .dnd-logo-text {\\n            transition: all 0.3s ease !important;\\n        }\\n        \\n        #dnd-logo-container:hover .dnd-logo-text {\\n            text-shadow: 0 2px 4px rgba(0,0,0,0.8),\\n                         0 0 20px rgba(255, 219, 133, 0.5) !important;\\n            transform: scale(1.1) !important;\\n        }\\n\\n        /* === 17. åˆ—è¡¨é¡¹äº¤é”™å…¥åœº === */\\n        \\n        .dnd-stagger-enter > * {\\n            opacity: 0;\\n            animation: dnd-slide-up-fade 0.4s ease forwards;\\n        }\\n        \\n        .dnd-stagger-enter > *:nth-child(1) { animation-delay: 0.05s; }\\n        .dnd-stagger-enter > *:nth-child(2) { animation-delay: 0.1s; }\\n        .dnd-stagger-enter > *:nth-child(3) { animation-delay: 0.15s; }\\n        .dnd-stagger-enter > *:nth-child(4) { animation-delay: 0.2s; }\\n        .dnd-stagger-enter > *:nth-child(5) { animation-delay: 0.25s; }\\n        .dnd-stagger-enter > *:nth-child(6) { animation-delay: 0.3s; }\\n        .dnd-stagger-enter > *:nth-child(7) { animation-delay: 0.35s; }\\n        .dnd-stagger-enter > *:nth-child(8) { animation-delay: 0.4s; }\\n        .dnd-stagger-enter > *:nth-child(9) { animation-delay: 0.45s; }\\n        .dnd-stagger-enter > *:nth-child(10) { animation-delay: 0.5s; }\\n\\n        /* === 18. é—ªçƒå…‰æ ‡æ•ˆæœ === */\\n        \\n        @keyframes dnd-cursor-blink {\\n            0%, 50% { opacity: 1; }\\n            51%, 100% { opacity: 0; }\\n        }\\n        \\n        .dnd-typing-cursor::after {\\n            content: '|';\\n            animation: dnd-cursor-blink 1s step-end infinite;\\n            color: var(--dnd-text-highlight);\\n            margin-left: 2px;\\n        }\\n\\n        /* === 19. æ‚¬æµ®ä¿¡æ¯å¡ç‰‡ 3D ç¿»è½¬ === */\\n        \\n        .dnd-flip-card {\\n            perspective: 1000px !important;\\n        }\\n        \\n        .dnd-flip-card-inner {\\n            transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1) !important;\\n            transform-style: preserve-3d !important;\\n        }\\n        \\n        .dnd-flip-card:hover .dnd-flip-card-inner {\\n            transform: rotateY(180deg) !important;\\n        }\\n        \\n        .dnd-flip-card-front,\\n        .dnd-flip-card-back {\\n            backface-visibility: hidden !important;\\n        }\\n        \\n        .dnd-flip-card-back {\\n            transform: rotateY(180deg) !important;\\n        }\\n\\n        /* === 20. å·¥å…·æç¤ºå¢å¼º === */\\n        \\n        [data-tooltip] {\\n            position: relative !important;\\n        }\\n        \\n        [data-tooltip]::after {\\n            content: attr(data-tooltip);\\n            position: absolute;\\n            bottom: 100%;\\n            left: 50%;\\n            transform: translateX(-50%) translateY(-5px) scale(0.8);\\n            background: rgba(0, 0, 0, 0.9);\\n            color: var(--dnd-text-main);\\n            padding: 5px 10px;\\n            border-radius: 4px;\\n            font-size: 11px;\\n            white-space: nowrap;\\n            opacity: 0;\\n            pointer-events: none;\\n            transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);\\n            border: 1px solid var(--dnd-border-inner);\\n            z-index: 1000;\\n        }\\n        \\n        [data-tooltip]:hover::after {\\n            opacity: 1;\\n            transform: translateX(-50%) translateY(-10px) scale(1);\\n        }\\n\\n        /* ============================================\\n           è¡¨å•ç»„ä»¶ç¾åŒ– (Form Elements)\\n           ============================================ */\\n        \\n        /* è¾“å…¥æ¡† */\\n        .dnd-input {\\n            background: rgba(0, 0, 0, 0.3) !important;\\n            border: 1px solid var(--dnd-border-subtle) !important;\\n            border-radius: 4px !important;\\n            color: var(--dnd-text-main) !important;\\n            padding: 8px 10px !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            transition: all var(--dnd-hover-transition, 0.2s) !important;\\n            outline: var(--dnd-focus-outline, none) !important;\\n        }\\n        .dnd-input:focus {\\n            border-color: var(--dnd-input-focus-border, var(--dnd-border-gold)) !important;\\n            background: rgba(0, 0, 0, 0.5) !important;\\n            box-shadow: var(--dnd-input-focus-shadow, 0 0 0 2px rgba(157, 139, 108, 0.2)) !important;\\n        }\\n        .dnd-input:disabled {\\n            opacity: var(--dnd-disabled-opacity, 0.5) !important;\\n            cursor: var(--dnd-disabled-cursor, not-allowed) !important;\\n            filter: var(--dnd-disabled-filter, grayscale(0.5)) !important;\\n        }\\n        \\n        /* ä¸‹æ‹‰é€‰æ¡† */\\n        .dnd-select {\\n            appearance: none !important;\\n            -webkit-appearance: none !important;\\n            background: rgba(0, 0, 0, 0.3) url(\"data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%239d8b6c%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E\") no-repeat right 10px center !important;\\n            background-size: 10px !important;\\n            border: 1px solid var(--dnd-border-subtle) !important;\\n            border-radius: 4px !important;\\n            color: var(--dnd-text-main) !important;\\n            padding: 8px 30px 8px 10px !important;\\n            cursor: pointer !important;\\n            font-family: var(--dnd-font-sans) !important;\\n            transition: all var(--dnd-hover-transition, 0.2s) !important;\\n        }\\n        .dnd-select:hover {\\n            border-color: var(--dnd-text-dim) !important;\\n        }\\n        .dnd-select:focus {\\n            border-color: var(--dnd-focus-border-color, var(--dnd-border-gold)) !important;\\n            box-shadow: var(--dnd-focus-shadow, 0 0 5px rgba(157, 139, 108, 0.3)) !important;\\n        }\\n        .dnd-select:disabled {\\n            opacity: var(--dnd-disabled-opacity, 0.5) !important;\\n            cursor: var(--dnd-disabled-cursor, not-allowed) !important;\\n        }\\n        \\n        /* å¤é€‰æ¡†ç¾åŒ– */\\n        .dnd-checkbox {\\n            appearance: none !important;\\n            -webkit-appearance: none !important;\\n            width: 16px !important;\\n            height: 16px !important;\\n            border: 1px solid var(--dnd-border-subtle) !important;\\n            border-radius: 3px !important;\\n            background: rgba(0,0,0,0.3) !important;\\n            cursor: pointer !important;\\n            position: relative !important;\\n            display: inline-block !important;\\n            vertical-align: middle !important;\\n            margin-right: 5px !important;\\n            transition: all var(--dnd-hover-transition, 0.2s) !important;\\n        }\\n        .dnd-checkbox:checked {\\n            background: var(--dnd-selected-border-color, var(--dnd-border-gold)) !important;\\n            border-color: var(--dnd-selected-border-color, var(--dnd-border-gold)) !important;\\n        }\\n        .dnd-checkbox:checked::after {\\n            content: \"âœ”\" !important;\\n            position: absolute !important;\\n            top: 50% !important;\\n            left: 50% !important;\\n            transform: translate(-50%, -50%) !important;\\n            color: #000 !important;\\n            font-size: 10px !important;\\n            font-weight: bold !important;\\n        }\\n        .dnd-checkbox:hover {\\n            border-color: var(--dnd-hover-border-color, var(--dnd-text-highlight)) !important;\\n        }\\n        .dnd-checkbox:disabled {\\n            opacity: var(--dnd-disabled-opacity, 0.5) !important;\\n            cursor: var(--dnd-disabled-cursor, not-allowed) !important;\\n        }\\n\\n        /* ============================================\\n           æ›´å¤šå·®å¼‚åŒ–åŠ¨æ•ˆ (Extra Animations)\\n           ============================================ */\\n           \\n        /* æ‚¬åœè¾‰å…‰æ‰«æ */\\n        .dnd-hover-scan {\\n            position: relative !important;\\n            overflow: hidden !important;\\n        }\\n        .dnd-hover-scan::before {\\n            content: \"\" !important;\\n            position: absolute !important;\\n            top: 0; left: -100%;\\n            width: 50%; height: 100%;\\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent) !important;\\n            transform: skewX(-25deg) !important;\\n            transition: left 0.5s !important;\\n            pointer-events: none !important;\\n        }\\n        .dnd-hover-scan:hover::before {\\n            left: 150% !important;\\n            transition: left 0.7s ease-in-out !important;\\n        }\\n        \\n        /* è„‰å†²ç¼©æ”¾ (ç”¨äºå¼ºè°ƒ) */\\n        @keyframes dnd-pulse-scale {\\n            0% { transform: scale(1); }\\n            50% { transform: scale(1.05); }\\n            100% { transform: scale(1); }\\n        }\\n        .dnd-pulse-hover:hover {\\n            animation: dnd-pulse-scale 1s infinite ease-in-out !important;\\n        }\\n        \\n        /* è¾¹æ¡†æµå…‰ (Border Flow) */\\n        @keyframes dnd-border-snake {\\n            0%, 100% { background-position: 0% 0%; }\\n            25% { background-position: 100% 0%; }\\n            50% { background-position: 100% 100%; }\\n            75% { background-position: 0% 100%; }\\n        }\\n        \\n        /* å¹½çµæŒ‰é’® (Ghost Button) */\\n        .dnd-btn-ghost {\\n            background: transparent !important;\\n            border: 1px dashed var(--dnd-text-dim) !important;\\n            color: var(--dnd-text-dim) !important;\\n            padding: 6px 12px !important;\\n            border-radius: 4px !important;\\n            cursor: pointer !important;\\n            transition: all 0.2s !important;\\n            font-size: 12px !important;\\n        }\\n        .dnd-btn-ghost:hover {\\n            border-color: var(--dnd-text-highlight) !important;\\n            color: var(--dnd-text-highlight) !important;\\n            background: rgba(255, 255, 255, 0.05) !important;\\n        }\\n    </style>`)};function s(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,a=Array(t);e<t;e++)a[e]=n[e];return a}function l(n,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,\"value\"in a&&(a.writable=!0),Object.defineProperty(n,u(a.key),a)}}function c(n,t){var e=\"undefined\"!=typeof Symbol&&n[Symbol.iterator]||n[\"@@iterator\"];if(!e){if(Array.isArray(n)||(e=x(n))||t&&n&&\"number\"==typeof n.length){e&&(n=e);var a=0,r=function(){};return{s:r,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(n){throw n},f:r}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var o,i=!0,d=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return i=n.done,n},e:function(n){d=!0,o=n},f:function(){try{i||null==e.return||e.return()}finally{if(d)throw o}}}}function p(n,t,e){return(t=u(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function g(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),e.push.apply(e,a)}return e}function f(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?g(Object(e),!0).forEach(function(t){p(n,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):g(Object(e)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))})}return n}function b(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){var e=null==n?null:\"undefined\"!=typeof Symbol&&n[Symbol.iterator]||n[\"@@iterator\"];if(null!=e){var a,r,o,i,d=[],s=!0,l=!1;try{if(o=(e=e.call(n)).next,0===t){if(Object(e)!==e)return;s=!1}else for(;!(s=(a=o.call(e)).done)&&(d.push(a.value),d.length!==t);s=!0);}catch(n){l=!0,r=n}finally{try{if(!s&&null!=e.return&&(i=e.return(),Object(i)!==i))return}finally{if(l)throw r}}return d}}(n,t)||x(n,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function m(n){return function(n){if(Array.isArray(n))return s(n)}(n)||function(n){if(\"undefined\"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n[\"@@iterator\"])return Array.from(n)}(n)||x(n)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function u(n){var t=function(n,t){if(\"object\"!=typeof n||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var a=e.call(n,t||\"default\");if(\"object\"!=typeof a)return a;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===t?String:Number)(n)}(n,\"string\");return\"symbol\"==typeof t?t:t+\"\"}function h(n){return h=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&\"function\"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?\"symbol\":typeof n},h(n)}function x(n,t){if(n){if(\"string\"==typeof n)return s(n,t);var e={}.toString.call(n).slice(8,-1);return\"Object\"===e&&n.constructor&&(e=n.constructor.name),\"Map\"===e||\"Set\"===e?Array.from(n):\"Arguments\"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?s(n,t):void 0}}var v=function(){},y={},w={},k=null,S={mark:v,measure:v};try{\"undefined\"!=typeof window&&(y=window),\"undefined\"!=typeof document&&(w=document),\"undefined\"!=typeof MutationObserver&&(k=MutationObserver),\"undefined\"!=typeof performance&&(S=performance)}catch(K){}var C,_,z=(y.navigator||{}).userAgent,D=void 0===z?\"\":z,I=y,A=w,P=k,E=S,T=(I.document,!!A.documentElement&&!!A.head&&\"function\"==typeof A.addEventListener&&\"function\"==typeof A.createElement),M=~D.indexOf(\"MSIE\")||~D.indexOf(\"Trident/\"),N={classic:{fa:\"solid\",fas:\"solid\",\"fa-solid\":\"solid\",far:\"regular\",\"fa-regular\":\"regular\",fal:\"light\",\"fa-light\":\"light\",fat:\"thin\",\"fa-thin\":\"thin\",fab:\"brands\",\"fa-brands\":\"brands\"},duotone:{fa:\"solid\",fad:\"solid\",\"fa-solid\":\"solid\",\"fa-duotone\":\"solid\",fadr:\"regular\",\"fa-regular\":\"regular\",fadl:\"light\",\"fa-light\":\"light\",fadt:\"thin\",\"fa-thin\":\"thin\"},sharp:{fa:\"solid\",fass:\"solid\",\"fa-solid\":\"solid\",fasr:\"regular\",\"fa-regular\":\"regular\",fasl:\"light\",\"fa-light\":\"light\",fast:\"thin\",\"fa-thin\":\"thin\"},\"sharp-duotone\":{fa:\"solid\",fasds:\"solid\",\"fa-solid\":\"solid\",fasdr:\"regular\",\"fa-regular\":\"regular\",fasdl:\"light\",\"fa-light\":\"light\",fasdt:\"thin\",\"fa-thin\":\"thin\"},slab:{\"fa-regular\":\"regular\",faslr:\"regular\"},\"slab-press\":{\"fa-regular\":\"regular\",faslpr:\"regular\"},thumbprint:{\"fa-light\":\"light\",fatl:\"light\"},whiteboard:{\"fa-semibold\":\"semibold\",fawsb:\"semibold\"},notdog:{\"fa-solid\":\"solid\",fans:\"solid\"},\"notdog-duo\":{\"fa-solid\":\"solid\",fands:\"solid\"},etch:{\"fa-solid\":\"solid\",faes:\"solid\"},jelly:{\"fa-regular\":\"regular\",fajr:\"regular\"},\"jelly-fill\":{\"fa-regular\":\"regular\",fajfr:\"regular\"},\"jelly-duo\":{\"fa-regular\":\"regular\",fajdr:\"regular\"},chisel:{\"fa-regular\":\"regular\",facr:\"regular\"},utility:{\"fa-semibold\":\"semibold\",fausb:\"semibold\"},\"utility-duo\":{\"fa-semibold\":\"semibold\",faudsb:\"semibold\"},\"utility-fill\":{\"fa-semibold\":\"semibold\",faufsb:\"semibold\"}},O=[\"fa-classic\",\"fa-duotone\",\"fa-sharp\",\"fa-sharp-duotone\",\"fa-thumbprint\",\"fa-whiteboard\",\"fa-notdog\",\"fa-notdog-duo\",\"fa-chisel\",\"fa-etch\",\"fa-jelly\",\"fa-jelly-fill\",\"fa-jelly-duo\",\"fa-slab\",\"fa-slab-press\",\"fa-utility\",\"fa-utility-duo\",\"fa-utility-fill\"],L=\"classic\",R=\"duotone\",j=\"sharp\",F=\"sharp-duotone\",U=\"chisel\",Y=\"etch\",H=\"jelly\",B=\"jelly-duo\",G=\"jelly-fill\",X=\"notdog\",W=\"notdog-duo\",V=\"slab\",q=\"slab-press\",K=\"thumbprint\",J=\"utility\",Q=\"utility-duo\",Z=\"utility-fill\",nn=\"whiteboard\",tn=[L,R,j,F,U,Y,H,B,G,X,W,V,q,K,J,Q,Z,nn],en=(p(p(p(p(p(p(p(p(p(p(C={},L,\"Classic\"),R,\"Duotone\"),j,\"Sharp\"),F,\"Sharp Duotone\"),U,\"Chisel\"),Y,\"Etch\"),H,\"Jelly\"),B,\"Jelly Duo\"),G,\"Jelly Fill\"),X,\"Notdog\"),p(p(p(p(p(p(p(p(C,W,\"Notdog Duo\"),V,\"Slab\"),q,\"Slab Press\"),K,\"Thumbprint\"),J,\"Utility\"),Q,\"Utility Duo\"),Z,\"Utility Fill\"),nn,\"Whiteboard\"),new Map([[\"classic\",{defaultShortPrefixId:\"fas\",defaultStyleId:\"solid\",styleIds:[\"solid\",\"regular\",\"light\",\"thin\",\"brands\"],futureStyleIds:[],defaultFontWeight:900}],[\"duotone\",{defaultShortPrefixId:\"fad\",defaultStyleId:\"solid\",styleIds:[\"solid\",\"regular\",\"light\",\"thin\"],futureStyleIds:[],defaultFontWeight:900}],[\"sharp\",{defaultShortPrefixId:\"fass\",defaultStyleId:\"solid\",styleIds:[\"solid\",\"regular\",\"light\",\"thin\"],futureStyleIds:[],defaultFontWeight:900}],[\"sharp-duotone\",{defaultShortPrefixId:\"fasds\",defaultStyleId:\"solid\",styleIds:[\"solid\",\"regular\",\"light\",\"thin\"],futureStyleIds:[],defaultFontWeight:900}],[\"chisel\",{defaultShortPrefixId:\"facr\",defaultStyleId:\"regular\",styleIds:[\"regular\"],futureStyleIds:[],defaultFontWeight:400}],[\"etch\",{defaultShortPrefixId:\"faes\",defaultStyleId:\"solid\",styleIds:[\"solid\"],futureStyleIds:[],defaultFontWeight:900}],[\"jelly\",{defaultShortPrefixId:\"fajr\",defaultStyleId:\"regular\",styleIds:[\"regular\"],futureStyleIds:[],defaultFontWeight:400}],[\"jelly-duo\",{defaultShortPrefixId:\"fajdr\",defaultStyleId:\"regular\",styleIds:[\"regular\"],futureStyleIds:[],defaultFontWeight:400}],[\"jelly-fill\",{defaultShortPrefixId:\"fajfr\",defaultStyleId:\"regular\",styleIds:[\"regular\"],futureStyleIds:[],defaultFontWeight:400}],[\"notdog\",{defaultShortPrefixId:\"fans\",defaultStyleId:\"solid\",styleIds:[\"solid\"],futureStyleIds:[],defaultFontWeight:900}],[\"notdog-duo\",{defaultShortPrefixId:\"fands\",defaultStyleId:\"solid\",styleIds:[\"solid\"],futureStyleIds:[],defaultFontWeight:900}],[\"slab\",{defaultShortPrefixId:\"faslr\",defaultStyleId:\"regular\",styleIds:[\"regular\"],futureStyleIds:[],defaultFontWeight:400}],[\"slab-press\",{defaultShortPrefixId:\"faslpr\",defaultStyleId:\"regular\",styleIds:[\"regular\"],futureStyleIds:[],defaultFontWeight:400}],[\"thumbprint\",{defaultShortPrefixId:\"fatl\",defaultStyleId:\"light\",styleIds:[\"light\"],futureStyleIds:[],defaultFontWeight:300}],[\"utility\",{defaultShortPrefixId:\"fausb\",defaultStyleId:\"semibold\",styleIds:[\"semibold\"],futureStyleIds:[],defaultFontWeight:600}],[\"utility-duo\",{defaultShortPrefixId:\"faudsb\",defaultStyleId:\"semibold\",styleIds:[\"semibold\"],futureStyleIds:[],defaultFontWeight:600}],[\"utility-fill\",{defaultShortPrefixId:\"faufsb\",defaultStyleId:\"semibold\",styleIds:[\"semibold\"],futureStyleIds:[],defaultFontWeight:600}],[\"whiteboard\",{defaultShortPrefixId:\"fawsb\",defaultStyleId:\"semibold\",styleIds:[\"semibold\"],futureStyleIds:[],defaultFontWeight:600}]])),an=[\"fak\",\"fa-kit\",\"fakd\",\"fa-kit-duotone\"],rn={fak:\"kit\",\"fa-kit\":\"kit\"},on={fakd:\"kit-duotone\",\"fa-kit-duotone\":\"kit-duotone\"},dn=(p(p({},\"kit\",\"Kit\"),\"kit-duotone\",\"Kit Duotone\"),{kit:\"fak\"}),sn={\"kit-duotone\":\"fakd\"},ln=\"duotone-group\",cn=\"swap-opacity\",pn=\"primary\",gn=\"secondary\",fn=(p(p(p(p(p(p(p(p(p(p(_={},\"classic\",\"Classic\"),\"duotone\",\"Duotone\"),\"sharp\",\"Sharp\"),\"sharp-duotone\",\"Sharp Duotone\"),\"chisel\",\"Chisel\"),\"etch\",\"Etch\"),\"jelly\",\"Jelly\"),\"jelly-duo\",\"Jelly Duo\"),\"jelly-fill\",\"Jelly Fill\"),\"notdog\",\"Notdog\"),p(p(p(p(p(p(p(p(_,\"notdog-duo\",\"Notdog Duo\"),\"slab\",\"Slab\"),\"slab-press\",\"Slab Press\"),\"thumbprint\",\"Thumbprint\"),\"utility\",\"Utility\"),\"utility-duo\",\"Utility Duo\"),\"utility-fill\",\"Utility Fill\"),\"whiteboard\",\"Whiteboard\"),p(p({},\"kit\",\"Kit\"),\"kit-duotone\",\"Kit Duotone\"),{classic:{fab:\"fa-brands\",fad:\"fa-duotone\",fal:\"fa-light\",far:\"fa-regular\",fas:\"fa-solid\",fat:\"fa-thin\"},duotone:{fadr:\"fa-regular\",fadl:\"fa-light\",fadt:\"fa-thin\"},sharp:{fass:\"fa-solid\",fasr:\"fa-regular\",fasl:\"fa-light\",fast:\"fa-thin\"},\"sharp-duotone\":{fasds:\"fa-solid\",fasdr:\"fa-regular\",fasdl:\"fa-light\",fasdt:\"fa-thin\"},slab:{faslr:\"fa-regular\"},\"slab-press\":{faslpr:\"fa-regular\"},whiteboard:{fawsb:\"fa-semibold\"},thumbprint:{fatl:\"fa-light\"},notdog:{fans:\"fa-solid\"},\"notdog-duo\":{fands:\"fa-solid\"},etch:{faes:\"fa-solid\"},jelly:{fajr:\"fa-regular\"},\"jelly-fill\":{fajfr:\"fa-regular\"},\"jelly-duo\":{fajdr:\"fa-regular\"},chisel:{facr:\"fa-regular\"},utility:{fausb:\"fa-semibold\"},\"utility-duo\":{faudsb:\"fa-semibold\"},\"utility-fill\":{faufsb:\"fa-semibold\"}}),bn=[\"fa\",\"fas\",\"far\",\"fal\",\"fat\",\"fad\",\"fadr\",\"fadl\",\"fadt\",\"fab\",\"fass\",\"fasr\",\"fasl\",\"fast\",\"fasds\",\"fasdr\",\"fasdl\",\"fasdt\",\"faslr\",\"faslpr\",\"fawsb\",\"fatl\",\"fans\",\"fands\",\"faes\",\"fajr\",\"fajfr\",\"fajdr\",\"facr\",\"fausb\",\"faudsb\",\"faufsb\"].concat([\"fa-classic\",\"fa-duotone\",\"fa-sharp\",\"fa-sharp-duotone\",\"fa-thumbprint\",\"fa-whiteboard\",\"fa-notdog\",\"fa-notdog-duo\",\"fa-chisel\",\"fa-etch\",\"fa-jelly\",\"fa-jelly-fill\",\"fa-jelly-duo\",\"fa-slab\",\"fa-slab-press\",\"fa-utility\",\"fa-utility-duo\",\"fa-utility-fill\"],[\"fa-solid\",\"fa-regular\",\"fa-light\",\"fa-thin\",\"fa-duotone\",\"fa-brands\",\"fa-semibold\"]),mn=[1,2,3,4,5,6,7,8,9,10],un=mn.concat([11,12,13,14,15,16,17,18,19,20]),hn=[].concat(m(Object.keys({classic:[\"fas\",\"far\",\"fal\",\"fat\",\"fad\"],duotone:[\"fadr\",\"fadl\",\"fadt\"],sharp:[\"fass\",\"fasr\",\"fasl\",\"fast\"],\"sharp-duotone\":[\"fasds\",\"fasdr\",\"fasdl\",\"fasdt\"],slab:[\"faslr\"],\"slab-press\":[\"faslpr\"],whiteboard:[\"fawsb\"],thumbprint:[\"fatl\"],notdog:[\"fans\"],\"notdog-duo\":[\"fands\"],etch:[\"faes\"],jelly:[\"fajr\"],\"jelly-fill\":[\"fajfr\"],\"jelly-duo\":[\"fajdr\"],chisel:[\"facr\"],utility:[\"fausb\"],\"utility-duo\":[\"faudsb\"],\"utility-fill\":[\"faufsb\"]})),[\"solid\",\"regular\",\"light\",\"thin\",\"duotone\",\"brands\",\"semibold\"],[\"aw\",\"fw\",\"pull-left\",\"pull-right\"],[\"2xs\",\"xs\",\"sm\",\"lg\",\"xl\",\"2xl\",\"beat\",\"border\",\"fade\",\"beat-fade\",\"bounce\",\"flip-both\",\"flip-horizontal\",\"flip-vertical\",\"flip\",\"inverse\",\"layers\",\"layers-bottom-left\",\"layers-bottom-right\",\"layers-counter\",\"layers-text\",\"layers-top-left\",\"layers-top-right\",\"li\",\"pull-end\",\"pull-start\",\"pulse\",\"rotate-180\",\"rotate-270\",\"rotate-90\",\"rotate-by\",\"shake\",\"spin-pulse\",\"spin-reverse\",\"spin\",\"stack-1x\",\"stack-2x\",\"stack\",\"ul\",\"width-auto\",\"width-fixed\",ln,cn,pn,gn]).concat(mn.map(function(n){return\"\".concat(n,\"x\")})).concat(un.map(function(n){return\"w-\".concat(n)})),xn=\"___FONT_AWESOME___\",vn=\"svg-inline--fa\",yn=\"data-fa-i2svg\",wn=\"data-fa-pseudo-element\",kn=\"data-prefix\",Sn=\"data-icon\",Cn=\"fontawesome-i2svg\",$n=[\"HTML\",\"HEAD\",\"STYLE\",\"SCRIPT\"],_n=[\"::before\",\"::after\",\":before\",\":after\"],zn=function(){try{return!0}catch(n){return!1}}();function Dn(n){return new Proxy(n,{get:function(n,t){return t in n?n[t]:n[L]}})}var In=f({},N);In[L]=f(f(f(f({},{\"fa-duotone\":\"duotone\"}),N[L]),rn),on);var An=Dn(In),Pn=f({},{chisel:{regular:\"facr\"},classic:{brands:\"fab\",light:\"fal\",regular:\"far\",solid:\"fas\",thin:\"fat\"},duotone:{light:\"fadl\",regular:\"fadr\",solid:\"fad\",thin:\"fadt\"},etch:{solid:\"faes\"},jelly:{regular:\"fajr\"},\"jelly-duo\":{regular:\"fajdr\"},\"jelly-fill\":{regular:\"fajfr\"},notdog:{solid:\"fans\"},\"notdog-duo\":{solid:\"fands\"},sharp:{light:\"fasl\",regular:\"fasr\",solid:\"fass\",thin:\"fast\"},\"sharp-duotone\":{light:\"fasdl\",regular:\"fasdr\",solid:\"fasds\",thin:\"fasdt\"},slab:{regular:\"faslr\"},\"slab-press\":{regular:\"faslpr\"},thumbprint:{light:\"fatl\"},utility:{semibold:\"fausb\"},\"utility-duo\":{semibold:\"faudsb\"},\"utility-fill\":{semibold:\"faufsb\"},whiteboard:{semibold:\"fawsb\"}});Pn[L]=f(f(f(f({},{duotone:\"fad\"}),Pn[L]),dn),sn);var En=Dn(Pn),Tn=f({},fn);Tn[L]=f(f({},Tn[L]),{fak:\"fa-kit\"});var Mn=Dn(Tn),Nn=f({},{classic:{\"fa-brands\":\"fab\",\"fa-duotone\":\"fad\",\"fa-light\":\"fal\",\"fa-regular\":\"far\",\"fa-solid\":\"fas\",\"fa-thin\":\"fat\"},duotone:{\"fa-regular\":\"fadr\",\"fa-light\":\"fadl\",\"fa-thin\":\"fadt\"},sharp:{\"fa-solid\":\"fass\",\"fa-regular\":\"fasr\",\"fa-light\":\"fasl\",\"fa-thin\":\"fast\"},\"sharp-duotone\":{\"fa-solid\":\"fasds\",\"fa-regular\":\"fasdr\",\"fa-light\":\"fasdl\",\"fa-thin\":\"fasdt\"},slab:{\"fa-regular\":\"faslr\"},\"slab-press\":{\"fa-regular\":\"faslpr\"},whiteboard:{\"fa-semibold\":\"fawsb\"},thumbprint:{\"fa-light\":\"fatl\"},notdog:{\"fa-solid\":\"fans\"},\"notdog-duo\":{\"fa-solid\":\"fands\"},etch:{\"fa-solid\":\"faes\"},jelly:{\"fa-regular\":\"fajr\"},\"jelly-fill\":{\"fa-regular\":\"fajfr\"},\"jelly-duo\":{\"fa-regular\":\"fajdr\"},chisel:{\"fa-regular\":\"facr\"},utility:{\"fa-semibold\":\"fausb\"},\"utility-duo\":{\"fa-semibold\":\"faudsb\"},\"utility-fill\":{\"fa-semibold\":\"faufsb\"}});Nn[L]=f(f({},Nn[L]),{\"fa-kit\":\"fak\"});Dn(Nn);var On=/fa(k|kd|s|r|l|t|d|dr|dl|dt|b|slr|slpr|wsb|tl|ns|nds|es|jr|jfr|jdr|usb|ufsb|udsb|cr|ss|sr|sl|st|sds|sdr|sdl|sdt)?[\\-\\ ]/,Ln=\"fa-layers-text\",Rn=/Font ?Awesome ?([567 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit|Notdog Duo|Notdog|Chisel|Etch|Thumbprint|Jelly Fill|Jelly Duo|Jelly|Utility|Utility Fill|Utility Duo|Slab Press|Slab|Whiteboard)?.*/i,jn=(Dn(f({},{classic:{900:\"fas\",400:\"far\",normal:\"far\",300:\"fal\",100:\"fat\"},duotone:{900:\"fad\",400:\"fadr\",300:\"fadl\",100:\"fadt\"},sharp:{900:\"fass\",400:\"fasr\",300:\"fasl\",100:\"fast\"},\"sharp-duotone\":{900:\"fasds\",400:\"fasdr\",300:\"fasdl\",100:\"fasdt\"},slab:{400:\"faslr\"},\"slab-press\":{400:\"faslpr\"},whiteboard:{600:\"fawsb\"},thumbprint:{300:\"fatl\"},notdog:{900:\"fans\"},\"notdog-duo\":{900:\"fands\"},etch:{900:\"faes\"},chisel:{400:\"facr\"},jelly:{400:\"fajr\"},\"jelly-fill\":{400:\"fajfr\"},\"jelly-duo\":{400:\"fajdr\"},utility:{600:\"fausb\"},\"utility-duo\":{600:\"faudsb\"},\"utility-fill\":{600:\"faufsb\"}})),[\"class\",\"data-prefix\",\"data-icon\",\"data-fa-transform\",\"data-fa-mask\"]),Fn={GROUP:\"duotone-group\",SWAP_OPACITY:\"swap-opacity\",PRIMARY:\"primary\",SECONDARY:\"secondary\"},Un=[].concat(m([\"kit\"]),m(hn)),Yn=I.FontAwesomeConfig||{};if(A&&\"function\"==typeof A.querySelector){[[\"data-family-prefix\",\"familyPrefix\"],[\"data-css-prefix\",\"cssPrefix\"],[\"data-family-default\",\"familyDefault\"],[\"data-style-default\",\"styleDefault\"],[\"data-replacement-class\",\"replacementClass\"],[\"data-auto-replace-svg\",\"autoReplaceSvg\"],[\"data-auto-add-css\",\"autoAddCss\"],[\"data-search-pseudo-elements\",\"searchPseudoElements\"],[\"data-search-pseudo-elements-warnings\",\"searchPseudoElementsWarnings\"],[\"data-search-pseudo-elements-full-scan\",\"searchPseudoElementsFullScan\"],[\"data-observe-mutations\",\"observeMutations\"],[\"data-mutate-approach\",\"mutateApproach\"],[\"data-keep-original-source\",\"keepOriginalSource\"],[\"data-measure-performance\",\"measurePerformance\"],[\"data-show-missing-icons\",\"showMissingIcons\"]].forEach(function(n){var t=b(n,2),e=t[0],a=t[1],r=function(n){return\"\"===n||\"false\"!==n&&(\"true\"===n||n)}(function(n){var t=A.querySelector(\"script[\"+n+\"]\");if(t)return t.getAttribute(n)}(e));null!=r&&(Yn[a]=r)})}var Hn={styleDefault:\"solid\",familyDefault:L,cssPrefix:\"fa\",replacementClass:vn,autoReplaceSvg:!0,autoAddCss:!0,searchPseudoElements:!1,searchPseudoElementsWarnings:!0,searchPseudoElementsFullScan:!1,observeMutations:!0,mutateApproach:\"async\",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Yn.familyPrefix&&(Yn.cssPrefix=Yn.familyPrefix);var Bn=f(f({},Hn),Yn);Bn.autoReplaceSvg||(Bn.observeMutations=!1);var Gn={};Object.keys(Hn).forEach(function(n){Object.defineProperty(Gn,n,{enumerable:!0,set:function(t){Bn[n]=t,Xn.forEach(function(n){return n(Gn)})},get:function(){return Bn[n]}})}),Object.defineProperty(Gn,\"familyPrefix\",{enumerable:!0,set:function(n){Bn.cssPrefix=n,Xn.forEach(function(n){return n(Gn)})},get:function(){return Bn.cssPrefix}}),I.FontAwesomeConfig=Gn;var Xn=[];var Wn=16,Vn={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function qn(){for(var n=12,t=\"\";n-- >0;)t+=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"[62*Math.random()|0];return t}function Kn(n){for(var t=[],e=(n||[]).length>>>0;e--;)t[e]=n[e];return t}function Jn(n){return n.classList?Kn(n.classList):(n.getAttribute(\"class\")||\"\").split(\" \").filter(function(n){return n})}function Qn(n){return\"\".concat(n).replace(/&/g,\"&amp;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\")}function Zn(n){return Object.keys(n||{}).reduce(function(t,e){return t+\"\".concat(e,\": \").concat(n[e].trim(),\";\")},\"\")}function nt(n){return n.size!==Vn.size||n.x!==Vn.x||n.y!==Vn.y||n.rotate!==Vn.rotate||n.flipX||n.flipY}function tt(){var n=\"fa\",t=vn,e=Gn.cssPrefix,a=Gn.replacementClass,r=':root, :host {\\n  --fa-font-solid: normal 900 1em/1 \"Font Awesome 7 Free\";\\n  --fa-font-regular: normal 400 1em/1 \"Font Awesome 7 Free\";\\n  --fa-font-light: normal 300 1em/1 \"Font Awesome 7 Pro\";\\n  --fa-font-thin: normal 100 1em/1 \"Font Awesome 7 Pro\";\\n  --fa-font-duotone: normal 900 1em/1 \"Font Awesome 7 Duotone\";\\n  --fa-font-duotone-regular: normal 400 1em/1 \"Font Awesome 7 Duotone\";\\n  --fa-font-duotone-light: normal 300 1em/1 \"Font Awesome 7 Duotone\";\\n  --fa-font-duotone-thin: normal 100 1em/1 \"Font Awesome 7 Duotone\";\\n  --fa-font-brands: normal 400 1em/1 \"Font Awesome 7 Brands\";\\n  --fa-font-sharp-solid: normal 900 1em/1 \"Font Awesome 7 Sharp\";\\n  --fa-font-sharp-regular: normal 400 1em/1 \"Font Awesome 7 Sharp\";\\n  --fa-font-sharp-light: normal 300 1em/1 \"Font Awesome 7 Sharp\";\\n  --fa-font-sharp-thin: normal 100 1em/1 \"Font Awesome 7 Sharp\";\\n  --fa-font-sharp-duotone-solid: normal 900 1em/1 \"Font Awesome 7 Sharp Duotone\";\\n  --fa-font-sharp-duotone-regular: normal 400 1em/1 \"Font Awesome 7 Sharp Duotone\";\\n  --fa-font-sharp-duotone-light: normal 300 1em/1 \"Font Awesome 7 Sharp Duotone\";\\n  --fa-font-sharp-duotone-thin: normal 100 1em/1 \"Font Awesome 7 Sharp Duotone\";\\n  --fa-font-slab-regular: normal 400 1em/1 \"Font Awesome 7 Slab\";\\n  --fa-font-slab-press-regular: normal 400 1em/1 \"Font Awesome 7 Slab Press\";\\n  --fa-font-whiteboard-semibold: normal 600 1em/1 \"Font Awesome 7 Whiteboard\";\\n  --fa-font-thumbprint-light: normal 300 1em/1 \"Font Awesome 7 Thumbprint\";\\n  --fa-font-notdog-solid: normal 900 1em/1 \"Font Awesome 7 Notdog\";\\n  --fa-font-notdog-duo-solid: normal 900 1em/1 \"Font Awesome 7 Notdog Duo\";\\n  --fa-font-etch-solid: normal 900 1em/1 \"Font Awesome 7 Etch\";\\n  --fa-font-jelly-regular: normal 400 1em/1 \"Font Awesome 7 Jelly\";\\n  --fa-font-jelly-fill-regular: normal 400 1em/1 \"Font Awesome 7 Jelly Fill\";\\n  --fa-font-jelly-duo-regular: normal 400 1em/1 \"Font Awesome 7 Jelly Duo\";\\n  --fa-font-chisel-regular: normal 400 1em/1 \"Font Awesome 7 Chisel\";\\n  --fa-font-utility-semibold: normal 600 1em/1 \"Font Awesome 7 Utility\";\\n  --fa-font-utility-duo-semibold: normal 600 1em/1 \"Font Awesome 7 Utility Duo\";\\n  --fa-font-utility-fill-semibold: normal 600 1em/1 \"Font Awesome 7 Utility Fill\";\\n}\\n\\n.svg-inline--fa {\\n  box-sizing: content-box;\\n  display: var(--fa-display, inline-block);\\n  height: 1em;\\n  overflow: visible;\\n  vertical-align: -0.125em;\\n  width: var(--fa-width, 1.25em);\\n}\\n.svg-inline--fa.fa-2xs {\\n  vertical-align: 0.1em;\\n}\\n.svg-inline--fa.fa-xs {\\n  vertical-align: 0em;\\n}\\n.svg-inline--fa.fa-sm {\\n  vertical-align: -0.0714285714em;\\n}\\n.svg-inline--fa.fa-lg {\\n  vertical-align: -0.2em;\\n}\\n.svg-inline--fa.fa-xl {\\n  vertical-align: -0.25em;\\n}\\n.svg-inline--fa.fa-2xl {\\n  vertical-align: -0.3125em;\\n}\\n.svg-inline--fa.fa-pull-left,\\n.svg-inline--fa .fa-pull-start {\\n  float: inline-start;\\n  margin-inline-end: var(--fa-pull-margin, 0.3em);\\n}\\n.svg-inline--fa.fa-pull-right,\\n.svg-inline--fa .fa-pull-end {\\n  float: inline-end;\\n  margin-inline-start: var(--fa-pull-margin, 0.3em);\\n}\\n.svg-inline--fa.fa-li {\\n  width: var(--fa-li-width, 2em);\\n  inset-inline-start: calc(-1 * var(--fa-li-width, 2em));\\n  inset-block-start: 0.25em; /* syncing vertical alignment with Web Font rendering */\\n}\\n\\n.fa-layers-counter, .fa-layers-text {\\n  display: inline-block;\\n  position: absolute;\\n  text-align: center;\\n}\\n\\n.fa-layers {\\n  display: inline-block;\\n  height: 1em;\\n  position: relative;\\n  text-align: center;\\n  vertical-align: -0.125em;\\n  width: var(--fa-width, 1.25em);\\n}\\n.fa-layers .svg-inline--fa {\\n  inset: 0;\\n  margin: auto;\\n  position: absolute;\\n  transform-origin: center center;\\n}\\n\\n.fa-layers-text {\\n  left: 50%;\\n  top: 50%;\\n  transform: translate(-50%, -50%);\\n  transform-origin: center center;\\n}\\n\\n.fa-layers-counter {\\n  background-color: var(--fa-counter-background-color, #ff253a);\\n  border-radius: var(--fa-counter-border-radius, 1em);\\n  box-sizing: border-box;\\n  color: var(--fa-inverse, #fff);\\n  line-height: var(--fa-counter-line-height, 1);\\n  max-width: var(--fa-counter-max-width, 5em);\\n  min-width: var(--fa-counter-min-width, 1.5em);\\n  overflow: hidden;\\n  padding: var(--fa-counter-padding, 0.25em 0.5em);\\n  right: var(--fa-right, 0);\\n  text-overflow: ellipsis;\\n  top: var(--fa-top, 0);\\n  transform: scale(var(--fa-counter-scale, 0.25));\\n  transform-origin: top right;\\n}\\n\\n.fa-layers-bottom-right {\\n  bottom: var(--fa-bottom, 0);\\n  right: var(--fa-right, 0);\\n  top: auto;\\n  transform: scale(var(--fa-layers-scale, 0.25));\\n  transform-origin: bottom right;\\n}\\n\\n.fa-layers-bottom-left {\\n  bottom: var(--fa-bottom, 0);\\n  left: var(--fa-left, 0);\\n  right: auto;\\n  top: auto;\\n  transform: scale(var(--fa-layers-scale, 0.25));\\n  transform-origin: bottom left;\\n}\\n\\n.fa-layers-top-right {\\n  top: var(--fa-top, 0);\\n  right: var(--fa-right, 0);\\n  transform: scale(var(--fa-layers-scale, 0.25));\\n  transform-origin: top right;\\n}\\n\\n.fa-layers-top-left {\\n  left: var(--fa-left, 0);\\n  right: auto;\\n  top: var(--fa-top, 0);\\n  transform: scale(var(--fa-layers-scale, 0.25));\\n  transform-origin: top left;\\n}\\n\\n.fa-1x {\\n  font-size: 1em;\\n}\\n\\n.fa-2x {\\n  font-size: 2em;\\n}\\n\\n.fa-3x {\\n  font-size: 3em;\\n}\\n\\n.fa-4x {\\n  font-size: 4em;\\n}\\n\\n.fa-5x {\\n  font-size: 5em;\\n}\\n\\n.fa-6x {\\n  font-size: 6em;\\n}\\n\\n.fa-7x {\\n  font-size: 7em;\\n}\\n\\n.fa-8x {\\n  font-size: 8em;\\n}\\n\\n.fa-9x {\\n  font-size: 9em;\\n}\\n\\n.fa-10x {\\n  font-size: 10em;\\n}\\n\\n.fa-2xs {\\n  font-size: calc(10 / 16 * 1em); /* converts a 10px size into an em-based value that\\'s relative to the scale\\'s 16px base */\\n  line-height: calc(1 / 10 * 1em); /* sets the line-height of the icon back to that of it\\'s parent */\\n  vertical-align: calc((6 / 10 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text\\'s descender */\\n}\\n\\n.fa-xs {\\n  font-size: calc(12 / 16 * 1em); /* converts a 12px size into an em-based value that\\'s relative to the scale\\'s 16px base */\\n  line-height: calc(1 / 12 * 1em); /* sets the line-height of the icon back to that of it\\'s parent */\\n  vertical-align: calc((6 / 12 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text\\'s descender */\\n}\\n\\n.fa-sm {\\n  font-size: calc(14 / 16 * 1em); /* converts a 14px size into an em-based value that\\'s relative to the scale\\'s 16px base */\\n  line-height: calc(1 / 14 * 1em); /* sets the line-height of the icon back to that of it\\'s parent */\\n  vertical-align: calc((6 / 14 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text\\'s descender */\\n}\\n\\n.fa-lg {\\n  font-size: calc(20 / 16 * 1em); /* converts a 20px size into an em-based value that\\'s relative to the scale\\'s 16px base */\\n  line-height: calc(1 / 20 * 1em); /* sets the line-height of the icon back to that of it\\'s parent */\\n  vertical-align: calc((6 / 20 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text\\'s descender */\\n}\\n\\n.fa-xl {\\n  font-size: calc(24 / 16 * 1em); /* converts a 24px size into an em-based value that\\'s relative to the scale\\'s 16px base */\\n  line-height: calc(1 / 24 * 1em); /* sets the line-height of the icon back to that of it\\'s parent */\\n  vertical-align: calc((6 / 24 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text\\'s descender */\\n}\\n\\n.fa-2xl {\\n  font-size: calc(32 / 16 * 1em); /* converts a 32px size into an em-based value that\\'s relative to the scale\\'s 16px base */\\n  line-height: calc(1 / 32 * 1em); /* sets the line-height of the icon back to that of it\\'s parent */\\n  vertical-align: calc((6 / 32 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text\\'s descender */\\n}\\n\\n.fa-width-auto {\\n  --fa-width: auto;\\n}\\n\\n.fa-fw,\\n.fa-width-fixed {\\n  --fa-width: 1.25em;\\n}\\n\\n.fa-ul {\\n  list-style-type: none;\\n  margin-inline-start: var(--fa-li-margin, 2.5em);\\n  padding-inline-start: 0;\\n}\\n.fa-ul > li {\\n  position: relative;\\n}\\n\\n.fa-li {\\n  inset-inline-start: calc(-1 * var(--fa-li-width, 2em));\\n  position: absolute;\\n  text-align: center;\\n  width: var(--fa-li-width, 2em);\\n  line-height: inherit;\\n}\\n\\n/* Heads Up: Bordered Icons will not be supported in the future!\\n  - This feature will be deprecated in the next major release of Font Awesome (v8)!\\n  - You may continue to use it in this version *v7), but it will not be supported in Font Awesome v8.\\n*/\\n/* Notes:\\n* --@{v.$css-prefix}-border-width = 1/16 by default (to render as ~1px based on a 16px default font-size)\\n* --@{v.$css-prefix}-border-padding =\\n  ** 3/16 for vertical padding (to give ~2px of vertical whitespace around an icon considering it\\'s vertical alignment)\\n  ** 4/16 for horizontal padding (to give ~4px of horizontal whitespace around an icon)\\n*/\\n.fa-border {\\n  border-color: var(--fa-border-color, #eee);\\n  border-radius: var(--fa-border-radius, 0.1em);\\n  border-style: var(--fa-border-style, solid);\\n  border-width: var(--fa-border-width, 0.0625em);\\n  box-sizing: var(--fa-border-box-sizing, content-box);\\n  padding: var(--fa-border-padding, 0.1875em 0.25em);\\n}\\n\\n.fa-pull-left,\\n.fa-pull-start {\\n  float: inline-start;\\n  margin-inline-end: var(--fa-pull-margin, 0.3em);\\n}\\n\\n.fa-pull-right,\\n.fa-pull-end {\\n  float: inline-end;\\n  margin-inline-start: var(--fa-pull-margin, 0.3em);\\n}\\n\\n.fa-beat {\\n  animation-name: fa-beat;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, ease-in-out);\\n}\\n\\n.fa-bounce {\\n  animation-name: fa-bounce;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));\\n}\\n\\n.fa-fade {\\n  animation-name: fa-fade;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\\n}\\n\\n.fa-beat-fade {\\n  animation-name: fa-beat-fade;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\\n}\\n\\n.fa-flip {\\n  animation-name: fa-flip;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, ease-in-out);\\n}\\n\\n.fa-shake {\\n  animation-name: fa-shake;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, linear);\\n}\\n\\n.fa-spin {\\n  animation-name: fa-spin;\\n  animation-delay: var(--fa-animation-delay, 0s);\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 2s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, linear);\\n}\\n\\n.fa-spin-reverse {\\n  --fa-animation-direction: reverse;\\n}\\n\\n.fa-pulse,\\n.fa-spin-pulse {\\n  animation-name: fa-spin;\\n  animation-direction: var(--fa-animation-direction, normal);\\n  animation-duration: var(--fa-animation-duration, 1s);\\n  animation-iteration-count: var(--fa-animation-iteration-count, infinite);\\n  animation-timing-function: var(--fa-animation-timing, steps(8));\\n}\\n\\n@media (prefers-reduced-motion: reduce) {\\n  .fa-beat,\\n  .fa-bounce,\\n  .fa-fade,\\n  .fa-beat-fade,\\n  .fa-flip,\\n  .fa-pulse,\\n  .fa-shake,\\n  .fa-spin,\\n  .fa-spin-pulse {\\n    animation: none !important;\\n    transition: none !important;\\n  }\\n}\\n@keyframes fa-beat {\\n  0%, 90% {\\n    transform: scale(1);\\n  }\\n  45% {\\n    transform: scale(var(--fa-beat-scale, 1.25));\\n  }\\n}\\n@keyframes fa-bounce {\\n  0% {\\n    transform: scale(1, 1) translateY(0);\\n  }\\n  10% {\\n    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\\n  }\\n  30% {\\n    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\\n  }\\n  50% {\\n    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\\n  }\\n  57% {\\n    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\\n  }\\n  64% {\\n    transform: scale(1, 1) translateY(0);\\n  }\\n  100% {\\n    transform: scale(1, 1) translateY(0);\\n  }\\n}\\n@keyframes fa-fade {\\n  50% {\\n    opacity: var(--fa-fade-opacity, 0.4);\\n  }\\n}\\n@keyframes fa-beat-fade {\\n  0%, 100% {\\n    opacity: var(--fa-beat-fade-opacity, 0.4);\\n    transform: scale(1);\\n  }\\n  50% {\\n    opacity: 1;\\n    transform: scale(var(--fa-beat-fade-scale, 1.125));\\n  }\\n}\\n@keyframes fa-flip {\\n  50% {\\n    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\\n  }\\n}\\n@keyframes fa-shake {\\n  0% {\\n    transform: rotate(-15deg);\\n  }\\n  4% {\\n    transform: rotate(15deg);\\n  }\\n  8%, 24% {\\n    transform: rotate(-18deg);\\n  }\\n  12%, 28% {\\n    transform: rotate(18deg);\\n  }\\n  16% {\\n    transform: rotate(-22deg);\\n  }\\n  20% {\\n    transform: rotate(22deg);\\n  }\\n  32% {\\n    transform: rotate(-12deg);\\n  }\\n  36% {\\n    transform: rotate(12deg);\\n  }\\n  40%, 100% {\\n    transform: rotate(0deg);\\n  }\\n}\\n@keyframes fa-spin {\\n  0% {\\n    transform: rotate(0deg);\\n  }\\n  100% {\\n    transform: rotate(360deg);\\n  }\\n}\\n.fa-rotate-90 {\\n  transform: rotate(90deg);\\n}\\n\\n.fa-rotate-180 {\\n  transform: rotate(180deg);\\n}\\n\\n.fa-rotate-270 {\\n  transform: rotate(270deg);\\n}\\n\\n.fa-flip-horizontal {\\n  transform: scale(-1, 1);\\n}\\n\\n.fa-flip-vertical {\\n  transform: scale(1, -1);\\n}\\n\\n.fa-flip-both,\\n.fa-flip-horizontal.fa-flip-vertical {\\n  transform: scale(-1, -1);\\n}\\n\\n.fa-rotate-by {\\n  transform: rotate(var(--fa-rotate-angle, 0));\\n}\\n\\n.svg-inline--fa .fa-primary {\\n  fill: var(--fa-primary-color, currentColor);\\n  opacity: var(--fa-primary-opacity, 1);\\n}\\n\\n.svg-inline--fa .fa-secondary {\\n  fill: var(--fa-secondary-color, currentColor);\\n  opacity: var(--fa-secondary-opacity, 0.4);\\n}\\n\\n.svg-inline--fa.fa-swap-opacity .fa-primary {\\n  opacity: var(--fa-secondary-opacity, 0.4);\\n}\\n\\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\\n  opacity: var(--fa-primary-opacity, 1);\\n}\\n\\n.svg-inline--fa mask .fa-primary,\\n.svg-inline--fa mask .fa-secondary {\\n  fill: black;\\n}\\n\\n.svg-inline--fa.fa-inverse {\\n  fill: var(--fa-inverse, #fff);\\n}\\n\\n.fa-stack {\\n  display: inline-block;\\n  height: 2em;\\n  line-height: 2em;\\n  position: relative;\\n  vertical-align: middle;\\n  width: 2.5em;\\n}\\n\\n.fa-inverse {\\n  color: var(--fa-inverse, #fff);\\n}\\n\\n.svg-inline--fa.fa-stack-1x {\\n  --fa-width: 1.25em;\\n  height: 1em;\\n  width: var(--fa-width);\\n}\\n.svg-inline--fa.fa-stack-2x {\\n  --fa-width: 2.5em;\\n  height: 2em;\\n  width: var(--fa-width);\\n}\\n\\n.fa-stack-1x,\\n.fa-stack-2x {\\n  inset: 0;\\n  margin: auto;\\n  position: absolute;\\n  z-index: var(--fa-stack-z-index, auto);\\n}';if(e!==n||a!==t){var o=new RegExp(\"\\\\.\".concat(n,\"\\\\-\"),\"g\"),i=new RegExp(\"\\\\--\".concat(n,\"\\\\-\"),\"g\"),d=new RegExp(\"\\\\.\".concat(t),\"g\");r=r.replace(o,\".\".concat(e,\"-\")).replace(i,\"--\".concat(e,\"-\")).replace(d,\".\".concat(a))}return r}var et=!1;function at(){Gn.autoAddCss&&!et&&(!function(n){if(n&&T){var t=A.createElement(\"style\");t.setAttribute(\"type\",\"text/css\"),t.innerHTML=n;for(var e=A.head.childNodes,a=null,r=e.length-1;r>-1;r--){var o=e[r],i=(o.tagName||\"\").toUpperCase();[\"STYLE\",\"LINK\"].indexOf(i)>-1&&(a=o)}A.head.insertBefore(t,a)}}(tt()),et=!0)}var rt={mixout:function(){return{dom:{css:tt,insertCss:at}}},hooks:function(){return{beforeDOMElementCreation:function(){at()},beforeI2svg:function(){at()}}}},ot=I||{};ot[xn]||(ot[xn]={}),ot[xn].styles||(ot[xn].styles={}),ot[xn].hooks||(ot[xn].hooks={}),ot[xn].shims||(ot[xn].shims=[]);var it=ot[xn],dt=[],st=function(){A.removeEventListener(\"DOMContentLoaded\",st),lt=1,dt.map(function(n){return n()})},lt=!1;function ct(n){var t=n.tag,e=n.attributes,a=void 0===e?{}:e,r=n.children,o=void 0===r?[]:r;return\"string\"==typeof n?Qn(n):\"<\".concat(t,\" \").concat(function(n){return Object.keys(n||{}).reduce(function(t,e){return t+\"\".concat(e,'=\"').concat(Qn(n[e]),'\" ')},\"\").trim()}(a),\">\").concat(o.map(ct).join(\"\"),\"</\").concat(t,\">\")}function pt(n,t,e){if(n&&n[t]&&n[t][e])return{prefix:t,iconName:e,icon:n[t][e]}}T&&((lt=(A.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(A.readyState))||A.addEventListener(\"DOMContentLoaded\",st));var gt=function(n,t,e,a){var r,o,i,d=Object.keys(n),s=d.length,l=void 0!==a?function(n,t){return function(e,a,r,o){return n.call(t,e,a,r,o)}}(t,a):t;for(void 0===e?(r=1,i=n[d[0]]):(r=0,i=e);r<s;r++)i=l(i,n[o=d[r]],o,n);return i};function ft(n){return 1!==m(n).length?null:n.codePointAt(0).toString(16)}function bt(n){return Object.keys(n).reduce(function(t,e){var a=n[e];return!!a.icon?t[a.iconName]=a.icon:t[e]=a,t},{})}function mt(n,t){var e=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipHooks,a=void 0!==e&&e,r=bt(t);\"function\"!=typeof it.hooks.addPack||a?it.styles[n]=f(f({},it.styles[n]||{}),r):it.hooks.addPack(n,bt(t)),\"fas\"===n&&mt(\"fa\",t)}var ut=it.styles,ht=it.shims,xt=Object.keys(Mn),vt=xt.reduce(function(n,t){return n[t]=Object.keys(Mn[t]),n},{}),yt=null,wt={},kt={},St={},Ct={},$t={};function _t(n,t){var e,a=t.split(\"-\"),r=a[0],o=a.slice(1).join(\"-\");return r!==n||\"\"===o||(e=o,~Un.indexOf(e))?null:o}var zt,Dt=function(){var n=function(n){return gt(ut,function(t,e,a){return t[a]=gt(e,n,{}),t},{})};wt=n(function(n,t,e){(t[3]&&(n[t[3]]=e),t[2])&&t[2].filter(function(n){return\"number\"==typeof n}).forEach(function(t){n[t.toString(16)]=e});return n}),kt=n(function(n,t,e){(n[e]=e,t[2])&&t[2].filter(function(n){return\"string\"==typeof n}).forEach(function(t){n[t]=e});return n}),$t=n(function(n,t,e){var a=t[2];return n[e]=e,a.forEach(function(t){n[t]=e}),n});var t=\"far\"in ut||Gn.autoFetchSvg,e=gt(ht,function(n,e){var a=e[0],r=e[1],o=e[2];return\"far\"!==r||t||(r=\"fas\"),\"string\"==typeof a&&(n.names[a]={prefix:r,iconName:o}),\"number\"==typeof a&&(n.unicodes[a.toString(16)]={prefix:r,iconName:o}),n},{names:{},unicodes:{}});St=e.names,Ct=e.unicodes,yt=Tt(Gn.styleDefault,{family:Gn.familyDefault})};function It(n,t){return(wt[n]||{})[t]}function At(n,t){return($t[n]||{})[t]}function Pt(n){return St[n]||{prefix:null,iconName:null}}function Et(){return yt}zt=function(n){yt=Tt(n.styleDefault,{family:Gn.familyDefault})},Xn.push(zt),Dt();function Tt(n){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).family,e=void 0===t?L:t,a=An[e][n];if(e===R&&!n)return\"fad\";var r=En[e][n]||En[e][a],o=n in it.styles?n:null;return r||o||null}function Mt(n){return n.sort().filter(function(n,t,e){return e.indexOf(n)===t})}var Nt=bn.concat(an);function Ot(n){var t,e,a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).skipLookups,r=void 0!==a&&a,o=null,i=Mt(n.filter(function(n){return Nt.includes(n)})),d=Mt(n.filter(function(n){return!Nt.includes(n)})),s=b(i.filter(function(n){return o=n,!O.includes(n)}),1)[0],l=void 0===s?null:s,c=function(n){var t=L,e=xt.reduce(function(n,t){return n[t]=\"\".concat(Gn.cssPrefix,\"-\").concat(t),n},{});return tn.forEach(function(a){(n.includes(e[a])||n.some(function(n){return vt[a].includes(n)}))&&(t=a)}),t}(i),p=f(f({},(t=[],e=null,d.forEach(function(n){var a=_t(Gn.cssPrefix,n);a?e=a:n&&t.push(n)}),{iconName:e,rest:t})),{},{prefix:Tt(l,{family:c})});return f(f(f({},p),function(n){var t=n.values,e=n.family,a=n.canonical,r=n.givenPrefix,o=void 0===r?\"\":r,i=n.styles,d=void 0===i?{}:i,s=n.config,l=void 0===s?{}:s,c=e===R,p=t.includes(\"fa-duotone\")||t.includes(\"fad\"),g=\"duotone\"===l.familyDefault,f=\"fad\"===a.prefix||\"fa-duotone\"===a.prefix;!c&&(p||g||f)&&(a.prefix=\"fad\");(t.includes(\"fa-brands\")||t.includes(\"fab\"))&&(a.prefix=\"fab\");if(!a.prefix&&Lt.includes(e)){if(Object.keys(d).find(function(n){return Rt.includes(n)})||l.autoFetchSvg){var b=en.get(e).defaultShortPrefixId;a.prefix=b,a.iconName=At(a.prefix,a.iconName)||a.iconName}}\"fa\"!==a.prefix&&\"fa\"!==o||(a.prefix=Et()||\"fas\");return a}({values:n,family:c,styles:ut,config:Gn,canonical:p,givenPrefix:o})),function(n,t,e){var a=e.prefix,r=e.iconName;if(n||!a||!r)return{prefix:a,iconName:r};var o=\"fa\"===t?Pt(r):{},i=At(a,r);r=o.iconName||i||r,a=o.prefix||a,\"far\"!==a||ut.far||!ut.fas||Gn.autoFetchSvg||(a=\"fas\");return{prefix:a,iconName:r}}(r,o,p))}var Lt=tn.filter(function(n){return n!==L||n!==R}),Rt=Object.keys(fn).filter(function(n){return n!==L}).map(function(n){return Object.keys(fn[n])}).flat();var jt=function(){return function(n,t,e){return t&&l(n.prototype,t),e&&l(n,e),Object.defineProperty(n,\"prototype\",{writable:!1}),n}(function n(){!function(n,t){if(!(n instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,n),this.definitions={}},[{key:\"add\",value:function(){for(var n=this,t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];var r=e.reduce(this._pullDefinitions,{});Object.keys(r).forEach(function(t){n.definitions[t]=f(f({},n.definitions[t]||{}),r[t]),mt(t,r[t]);var e=Mn[L][t];e&&mt(e,r[t]),Dt()})}},{key:\"reset\",value:function(){this.definitions={}}},{key:\"_pullDefinitions\",value:function(n,t){var e=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(e).map(function(t){var a=e[t],r=a.prefix,o=a.iconName,i=a.icon,d=i[2];n[r]||(n[r]={}),d.length>0&&d.forEach(function(t){\"string\"==typeof t&&(n[r][t]=i)}),n[r][o]=i}),n}}])}(),Ft=[],Ut={},Yt={},Ht=Object.keys(Yt);function Bt(n,t){for(var e=arguments.length,a=new Array(e>2?e-2:0),r=2;r<e;r++)a[r-2]=arguments[r];return(Ut[n]||[]).forEach(function(n){t=n.apply(null,[t].concat(a))}),t}function Gt(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),a=1;a<t;a++)e[a-1]=arguments[a];(Ut[n]||[]).forEach(function(n){n.apply(null,e)})}function Xt(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);return Yt[n]?Yt[n].apply(null,t):void 0}function Wt(n){\"fa\"===n.prefix&&(n.prefix=\"fas\");var t=n.iconName,e=n.prefix||Et();if(t)return t=At(e,t)||t,pt(Vt.definitions,e,t)||pt(it.styles,e,t)}var Vt=new jt,qt={i2svg:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T?(Gt(\"beforeI2svg\",n),Xt(\"pseudoElements2svg\",n),Xt(\"i2svg\",n)):Promise.reject(new Error(\"Operation requires a DOM of some kind.\"))},watch:function(){var n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.autoReplaceSvgRoot;!1===Gn.autoReplaceSvg&&(Gn.autoReplaceSvg=!0),Gn.observeMutations=!0,n=function(){Qt({autoReplaceSvgRoot:e}),Gt(\"watch\",t)},T&&(lt?setTimeout(n,0):dt.push(n))}},Kt={icon:function(n){if(null===n)return null;if(\"object\"===h(n)&&n.prefix&&n.iconName)return{prefix:n.prefix,iconName:At(n.prefix,n.iconName)||n.iconName};if(Array.isArray(n)&&2===n.length){var t=0===n[1].indexOf(\"fa-\")?n[1].slice(3):n[1],e=Tt(n[0]);return{prefix:e,iconName:At(e,t)||t}}if(\"string\"==typeof n&&(n.indexOf(\"\".concat(Gn.cssPrefix,\"-\"))>-1||n.match(On))){var a=Ot(n.split(\" \"),{skipLookups:!0});return{prefix:a.prefix||Et(),iconName:At(a.prefix,a.iconName)||a.iconName}}if(\"string\"==typeof n){var r=Et();return{prefix:r,iconName:At(r,n)||n}}}},Jt={noAuto:function(){Gn.autoReplaceSvg=!1,Gn.observeMutations=!1,Gt(\"noAuto\")},config:Gn,dom:qt,parse:Kt,library:Vt,findIconDefinition:Wt,toHtml:ct},Qt=function(){var n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).autoReplaceSvgRoot,t=void 0===n?A:n;(Object.keys(it.styles).length>0||Gn.autoFetchSvg)&&T&&Gn.autoReplaceSvg&&Jt.dom.i2svg({node:t})};function Zt(n,t){return Object.defineProperty(n,\"abstract\",{get:t}),Object.defineProperty(n,\"html\",{get:function(){return n.abstract.map(function(n){return ct(n)})}}),Object.defineProperty(n,\"node\",{get:function(){if(T){var t=A.createElement(\"div\");return t.innerHTML=n.html,t.children}}}),n}function ne(n){var t=n.icons,e=t.main,a=t.mask,r=n.prefix,o=n.iconName,i=n.transform,d=n.symbol,s=n.maskId,l=n.extra,c=n.watchable,p=void 0!==c&&c,g=a.found?a:e,b=g.width,m=g.height,u=[Gn.replacementClass,o?\"\".concat(Gn.cssPrefix,\"-\").concat(o):\"\"].filter(function(n){return-1===l.classes.indexOf(n)}).filter(function(n){return\"\"!==n||!!n}).concat(l.classes).join(\" \"),h={children:[],attributes:f(f({},l.attributes),{},{\"data-prefix\":r,\"data-icon\":o,class:u,role:l.attributes.role||\"img\",viewBox:\"0 0 \".concat(b,\" \").concat(m)})};(function(n){return[\"aria-label\",\"aria-labelledby\",\"title\",\"role\"].some(function(t){return t in n})})(l.attributes)||l.attributes[\"aria-hidden\"]||(h.attributes[\"aria-hidden\"]=\"true\"),p&&(h.attributes[yn]=\"\");var x=f(f({},h),{},{prefix:r,iconName:o,main:e,mask:a,maskId:s,transform:i,symbol:d,styles:f({},l.styles)}),v=a.found&&e.found?Xt(\"generateAbstractMask\",x)||{children:[],attributes:{}}:Xt(\"generateAbstractIcon\",x)||{children:[],attributes:{}},y=v.children,w=v.attributes;return x.children=y,x.attributes=w,d?function(n){var t=n.prefix,e=n.iconName,a=n.children,r=n.attributes,o=n.symbol,i=!0===o?\"\".concat(t,\"-\").concat(Gn.cssPrefix,\"-\").concat(e):o;return[{tag:\"svg\",attributes:{style:\"display: none;\"},children:[{tag:\"symbol\",attributes:f(f({},r),{},{id:i}),children:a}]}]}(x):function(n){var t=n.children,e=n.main,a=n.mask,r=n.attributes,o=n.styles,i=n.transform;if(nt(i)&&e.found&&!a.found){var d={x:e.width/e.height/2,y:.5};r.style=Zn(f(f({},o),{},{\"transform-origin\":\"\".concat(d.x+i.x/16,\"em \").concat(d.y+i.y/16,\"em\")}))}return[{tag:\"svg\",attributes:r,children:t}]}(x)}function te(n){var t=n.content,e=n.width,a=n.height,r=n.transform,o=n.extra,i=n.watchable,d=void 0!==i&&i,s=f(f({},o.attributes),{},{class:o.classes.join(\" \")});d&&(s[yn]=\"\");var l=f({},o.styles);nt(r)&&(l.transform=function(n){var t=n.transform,e=n.width,a=void 0===e?16:e,r=n.height,o=void 0===r?16:r,i=n.startCentered,d=void 0!==i&&i,s=\"\";return s+=d&&M?\"translate(\".concat(t.x/Wn-a/2,\"em, \").concat(t.y/Wn-o/2,\"em) \"):d?\"translate(calc(-50% + \".concat(t.x/Wn,\"em), calc(-50% + \").concat(t.y/Wn,\"em)) \"):\"translate(\".concat(t.x/Wn,\"em, \").concat(t.y/Wn,\"em) \"),s+=\"scale(\".concat(t.size/Wn*(t.flipX?-1:1),\", \").concat(t.size/Wn*(t.flipY?-1:1),\") \"),s+\"rotate(\".concat(t.rotate,\"deg) \")}({transform:r,startCentered:!0,width:e,height:a}),l[\"-webkit-transform\"]=l.transform);var c=Zn(l);c.length>0&&(s.style=c);var p=[];return p.push({tag:\"span\",attributes:s,children:[t]}),p}var ee=it.styles;function ae(n){var t=n[0],e=n[1],a=b(n.slice(4),1)[0];return{found:!0,width:t,height:e,icon:Array.isArray(a)?{tag:\"g\",attributes:{class:\"\".concat(Gn.cssPrefix,\"-\").concat(Fn.GROUP)},children:[{tag:\"path\",attributes:{class:\"\".concat(Gn.cssPrefix,\"-\").concat(Fn.SECONDARY),fill:\"currentColor\",d:a[0]}},{tag:\"path\",attributes:{class:\"\".concat(Gn.cssPrefix,\"-\").concat(Fn.PRIMARY),fill:\"currentColor\",d:a[1]}}]}:{tag:\"path\",attributes:{fill:\"currentColor\",d:a}}}}var re={found:!1,width:512,height:512};function oe(n,t){var e=t;return\"fa\"===t&&null!==Gn.styleDefault&&(t=Et()),new Promise(function(a,r){if(\"fa\"===e){var o=Pt(n)||{};n=o.iconName||n,t=o.prefix||t}if(n&&t&&ee[t]&&ee[t][n])return a(ae(ee[t][n]));!function(n,t){zn||Gn.showMissingIcons||!n||console.error('Icon with name \"'.concat(n,'\" and prefix \"').concat(t,'\" is missing.'))}(n,t),a(f(f({},re),{},{icon:Gn.showMissingIcons&&n&&Xt(\"missingIconAbstract\")||{}}))})}var ie=function(){},de=Gn.measurePerformance&&E&&E.mark&&E.measure?E:{mark:ie,measure:ie},se='FA \"7.1.0\"',le=function(n){de.mark(\"\".concat(se,\" \").concat(n,\" ends\")),de.measure(\"\".concat(se,\" \").concat(n),\"\".concat(se,\" \").concat(n,\" begins\"),\"\".concat(se,\" \").concat(n,\" ends\"))},ce=function(n){return de.mark(\"\".concat(se,\" \").concat(n,\" begins\")),function(){return le(n)}},pe=function(){};function ge(n){return\"string\"==typeof(n.getAttribute?n.getAttribute(yn):null)}function fe(n){return A.createElementNS(\"http://www.w3.org/2000/svg\",n)}function be(n){return A.createElement(n)}function me(n){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ceFn,e=void 0===t?\"svg\"===n.tag?fe:be:t;if(\"string\"==typeof n)return A.createTextNode(n);var a=e(n.tag);return Object.keys(n.attributes||[]).forEach(function(t){a.setAttribute(t,n.attributes[t])}),(n.children||[]).forEach(function(n){a.appendChild(me(n,{ceFn:e}))}),a}var ue={replace:function(n){var t=n[0];if(t.parentNode)if(n[1].forEach(function(n){t.parentNode.insertBefore(me(n),t)}),null===t.getAttribute(yn)&&Gn.keepOriginalSource){var e=A.createComment(function(n){var t=\" \".concat(n.outerHTML,\" \");return\"\".concat(t,\"Font Awesome fontawesome.com \")}(t));t.parentNode.replaceChild(e,t)}else t.remove()},nest:function(n){var t=n[0],e=n[1];if(~Jn(t).indexOf(Gn.replacementClass))return ue.replace(n);var a=new RegExp(\"\".concat(Gn.cssPrefix,\"-.*\"));if(delete e[0].attributes.id,e[0].attributes.class){var r=e[0].attributes.class.split(\" \").reduce(function(n,t){return t===Gn.replacementClass||t.match(a)?n.toSvg.push(t):n.toNode.push(t),n},{toNode:[],toSvg:[]});e[0].attributes.class=r.toSvg.join(\" \"),0===r.toNode.length?t.removeAttribute(\"class\"):t.setAttribute(\"class\",r.toNode.join(\" \"))}var o=e.map(function(n){return ct(n)}).join(\"\\n\");t.setAttribute(yn,\"\"),t.innerHTML=o}};function he(n){n()}function xe(n,t){var e=\"function\"==typeof t?t:pe;if(0===n.length)e();else{var a=he;\"async\"===Gn.mutateApproach&&(a=I.requestAnimationFrame||he),a(function(){var t=!0===Gn.autoReplaceSvg?ue.replace:ue[Gn.autoReplaceSvg]||ue.replace,a=ce(\"mutate\");n.map(t),a(),e()})}}var ve=!1;function ye(){ve=!0}function we(){ve=!1}var ke=null;function Se(n){if(P&&Gn.observeMutations){var t=n.treeCallback,e=void 0===t?pe:t,a=n.nodeCallback,r=void 0===a?pe:a,o=n.pseudoElementsCallback,i=void 0===o?pe:o,d=n.observeMutationsRoot,s=void 0===d?A:d;ke=new P(function(n){if(!ve){var t=Et();Kn(n).forEach(function(n){if(\"childList\"===n.type&&n.addedNodes.length>0&&!ge(n.addedNodes[0])&&(Gn.searchPseudoElements&&i(n.target),e(n.target)),\"attributes\"===n.type&&n.target.parentNode&&Gn.searchPseudoElements&&i([n.target],!0),\"attributes\"===n.type&&ge(n.target)&&~jn.indexOf(n.attributeName))if(\"class\"===n.attributeName&&function(n){var t=n.getAttribute?n.getAttribute(kn):null,e=n.getAttribute?n.getAttribute(Sn):null;return t&&e}(n.target)){var a=Ot(Jn(n.target)),o=a.prefix,d=a.iconName;n.target.setAttribute(kn,o||t),d&&n.target.setAttribute(Sn,d)}else(s=n.target)&&s.classList&&s.classList.contains&&s.classList.contains(Gn.replacementClass)&&r(n.target);var s})}}),T&&ke.observe(s,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function Ce(n){var t=n.getAttribute(\"data-prefix\"),e=n.getAttribute(\"data-icon\"),a=void 0!==n.innerText?n.innerText.trim():\"\",r=Ot(Jn(n));return r.prefix||(r.prefix=Et()),t&&e&&(r.prefix=t,r.iconName=e),r.iconName&&r.prefix||(r.prefix&&a.length>0&&(r.iconName=function(n,t){return(kt[n]||{})[t]}(r.prefix,n.innerText)||It(r.prefix,ft(n.innerText))),!r.iconName&&Gn.autoFetchSvg&&n.firstChild&&n.firstChild.nodeType===Node.TEXT_NODE&&(r.iconName=n.firstChild.data)),r}function $e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{styleParser:!0},e=Ce(n),a=e.iconName,r=e.prefix,o=e.rest,i=function(n){return Kn(n.attributes).reduce(function(n,t){return\"class\"!==n.name&&\"style\"!==n.name&&(n[t.name]=t.value),n},{})}(n),d=Bt(\"parseNodeAttributes\",{},n),s=t.styleParser?function(n){var t=n.getAttribute(\"style\"),e=[];return t&&(e=t.split(\";\").reduce(function(n,t){var e=t.split(\":\"),a=e[0],r=e.slice(1);return a&&r.length>0&&(n[a]=r.join(\":\").trim()),n},{})),e}(n):[];return f({iconName:a,prefix:r,transform:Vn,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:o,styles:s,attributes:i}},d)}var _e=it.styles;function ze(n){var t=\"nest\"===Gn.autoReplaceSvg?$e(n,{styleParser:!1}):$e(n);return~t.extra.classes.indexOf(Ln)?Xt(\"generateLayersText\",n,t):Xt(\"generateSvgReplacementMutation\",n,t)}function De(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!T)return Promise.resolve();var e=A.documentElement.classList,a=function(n){return e.add(\"\".concat(Cn,\"-\").concat(n))},r=function(n){return e.remove(\"\".concat(Cn,\"-\").concat(n))},o=Gn.autoFetchSvg?[].concat(m(an),m(bn)):O.concat(Object.keys(_e));o.includes(\"fa\")||o.push(\"fa\");var i=[\".\".concat(Ln,\":not([\").concat(yn,\"])\")].concat(o.map(function(n){return\".\".concat(n,\":not([\").concat(yn,\"])\")})).join(\", \");if(0===i.length)return Promise.resolve();var d=[];try{d=Kn(n.querySelectorAll(i))}catch(n){}if(!(d.length>0))return Promise.resolve();a(\"pending\"),r(\"complete\");var s=ce(\"onTree\"),l=d.reduce(function(n,t){try{var e=ze(t);e&&n.push(e)}catch(n){zn||\"MissingIcon\"===n.name&&console.error(n)}return n},[]);return new Promise(function(n,e){Promise.all(l).then(function(e){xe(e,function(){a(\"active\"),a(\"complete\"),r(\"pending\"),\"function\"==typeof t&&t(),s(),n()})}).catch(function(n){s(),e(n)})})}function Ie(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ze(n).then(function(n){n&&xe([n],t)})}var Ae=function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.transform,a=void 0===e?Vn:e,r=t.symbol,o=void 0!==r&&r,i=t.mask,d=void 0===i?null:i,s=t.maskId,l=void 0===s?null:s,c=t.classes,p=void 0===c?[]:c,g=t.attributes,b=void 0===g?{}:g,m=t.styles,u=void 0===m?{}:m;if(n){var h=n.prefix,x=n.iconName,v=n.icon;return Zt(f({type:\"icon\"},n),function(){return Gt(\"beforeDOMElementCreation\",{iconDefinition:n,params:t}),ne({icons:{main:ae(v),mask:d?ae(d.icon):{found:!1,width:null,height:null,icon:{}}},prefix:h,iconName:x,transform:f(f({},Vn),a),symbol:o,maskId:l,extra:{attributes:b,styles:u,classes:p}})})}},Pe={mixout:function(){return{icon:(n=Ae,function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(t||{}).icon?t:Wt(t||{}),r=e.mask;return r&&(r=(r||{}).icon?r:Wt(r||{})),n(a,f(f({},e),{},{mask:r}))})};var n},hooks:function(){return{mutationObserverCallbacks:function(n){return n.treeCallback=De,n.nodeCallback=Ie,n}}},provides:function(n){n.i2svg=function(n){var t=n.node,e=void 0===t?A:t,a=n.callback;return De(e,void 0===a?function(){}:a)},n.generateSvgReplacementMutation=function(n,t){var e=t.iconName,a=t.prefix,r=t.transform,o=t.symbol,i=t.mask,d=t.maskId,s=t.extra;return new Promise(function(t,l){Promise.all([oe(e,a),i.iconName?oe(i.iconName,i.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(i){var l=b(i,2),c=l[0],p=l[1];t([n,ne({icons:{main:c,mask:p},prefix:a,iconName:e,transform:r,symbol:o,maskId:d,extra:s,watchable:!0})])}).catch(l)})},n.generateAbstractIcon=function(n){var t,e=n.children,a=n.attributes,r=n.main,o=n.transform,i=Zn(n.styles);return i.length>0&&(a.style=i),nt(o)&&(t=Xt(\"generateAbstractTransformGrouping\",{main:r,transform:o,containerWidth:r.width,iconWidth:r.width})),e.push(t||r.icon),{children:e,attributes:a}}}},Ee={mixout:function(){return{layer:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.classes,a=void 0===e?[]:e;return Zt({type:\"layer\"},function(){Gt(\"beforeDOMElementCreation\",{assembler:n,params:t});var e=[];return n(function(n){Array.isArray(n)?n.map(function(n){e=e.concat(n.abstract)}):e=e.concat(n.abstract)}),[{tag:\"span\",attributes:{class:[\"\".concat(Gn.cssPrefix,\"-layers\")].concat(m(a)).join(\" \")},children:e}]})}}}},Te={mixout:function(){return{counter:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.title,a=void 0===e?null:e,r=t.classes,o=void 0===r?[]:r,i=t.attributes,d=void 0===i?{}:i,s=t.styles,l=void 0===s?{}:s;return Zt({type:\"counter\",content:n},function(){return Gt(\"beforeDOMElementCreation\",{content:n,params:t}),function(n){var t=n.content,e=n.extra,a=f(f({},e.attributes),{},{class:e.classes.join(\" \")}),r=Zn(e.styles);r.length>0&&(a.style=r);var o=[];return o.push({tag:\"span\",attributes:a,children:[t]}),o}({content:n.toString(),title:a,extra:{attributes:d,styles:l,classes:[\"\".concat(Gn.cssPrefix,\"-layers-counter\")].concat(m(o))}})})}}}},Me={mixout:function(){return{text:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.transform,a=void 0===e?Vn:e,r=t.classes,o=void 0===r?[]:r,i=t.attributes,d=void 0===i?{}:i,s=t.styles,l=void 0===s?{}:s;return Zt({type:\"text\",content:n},function(){return Gt(\"beforeDOMElementCreation\",{content:n,params:t}),te({content:n,transform:f(f({},Vn),a),extra:{attributes:d,styles:l,classes:[\"\".concat(Gn.cssPrefix,\"-layers-text\")].concat(m(o))}})})}}},provides:function(n){n.generateLayersText=function(n,t){var e=t.transform,a=t.extra,r=null,o=null;if(M){var i=parseInt(getComputedStyle(n).fontSize,10),d=n.getBoundingClientRect();r=d.width/i,o=d.height/i}return Promise.resolve([n,te({content:n.innerHTML,width:r,height:o,transform:e,extra:a,watchable:!0})])}}},Ne=new RegExp('\"',\"ug\"),Oe=[1105920,1112319],Le=f(f(f(f({},{FontAwesome:{normal:\"fas\",400:\"fas\"}}),{\"Font Awesome 7 Free\":{900:\"fas\",400:\"far\"},\"Font Awesome 7 Pro\":{900:\"fas\",400:\"far\",normal:\"far\",300:\"fal\",100:\"fat\"},\"Font Awesome 7 Brands\":{400:\"fab\",normal:\"fab\"},\"Font Awesome 7 Duotone\":{900:\"fad\",400:\"fadr\",normal:\"fadr\",300:\"fadl\",100:\"fadt\"},\"Font Awesome 7 Sharp\":{900:\"fass\",400:\"fasr\",normal:\"fasr\",300:\"fasl\",100:\"fast\"},\"Font Awesome 7 Sharp Duotone\":{900:\"fasds\",400:\"fasdr\",normal:\"fasdr\",300:\"fasdl\",100:\"fasdt\"},\"Font Awesome 7 Jelly\":{400:\"fajr\",normal:\"fajr\"},\"Font Awesome 7 Jelly Fill\":{400:\"fajfr\",normal:\"fajfr\"},\"Font Awesome 7 Jelly Duo\":{400:\"fajdr\",normal:\"fajdr\"},\"Font Awesome 7 Slab\":{400:\"faslr\",normal:\"faslr\"},\"Font Awesome 7 Slab Press\":{400:\"faslpr\",normal:\"faslpr\"},\"Font Awesome 7 Thumbprint\":{300:\"fatl\",normal:\"fatl\"},\"Font Awesome 7 Notdog\":{900:\"fans\",normal:\"fans\"},\"Font Awesome 7 Notdog Duo\":{900:\"fands\",normal:\"fands\"},\"Font Awesome 7 Etch\":{900:\"faes\",normal:\"faes\"},\"Font Awesome 7 Chisel\":{400:\"facr\",normal:\"facr\"},\"Font Awesome 7 Whiteboard\":{600:\"fawsb\",normal:\"fawsb\"},\"Font Awesome 7 Utility\":{600:\"fausb\",normal:\"fausb\"},\"Font Awesome 7 Utility Duo\":{600:\"faudsb\",normal:\"faudsb\"},\"Font Awesome 7 Utility Fill\":{600:\"faufsb\",normal:\"faufsb\"}}),{\"Font Awesome 5 Free\":{900:\"fas\",400:\"far\"},\"Font Awesome 5 Pro\":{900:\"fas\",400:\"far\",normal:\"far\",300:\"fal\"},\"Font Awesome 5 Brands\":{400:\"fab\",normal:\"fab\"},\"Font Awesome 5 Duotone\":{900:\"fad\"}}),{\"Font Awesome Kit\":{400:\"fak\",normal:\"fak\"},\"Font Awesome Kit Duotone\":{400:\"fakd\",normal:\"fakd\"}}),Re=Object.keys(Le).reduce(function(n,t){return n[t.toLowerCase()]=Le[t],n},{}),je=Object.keys(Re).reduce(function(n,t){var e=Re[t];return n[t]=e[900]||m(Object.entries(e))[0][1],n},{});function Fe(n,t){var e=\"\".concat(\"data-fa-pseudo-element-pending\").concat(t.replace(\":\",\"-\"));return new Promise(function(a,r){if(null!==n.getAttribute(e))return a();var o,i,d,s=Kn(n.children).filter(function(n){return n.getAttribute(wn)===t})[0],l=I.getComputedStyle(n,t),c=l.getPropertyValue(\"font-family\"),p=c.match(Rn),g=l.getPropertyValue(\"font-weight\"),b=l.getPropertyValue(\"content\");if(s&&!p)return n.removeChild(s),a();if(p&&\"none\"!==b&&\"\"!==b){var u=l.getPropertyValue(\"content\"),h=function(n,t){var e=n.replace(/^['\"]|['\"]$/g,\"\").toLowerCase(),a=parseInt(t),r=isNaN(a)?\"normal\":a;return(Re[e]||{})[r]||je[e]}(c,g),x=function(n){return ft(m(n.replace(Ne,\"\"))[0]||\"\")}(u),v=p[0].startsWith(\"FontAwesome\"),y=function(n){var t=n.getPropertyValue(\"font-feature-settings\").includes(\"ss01\"),e=n.getPropertyValue(\"content\").replace(Ne,\"\"),a=e.codePointAt(0),r=a>=Oe[0]&&a<=Oe[1],o=2===e.length&&e[0]===e[1];return r||o||t}(l),w=It(h,x),k=w;if(v){var S=(i=Ct[o=x],d=It(\"fas\",o),i||(d?{prefix:\"fas\",iconName:d}:null)||{prefix:null,iconName:null});S.iconName&&S.prefix&&(w=S.iconName,h=S.prefix)}if(!w||y||s&&s.getAttribute(kn)===h&&s.getAttribute(Sn)===k)a();else{n.setAttribute(e,k),s&&n.removeChild(s);var C={iconName:null,prefix:null,transform:Vn,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}},$=C.extra;$.attributes[wn]=t,oe(w,h).then(function(r){var o=ne(f(f({},C),{},{icons:{main:r,mask:{prefix:null,iconName:null,rest:[]}},prefix:h,iconName:k,extra:$,watchable:!0})),i=A.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");\"::before\"===t?n.insertBefore(i,n.firstChild):n.appendChild(i),i.outerHTML=o.map(function(n){return ct(n)}).join(\"\\n\"),n.removeAttribute(e),a()}).catch(r)}}else a()})}function Ue(n){return Promise.all([Fe(n,\"::before\"),Fe(n,\"::after\")])}function Ye(n){return!(n.parentNode===document.head||~$n.indexOf(n.tagName.toUpperCase())||n.getAttribute(wn)||n.parentNode&&\"svg\"===n.parentNode.tagName)}var He=function(n){return!!n&&_n.some(function(t){return n.includes(t)})},Be=function(n){if(!n)return[];var t=new Set,e=n.split(/,(?![^()]*\\))/).map(function(n){return n.trim()});e=e.flatMap(function(n){return n.includes(\"(\")?n:n.split(\",\").map(function(n){return n.trim()})});var a,r=c(e);try{for(r.s();!(a=r.n()).done;){var o=a.value;if(He(o)){var i=_n.reduce(function(n,t){return n.replace(t,\"\")},o);\"\"!==i&&\"*\"!==i&&t.add(i)}}}catch(n){r.e(n)}finally{r.f()}return t};function Ge(n){if(T){var t;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])t=n;else if(Gn.searchPseudoElementsFullScan)t=n.querySelectorAll(\"*\");else{var e,a=new Set,r=c(document.styleSheets);try{for(r.s();!(e=r.n()).done;){var o=e.value;try{var i,d=c(o.cssRules);try{for(d.s();!(i=d.n()).done;){var s,l=i.value,p=c(Be(l.selectorText));try{for(p.s();!(s=p.n()).done;){var g=s.value;a.add(g)}}catch(n){p.e(n)}finally{p.f()}}}catch(n){d.e(n)}finally{d.f()}}catch(n){Gn.searchPseudoElementsWarnings&&console.warn(\"Font Awesome: cannot parse stylesheet: \".concat(o.href,\" (\").concat(n.message,')\\nIf it declares any Font Awesome CSS pseudo-elements, they will not be rendered as SVG icons. Add crossorigin=\"anonymous\" to the <link>, enable searchPseudoElementsFullScan for slower but more thorough DOM parsing, or suppress this warning by setting searchPseudoElementsWarnings to false.'))}}}catch(n){r.e(n)}finally{r.f()}if(!a.size)return;var f=Array.from(a).join(\", \");try{t=n.querySelectorAll(f)}catch(n){}}return new Promise(function(n,e){var a=Kn(t).filter(Ye).map(Ue),r=ce(\"searchPseudoElements\");ye(),Promise.all(a).then(function(){r(),we(),n()}).catch(function(){r(),we(),e()})})}}var Xe={hooks:function(){return{mutationObserverCallbacks:function(n){return n.pseudoElementsCallback=Ge,n}}},provides:function(n){n.pseudoElements2svg=function(n){var t=n.node,e=void 0===t?A:t;Gn.searchPseudoElements&&Ge(e)}}},We=!1,Ve=function(n){return n.toLowerCase().split(\" \").reduce(function(n,t){var e=t.toLowerCase().split(\"-\"),a=e[0],r=e.slice(1).join(\"-\");if(a&&\"h\"===r)return n.flipX=!0,n;if(a&&\"v\"===r)return n.flipY=!0,n;if(r=parseFloat(r),isNaN(r))return n;switch(a){case\"grow\":n.size=n.size+r;break;case\"shrink\":n.size=n.size-r;break;case\"left\":n.x=n.x-r;break;case\"right\":n.x=n.x+r;break;case\"up\":n.y=n.y-r;break;case\"down\":n.y=n.y+r;break;case\"rotate\":n.rotate=n.rotate+r}return n},{size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0})},qe={mixout:function(){return{parse:{transform:function(n){return Ve(n)}}}},hooks:function(){return{parseNodeAttributes:function(n,t){var e=t.getAttribute(\"data-fa-transform\");return e&&(n.transform=Ve(e)),n}}},provides:function(n){n.generateAbstractTransformGrouping=function(n){var t=n.main,e=n.transform,a=n.containerWidth,r=n.iconWidth,o={transform:\"translate(\".concat(a/2,\" 256)\")},i=\"translate(\".concat(32*e.x,\", \").concat(32*e.y,\") \"),d=\"scale(\".concat(e.size/16*(e.flipX?-1:1),\", \").concat(e.size/16*(e.flipY?-1:1),\") \"),s=\"rotate(\".concat(e.rotate,\" 0 0)\"),l={outer:o,inner:{transform:\"\".concat(i,\" \").concat(d,\" \").concat(s)},path:{transform:\"translate(\".concat(r/2*-1,\" -256)\")}};return{tag:\"g\",attributes:f({},l.outer),children:[{tag:\"g\",attributes:f({},l.inner),children:[{tag:t.icon.tag,children:t.icon.children,attributes:f(f({},t.icon.attributes),l.path)}]}]}}}},Ke={x:0,y:0,width:\"100%\",height:\"100%\"};function Je(n){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n.attributes&&(n.attributes.fill||t)&&(n.attributes.fill=\"black\"),n}var Qe={hooks:function(){return{parseNodeAttributes:function(n,t){var e=t.getAttribute(\"data-fa-mask\"),a=e?Ot(e.split(\" \").map(function(n){return n.trim()})):{prefix:null,iconName:null,rest:[]};return a.prefix||(a.prefix=Et()),n.mask=a,n.maskId=t.getAttribute(\"data-fa-mask-id\"),n}}},provides:function(n){n.generateAbstractMask=function(n){var t,e=n.children,a=n.attributes,r=n.main,o=n.mask,i=n.maskId,d=n.transform,s=r.width,l=r.icon,c=o.width,p=o.icon,g=function(n){var t=n.transform,e=n.containerWidth,a=n.iconWidth,r={transform:\"translate(\".concat(e/2,\" 256)\")},o=\"translate(\".concat(32*t.x,\", \").concat(32*t.y,\") \"),i=\"scale(\".concat(t.size/16*(t.flipX?-1:1),\", \").concat(t.size/16*(t.flipY?-1:1),\") \"),d=\"rotate(\".concat(t.rotate,\" 0 0)\");return{outer:r,inner:{transform:\"\".concat(o,\" \").concat(i,\" \").concat(d)},path:{transform:\"translate(\".concat(a/2*-1,\" -256)\")}}}({transform:d,containerWidth:c,iconWidth:s}),b={tag:\"rect\",attributes:f(f({},Ke),{},{fill:\"white\"})},m=l.children?{children:l.children.map(Je)}:{},u={tag:\"g\",attributes:f({},g.inner),children:[Je(f({tag:l.tag,attributes:f(f({},l.attributes),g.path)},m))]},h={tag:\"g\",attributes:f({},g.outer),children:[u]},x=\"mask-\".concat(i||qn()),v=\"clip-\".concat(i||qn()),y={tag:\"mask\",attributes:f(f({},Ke),{},{id:x,maskUnits:\"userSpaceOnUse\",maskContentUnits:\"userSpaceOnUse\"}),children:[b,h]},w={tag:\"defs\",children:[{tag:\"clipPath\",attributes:{id:v},children:(t=p,\"g\"===t.tag?t.children:[t])},y]};return e.push(w,{tag:\"rect\",attributes:f({fill:\"currentColor\",\"clip-path\":\"url(#\".concat(v,\")\"),mask:\"url(#\".concat(x,\")\")},Ke)}),{children:e,attributes:a}}}},Ze={provides:function(n){var t=!1;I.matchMedia&&(t=I.matchMedia(\"(prefers-reduced-motion: reduce)\").matches),n.missingIconAbstract=function(){var n=[],e={fill:\"currentColor\"},a={attributeType:\"XML\",repeatCount:\"indefinite\",dur:\"2s\"};n.push({tag:\"path\",attributes:f(f({},e),{},{d:\"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z\"})});var r=f(f({},a),{},{attributeName:\"opacity\"}),o={tag:\"circle\",attributes:f(f({},e),{},{cx:\"256\",cy:\"364\",r:\"28\"}),children:[]};return t||o.children.push({tag:\"animate\",attributes:f(f({},a),{},{attributeName:\"r\",values:\"28;14;28;28;14;28;\"})},{tag:\"animate\",attributes:f(f({},r),{},{values:\"1;0;1;1;0;1;\"})}),n.push(o),n.push({tag:\"path\",attributes:f(f({},e),{},{opacity:\"1\",d:\"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z\"}),children:t?[]:[{tag:\"animate\",attributes:f(f({},r),{},{values:\"1;0;0;0;0;1;\"})}]}),t||n.push({tag:\"path\",attributes:f(f({},e),{},{opacity:\"0\",d:\"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z\"}),children:[{tag:\"animate\",attributes:f(f({},r),{},{values:\"0;0;1;1;0;0;\"})}]}),{tag:\"g\",attributes:{class:\"missing\"},children:n}}}};!function(n,t){var e=t.mixoutsTo;Ft=n,Ut={},Object.keys(Yt).forEach(function(n){-1===Ht.indexOf(n)&&delete Yt[n]}),Ft.forEach(function(n){var t=n.mixout?n.mixout():{};if(Object.keys(t).forEach(function(n){\"function\"==typeof t[n]&&(e[n]=t[n]),\"object\"===h(t[n])&&Object.keys(t[n]).forEach(function(a){e[n]||(e[n]={}),e[n][a]=t[n][a]})}),n.hooks){var a=n.hooks();Object.keys(a).forEach(function(n){Ut[n]||(Ut[n]=[]),Ut[n].push(a[n])})}n.provides&&n.provides(Yt)})}([rt,Pe,Ee,Te,Me,Xe,{mixout:function(){return{dom:{unwatch:function(){ye(),We=!0}}}},hooks:function(){return{bootstrap:function(){Se(Bt(\"mutationObserverCallbacks\",{}))},noAuto:function(){ke&&ke.disconnect()},watch:function(n){var t=n.observeMutationsRoot;We?we():Se(Bt(\"mutationObserverCallbacks\",{observeMutationsRoot:t}))}}}},qe,Qe,Ze,{hooks:function(){return{parseNodeAttributes:function(n,t){var e=t.getAttribute(\"data-fa-symbol\"),a=null!==e&&(\"\"===e||e);return n.symbol=a,n}}}}],{mixoutsTo:Jt});var na=Jt.library,ta=Jt.dom,ea={prefix:\"fas\",iconName:\"rotate\",icon:[512,512,[128260,\"sync-alt\"],\"f2f1\",\"M480.1 192l7.9 0c13.3 0 24-10.7 24-24l0-144c0-9.7-5.8-18.5-14.8-22.2S477.9 .2 471 7L419.3 58.8C375 22.1 318 0 256 0 127 0 20.3 95.4 2.6 219.5 .1 237 12.2 253.2 29.7 255.7s33.7-9.7 36.2-27.1C79.2 135.5 159.3 64 256 64 300.4 64 341.2 79 373.7 104.3L327 151c-6.9 6.9-8.9 17.2-5.2 26.2S334.3 192 344 192l136.1 0zm29.4 100.5c2.5-17.5-9.7-33.7-27.1-36.2s-33.7 9.7-36.2 27.1c-13.3 93-93.4 164.5-190.1 164.5-44.4 0-85.2-15-117.7-40.3L185 361c6.9-6.9 8.9-17.2 5.2-26.2S177.7 320 168 320L24 320c-13.3 0-24 10.7-24 24L0 488c0 9.7 5.8 18.5 14.8 22.2S34.1 511.8 41 505l51.8-51.8C137 489.9 194 512 256 512 385 512 491.7 416.6 509.4 292.5z\"]},aa={prefix:\"fas\",iconName:\"question\",icon:[320,512,[10067,10068,61736],\"3f\",\"M64 160c0-53 43-96 96-96s96 43 96 96c0 42.7-27.9 78.9-66.5 91.4-28.4 9.2-61.5 35.3-61.5 76.6l0 24c0 17.7 14.3 32 32 32s32-14.3 32-32l0-24c0-1.7 .6-4.1 3.5-7.3 3-3.3 7.9-6.5 13.7-8.4 64.3-20.7 110.8-81 110.8-152.3 0-88.4-71.6-160-160-160S0 71.6 0 160c0 17.7 14.3 32 32 32s32-14.3 32-32zm96 352c22.1 0 40-17.9 40-40s-17.9-40-40-40-40 17.9-40 40 17.9 40 40 40z\"]},ra={prefix:\"fas\",iconName:\"hand-fist\",icon:[384,512,[9994,\"fist-raised\"],\"f6de\",\"M160 0c17.7 0 32 14.3 32 32l0 112-64 0 0-112c0-17.7 14.3-32 32-32zM32 64c0-17.7 14.3-32 32-32S96 46.3 96 64l0 80-64 0 0-80zm192 0c0-17.7 14.3-32 32-32s32 14.3 32 32l0 96c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-96zm96 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 64c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-64zm-96 88l0-.6c9.4 5.4 20.3 8.6 32 8.6 13.2 0 25.4-4 35.6-10.8 8.7 24.9 32.5 42.8 60.4 42.8 11.7 0 22.6-3.1 32-8.6l0 8.6c0 52.3-25.1 98.8-64 128l0 96c0 17.7-14.3 32-32 32l-160 0c-17.7 0-32-14.3-32-32l0-78.4c-17.3-7.9-33.2-18.8-46.9-32.5L37.5 357.5C13.5 333.5 0 300.9 0 267l0-27c0-35.3 28.7-64 64-64l88 0c22.1 0 40 17.9 40 40s-17.9 40-40 40l-56 0c-8.8 0-16 7.2-16 16s7.2 16 16 16l56 0c39.8 0 72-32.2 72-72z\"]},oa=ra,ia={prefix:\"fas\",iconName:\"scale-balanced\",icon:[640,512,[9878,\"balance-scale\"],\"f24e\",\"M384 32l128 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L398.4 96c-5.2 25.8-22.9 47.1-46.4 57.3l0 294.7 160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-384 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l160 0 0-294.7c-23.5-10.3-41.2-31.6-46.4-57.3L128 96c-17.7 0-32-14.3-32-32s14.3-32 32-32l128 0c14.6-19.4 37.8-32 64-32s49.4 12.6 64 32zm55.6 288L584.4 320 512 195.8 439.6 320zM512 416c-62.9 0-115.2-34-126-78.9-2.6-11 1-22.3 6.7-32.1l95.2-163.2c5-8.6 14.2-13.8 24.1-13.8s19.1 5.3 24.1 13.8l95.2 163.2c5.7 9.8 9.3 21.1 6.7 32.1-10.8 44.8-63.1 78.9-126 78.9zM126.8 195.8L54.4 320 199.3 320 126.8 195.8zM.9 337.1c-2.6-11 1-22.3 6.7-32.1l95.2-163.2c5-8.6 14.2-13.8 24.1-13.8s19.1 5.3 24.1 13.8l95.2 163.2c5.7 9.8 9.3 21.1 6.7 32.1-10.8 44.8-63.1 78.9-126 78.9S11.7 382 .9 337.1z\"]},da={prefix:\"fas\",iconName:\"scroll\",icon:[576,512,[128220],\"f70e\",\"M0 112C0 70.5 31.6 36.4 72 32.4l0-.4 280 0c53 0 96 43 96 96l0 176-176 0c-39.8 0-72 32.2-72 72l0 60c0 24.3-19.7 44-44 44s-44-19.7-44-44l0-228-64 0c-26.5 0-48-21.5-48-48l0-48zM236.8 480c7.1-13.1 11.2-28.1 11.2-44l0-60c0-13.3 10.7-24 24-24l248 0c13.3 0 24 10.7 24 24l0 24c0 44.2-35.8 80-80 80l-227.2 0zM80 80c-17.7 0-32 14.3-32 32l0 48 64 0 0-48c0-17.7-14.3-32-32-32z\"]},sa={prefix:\"fas\",iconName:\"filter\",icon:[512,512,[],\"f0b0\",\"M32 64C19.1 64 7.4 71.8 2.4 83.8S.2 109.5 9.4 118.6L192 301.3 192 416c0 8.5 3.4 16.6 9.4 22.6l64 64c9.2 9.2 22.9 11.9 34.9 6.9S320 492.9 320 480l0-178.7 182.6-182.6c9.2-9.2 11.9-22.9 6.9-34.9S492.9 64 480 64L32 64z\"]},la={prefix:\"fas\",iconName:\"exclamation\",icon:[128,512,[10069,10071,61738],\"21\",\"M64 432c22.1 0 40 17.9 40 40s-17.9 40-40 40-40-17.9-40-40c0-22.1 17.9-40 40-40zM64 0c26.5 0 48 21.5 48 48 0 .6 0 1.1 0 1.7l-16 304c-.9 17-15 30.3-32 30.3S33 370.7 32 353.7L16 49.7c0-.6 0-1.1 0-1.7 0-26.5 21.5-48 48-48z\"]},ca={prefix:\"fas\",iconName:\"shoe-prints\",icon:[576,512,[],\"f54b\",\"M296 192c-21.1-12.1-42.3-24.2-72-29.3l0-140.3C257.7 13 311.4 0 352 0 448 0 576 48 576 128s-119.6 96-176 96c-48 0-76-16-104-32zM128 32l48 0 0 128-48 0c-35.3 0-64-28.7-64-64s28.7-64 64-64zM232 320c28-16 56-32 104-32 56.4 0 176 16 176 96S384 512 288 512c-40.5 0-94.3-13-128-22.4l0-140.3c29.7-5.2 50.9-17.3 72-29.4zM64 480c-35.3 0-64-28.7-64-64s28.7-64 64-64l48 0 0 128-48 0z\"]},pa={prefix:\"fas\",iconName:\"trophy\",icon:[512,512,[127942],\"f091\",\"M144.3 0l224 0c26.5 0 48.1 21.8 47.1 48.2-.2 5.3-.4 10.6-.7 15.8l49.6 0c26.1 0 49.1 21.6 47.1 49.8-7.5 103.7-60.5 160.7-118 190.5-15.8 8.2-31.9 14.3-47.2 18.8-20.2 28.6-41.2 43.7-57.9 51.8l0 73.1 64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-192 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l64 0 0-73.1c-16-7.7-35.9-22-55.3-48.3-18.4-4.8-38.4-12.1-57.9-23.1-54.1-30.3-102.9-87.4-109.9-189.9-1.9-28.1 21-49.7 47.1-49.7l49.6 0c-.3-5.2-.5-10.4-.7-15.8-1-26.5 20.6-48.2 47.1-48.2zM101.5 112l-52.4 0c6.2 84.7 45.1 127.1 85.2 149.6-14.4-37.3-26.3-86-32.8-149.6zM380 256.8c40.5-23.8 77.1-66.1 83.3-144.8L411 112c-6.2 60.9-17.4 108.2-31 144.8z\"]},ga={prefix:\"fas\",iconName:\"magnifying-glass\",icon:[512,512,[128269,\"search\"],\"f002\",\"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376C296.3 401.1 253.9 416 208 416 93.1 416 0 322.9 0 208S93.1 0 208 0 416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z\"]},fa=ga,ba={prefix:\"fas\",iconName:\"cloud-moon\",icon:[640,512,[],\"f6c3\",\"M480 0c14.6 0 28.8 1.6 42.5 4.7 7.4 1.7 13 7.8 13.9 15.4s-3 14.9-9.8 18.3c-45.4 22.6-76.6 69.5-76.6 123.6 0 76.2 61.8 138 138 138 3.7 0 7.4-.1 11.1-.4 7.6-.6 14.7 3.6 17.8 10.6s1.5 15.1-3.9 20.4c-26 25-59.1 42.7-95.9 49.9-11.1-25.3-30.2-46.3-54.1-59.8-7.6-63.4-61.6-112.6-127.1-112.6-11.2 0-22.1 1.5-32.5 4.2-4.8-4.2-9.9-8.2-15.2-11.8-.1-2.8-.2-5.6-.2-8.4 0-106 86-192 192-192zm-.1 431.9c0 44.2-35.8 80-80 80l-271.9 0c-53 0-96-43-96-96 0-47.6 34.6-87 80-94.6-.4-52.8 42.9-97.3 96-97.3 34.9 0 65.4 18.6 82.2 46.4 13-9.1 28.8-14.4 45.8-14.4 44.2 0 80 35.8 80 80 0 5.9-.6 11.7-1.9 17.2 37.4 6.7 65.8 39.4 65.8 78.7z\"]},ma={prefix:\"fas\",iconName:\"floppy-disk\",icon:[448,512,[128190,128426,\"save\"],\"f0c7\",\"M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-242.7c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32L64 32zm32 96c0-17.7 14.3-32 32-32l160 0c17.7 0 32 14.3 32 32l0 64c0 17.7-14.3 32-32 32l-160 0c-17.7 0-32-14.3-32-32l0-64zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z\"]},ua=ma,ha={prefix:\"fas\",iconName:\"skull\",icon:[512,512,[128128],\"f54c\",\"M416 427.4c58.5-44 96-111.6 96-187.4 0-132.5-114.6-240-256-240S0 107.5 0 240c0 75.8 37.5 143.4 96 187.4L96 464c0 26.5 21.5 48 48 48l32 0 0-40c0-13.3 10.7-24 24-24s24 10.7 24 24l0 40 64 0 0-40c0-13.3 10.7-24 24-24s24 10.7 24 24l0 40 32 0c26.5 0 48-21.5 48-48l0-36.6zM96 256a64 64 0 1 1 128 0 64 64 0 1 1 -128 0zm256-64a64 64 0 1 1 0 128 64 64 0 1 1 0-128z\"]},xa={prefix:\"fas\",iconName:\"camera\",icon:[512,512,[62258,\"camera-alt\"],\"f030\",\"M149.1 64.8L138.7 96 64 96C28.7 96 0 124.7 0 160L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-256c0-35.3-28.7-64-64-64l-74.7 0-10.4-31.2C356.4 45.2 338.1 32 317.4 32L194.6 32c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z\"]},va={prefix:\"fas\",iconName:\"eye\",icon:[576,512,[128065],\"f06e\",\"M288 32c-80.8 0-145.5 36.8-192.6 80.6-46.8 43.5-78.1 95.4-93 131.1-3.3 7.9-3.3 16.7 0 24.6 14.9 35.7 46.2 87.7 93 131.1 47.1 43.7 111.8 80.6 192.6 80.6s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7 0-24.6-14.9-35.7-46.2-87.7-93-131.1-47.1-43.7-111.8-80.6-192.6-80.6zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64-11.5 0-22.3-3-31.7-8.4-1 10.9-.1 22.1 2.9 33.2 13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-12.2-45.7-55.5-74.8-101.1-70.8 5.3 9.3 8.4 20.1 8.4 31.7z\"]},ya={prefix:\"fas\",iconName:\"trash\",icon:[448,512,[],\"f1f8\",\"M136.7 5.9L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-8.7-26.1C306.9-7.2 294.7-16 280.9-16L167.1-16c-13.8 0-26 8.8-30.4 21.9zM416 144L32 144 53.1 467.1C54.7 492.4 75.7 512 101 512L347 512c25.3 0 46.3-19.6 47.9-44.9L416 144z\"]},wa={prefix:\"fas\",iconName:\"chevron-up\",icon:[448,512,[],\"f077\",\"M201.4 105.4c12.5-12.5 32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 173.3 54.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l192-192z\"]},ka={prefix:\"fas\",iconName:\"book-skull\",icon:[448,512,[\"book-dead\"],\"f6b7\",\"M96 512l320 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l0-66.7c18.6-6.6 32-24.4 32-45.3l0-288c0-26.5-21.5-48-48-48L96 0C43 0 0 43 0 96L0 416c0 53 43 96 96 96zM64 416c0-17.7 14.3-32 32-32l256 0 0 64-256 0c-17.7 0-32-14.3-32-32zM272 163.2l0 12.8c0 8.8-7.2 16-16 16l-64 0c-8.8 0-16-7.2-16-16l0-12.8c-19.4-11.7-32-30.3-32-51.2 0-35.3 35.8-64 80-64s80 28.7 80 64c0 20.9-12.6 39.5-32 51.2zM208 112a16 16 0 1 0 -32 0 16 16 0 1 0 32 0zm48 16a16 16 0 1 0 0-32 16 16 0 1 0 0 32zm74.2 95.7c4.6 10.1 .1 21.9-9.9 26.5l-47.9 21.8 47.9 21.8c10.1 4.6 14.5 16.4 9.9 26.5s-16.4 14.5-26.5 9.9L224 294 144.3 330.2c-10.1 4.6-21.9 .1-26.5-9.9s-.1-21.9 9.9-26.5l47.9-21.8-47.9-21.8c-10.1-4.6-14.5-16.4-9.9-26.5s16.4-14.5 26.5-9.9L224 250 303.7 213.8c10.1-4.6 21.9-.1 26.5 9.9z\"]},Sa={prefix:\"fas\",iconName:\"clock\",icon:[512,512,[128339,\"clock-four\"],\"f017\",\"M256 0a256 256 0 1 1 0 512 256 256 0 1 1 0-512zM232 120l0 136c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2 280 120c0-13.3-10.7-24-24-24s-24 10.7-24 24z\"]},Ca={prefix:\"fas\",iconName:\"book\",icon:[448,512,[128212],\"f02d\",\"M384 512L96 512c-53 0-96-43-96-96L0 96C0 43 43 0 96 0L400 0c26.5 0 48 21.5 48 48l0 288c0 20.9-13.4 38.7-32 45.3l0 66.7c17.7 0 32 14.3 32 32s-14.3 32-32 32l-32 0zM96 384c-17.7 0-32 14.3-32 32s14.3 32 32 32l256 0 0-64-256 0zm32-232c0 13.3 10.7 24 24 24l176 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-176 0c-13.3 0-24 10.7-24 24zm24 72c-13.3 0-24 10.7-24 24s10.7 24 24 24l176 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-176 0z\"]},$a={prefix:\"fas\",iconName:\"rocket\",icon:[512,512,[],\"f135\",\"M128 320L24.5 320c-24.9 0-40.2-27.1-27.4-48.5L50 183.3C58.7 168.8 74.3 160 91.2 160l95 0c76.1-128.9 189.6-135.4 265.5-124.3 12.8 1.9 22.8 11.9 24.6 24.6 11.1 75.9 4.6 189.4-124.3 265.5l0 95c0 16.9-8.8 32.5-23.3 41.2l-88.2 52.9c-21.3 12.8-48.5-2.6-48.5-27.4L192 384c0-35.3-28.7-64-64-64l-.1 0zM400 160a48 48 0 1 0 -96 0 48 48 0 1 0 96 0z\"]},_a={prefix:\"fas\",iconName:\"paper-plane\",icon:[576,512,[61913],\"f1d8\",\"M536.4-26.3c9.8-3.5 20.6-1 28 6.3s9.8 18.2 6.3 28l-178 496.9c-5 13.9-18.1 23.1-32.8 23.1-14.2 0-27-8.6-32.3-21.7l-64.2-158c-4.5-11-2.5-23.6 5.2-32.6l94.5-112.4c5.1-6.1 4.7-15-.9-20.6s-14.6-6-20.6-.9L229.2 276.1c-9.1 7.6-21.6 9.6-32.6 5.2L38.1 216.8c-13.1-5.3-21.7-18.1-21.7-32.3 0-14.7 9.2-27.8 23.1-32.8l496.9-178z\"]},za={prefix:\"fas\",iconName:\"heart\",icon:[512,512,[128153,128154,128155,128156,128420,129293,129294,129505,9829,10084,61578],\"f004\",\"M241 87.1l15 20.7 15-20.7C296 52.5 336.2 32 378.9 32 452.4 32 512 91.6 512 165.1l0 2.6c0 112.2-139.9 242.5-212.9 298.2-12.4 9.4-27.6 14.1-43.1 14.1s-30.8-4.6-43.1-14.1C139.9 410.2 0 279.9 0 167.7l0-2.6C0 91.6 59.6 32 133.1 32 175.8 32 216 52.5 241 87.1z\"]},Da={prefix:\"fas\",iconName:\"flask\",icon:[448,512,[],\"f0c3\",\"M288 0L128 0C110.3 0 96 14.3 96 32s14.3 32 32 32L128 215.5 7.5 426.3C2.6 435 0 444.7 0 454.7 0 486.4 25.6 512 57.3 512l333.4 0c31.6 0 57.3-25.6 57.3-57.3 0-10-2.6-19.8-7.5-28.4L320 215.5 320 64c17.7 0 32-14.3 32-32S337.7 0 320 0L288 0zM192 215.5l0-151.5 64 0 0 151.5c0 11.1 2.9 22.1 8.4 31.8l41.6 72.7-164 0 41.6-72.7c5.5-9.7 8.4-20.6 8.4-31.8z\"]},Ia={prefix:\"fas\",iconName:\"users\",icon:[640,512,[],\"f0c0\",\"M320 16a104 104 0 1 1 0 208 104 104 0 1 1 0-208zM96 88a72 72 0 1 1 0 144 72 72 0 1 1 0-144zM0 416c0-70.7 57.3-128 128-128 12.8 0 25.2 1.9 36.9 5.4-32.9 36.8-52.9 85.4-52.9 138.6l0 16c0 11.4 2.4 22.2 6.7 32L32 480c-17.7 0-32-14.3-32-32l0-32zm521.3 64c4.3-9.8 6.7-20.6 6.7-32l0-16c0-53.2-20-101.8-52.9-138.6 11.7-3.5 24.1-5.4 36.9-5.4 70.7 0 128 57.3 128 128l0 32c0 17.7-14.3 32-32 32l-86.7 0zM472 160a72 72 0 1 1 144 0 72 72 0 1 1 -144 0zM160 432c0-88.4 71.6-160 160-160s160 71.6 160 160l0 16c0 17.7-14.3 32-32 32l-256 0c-17.7 0-32-14.3-32-32l0-16z\"]},Aa={prefix:\"fas\",iconName:\"database\",icon:[448,512,[],\"f1c0\",\"M448 205.8c-14.8 9.8-31.8 17.7-49.5 24-47 16.8-108.7 26.2-174.5 26.2S96.4 246.5 49.5 229.8c-17.6-6.3-34.7-14.2-49.5-24L0 288c0 44.2 100.3 80 224 80s224-35.8 224-80l0-82.2zm0-77.8l0-48C448 35.8 347.7 0 224 0S0 35.8 0 80l0 48c0 44.2 100.3 80 224 80s224-35.8 224-80zM398.5 389.8C351.6 406.5 289.9 416 224 416S96.4 406.5 49.5 389.8c-17.6-6.3-34.7-14.2-49.5-24L0 432c0 44.2 100.3 80 224 80s224-35.8 224-80l0-66.2c-14.8 9.8-31.8 17.7-49.5 24z\"]},Pa={prefix:\"fas\",iconName:\"file-import\",icon:[384,512,[\"arrow-right-to-file\"],\"f56f\",\"M64 0C28.7 0 0 28.7 0 64l0 240 182.1 0-31-31c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l72 72c9.4 9.4 9.4 24.6 0 33.9l-72 72c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l31-31-182.1 0 0 96c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-277.5c0-17-6.7-33.3-18.7-45.3L258.7 18.7C246.7 6.7 230.5 0 213.5 0L64 0zM325.5 176L232 176c-13.3 0-24-10.7-24-24L208 58.5 325.5 176z\"]},Ea={prefix:\"fas\",iconName:\"circle-xmark\",icon:[512,512,[61532,\"times-circle\",\"xmark-circle\"],\"f057\",\"M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zM167 167c9.4-9.4 24.6-9.4 33.9 0l55 55 55-55c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-55 55 55 55c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-55-55-55 55c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l55-55-55-55c-9.4-9.4-9.4-24.6 0-33.9z\"]},Ta=Ea,Ma={prefix:\"fas\",iconName:\"clipboard-list\",icon:[384,512,[],\"f46d\",\"M311.4 32l8.6 0c35.3 0 64 28.7 64 64l0 352c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 96C0 60.7 28.7 32 64 32l8.6 0C83.6 12.9 104.3 0 128 0L256 0c23.7 0 44.4 12.9 55.4 32zM248 112c13.3 0 24-10.7 24-24s-10.7-24-24-24L136 64c-13.3 0-24 10.7-24 24s10.7 24 24 24l112 0zM128 256a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm32 0c0 13.3 10.7 24 24 24l112 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-112 0c-13.3 0-24 10.7-24 24zm0 128c0 13.3 10.7 24 24 24l112 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-112 0c-13.3 0-24 10.7-24 24zM96 416a32 32 0 1 0 0-64 32 32 0 1 0 0 64z\"]},Na={prefix:\"fas\",iconName:\"lightbulb\",icon:[384,512,[128161],\"f0eb\",\"M292.9 384c7.3-22.3 21.9-42.5 38.4-59.9 32.7-34.4 52.7-80.9 52.7-132.1 0-106-86-192-192-192S0 86 0 192c0 51.2 20 97.7 52.7 132.1 16.5 17.4 31.2 37.6 38.4 59.9l201.7 0zM288 432l-192 0 0 16c0 44.2 35.8 80 80 80l32 0c44.2 0 80-35.8 80-80l0-16zM184 112c-39.8 0-72 32.2-72 72 0 13.3-10.7 24-24 24s-24-10.7-24-24c0-66.3 53.7-120 120-120 13.3 0 24 10.7 24 24s-10.7 24-24 24z\"]},Oa={prefix:\"fas\",iconName:\"map\",icon:[512,512,[128506,62072],\"f279\",\"M512 48c0-11.1-5.7-21.4-15.2-27.2s-21.2-6.4-31.1-1.4L349.5 77.5 170.1 17.6c-8.1-2.7-16.8-2.1-24.4 1.7l-128 64C6.8 88.8 0 99.9 0 112L0 464c0 11.1 5.7 21.4 15.2 27.2s21.2 6.4 31.1 1.4l116.1-58.1 179.4 59.8c8.1 2.7 16.8 2.1 24.4-1.7l128-64c10.8-5.4 17.7-16.5 17.7-28.6l0-352zM192 376.9l0-284.5 128 42.7 0 284.5-128-42.7z\"]},La={prefix:\"fas\",iconName:\"thumbtack\",icon:[384,512,[128204,128392,\"thumb-tack\"],\"f08d\",\"M32 32C32 14.3 46.3 0 64 0L320 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-29.5 0 10.3 134.1c37.1 21.2 65.8 56.4 78.2 99.7l3.8 13.4c2.8 9.7 .8 20-5.2 28.1S362 352 352 352L32 352c-10 0-19.5-4.7-25.5-12.7s-8-18.4-5.2-28.1L5 297.8c12.4-43.3 41-78.5 78.2-99.7L93.5 64 64 64C46.3 64 32 49.7 32 32zM160 400l64 0 0 112c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-112z\"]},Ra={prefix:\"fas\",iconName:\"circle-plus\",icon:[512,512,[\"plus-circle\"],\"f055\",\"M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z\"]},ja=Ra,Fa={prefix:\"fas\",iconName:\"cloud\",icon:[576,512,[9729],\"f0c2\",\"M0 336c0 79.5 64.5 144 144 144l304 0c70.7 0 128-57.3 128-128 0-51.6-30.5-96.1-74.5-116.3 6.7-13.1 10.5-28 10.5-43.7 0-53-43-96-96-96-17.7 0-34.2 4.8-48.4 13.1-24.1-45.8-72.2-77.1-127.6-77.1-79.5 0-144 64.5-144 144 0 8 .7 15.9 1.9 23.5-56.9 19.2-97.9 73.1-97.9 136.5z\"]},Ua={prefix:\"fas\",iconName:\"circle\",icon:[512,512,[128308,128309,128992,128993,128994,128995,128996,9679,9898,9899,11044,61708,61915],\"f111\",\"M0 256a256 256 0 1 1 512 0 256 256 0 1 1 -512 0z\"]},Ya={prefix:\"fas\",iconName:\"gear\",icon:[512,512,[9881,\"cog\"],\"f013\",\"M195.1 9.5C198.1-5.3 211.2-16 226.4-16l59.8 0c15.2 0 28.3 10.7 31.3 25.5L332 79.5c14.1 6 27.3 13.7 39.3 22.8l67.8-22.5c14.4-4.8 30.2 1.2 37.8 14.4l29.9 51.8c7.6 13.2 4.9 29.8-6.5 39.9L447 233.3c.9 7.4 1.3 15 1.3 22.7s-.5 15.3-1.3 22.7l53.4 47.5c11.4 10.1 14 26.8 6.5 39.9l-29.9 51.8c-7.6 13.1-23.4 19.2-37.8 14.4l-67.8-22.5c-12.1 9.1-25.3 16.7-39.3 22.8l-14.4 69.9c-3.1 14.9-16.2 25.5-31.3 25.5l-59.8 0c-15.2 0-28.3-10.7-31.3-25.5l-14.4-69.9c-14.1-6-27.2-13.7-39.3-22.8L73.5 432.3c-14.4 4.8-30.2-1.2-37.8-14.4L5.8 366.1c-7.6-13.2-4.9-29.8 6.5-39.9l53.4-47.5c-.9-7.4-1.3-15-1.3-22.7s.5-15.3 1.3-22.7L12.3 185.8c-11.4-10.1-14-26.8-6.5-39.9L35.7 94.1c7.6-13.2 23.4-19.2 37.8-14.4l67.8 22.5c12.1-9.1 25.3-16.7 39.3-22.8L195.1 9.5zM256.3 336a80 80 0 1 0 -.6-160 80 80 0 1 0 .6 160z\"]},Ha=Ya,Ba={prefix:\"fas\",iconName:\"arrow-up\",icon:[384,512,[8593],\"f062\",\"M214.6 17.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 117.3 160 488c0 17.7 14.3 32 32 32s32-14.3 32-32l0-370.7 105.4 105.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z\"]},Ga={prefix:\"fas\",iconName:\"suitcase\",icon:[512,512,[129523],\"f0f2\",\"M200 48l112 0c4.4 0 8 3.6 8 8l0 40-128 0 0-40c0-4.4 3.6-8 8-8zm-56 8l0 424 224 0 0-424c0-30.9-25.1-56-56-56L200 0c-30.9 0-56 25.1-56 56zM416 96l0 384 32 0c35.3 0 64-28.7 64-64l0-256c0-35.3-28.7-64-64-64l-32 0zM96 480l0-384-32 0C28.7 96 0 124.7 0 160L0 416c0 35.3 28.7 64 64 64l32 0z\"]},Xa={prefix:\"fas\",iconName:\"gem\",icon:[512,512,[128142],\"f3a5\",\"M116.7 33.8c4.5-6.1 11.7-9.8 19.3-9.8l240 0c7.6 0 14.8 3.6 19.3 9.8l112 152c6.8 9.2 6.1 21.9-1.5 30.4l-232 256c-4.5 5-11 7.9-17.8 7.9s-13.2-2.9-17.8-7.9l-232-256c-7.7-8.5-8.3-21.2-1.5-30.4l112-152zm38.5 39.8c-3.3 2.5-4.2 7-2.1 10.5L210.5 179.8 63.3 192c-4.1 .3-7.3 3.8-7.3 8s3.2 7.6 7.3 8l192 16c.4 0 .9 0 1.3 0l192-16c4.1-.3 7.3-3.8 7.3-8s-3.2-7.6-7.3-8l-147.2-12.3 57.4-95.6c2.1-3.5 1.2-8.1-2.1-10.5s-7.9-2-10.7 1L256 172.2 165.9 74.6c-2.8-3-7.4-3.4-10.7-1z\"]},Wa={prefix:\"fas\",iconName:\"check\",icon:[448,512,[10003,10004],\"f00c\",\"M434.8 70.1c14.3 10.4 17.5 30.4 7.1 44.7l-256 352c-5.5 7.6-14 12.3-23.4 13.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l101.5 101.5 234-321.7c10.4-14.3 30.4-17.5 44.7-7.1z\"]},Va={prefix:\"fas\",iconName:\"hat-wizard\",icon:[512,512,[],\"f6e8\",\"M64 400l85.7-208.2c17-41.3 47.8-75.3 87.2-96.3L383.8 17.2c12.3-6.6 26.5 4.7 23 18.2L369.6 177.8c-1.1 4.1-1.6 8.3-1.6 12.6 0 6.3 1.2 12.6 3.6 18.5l76.4 191.1-207.1 0 11.8-35.4 40.4-13.5c6.5-2.2 10.9-8.3 10.9-15.2s-4.4-13-10.9-15.2l-40.4-13.5-13.5-40.4C237 260.4 230.9 256 224 256s-13 4.4-15.2 10.9l-13.5 40.4-40.4 13.5C148.4 323 144 329.1 144 336s4.4 13 10.9 15.2l40.4 13.5 11.8 35.4-143.1 0zM279.6 141.5c-1.1-3.3-4.1-5.5-7.6-5.5s-6.5 2.2-7.6 5.5l-6.7 20.2-20.2 6.7c-3.3 1.1-5.5 4.1-5.5 7.6s2.2 6.5 5.5 7.6l20.2 6.7 6.7 20.2c1.1 3.3 4.1 5.5 7.6 5.5s6.5-2.2 7.6-5.5l6.7-20.2 20.2-6.7c3.3-1.1 5.5-4.1 5.5-7.6s-2.2-6.5-5.5-7.6l-20.2-6.7-6.7-20.2zM32 448l448 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32s14.3-32 32-32z\"]},qa={prefix:\"fas\",iconName:\"gavel\",icon:[576,512,[\"legal\"],\"f0e3\",\"M169.6 153.4l-18.7-18.7c-12.5-12.5-12.5-32.8 0-45.3L265.6-25.4c12.5-12.5 32.8-12.5 45.3 0L329.6-6.6c12.5 12.5 12.5 32.8 0 45.3L214.9 153.4c-12.5 12.5-32.8 12.5-45.3 0zM276 211.7l-31.4-31.4 112-112 119.4 119.4-112 112-31.4-31.4-232 232c-15.6 15.6-40.9 15.6-56.6 0s-15.6-40.9 0-56.6l232-232zM390.9 374.6c-12.5-12.5-12.5-32.8 0-45.3L505.6 214.6c12.5-12.5 32.8-12.5 45.3 0l18.7 18.7c12.5 12.5 12.5 32.8 0 45.3L454.9 393.4c-12.5 12.5-32.8 12.5-45.3 0l-18.7-18.7z\"]},Ka={prefix:\"fas\",iconName:\"person-walking\",icon:[384,512,[128694,\"walking\"],\"f554\",\"M192 80a56 56 0 1 0 0-112 56 56 0 1 0 0 112zM105.4 227.9l22.6-22.6 0 69.3c0 28 12.2 54.7 33.5 72.9l71.4 61.2c5.9 5.1 9.8 12.1 10.9 19.8l12.6 88.1c2.5 17.5 18.7 29.7 36.2 27.2s29.7-18.7 27.2-36.2l-12.6-88.1c-3.3-23.1-14.9-44.1-32.6-59.3l-34.5-29.6 0-115.2 3.8 4.7c18.2 22.8 45.8 36 75 36l33.2 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-33.2 0c-9.7 0-18.9-4.4-25-12l-17.9-22.4c-23-28.8-57.9-45.6-94.8-45.6-32.2 0-63.1 12.8-85.8 35.6L60.1 182.6C42.1 200.6 32 225 32 250.5L32 288c0 17.7 14.3 32 32 32s32-14.3 32-32l0-37.5c0-8.5 3.4-16.6 9.4-22.6zm12.4 179.4c-1.5 5.2-4.3 10-8.1 13.8L41.4 489.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l68.3-68.3c11.5-11.5 19.9-25.8 24.4-41.5l2.2-7.6-46-39.4c-2.5-2.2-5-4.4-7.4-6.8l-10.4 36.2z\"]},Ja={prefix:\"fas\",iconName:\"user\",icon:[448,512,[128100,62144,62470,\"user-alt\",\"user-large\"],\"f007\",\"M224 248a120 120 0 1 0 0-240 120 120 0 1 0 0 240zm-29.7 56C95.8 304 16 383.8 16 482.3 16 498.7 29.3 512 45.7 512l356.6 0c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3l-59.4 0z\"]},Qa={prefix:\"fas\",iconName:\"arrow-right\",icon:[512,512,[8594],\"f061\",\"M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-105.4 105.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z\"]},Za={prefix:\"fas\",iconName:\"handshake\",icon:[576,512,[129309,62662,\"handshake-alt\",\"handshake-simple\"],\"f2b5\",\"M268.9 85.2L152.3 214.8c-4.6 5.1-4.4 13 .5 17.9 30.5 30.5 80 30.5 110.5 0l31.8-31.8c4.2-4.2 9.5-6.5 14.9-6.9 6.8-.6 13.8 1.7 19 6.9L505.6 376 576 320 576 32 464 96 440.2 80.1C424.4 69.6 405.9 64 386.9 64l-70.4 0c-1.1 0-2.3 0-3.4 .1-16.9 .9-32.8 8.5-44.2 21.1zM116.6 182.7L223.4 64 183.8 64c-25.5 0-49.9 10.1-67.9 28.1L112 96 0 32 0 320 156.4 450.3c23 19.2 52 29.7 81.9 29.7l15.7 0-7-7c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l41 41 9 0c19.1 0 37.8-4.3 54.8-12.3L359 441c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l32 32 17.5-17.5c8.9-8.9 11.5-21.8 7.6-33.1l-137.9-136.8-14.9 14.9c-49.3 49.3-129.1 49.3-178.4 0-23-23-23.9-59.9-2.2-84z\"]},nr={prefix:\"fas\",iconName:\"xmark\",icon:[384,512,[128473,10005,10006,10060,215,\"close\",\"multiply\",\"remove\",\"times\"],\"f00d\",\"M55.1 73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L147.2 256 9.9 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192.5 301.3 329.9 438.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.8 256 375.1 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192.5 210.7 55.1 73.4z\"]},tr=nr,er={prefix:\"fas\",iconName:\"comments\",icon:[576,512,[128490,61670],\"f086\",\"M384 144c0 97.2-86 176-192 176-26.7 0-52.1-5-75.2-14L35.2 349.2c-9.3 4.9-20.7 3.2-28.2-4.2s-9.2-18.9-4.2-28.2l35.6-67.2C14.3 220.2 0 183.6 0 144 0 46.8 86-32 192-32S384 46.8 384 144zm0 368c-94.1 0-172.4-62.1-188.8-144 120-1.5 224.3-86.9 235.8-202.7 83.3 19.2 145 88.3 145 170.7 0 39.6-14.3 76.2-38.4 105.6l35.6 67.2c4.9 9.3 3.2 20.7-4.2 28.2s-18.9 9.2-28.2 4.2L459.2 498c-23.1 9-48.5 14-75.2 14z\"]},ar={prefix:\"fas\",iconName:\"circle-check\",icon:[512,512,[61533,\"check-circle\"],\"f058\",\"M256 512a256 256 0 1 1 0-512 256 256 0 1 1 0 512zM374 145.7c-10.7-7.8-25.7-5.4-33.5 5.3L221.1 315.2 169 263.1c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l72 72c5 5 11.8 7.5 18.8 7s13.4-4.1 17.5-9.8L379.3 179.2c7.8-10.7 5.4-25.7-5.3-33.5z\"]},rr=ar,or={prefix:\"fas\",iconName:\"pen\",icon:[512,512,[128394],\"f304\",\"M352.9 21.2L308 66.1 445.9 204 490.8 159.1C504.4 145.6 512 127.2 512 108s-7.6-37.6-21.2-51.1L455.1 21.2C441.6 7.6 423.2 0 404 0s-37.6 7.6-51.1 21.2zM274.1 100L58.9 315.1c-10.7 10.7-18.5 24.1-22.6 38.7L.9 481.6c-2.3 8.3 0 17.3 6.2 23.4s15.1 8.5 23.4 6.2l127.8-35.5c14.6-4.1 27.9-11.8 38.7-22.6L412 237.9 274.1 100z\"]},ir={prefix:\"fas\",iconName:\"address-book\",icon:[512,512,[62138,\"contact-book\"],\"f2b9\",\"M96 0C60.7 0 32 28.7 32 64l0 384c0 35.3 28.7 64 64 64l288 0c35.3 0 64-28.7 64-64l0-384c0-35.3-28.7-64-64-64L96 0zM208 288l64 0c44.2 0 80 35.8 80 80 0 8.8-7.2 16-16 16l-192 0c-8.8 0-16-7.2-16-16 0-44.2 35.8-80 80-80zm-24-96a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zM512 80c0-8.8-7.2-16-16-16s-16 7.2-16 16l0 64c0 8.8 7.2 16 16 16s16-7.2 16-16l0-64zm0 128c0-8.8-7.2-16-16-16s-16 7.2-16 16l0 64c0 8.8 7.2 16 16 16s16-7.2 16-16l0-64zM496 320c-8.8 0-16 7.2-16 16l0 64c0 8.8 7.2 16 16 16s16-7.2 16-16l0-64c0-8.8-7.2-16-16-16z\"]},dr={prefix:\"fas\",iconName:\"list\",icon:[512,512,[\"list-squares\"],\"f03a\",\"M40 48C26.7 48 16 58.7 16 72l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24L40 48zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L192 64zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-288 0zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-288 0zM16 232l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24l-48 0c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24l-48 0z\"]},sr={prefix:\"fas\",iconName:\"chevron-down\",icon:[448,512,[],\"f078\",\"M201.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 338.7 54.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z\"]},lr={prefix:\"fas\",iconName:\"plug\",icon:[448,512,[128268],\"f1e6\",\"M128-32c17.7 0 32 14.3 32 32l0 96 128 0 0-96c0-17.7 14.3-32 32-32s32 14.3 32 32l0 96 64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l0 64c0 95.1-69.2 174.1-160 189.3l0 66.7c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-66.7C101.2 398.1 32 319.1 32 224l0-64c-17.7 0-32-14.3-32-32S14.3 96 32 96l64 0 0-96c0-17.7 14.3-32 32-32z\"]},cr={prefix:\"fas\",iconName:\"clock-rotate-left\",icon:[576,512,[\"history\"],\"f1da\",\"M288 64c106 0 192 86 192 192S394 448 288 448c-65.2 0-122.9-32.5-157.6-82.3-10.1-14.5-30.1-18-44.6-7.9s-18 30.1-7.9 44.6C124.1 468.6 201 512 288 512 429.4 512 544 397.4 544 256S429.4 0 288 0C202.3 0 126.5 42.1 80 106.7L80 80c0-17.7-14.3-32-32-32S16 62.3 16 80l0 112c0 17.7 14.3 32 32 32l24.6 0c.5 0 1 0 1.5 0l86 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-38.3 0C154.9 102.6 217 64 288 64zm24 88c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 104c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65 0-94.1z\"]},pr=cr,gr={prefix:\"fas\",iconName:\"hourglass-half\",icon:[384,512,[\"hourglass-2\"],\"f252\",\"M32 0C14.3 0 0 14.3 0 32S14.3 64 32 64l0 11c0 42.4 16.9 83.1 46.9 113.1l67.9 67.9-67.9 67.9C48.9 353.9 32 394.6 32 437l0 11c-17.7 0-32 14.3-32 32s14.3 32 32 32l320 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l0-11c0-42.4-16.9-83.1-46.9-113.1l-67.9-67.9 67.9-67.9c30-30 46.9-70.7 46.9-113.1l0-11c17.7 0 32-14.3 32-32S369.7 0 352 0L32 0zM96 75l0-11 192 0 0 11c0 19-5.6 37.4-16 53L112 128c-10.3-15.6-16-34-16-53zm16 309c3.5-5.3 7.6-10.3 12.1-14.9l67.9-67.9 67.9 67.9c4.6 4.6 8.6 9.6 12.2 14.9L112 384z\"]},fr={prefix:\"fas\",iconName:\"arrow-down-1-9\",icon:[512,512,[\"sort-numeric-asc\",\"sort-numeric-down\"],\"f162\",\"M418.7 38c8.3 6 13.3 15.7 13.3 26l0 96 16 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-96 0c-17.7 0-32-14.3-32-32s14.3-32 32-32l16 0 0-51.6-5.9 2c-16.8 5.6-34.9-3.5-40.5-20.2s3.5-34.9 20.2-40.5l48-16c9.8-3.3 20.5-1.6 28.8 4.4zM365.1 430.6l11.7-18c-32.9-9.9-56.8-40.5-56.8-76.6 0-44.2 35.8-80 80-80s80 35.8 80 80c0 22.9-6.6 45.3-19.1 64.5l-42.1 64.9c-9.6 14.8-29.4 19.1-44.3 9.4s-19.1-29.4-9.4-44.3zM424 336a24 24 0 1 0 -48 0 24 24 0 1 0 48 0zM150.6 470.6c-12.5 12.5-32.8 12.5-45.3 0l-96-96c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L96 370.7 96 64c0-17.7 14.3-32 32-32s32 14.3 32 32l0 306.7 41.4-41.4c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3l-96 96z\"]},br=fr,mr={prefix:\"fas\",iconName:\"dice-d20\",icon:[512,512,[],\"f6cf\",\"M224.4-8.2c19.6-11.1 43.6-11.1 63.1 0l192 108.8c20 11.4 32.4 32.6 32.4 55.7l0 215.6c0 23-12.4 44.3-32.4 55.7l-192 108.8c-19.6 11.1-43.6 11.1-63.1 0L32.4 427.5C12.4 416.1 0 394.8 0 371.8L0 156.2c0-23 12.4-44.3 32.4-55.7L224.4-8.2zm52 73.2C267 49.8 245 49.8 235.6 65l-76.6 123.7-85.4-46.3-3.8-1.6c-8.9-2.7-18.8 1.1-23.4 9.6s-2.4 18.9 4.7 24.8l3.3 2.3 83.4 45.2-74.6 120.6C55.3 356.2 61 373 75 378.4l161 61.9 0 39.7c0 11 9 20 20 20s20-9 20-20l0-39.7 161-61.9c14-5.4 19.7-22.2 11.8-35l-74.7-120.6 83.4-45.2c9.7-5.3 13.3-17.4 8.1-27.1s-17.4-13.3-27.1-8.1L353 188.7 276.4 65zm-47 329.9l-122-46.9 54.5-88.1 67.5 135zM404.6 348l-122 46.9 67.5-135 54.5 88.1zM319.3 232L256 358.6 192.7 232 319.3 232zM308 192l-104.1 0 52-84 52 84z\"]},ur={prefix:\"fas\",iconName:\"download\",icon:[448,512,[],\"f019\",\"M256 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 210.7-41.4-41.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 242.7 256 32zM64 320c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-46.9 0-56.6 56.6c-31.2 31.2-81.9 31.2-113.1 0L110.9 320 64 320zm304 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z\"]},hr={prefix:\"fas\",iconName:\"shield-halved\",icon:[512,512,[\"shield-alt\"],\"f3ed\",\"M256 0c4.6 0 9.2 1 13.4 2.9L457.8 82.8c22 9.3 38.4 31 38.3 57.2-.5 99.2-41.3 280.7-213.6 363.2-16.7 8-36.1 8-52.8 0-172.4-82.5-213.1-264-213.6-363.2-.1-26.2 16.3-47.9 38.3-57.2L242.7 2.9C246.9 1 251.4 0 256 0zm0 66.8l0 378.1c138-66.8 175.1-214.8 176-303.4l-176-74.6 0 0z\"]},xr={prefix:\"fas\",iconName:\"caret-up\",icon:[320,512,[],\"f0d8\",\"M140.3 135.2c12.6-10.3 31.1-9.5 42.8 2.2l128 128c9.2 9.2 11.9 22.9 6.9 34.9S301.4 320 288.5 320l-256 0c-12.9 0-24.6-7.8-29.6-19.8S.7 274.5 9.9 265.4l128-128 2.4-2.2z\"]},vr={prefix:\"fas\",iconName:\"globe\",icon:[512,512,[127760],\"f0ac\",\"M351.9 280l-190.9 0c2.9 64.5 17.2 123.9 37.5 167.4 11.4 24.5 23.7 41.8 35.1 52.4 11.2 10.5 18.9 12.2 22.9 12.2s11.7-1.7 22.9-12.2c11.4-10.6 23.7-28 35.1-52.4 20.3-43.5 34.6-102.9 37.5-167.4zM160.9 232l190.9 0C349 167.5 334.7 108.1 314.4 64.6 303 40.2 290.7 22.8 279.3 12.2 268.1 1.7 260.4 0 256.4 0s-11.7 1.7-22.9 12.2c-11.4 10.6-23.7 28-35.1 52.4-20.3 43.5-34.6 102.9-37.5 167.4zm-48 0C116.4 146.4 138.5 66.9 170.8 14.7 78.7 47.3 10.9 131.2 1.5 232l111.4 0zM1.5 280c9.4 100.8 77.2 184.7 169.3 217.3-32.3-52.2-54.4-131.7-57.9-217.3L1.5 280zm398.4 0c-3.5 85.6-25.6 165.1-57.9 217.3 92.1-32.7 159.9-116.5 169.3-217.3l-111.4 0zm111.4-48C501.9 131.2 434.1 47.3 342 14.7 374.3 66.9 396.4 146.4 399.9 232l111.4 0z\"]},yr={prefix:\"fas\",iconName:\"upload\",icon:[448,512,[],\"f093\",\"M256 109.3L256 320c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-210.7-41.4 41.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l96-96c12.5-12.5 32.8-12.5 45.3 0l96 96c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L256 109.3zM224 400c44.2 0 80-35.8 80-80l80 0c35.3 0 64 28.7 64 64l0 32c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64l0-32c0-35.3 28.7-64 64-64l80 0c0 44.2 35.8 80 80 80zm144 24a24 24 0 1 0 0-48 24 24 0 1 0 0 48z\"]},wr={prefix:\"fas\",iconName:\"arrow-left\",icon:[512,512,[8592],\"f060\",\"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 288 480 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-370.7 0 105.4-105.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z\"]},kr={prefix:\"fas\",iconName:\"landmark\",icon:[512,512,[127963],\"f66f\",\"M238.7 5.1c10.5-6.8 24.1-6.8 34.6 0l224 144c11.9 7.7 17.4 22.3 13.4 35.9s-16.5 23-30.7 23l-32 0 0 208 51.2 38.4c8.1 6 12.8 15.5 12.8 25.6 0 17.7-14.3 32-32 32L32 512c-17.7 0-32-14.3-32-32 0-10.1 4.7-19.6 12.8-25.6l51.2-38.4 0 0 0-208-32 0c-14.2 0-26.7-9.4-30.7-23s1.5-28.3 13.4-35.9l224-144zM336 208l0 208 64 0 0-208-64 0zM224 416l64 0 0-208-64 0 0 208zM112 208l0 208 64 0 0-208-64 0z\"]},Sr={prefix:\"fas\",iconName:\"robot\",icon:[640,512,[129302],\"f544\",\"M352 0c0-17.7-14.3-32-32-32S288-17.7 288 0l0 64-96 0c-53 0-96 43-96 96l0 224c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-224c0-53-43-96-96-96l-96 0 0-64zM160 368c0-13.3 10.7-24 24-24l32 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-32 0c-13.3 0-24-10.7-24-24zm120 0c0-13.3 10.7-24 24-24l32 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-32 0c-13.3 0-24-10.7-24-24zm120 0c0-13.3 10.7-24 24-24l32 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-32 0c-13.3 0-24-10.7-24-24zM224 176a48 48 0 1 1 0 96 48 48 0 1 1 0-96zm144 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zM64 224c0-17.7-14.3-32-32-32S0 206.3 0 224l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96zm544-32c-17.7 0-32 14.3-32 32l0 96c0 17.7 14.3 32 32 32s32-14.3 32-32l0-96c0-17.7-14.3-32-32-32z\"]},Cr={prefix:\"fas\",iconName:\"eye-slash\",icon:[576,512,[],\"f070\",\"M41-24.9c-9.4-9.4-24.6-9.4-33.9 0S-2.3-.3 7 9.1l528 528c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-96.4-96.4c2.7-2.4 5.4-4.8 8-7.2 46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7 0-24.6-14.9-35.7-46.2-87.7-93-131.1-47.1-43.7-111.8-80.6-192.6-80.6-56.8 0-105.6 18.2-146 44.2L41-24.9zM204.5 138.7c23.5-16.8 52.4-26.7 83.5-26.7 79.5 0 144 64.5 144 144 0 31.1-9.9 59.9-26.7 83.5l-34.7-34.7c12.7-21.4 17-47.7 10.1-73.7-13.7-51.2-66.4-81.6-117.6-67.9-8.6 2.3-16.7 5.7-24 10l-34.7-34.7zM325.3 395.1c-11.9 3.2-24.4 4.9-37.3 4.9-79.5 0-144-64.5-144-144 0-12.9 1.7-25.4 4.9-37.3L69.4 139.2c-32.6 36.8-55 75.8-66.9 104.5-3.3 7.9-3.3 16.7 0 24.6 14.9 35.7 46.2 87.7 93 131.1 47.1 43.7 111.8 80.6 192.6 80.6 37.3 0 71.2-7.9 101.5-20.6l-64.2-64.2z\"]},$r={prefix:\"fas\",iconName:\"bolt\",icon:[448,512,[9889,\"zap\"],\"f0e7\",\"M338.8-9.9c11.9 8.6 16.3 24.2 10.9 37.8L271.3 224 416 224c13.5 0 25.5 8.4 30.1 21.1s.7 26.9-9.6 35.5l-288 240c-11.3 9.4-27.4 9.9-39.3 1.3s-16.3-24.2-10.9-37.8L176.7 288 32 288c-13.5 0-25.5-8.4-30.1-21.1s-.7-26.9 9.6-35.5l288-240c11.3-9.4 27.4-9.9 39.3-1.3z\"]},_r={prefix:\"fas\",iconName:\"tag\",icon:[512,512,[127991],\"f02b\",\"M32.5 96l0 149.5c0 17 6.7 33.3 18.7 45.3l192 192c25 25 65.5 25 90.5 0L483.2 333.3c25-25 25-65.5 0-90.5l-192-192C279.2 38.7 263 32 246 32L96.5 32c-35.3 0-64 28.7-64 64zm112 16a32 32 0 1 1 0 64 32 32 0 1 1 0-64z\"]},zr={prefix:\"fas\",iconName:\"compass\",icon:[512,512,[129517],\"f14e\",\"M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm50.7-186.9L162.4 380.6c-19.4 7.5-38.5-11.6-31-31l55.5-144.3c3.3-8.5 9.9-15.1 18.4-18.4l144.3-55.5c19.4-7.5 38.5 11.6 31 31L325.1 306.7c-3.2 8.5-9.9 15.1-18.4 18.4zM288 256a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z\"]},Dr={prefix:\"fas\",iconName:\"desktop\",icon:[512,512,[128421,61704,\"desktop-alt\"],\"f390\",\"M64 32C28.7 32 0 60.7 0 96L0 352c0 35.3 28.7 64 64 64l144 0-16 48-72 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l272 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-72 0-16-48 144 0c35.3 0 64-28.7 64-64l0-256c0-35.3-28.7-64-64-64L64 32zM96 96l320 0c17.7 0 32 14.3 32 32l0 160c0 17.7-14.3 32-32 32L96 320c-17.7 0-32-14.3-32-32l0-160c0-17.7 14.3-32 32-32z\"]},Ir={prefix:\"fas\",iconName:\"coins\",icon:[512,512,[],\"f51e\",\"M128 96l0-16c0-44.2 86-80 192-80S512 35.8 512 80l0 16c0 30.6-41.3 57.2-102 70.7-2.4-2.8-4.9-5.5-7.4-8-15.5-15.3-35.5-26.9-56.4-35.5-41.9-17.5-96.5-27.1-154.2-27.1-21.9 0-43.3 1.4-63.8 4.1-.2-1.3-.2-2.7-.2-4.1zM432 353l0-46.2c15.1-3.9 29.3-8.5 42.2-13.9 13.2-5.5 26.1-12.2 37.8-20.3l0 15.4c0 26.8-31.5 50.5-80 65zm0-96l0-33c0-4.5-.4-8.8-1-13 15.5-3.9 30-8.6 43.2-14.2s26.1-12.2 37.8-20.3l0 15.4c0 26.8-31.5 50.5-80 65zM0 240l0-16c0-44.2 86-80 192-80s192 35.8 192 80l0 16c0 44.2-86 80-192 80S0 284.2 0 240zm384 96c0 44.2-86 80-192 80S0 380.2 0 336l0-15.4c11.6 8.1 24.5 14.7 37.8 20.3 41.9 17.5 96.5 27.1 154.2 27.1s112.3-9.7 154.2-27.1c13.2-5.5 26.1-12.2 37.8-20.3l0 15.4zm0 80.6l0 15.4c0 44.2-86 80-192 80S0 476.2 0 432l0-15.4c11.6 8.1 24.5 14.7 37.8 20.3 41.9 17.5 96.5 27.1 154.2 27.1s112.3-9.7 154.2-27.1c13.2-5.5 26.1-12.2 37.8-20.3z\"]},Ar={prefix:\"fas\",iconName:\"gamepad\",icon:[640,512,[],\"f11b\",\"M448 64c106 0 192 86 192 192S554 448 448 448l-256 0C86 448 0 362 0 256S86 64 192 64l256 0zM192 176c-13.3 0-24 10.7-24 24l0 32-32 0c-13.3 0-24 10.7-24 24s10.7 24 24 24l32 0 0 32c0 13.3 10.7 24 24 24s24-10.7 24-24l0-32 32 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-32 0 0-32c0-13.3-10.7-24-24-24zm240 96a32 32 0 1 0 0 64 32 32 0 1 0 0-64zm64-96a32 32 0 1 0 0 64 32 32 0 1 0 0-64z\"]},Pr={prefix:\"fas\",iconName:\"arrows-rotate\",icon:[512,512,[128472,\"refresh\",\"sync\"],\"f021\",\"M65.9 228.5c13.3-93 93.4-164.5 190.1-164.5 53 0 101 21.5 135.8 56.2 .2 .2 .4 .4 .6 .6l7.6 7.2-47.9 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l128 0c17.7 0 32-14.3 32-32l0-128c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 53.4-11.3-10.7C390.5 28.6 326.5 0 256 0 127 0 20.3 95.4 2.6 219.5 .1 237 12.2 253.2 29.7 255.7s33.7-9.7 36.2-27.1zm443.5 64c2.5-17.5-9.7-33.7-27.1-36.2s-33.7 9.7-36.2 27.1c-13.3 93-93.4 164.5-190.1 164.5-53 0-101-21.5-135.8-56.2-.2-.2-.4-.4-.6-.6l-7.6-7.2 47.9 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L32 320c-8.5 0-16.7 3.4-22.7 9.5S-.1 343.7 0 352.3l1 127c.1 17.7 14.6 31.9 32.3 31.7S65.2 496.4 65 478.7l-.4-51.5 10.7 10.1c46.3 46.1 110.2 74.7 180.7 74.7 129 0 235.7-95.4 253.4-219.5z\"]},Er=Pr,Tr={prefix:\"fas\",iconName:\"circle-info\",icon:[512,512,[\"info-circle\"],\"f05a\",\"M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zM224 160a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm-8 64l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24z\"]},Mr=Tr,Nr={prefix:\"fas\",iconName:\"weight-hanging\",icon:[512,512,[],\"f5cd\",\"M224 96a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm122.5 32c3.5-10 5.5-20.8 5.5-32 0-53-43-96-96-96s-96 43-96 96c0 11.2 1.9 22 5.5 32l-21.8 0c-28.3 0-53.2 18.5-61.3 45.6L2.4 440.2C.8 445.4 0 450.8 0 456.2 0 487 25 512 55.8 512l400.4 0c30.8 0 55.8-25 55.8-55.8 0-5.4-.8-10.8-2.4-16l-80-266.5c-8.1-27.1-33-45.6-61.3-45.6l-21.8 0z\"]};na.add(mr,ha,da,Ga,Ca,ka,Ia,Oa,Ha,tr,sr,wa,ja,vr,Aa,ir,pr,ba,Sa,hr,$r,Wa,or,ua,qa,oa,Ir,sa,fa,ur,yr,Pa,ya,Da,_r,aa,la,rr,Ta,Mr,Xa,Nr,dr,br,va,Cr,Qa,wr,Za,ia,pa,Ja,zr,Dr,lr,Na,Fa,$a,_a,xa,Va,er,Ma,Sr,gr,Ua,xr,ea,ca,Ka,La,Ar,Ba,za,kr,Er),ta.watch(),console.log(\"[DND Dashboard] FontAwesome SVGs loaded.\");const Or={_suppressNext:!1,runSilently:async n=>{Or._suppressNext=!0;try{await n()}finally{setTimeout(()=>{Or._suppressNext=!1,console.log(\"[DND Dashboard] æ¢å¤æ•°æ®åº“ç›‘å¬\")},2e3)}},handleUpdate:()=>{if(Or._suppressNext)return void console.log(\"[DND Dashboard] æ‹¦æˆªäº†å›å¼¹ä¿¡å·\");const{$:n}=a();if(n(\"#dnd-dashboard-root\").hasClass(\"visible\")){const t=n(\".dnd-nav-item.active\");t.length&&mo&&mo.renderPanel&&mo.renderPanel(t.data(\"target\"))}mo&&mo.renderHUD&&mo.renderHUD(),Lr.checkAndRefill()}},Lr={isRefilling:!1,generateRow:n=>{const t=n=>Math.floor(Math.random()*n)+1;return[null,String(n),t(4),t(6),t(8),t(10),t(12),t(20),t(100)]},ensureProperFormat:n=>{if(!n)return n;if(n.mate&&\"chatSheets\"===n.mate.type)return n;const t=JSON.parse(JSON.stringify(n));return Object.keys(t).some(n=>n.startsWith(\"sheet_\"))&&!t.mate&&(t.mate={type:\"chatSheets\",version:2,schema:\"DND5E_TextRPG\",created:Date.now()}),t},saveData:async n=>{const t=Rr.getAPI(),e=Lr.ensureProperFormat(n);await Or.runSilently(async()=>{try{let n=!1;try{const t=window.parent||window;let e=t.SillyTavern||(t.top?t.top.SillyTavern:null);if(e&&e.chat&&e.chat.length>0){let t=null;for(let n=e.chat.length-1;n>=0;n--)if(!e.chat[n].is_user){t=e.chat[n];break}t&&(t.TavernDB_ACU_Data||(t.TavernDB_ACU_Data={}),e.saveChat&&(await e.saveChat(),n=!0,console.log(\"[DND Dashboard] å·²é€šè¿‡ ST.saveChat() æ³¨å…¥æ•°æ®\")))}}catch(n){console.warn(\"[DND Dashboard] ç›´æ¥æ³¨å…¥å¤±è´¥:\",n)}t&&t.importTableAsJson?(await t.importTableAsJson(JSON.stringify(e)),console.log(\"[DND Dashboard] å·²è°ƒç”¨ api.importTableAsJson\")):n||console.error(\"[DND Dashboard] æ— æ³•ä¿å­˜æ•°æ®ï¼šAPI ä¸å¯ç”¨ä¸”æ³¨å…¥å¤±è´¥\")}catch(n){console.error(\"[DND Dashboard] ä¿å­˜è¿‡ç¨‹å¼‚å¸¸:\",n)}})},checkAndRefill:async()=>{if(Lr.isRefilling)return;const n=Rr.getAPI();if(n&&n.exportTableAsJson)try{const t=n.exportTableAsJson();if(!t)return;let e=\"string\"==typeof t?JSON.parse(t):t,r=Object.keys(e).find(n=>{const t=e[n];return t.name&&(\"ğŸ² éª°å­æ± \"===t.name||t.name.includes(\"éª°å­æ± \"))});if(!r)return;const o=e[r];if(o.content||(o.content=[]),o.content.length<7){console.log(\"[DND Dashboard] Dice pool low, refilling...\"),Lr.isRefilling=!0;let n=0;if(o.content.length>1)for(let t=1;t<o.content.length;t++){const e=parseInt(o.content[t][1]);!isNaN(e)&&e>n&&(n=e)}const t=21-o.content.length;if(t>0){for(let e=0;e<t;e++)n++,o.content.push(Lr.generateRow(n));await Lr.saveData(e),console.log(`[DND Dashboard] Added ${t} dice rows.`);const{$:r}=a();if(r(\"#dnd-hud-status-text\").length){const n=r(\"#dnd-hud-status-text\"),t=n.html();n.html('<span style=\"color:var(--dnd-text-highlight);animation:dnd-pulse 1s infinite;\">ğŸ² éª°å­æ± å·²è‡ªåŠ¨è¡¥å……</span>'),setTimeout(()=>{n.text().includes(\"éª°å­æ± å·²è‡ªåŠ¨è¡¥å……\")&&n.html(t)},3e3)}}}}catch(n){console.error(\"[DND Dashboard] Failed to refill dice pool:\",n)}finally{setTimeout(()=>{Lr.isRefilling=!1},3e3)}}},Rr={findTableKey:(n,t)=>n?Object.keys(n).find(e=>e===t||e.includes(t)||n[e].name&&n[e].name.includes(t)):null,applySystemNotification:(n,t)=>{if(!n)return;let e=Object.keys(n).find(t=>t.includes(\"SYS_GlobalState\")||n[t].name&&n[t].name.includes(\"å…¨å±€çŠ¶æ€\"));if(!e)return;const a=n[e];if(!a.content||a.content.length<2)return;let r=a.content[0].indexOf(\"ç³»ç»Ÿé€šçŸ¥\");-1===r&&(a.content[0].push(\"ç³»ç»Ÿé€šçŸ¥\"),r=a.content[0].length-1,a.content[1].length<=r&&(a.content[1][r]=null)),a.content[1][r]=t},setSystemNotification:async n=>{const t=Rr.getAllData();Rr.applySystemNotification(t,n),await Lr.saveData(t)},getAPI:()=>a().getDB(),getCore:a,parseValue:(n,t=\"json\")=>{if(!n)return null;if(\"object\"==typeof n)return n;if(\"string\"==typeof n){if(n.trim().startsWith(\"{\")||n.trim().startsWith(\"[\"))try{const t=JSON.parse(n);if(t&&\"object\"==typeof t)return t}catch(n){}if(\"stats\"===t){const t={};if(n.trim().startsWith(\"{\"))try{const t=JSON.parse(n);if(t)return t}catch(n){}return n.split(\"|\").forEach(n=>{const[e,a]=n.split(\":\");e&&a&&(t[e.trim()]=isNaN(a)?a:parseInt(a))}),Object.keys(t).length>0?t:null}if(\"coord\"===t){if(n.trim().startsWith(\"{\"))try{const t=JSON.parse(n);if(t)return t}catch(n){}if(n.includes(\":\")&&!n.includes(\"{\")){const t={};return n.split(\",\").forEach(n=>{const[e,a]=n.split(\":\");e&&a&&(t[e.trim()]=parseFloat(a))}),t}const t=n.split(\",\");if(t.length>=2)return{x:parseFloat(t[0]),y:parseFloat(t[1])}}if(\"size\"===t){if(n.trim().startsWith(\"{\"))try{const t=JSON.parse(n);if(t)return t}catch(n){}const t=n.split(\",\");if(t.length>=2)return{w:parseFloat(t[0]),h:parseFloat(t[1])}}if(\"resources\"===t){if(n.trim().startsWith(\"{\"))try{const t=JSON.parse(n);if(t)return t}catch(n){}const t={};return n.split(\"|\").forEach(n=>{const[e,a]=n.split(\":\");e&&a&&(t[e.trim()]=a.trim())}),Object.keys(t).length>0?t:null}}return null},getAllData:()=>{const n=Rr.getAPI();if(!n||!n.exportTableAsJson)return null;const t=n.exportTableAsJson();return\"string\"==typeof t?JSON.parse(t):t},parseSheet:n=>{if(!n||!n.content||n.content.length<2)return[];const t=n.content[0];return n.content.slice(1).map(n=>{const e={};return t.forEach((t,a)=>{t&&(e[t]=n[a])}),e})},getTable:n=>{const t=Rr.getAllData();if(!t)return null;const e=Object.keys(t).find(e=>e.includes(n)||t[e].name&&t[e].name.includes(n));return e?Rr.parseSheet(t[e]):null},getPartyData:()=>{const n=Rr.getTable(\"CHARACTER_Registry\"),t=Rr.getTable(\"CHARACTER_Attributes\"),e=Rr.getTable(\"CHARACTER_Resources\");if(!n)return[];const a=[];return n.forEach(n=>{const r=n.CHAR_ID,o=t?t.find(n=>n.CHAR_ID===r):{},i=e?e.find(n=>n.CHAR_ID===r):{},d=\"ä¸»è§’\"===n[\"æˆå‘˜ç±»å‹\"]?\"PC\":\"NPC\",s=\"PC\"===d,l={...n,...o,...i,type:d,isPC:s};a.push(l)}),a},getCharacterSkills:n=>{const t=Rr.getTable(\"CHARACTER_Skills\"),e=Rr.getTable(\"SKILL_Library\");if(!t||!e)return[];let a=t.filter(t=>t.CHAR_ID===n);if(0===a.length){const e=Rr.getPartyData().find(t=>t[\"å§“å\"]===n);if(e){const n=e.CHAR_ID;a=t.filter(t=>t.CHAR_ID===n)}}return a.map(n=>{const t=e.find(t=>t.SKILL_ID===n.SKILL_ID);return{...n,...t}})},getCharacterFeats:n=>{const t=Rr.getTable(\"CHARACTER_Feats\"),e=Rr.getTable(\"FEAT_Library\");if(!t||!e)return[];let a=t.filter(t=>t.CHAR_ID===n);if(0===a.length){const e=Rr.getPartyData().find(t=>t[\"å§“å\"]===n);if(e){const n=e.CHAR_ID;a=t.filter(t=>t.CHAR_ID===n)}}return a.map(n=>{const t=e.find(t=>t.FEAT_ID===n.FEAT_ID);return{...n,...t}})},getKnownSpells:n=>{if(!n){const t=Rr.getPartyData().find(n=>n.isPC);t&&(n=t.CHAR_ID)}if(!n)return[];const t=Rr.getTable(\"CHARACTER_Skills\"),e=Rr.getTable(\"SKILL_Library\");if(!t||!e)return[];let a=t.filter(t=>t.CHAR_ID===n);if(0===a.length){const e=Rr.getPartyData().find(t=>t[\"å§“å\"]===n);if(e){const n=e.CHAR_ID;a=t.filter(t=>t.CHAR_ID===n)}}const r=[];return a.forEach(n=>{const t=e.find(t=>t.SKILL_ID===n.SKILL_ID);t&&\"æ³•æœ¯\"===t[\"æŠ€èƒ½ç±»å‹\"]&&r.push({...t,...n,\"æ³•æœ¯åç§°\":t[\"æŠ€èƒ½åç§°\"],\"å·²å‡†å¤‡\":n[\"å·²å‡†å¤‡\"]})}),r},getMaxSpellSlotLevel:n=>{if(!n||!n[\"æ³•æœ¯ä½\"])return 9;const t=Rr.parseValue(n[\"æ³•æœ¯ä½\"],\"resources\");if(!t)return 0;let e=0;return Object.keys(t).forEach(n=>{let a=parseInt(n);if(isNaN(a)){const t=n.match(/(\\d+)/);t&&(a=parseInt(t[1]))}if(!isNaN(a)&&a>e){const r=t[n].toString().split(\"/\");if(r.length>=2){const n=parseInt(r[1]);!isNaN(n)&&n>0&&(e=a)}else e=a}}),e},exportPartyData:()=>{const n=Rr.getPartyData();if(!n||0===n.length)return console.warn(\"[DND DataManager] æ— é˜Ÿä¼æ•°æ®å¯å¯¼å‡º\"),null;const t={version:\"1.0\",exportDate:(new Date).toISOString(),exportSource:\"DND_Dashboard_Immersive\",party:[],skills:{},feats:{},spells:{}};return n.forEach(n=>{const e=n.CHAR_ID||n.PC_ID||n[\"å§“å\"];t.party.push({...n});const a=Rr.getCharacterSkills(e);a&&a.length>0&&(t.skills[e]=a);const r=Rr.getCharacterFeats(e);r&&r.length>0&&(t.feats[e]=r);const o=Rr.getKnownSpells(e);o&&o.length>0&&(t.spells[e]=o)}),t},importPartyData:async n=>{try{if(!n||!n.party||!Array.isArray(n.party))return{success:!1,message:\"æ— æ•ˆçš„æ•°æ®æ ¼å¼\"};const t=Rr.getAllData();if(!t)return{success:!1,message:\"æ— æ³•è¯»å–æ•°æ®åº“\"};const e=(n,e)=>{const a=Rr.findTableKey(t,n);if(!a)return;const r=t[a];if(!r||!r.content||r.content.length<1)return;const o=r.content[0];let i=\"CHAR_ID\";o.includes(\"PC_ID\")?i=\"PC_ID\":o.includes(\"å§“å\")&&!o.includes(\"CHAR_ID\")&&(i=\"å§“å\");const d=o.indexOf(i);-1!==d&&e.forEach(n=>{const t=n[i]||n.CHAR_ID||n[\"å§“å\"];if(!t)return;let e=-1;for(let n=1;n<r.content.length;n++){if(r.content[n][d]===t){e=n;break}}if(-1!==e)o.forEach((t,a)=>{void 0!==n[t]&&(r.content[e][a]=n[t])});else{const t=o.map(t=>void 0!==n[t]?n[t]:null);void 0!==n[i]&&(t[d]=n[i]),r.content.push(t)}})};e(\"CHARACTER_Registry\",n.party),e(\"CHARACTER_Attributes\",n.party),e(\"CHARACTER_Resources\",n.party);const a=(n,e,a,r,o,i=null,d=null)=>{if(!n)return;const s=Rr.findTableKey(t,e),l=Rr.findTableKey(t,a);if(!s||!l)return;const c=t[s],p=t[l],g=c.content[0],f=p.content[0];Object.keys(n).forEach(t=>{const e=n[t];Array.isArray(e)&&e.forEach(n=>{let e=n[r];const a=n[o];let s=-1;const l=g.indexOf(r),b=g.indexOf(o);if(e&&-1!==l&&(s=c.content.findIndex((n,t)=>t>0&&n[l]===e)),-1===s&&a&&-1!==b&&(s=c.content.findIndex((n,t)=>t>0&&n[b]===a),-1!==s&&(e=c.content[s][l])),-1===s){e||(e=(r.startsWith(\"SKILL\")?\"SKL_\":\"FEAT_\")+Math.random().toString(36).substr(2,8));const t=g.map(t=>t===r?e:d&&t===i?d:void 0!==n[t]?n[t]:null);c.content.push(t)}const m=f.indexOf(\"CHAR_ID\"),u=f.indexOf(r);if(-1!==m&&-1!==u){const a=p.content.some((n,a)=>a>0&&n[m]===t&&n[u]===e);if(!a){const a=f.map(a=>\"LINK_ID\"===a?\"LNK_\"+Math.random().toString(36).substr(2,8):\"CHAR_ID\"===a?t:a===r?e:void 0!==n[a]?n[a]:null);p.content.push(a)}}})})};return a(n.skills,\"SKILL_Library\",\"CHARACTER_Skills\",\"SKILL_ID\",\"æŠ€èƒ½åç§°\"),a(n.spells,\"SKILL_Library\",\"CHARACTER_Skills\",\"SKILL_ID\",\"æŠ€èƒ½åç§°\",\"æŠ€èƒ½ç±»å‹\",\"æ³•æœ¯\"),a(n.feats,\"FEAT_Library\",\"CHARACTER_Feats\",\"FEAT_ID\",\"ä¸“é•¿åç§°\"),await Lr.saveData(t),{success:!0,message:`æˆåŠŸå¯¼å…¥ ${n.party.length} ä¸ªè§’è‰²`,count:n.party.length}}catch(n){return console.error(\"[DND DataManager] å¯¼å…¥é˜Ÿä¼æ•°æ®å¤±è´¥:\",n),{success:!1,message:\"å¯¼å…¥å¤±è´¥: \"+n.message}}},importFVTTData:async n=>{try{const t=Rr.getAPI();if(!t)return{success:!1,message:\"API ä¸å¯ç”¨\"};if(!n.name||!n.system)return{success:!1,message:\"æ— æ•ˆçš„ FVTT è§’è‰²æ–‡ä»¶\"};const e=n.name,a=n.system,r=a.details||{},o=a.abilities||{},i=a.attributes||{},d=(n.items||[]).filter(n=>\"class\"===n.type),s=d.map(n=>`${n.name} ${n.system?.levels||1}`).join(\" / \")||\"å¹³æ°‘ 1\",l=r.level||d.reduce((n,t)=>n+(t.system?.levels||0),0)||1,c=(n.items||[]).find(n=>\"race\"===n.type),p=c?c.name:r.race||\"æœªçŸ¥ç§æ—\",g={},f={str:\"STR\",dex:\"DEX\",con:\"CON\",int:\"INT\",wis:\"WIS\",cha:\"CHA\"};Object.keys(o).forEach(n=>{f[n]&&(g[f[n]]=o[n].value||10)});const b={acr:\"æ‚æŠ€\",ani:\"é©¯å…½\",arc:\"å¥¥ç§˜\",ath:\"è¿åŠ¨\",dec:\"æ¬ºç’\",his:\"å†å²\",ins:\"æ´æ‚‰\",itm:\"å¨å“\",inv:\"è°ƒæŸ¥\",med:\"åŒ»è¯\",nat:\"è‡ªç„¶\",prc:\"å¯Ÿè§‰\",prf:\"è¡¨æ¼”\",per:\"è¯´æœ\",rel:\"å®—æ•™\",slt:\"æ‰‹æ³•\",ste:\"éšåŒ¿\",sur:\"ç”Ÿå­˜\"},m=[];a.skills&&Object.keys(a.skills).forEach(n=>{a.skills[n].value>=1&&m.push(b[n]||n)});const u=[];Object.keys(o).forEach(n=>{o[n].proficient>=1&&u.push(b[n]||n.toUpperCase())});const h={CHAR_ID:\"FVTT_\"+Date.now(),\"æˆå‘˜ç±»å‹\":\"åŒä¼´\",\"å§“å\":e,\"ç§æ—/æ€§åˆ«/å¹´é¾„\":`${p} / - / -`,\"èŒä¸š\":s,\"å¤–è²Œæè¿°\":r.appearance||\"\",\"æ€§æ ¼ç‰¹ç‚¹\":(r.trait||\"\")+\" \"+(r.ideal||\"\")+\" \"+(r.bond||\"\")+\" \"+(r.flaw||\"\"),\"èƒŒæ™¯æ•…äº‹\":r.biography?.value?.replace(/<[^>]+>/g,\"\")||\"\",\"åŠ å…¥æ—¶é—´\":(new Date).toISOString().slice(0,10),\"ç­‰çº§\":l,HP:`${i.hp?.value||0}/${i.hp?.max||1}`,AC:i.ac?.value||10,\"å…ˆæ”»åŠ å€¼\":i.init?.total||0,\"é€Ÿåº¦\":i.movement?.walk?`${i.movement.walk}å°º`:\"30å°º\",\"å±æ€§å€¼\":JSON.stringify(g),\"è±å…ç†Ÿç»ƒ\":JSON.stringify(u),\"æŠ€èƒ½ç†Ÿç»ƒ\":JSON.stringify(m),\"è¢«åŠ¨æ„ŸçŸ¥\":a.skills?.prc?.passive||10,\"æ³•æœ¯ä½\":\"\",\"é‡‘å¸\":a.currency&&a.currency.gp||0,\"ç”Ÿå‘½éª°\":`${i.hd||0}/${i.hd||0}`},x=[];(n.items||[]).forEach(n=>{[\"weapon\",\"equipment\",\"consumable\",\"loot\",\"backpack\"].includes(n.type)&&x.push({\"ç‰©å“ID\":n.name,\"ç‰©å“åç§°\":n.name,\"ç±»åˆ«\":\"weapon\"===n.type?\"æ­¦å™¨\":\"equipment\"===n.type?\"æŠ¤ç”²\":\"æ‚ç‰©\",\"æ•°é‡\":n.system?.quantity||1,\"å·²è£…å¤‡\":n.system?.equipped?\"æ˜¯\":\"å¦\",\"æ‰€å±äºº\":e,\"ç¨€æœ‰åº¦\":n.system?.rarity||\"æ™®é€š\",\"æè¿°\":n.system?.description?.value?.replace(/<[^>]+>/g,\"\")||\"\",\"é‡é‡\":n.system?.weight||0,\"ä»·å€¼\":n.system?.price?.value?`${n.system.price.value}gp`:\"-\"})});const v=[];(n.items||[]).forEach(n=>{\"spell\"===n.type&&v.push({SKILL_ID:n.name,\"æŠ€èƒ½åç§°\":n.name,\"æŠ€èƒ½ç±»å‹\":\"æ³•æœ¯\",\"ç¯é˜¶\":n.system?.level||0,\"å­¦æ´¾\":n.system?.school||\"-\",\"æ–½æ³•æ—¶é—´\":n.system?.activation?.type||\"-\",\"å°„ç¨‹\":n.system?.range?.value?`${n.system.range.value} ${n.system.range.units}`:\"-\",\"æˆåˆ†\":n.system?.components?Object.keys(n.system.components).filter(t=>n.system.components[t]).join(\",\").toUpperCase():\"-\",\"æŒç»­æ—¶é—´\":n.system?.duration?.value?`${n.system.duration.value} ${n.system.duration.units}`:\"-\",\"æ•ˆæœæè¿°\":n.system?.description?.value?.replace(/<[^>]+>/g,\"\")||\"\"})});const y=t.exportTableAsJson(),w=\"string\"==typeof y?JSON.parse(y):y,k=Rr.findTableKey(w,\"CHARACTER_Registry\"),S=k?w[k]:null;if(S&&S.content){const n=S.content[0].map(n=>void 0!==h[n]?h[n]:null);S.content.push(n)}const C=Rr.findTableKey(w,\"CHARACTER_Attributes\"),$=C?w[C]:null;if($&&$.content){const n=$.content[0].map(n=>void 0!==h[n]?h[n]:null);$.content.push(n)}const _=Rr.findTableKey(w,\"CHARACTER_Resources\"),z=_?w[_]:null;if(z&&z.content){const n=z.content[0].map(n=>void 0!==h[n]?h[n]:null);z.content.push(n)}const D=Rr.findTableKey(w,\"ITEM_Inventory\"),I=D?w[D]:null;if(I&&I.content){const n=I.content[0];x.forEach(t=>{const e=n.map(n=>void 0!==t[n]?t[n]:null);I.content.push(e)})}const A=Rr.findTableKey(w,\"SKILL_Library\"),P=A?w[A]:null,E=Rr.findTableKey(w,\"CHARACTER_Skills\"),T=E?w[E]:null;if(P&&P.content&&T&&T.content){const n=P.content[0],t=T.content[0];v.forEach(e=>{const a=P.content.some(n=>n[1]===e[\"æŠ€èƒ½åç§°\"]);let r=\"SKL_\"+Math.random().toString(36).substr(2,6);if(a){const t=P.content.find(n=>n[1]===e[\"æŠ€èƒ½åç§°\"]);t&&(r=t[n.indexOf(\"SKILL_ID\")])}else{const t=n.map(n=>\"SKILL_ID\"===n?r:void 0!==e[n]?e[n]:null);P.content.push(t)}const o=t.map(n=>\"LINK_ID\"===n?\"LNK_\"+Math.random().toString(36).substr(2,6):\"CHAR_ID\"===n?h.CHAR_ID:\"SKILL_ID\"===n?r:\"å·²å‡†å¤‡\"===n?\"æ˜¯\":null);T.content.push(o)})}return await t.importTableAsJson(JSON.stringify(w)),{success:!0,message:`æˆåŠŸå¯¼å…¥ FVTT è§’è‰²: ${e}`}}catch(n){return console.error(\"[DND DataManager] FVTT å¯¼å…¥å¤±è´¥:\",n),{success:!1,message:\"è§£ææˆ–ä¿å­˜å¤±è´¥: \"+n.message}}}},jr={_container:null,_dialogContainer:null,_ensureContainer(){const{$:n}=a();this._container||(this._container=n('<div id=\"dnd-notification-container\"></div>'),n(\"body\").append(this._container)),this._dialogContainer||(this._dialogContainer=n('<div id=\"dnd-dialog-container\"></div>'),n(\"body\").append(this._dialogContainer))},notify(n,t={}){const{$:e}=a();this._ensureContainer();const{type:r=\"info\",duration:o=3e3,title:i=\"\"}=t,d={info:'<i class=\"fa-solid fa-info-circle\"></i>',success:'<i class=\"fa-solid fa-check-circle\"></i>',warning:'<i class=\"fa-solid fa-exclamation\"></i>',error:'<i class=\"fa-solid fa-times-circle\"></i>'},s=e(`\\n            <div class=\"dnd-toast dnd-toast-${r}\">\\n                <div class=\"dnd-toast-icon\">${d[r]||d.info}</div>\\n                <div class=\"dnd-toast-content\">\\n                    ${i?`<div class=\"dnd-toast-title\">${i}</div>`:\"\"}\\n                    <div class=\"dnd-toast-message\">${n}</div>\\n                </div>\\n                <button class=\"dnd-toast-close\">Ã—</button>\\n            </div>\\n        `);return s.find(\".dnd-toast-close\").on(\"click\",()=>{this._dismissToast(s)}),this._container.append(s),requestAnimationFrame(()=>{s.addClass(\"dnd-toast-visible\")}),o>0&&setTimeout(()=>{this._dismissToast(s)},o),Promise.resolve()},_dismissToast(n){n.removeClass(\"dnd-toast-visible\"),n.addClass(\"dnd-toast-exit\"),setTimeout(()=>{n.remove()},300)},confirm(n,t={}){const{$:e}=a();this._ensureContainer();const{title:r=\"ç¡®è®¤\",confirmText:o=\"ç¡®å®š\",cancelText:i=\"å–æ¶ˆ\",type:d=\"info\"}=t;return new Promise(t=>{const a=e('<div class=\"dnd-dialog-backdrop\"></div>'),s=e(`\\n                <div class=\"dnd-dialog dnd-dialog-${d}\">\\n                    <div class=\"dnd-dialog-header\">\\n                        <span class=\"dnd-dialog-title\">${r}</span>\\n                        <button class=\"dnd-dialog-close\">Ã—</button>\\n                    </div>\\n                    <div class=\"dnd-dialog-body\">\\n                        <p class=\"dnd-dialog-message\">${n}</p>\\n                    </div>\\n                    <div class=\"dnd-dialog-footer\">\\n                        <button class=\"dnd-dialog-btn dnd-dialog-btn-cancel\">${i}</button>\\n                        <button class=\"dnd-dialog-btn dnd-dialog-btn-confirm\">${o}</button>\\n                    </div>\\n                </div>\\n            `),l=n=>{s.removeClass(\"dnd-dialog-visible\"),a.removeClass(\"dnd-dialog-backdrop-visible\"),setTimeout(()=>{a.remove(),s.remove()},200),t(n)};s.find(\".dnd-dialog-btn-confirm\").on(\"click\",()=>l(!0)),s.find(\".dnd-dialog-btn-cancel\").on(\"click\",()=>l(!1)),s.find(\".dnd-dialog-close\").on(\"click\",()=>l(!1)),a.on(\"click\",()=>l(!1));const c=n=>{\"Escape\"===n.key&&(l(!1),document.removeEventListener(\"keydown\",c))};document.addEventListener(\"keydown\",c),this._dialogContainer.append(a).append(s),requestAnimationFrame(()=>{a.addClass(\"dnd-dialog-backdrop-visible\"),s.addClass(\"dnd-dialog-visible\")})})},prompt(n,t={}){const{$:e}=a();this._ensureContainer();const{title:r=\"è¯·è¾“å…¥\",defaultValue:o=\"\",placeholder:i=\"\",confirmText:d=\"ç¡®å®š\",cancelText:s=\"å–æ¶ˆ\"}=t;return new Promise(t=>{const a=e('<div class=\"dnd-dialog-backdrop\"></div>'),l=e(`\\n                <div class=\"dnd-dialog dnd-dialog-prompt\">\\n                    <div class=\"dnd-dialog-header\">\\n                        <span class=\"dnd-dialog-title\">${r}</span>\\n                        <button class=\"dnd-dialog-close\">Ã—</button>\\n                    </div>\\n                    <div class=\"dnd-dialog-body\">\\n                        <p class=\"dnd-dialog-message\">${n}</p>\\n                        <input type=\"text\" class=\"dnd-dialog-input\" value=\"${o}\" placeholder=\"${i}\" />\\n                    </div>\\n                    <div class=\"dnd-dialog-footer\">\\n                        <button class=\"dnd-dialog-btn dnd-dialog-btn-cancel\">${s}</button>\\n                        <button class=\"dnd-dialog-btn dnd-dialog-btn-confirm\">${d}</button>\\n                    </div>\\n                </div>\\n            `),c=l.find(\".dnd-dialog-input\"),p=n=>{const e=n?c.val():null;l.removeClass(\"dnd-dialog-visible\"),a.removeClass(\"dnd-dialog-backdrop-visible\"),setTimeout(()=>{a.remove(),l.remove()},200),t(e)};l.find(\".dnd-dialog-btn-confirm\").on(\"click\",()=>p(!0)),l.find(\".dnd-dialog-btn-cancel\").on(\"click\",()=>p(!1)),l.find(\".dnd-dialog-close\").on(\"click\",()=>p(!1)),a.on(\"click\",()=>p(!1)),c.on(\"keydown\",n=>{\"Enter\"===n.key?(n.preventDefault(),p(!0)):\"Escape\"===n.key&&p(!1)}),this._dialogContainer.append(a).append(l),requestAnimationFrame(()=>{a.addClass(\"dnd-dialog-backdrop-visible\"),l.addClass(\"dnd-dialog-visible\"),c.focus().select()})})},success(n,t=\"\"){return this.notify(n,{type:\"success\",title:t})},error(n,t=\"\"){return this.notify(n,{type:\"error\",title:t,duration:5e3})},warning(n,t=\"\"){return this.notify(n,{type:\"warning\",title:t,duration:4e3})},info(n,t=\"\"){return this.notify(n,{type:\"info\",title:t})}},Fr={getNameInitial:n=>n?n.charAt(0).toUpperCase():\"?\",compressImage(n,t,e){const a=new Image;a.onload=function(){const n=document.createElement(\"canvas\");let r=a.width,o=a.height;(r>t||o>t)&&(r>o?(o=Math.round(o*t/r),r=t):(r=Math.round(r*t/o),o=t)),n.width=r,n.height=o;n.getContext(\"2d\").drawImage(a,0,0,r,o);const i=n.toDataURL(\"image/jpeg\",.8);e(i)},a.src=n},fillChatInput(n){const{$:t,window:e}=a(),r=t(\"#send_textarea\");if(r.length){const t=r.val(),e=t?t+\" \"+n:n;r.val(e);const a=new Event(\"input\",{bubbles:!0});r[0].dispatchEvent(a),r.focus()}else try{navigator.clipboard.writeText(n).then(()=>{jr.success(\"å·²å¤åˆ¶è¡ŒåŠ¨æ–‡æœ¬åˆ°å‰ªè´´æ¿\",\"å¤åˆ¶æˆåŠŸ\")})}catch(t){jr.info(n,\"è¡ŒåŠ¨æ–‡æœ¬\")}},formatClassRes(n){try{const t=Rr.parseValue(n,\"resources\");return t?Object.keys(t).map(n=>`<span style=\"background:rgba(255,255,255,0.05);padding:1px 4px;border-radius:3px;margin-right:3px;\">${n}: ${t[n]}</span>`).join(\"\"):\"\"}catch(n){return\"\"}},getGridFromEvent(n,t,e){const a=this._mapZoom.scale||1,r=getComputedStyle(document.documentElement).getPropertyValue(\"--dnd-ui-scale\"),o=parseFloat(r)||1,i=e[0].getBoundingClientRect(),d=n.clientX-i.left,s=n.clientY-i.top,l=o*a,c=d/l,p=s/l,g=parseFloat(e.data(\"cell-size\"))||20,f=parseFloat(e.data(\"cols\"))||20,b=parseFloat(e.data(\"rows\"))||20;let m=Math.floor(c/g)+1,u=Math.floor(p/g)+1;return m=Math.max(1,Math.min(f,m)),u=Math.max(1,Math.min(b,u)),console.log(\"[getGridFromEvent] Debug:\",{click:{clientX:n.clientX,clientY:n.clientY},innerRect:{left:i.left,top:i.top,width:i.width,height:i.height},uiZoom:o,mapScale:a,totalScale:l,rel:{relX:d,relY:s},original:{originalX:c,originalY:p},cellSize:g,grid:{gridX:m,gridY:u}}),{x:m,y:u}}},Ur={currentTheme:\"dark\",customTheme:null,COLOR_VARS:{\"--dnd-bg-main\":{label:\"ä¸»èƒŒæ™¯\",type:\"color\",default:\"#0f0b0a\"},\"--dnd-bg-panel-start\":{label:\"é¢æ¿èƒŒæ™¯(ä¸Š)\",type:\"color\",default:\"#2b1b17\"},\"--dnd-bg-panel-end\":{label:\"é¢æ¿èƒŒæ™¯(ä¸‹)\",type:\"color\",default:\"#1a100e\"},\"--dnd-bg-card-start\":{label:\"å¡ç‰‡èƒŒæ™¯(äº®)\",type:\"color\",default:\"#242424\"},\"--dnd-bg-card-end\":{label:\"å¡ç‰‡èƒŒæ™¯(æš—)\",type:\"color\",default:\"#1a1a1c\"},\"--dnd-border-gold\":{label:\"ä¸»è¾¹æ¡†\",type:\"color\",default:\"#9d8b6c\"},\"--dnd-border-inner\":{label:\"å†…è¾¹æ¡†\",type:\"color\",default:\"#5c4b35\"},\"--dnd-text-main\":{label:\"ä¸»æ–‡æœ¬\",type:\"color\",default:\"#dcd0c0\"},\"--dnd-text-header\":{label:\"æ ‡é¢˜æ–‡æœ¬\",type:\"color\",default:\"#e6dcca\"},\"--dnd-text-highlight\":{label:\"é«˜äº®æ–‡æœ¬\",type:\"color\",default:\"#ffdb85\"},\"--dnd-text-dim\":{label:\"æ¬¡è¦æ–‡æœ¬\",type:\"color\",default:\"#888888\"},\"--dnd-accent-red\":{label:\"çº¢è‰²å¼ºè°ƒ\",type:\"color\",default:\"#8a2c2c\"},\"--dnd-accent-green\":{label:\"ç»¿è‰²å¼ºè°ƒ\",type:\"color\",default:\"#3a6b4a\"},\"--dnd-accent-blue\":{label:\"è“è‰²å¼ºè°ƒ\",type:\"color\",default:\"#2c4c8a\"}},init:async()=>{try{const n=await t.getSetting(o.STORAGE_KEYS.CUSTOM_THEME);n&&(Ur.customTheme=JSON.parse(n))}catch(t){n.error(\"Failed to load custom theme:\",t)}const e=await t.getSetting(o.STORAGE_KEYS.THEME);\"custom\"===e&&Ur.customTheme?Ur.applyCustom(Ur.customTheme):e&&o.THEMES[e]&&Ur.apply(e)},apply:t=>{const e=o.THEMES[t];e&&(Ur.currentTheme=t,r(o.STORAGE_KEYS.THEME,t),Ur._applyVars(e.vars),n.info(\"ä¸»é¢˜å·²åˆ‡æ¢:\",e.name))},applyCustom:t=>{if(!t||\"object\"!=typeof t)return;Ur.currentTheme=\"custom\",Ur.customTheme=t,r(o.STORAGE_KEYS.THEME,\"custom\");const e={...o.THEMES.dark.vars};Object.keys(t).forEach(n=>{Ur.COLOR_VARS[n]&&(e[n]=t[n])});const a=t[\"--dnd-bg-panel-start\"]||Ur.COLOR_VARS[\"--dnd-bg-panel-start\"].default,i=t[\"--dnd-bg-panel-end\"]||Ur.COLOR_VARS[\"--dnd-bg-panel-end\"].default,d=t[\"--dnd-bg-card-start\"]||Ur.COLOR_VARS[\"--dnd-bg-card-start\"].default,s=t[\"--dnd-bg-card-end\"]||Ur.COLOR_VARS[\"--dnd-bg-card-end\"].default;e[\"--dnd-bg-panel\"]=`linear-gradient(to bottom, ${a}, ${i})`,e[\"--dnd-bg-hud\"]=`linear-gradient(to bottom, ${a}, ${i})`,e[\"--dnd-bg-card\"]=`linear-gradient(135deg, ${d} 0%, ${s} 100%)`,e[\"--dnd-bg-popup\"]=`linear-gradient(to bottom, ${d}fc, ${s}fc)`,Ur._applyVars(e),n.info(\"è‡ªå®šä¹‰é…è‰²å·²åº”ç”¨\")},saveCustom:async e=>{Ur.customTheme=e,await t.setSetting(o.STORAGE_KEYS.CUSTOM_THEME,JSON.stringify(e)),n.info(\"è‡ªå®šä¹‰é…è‰²å·²ä¿å­˜\")},getCurrentVars:()=>{if(\"custom\"===Ur.currentTheme&&Ur.customTheme){return{...{...o.THEMES.dark.vars},...Ur.customTheme}}const n=o.THEMES[Ur.currentTheme];return n?{...n.vars}:{...o.THEMES.dark.vars}},getEditableVars:()=>{const n=Ur.getCurrentVars(),t={};return Object.keys(Ur.COLOR_VARS).forEach(e=>{t[e]={...Ur.COLOR_VARS[e],value:n[e]||Ur.COLOR_VARS[e].default}}),t},_applyVars:t=>{try{const{window:n}=a();let e;try{e=n.document.documentElement}catch(n){e=document.documentElement}e&&Object.keys(t).forEach(n=>{e.style.setProperty(n,t[n])})}catch(t){n.error(\"Failed to apply theme styles:\",t)}},getList:()=>{const n=Object.keys(o.THEMES).map(n=>({id:n,...o.THEMES[n]}));return Ur.customTheme&&n.push({id:\"custom\",name:\"è‡ªå®šä¹‰é…è‰²\",icon:\"ğŸ¨\"}),n}},Yr={ALLOWED_PROPERTIES:[\"color\",\"background\",\"background-color\",\"background-image\",\"background-gradient\",\"border\",\"border-color\",\"border-width\",\"border-style\",\"border-radius\",\"border-top\",\"border-right\",\"border-bottom\",\"border-left\",\"border-top-color\",\"border-right-color\",\"border-bottom-color\",\"border-left-color\",\"border-top-width\",\"border-right-width\",\"border-bottom-width\",\"border-left-width\",\"border-top-left-radius\",\"border-top-right-radius\",\"border-bottom-left-radius\",\"border-bottom-right-radius\",\"padding\",\"padding-top\",\"padding-right\",\"padding-bottom\",\"padding-left\",\"margin\",\"margin-top\",\"margin-right\",\"margin-bottom\",\"margin-left\",\"gap\",\"row-gap\",\"column-gap\",\"font-size\",\"font-weight\",\"font-family\",\"font-style\",\"line-height\",\"letter-spacing\",\"text-align\",\"text-transform\",\"text-decoration\",\"box-shadow\",\"text-shadow\",\"opacity\",\"transition\",\"transform\",\"width\",\"height\",\"min-width\",\"max-width\",\"min-height\",\"max-height\",\"filter\",\"backdrop-filter\"],FORBIDDEN_PROPERTIES:[\"position\",\"top\",\"left\",\"right\",\"bottom\",\"z-index\",\"display\",\"visibility\",\"overflow\",\"overflow-x\",\"overflow-y\",\"content\",\"cursor\",\"pointer-events\",\"animation\",\"animation-name\",\"flex\",\"flex-direction\",\"flex-wrap\",\"justify-content\",\"align-items\",\"grid\",\"grid-template-columns\",\"grid-template-rows\"],ALLOWED_CLASS_PATTERNS:[/^\\.dnd-char-card$/,/^\\.dnd-card-/,/^\\.dnd-nav-item/,/^\\.dnd-btn/,/^\\.dnd-dice-btn/,/^\\.dnd-action-btn/,/^\\.dnd-bar-/,/^\\.dnd-micro-bar/,/^\\.dnd-tag/,/^\\.dnd-badge/,/^\\.dnd-dialog-/,/^\\.dnd-modal-/,/^\\.dnd-toast-/,/^\\.dnd-hud-/,/^\\.dnd-mini-/,/^\\.dnd-tm-/,/^\\.dnd-inv-/,/^\\.dnd-detail-/,/^\\.dnd-attr-/,/^\\.dnd-stat-/,/^\\.dnd-quick-/,/^\\.dnd-res-/,/^\\.dnd-party-/,/^\\.dnd-spell-/,/^\\.dnd-item-/,/^\\.dnd-quest-/,/^\\.dnd-faction-/,/^\\.dnd-top-bar/,/^\\.dnd-close-btn/,/^\\.dnd-title/,/^\\.dnd-logo/,/^\\.dnd-location/,/^\\.dnd-content-area/,/^\\.dnd-grid/,/^\\.dnd-popup/,/^\\.dnd-md-/,/^\\.dnd-clickable/,/^\\.dnd-hover-/,/^\\.dnd-avatar/],ALLOWED_VAR_PATTERNS:[/^--dnd-bg-/,/^--dnd-border-/,/^--dnd-text-/,/^--dnd-accent-/,/^--dnd-shadow/,/^--dnd-font-/,/^--dnd-spacing-/,/^--dnd-radius-/,/^--dnd-transition-/],VALUE_VALIDATORS:{color:/^(#[0-9a-fA-F]{3,8}|rgba?\\([^)]+\\)|hsla?\\([^)]+\\)|var\\(--dnd-[a-z-]+\\)|transparent|inherit|currentColor)$/i,dimension:/^(-?\\d+(\\.\\d+)?(px|em|rem|%|vh|vw|vmin|vmax)|0|auto|var\\(--dnd-[a-z-]+\\))$/i,time:/^(\\d+(\\.\\d+)?(s|ms)|var\\(--dnd-[a-z-]+\\))$/i,fontWeight:/^(normal|bold|bolder|lighter|[1-9]00|var\\(--dnd-[a-z-]+\\))$/i,fontFamily:/^[a-zA-Z\\s,'\"()-]+$/,gradient:/^linear-gradient\\([^)]+\\)$|^radial-gradient\\([^)]+\\)$|^var\\(--dnd-[a-z-]+\\)$/i},DANGEROUS_PATTERNS:[/javascript:/i,/expression\\s*\\(/i,/url\\s*\\(\\s*[\"']?data:/i,/<script/i,/on\\w+\\s*=/i,/\\beval\\b/i,/\\bFunction\\b/i],validate(t){const e={valid:!0,errors:[],warnings:[],sanitized:null};try{if(!t||\"object\"!=typeof t)return e.valid=!1,e.errors.push(\"é£æ ¼åŒ…å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„JSONå¯¹è±¡\"),e;const a=this._validateMeta(t.meta);if(!a.valid)return e.valid=!1,e.errors.push(...a.errors),e;const r={meta:this._sanitizeMeta(t.meta),colors:{},dimensions:{},typography:{},animations:{},components:{},morphology:{},overrides:{}};if(t.colors){const n=this._validateAndSanitizeVars(t.colors,\"color\");r.colors=n.sanitized,e.warnings.push(...n.warnings)}if(t.dimensions){const n=this._validateAndSanitizeVars(t.dimensions,\"dimension\");r.dimensions=n.sanitized,e.warnings.push(...n.warnings)}if(t.typography){const n=this._validateAndSanitizeVars(t.typography,\"typography\");r.typography=n.sanitized,e.warnings.push(...n.warnings)}if(t.animations){const n=this._validateAndSanitizeVars(t.animations,\"time\");r.animations=n.sanitized,e.warnings.push(...n.warnings)}if(t.components){const n=this._validateComponents(t.components);r.components=n.sanitized,e.warnings.push(...n.warnings)}if(t.morphology){const n=this._validateMorphology(t.morphology);r.morphology=n.sanitized,e.warnings.push(...n.warnings)}if(t.overrides){const n=this._validateAndSanitizeOverrides(t.overrides);r.overrides=n.sanitized,e.warnings.push(...n.warnings),n.errors.length>0&&e.errors.push(...n.errors)}t.customCSS&&(this._containsDangerous(t.customCSS)?e.warnings.push(\"customCSS åŒ…å«å±é™©å†…å®¹è¢«å¿½ç•¥\"):t.customCSS.length>1e4?(e.warnings.push(\"customCSS è¶…è¿‡é•¿åº¦é™åˆ¶ (10000å­—ç¬¦)\"),r.customCSS=t.customCSS.substring(0,1e4)):r.customCSS=t.customCSS),e.sanitized=r,n.info(\"é£æ ¼åŒ…éªŒè¯å®Œæˆ\",{warnings:e.warnings.length,errors:e.errors.length})}catch(t){e.valid=!1,e.errors.push(`éªŒè¯è¿‡ç¨‹å‡ºé”™: ${t.message}`),n.error(\"StyleValidator.validate error:\",t)}return e},_validateMeta(n){const t={valid:!0,errors:[]};return n?(n.id&&\"string\"==typeof n.id?/^[a-z0-9-]+$/.test(n.id)||(t.valid=!1,t.errors.push(\"meta.id åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦\")):(t.valid=!1,t.errors.push(\"meta.id å¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²\")),n.name&&\"string\"==typeof n.name||(t.valid=!1,t.errors.push(\"meta.name å¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²\")),t):(t.valid=!1,t.errors.push(\"ç¼ºå°‘ meta å…ƒæ•°æ®\"),t)},_sanitizeMeta(n){return{id:String(n.id||\"\").toLowerCase().replace(/[^a-z0-9-]/g,\"-\"),name:String(n.name||\"æœªå‘½åé£æ ¼\").substring(0,50),version:String(n.version||\"1.0.0\").substring(0,20),author:String(n.author||\"\").substring(0,100),description:String(n.description||\"\").substring(0,500),icon:this._sanitizeEmoji(n.icon)||\"ğŸ¨\",preview:this._sanitizePreview(n.preview)}},_sanitizeEmoji(n){if(!n)return null;const t=String(n).match(/^(\\p{Emoji_Presentation}|\\p{Extended_Pictographic})/u);return t?t[0]:null},_sanitizePreview:n=>n&&\"string\"==typeof n&&/^data:image\\/(png|jpeg|gif|webp);base64,[A-Za-z0-9+/=]+$/.test(n)&&n.length<=14e4?n:null,_validateAndSanitizeVars(n,t){const e={sanitized:{},warnings:[]};if(!n||\"object\"!=typeof n)return e;for(const[a,r]of Object.entries(n)){if(!this._isAllowedVarName(a)){e.warnings.push(`è·³è¿‡ä¸å…è®¸çš„å˜é‡: ${a}`);continue}const n=this._sanitizeValue(r,t);null!==n?e.sanitized[a]=n:e.warnings.push(`å˜é‡å€¼æ— æ•ˆè¢«ç§»é™¤: ${a}`)}return e},_isAllowedVarName(n){return this.ALLOWED_VAR_PATTERNS.some(t=>t.test(n))},_sanitizeValue(t,e){\"string\"!=typeof t&&(t=String(t));for(const e of this.DANGEROUS_PATTERNS)if(e.test(t))return n.warn(\"æ£€æµ‹åˆ°å±é™©CSSå€¼:\",t),null;switch(e){case\"color\":if(this.VALUE_VALIDATORS.color.test(t)||this.VALUE_VALIDATORS.gradient.test(t))return t;break;case\"dimension\":if(this.VALUE_VALIDATORS.dimension.test(t))return t;break;case\"time\":if(this.VALUE_VALIDATORS.time.test(t))return t;break;case\"typography\":if(this.VALUE_VALIDATORS.dimension.test(t)||this.VALUE_VALIDATORS.fontWeight.test(t)||this.VALUE_VALIDATORS.fontFamily.test(t))return t;break;default:if(t.length<=200)return t}return null},_validateComponents(n){const t={sanitized:{},warnings:[]};if(!n||\"object\"!=typeof n)return t;const e=[\"card\",\"button\",\"navbar\",\"progress\",\"dialog\",\"toast\",\"hud\",\"avatar\"],a=[\"borderWidth\",\"borderStyle\",\"borderRadius\",\"hoverEffect\",\"textTransform\",\"itemSpacing\",\"activeIndicator\",\"height\",\"shadow\"];for(const[r,o]of Object.entries(n)){if(!e.includes(r)){t.warnings.push(`è·³è¿‡æœªçŸ¥ç»„ä»¶: ${r}`);continue}if(!o||\"object\"!=typeof o)continue;const n={};for(const[e,i]of Object.entries(o)){if(!a.includes(e)){t.warnings.push(`ç»„ä»¶ ${r} è·³è¿‡æœªçŸ¥å±æ€§: ${e}`);continue}const o=this._sanitizeValue(String(i),\"general\");o&&(n[e]=o)}Object.keys(n).length>0&&(t.sanitized[r]=n)}return t},_validateMorphology(n){const t={sanitized:{},warnings:[]};if(!n||\"object\"!=typeof n)return t;const e={border:{style:[\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\",\"dashed\",\"dotted\",\"none\"],width:\"dimension\",outerStyle:[\"solid\",\"double\",\"groove\",\"ridge\",\"inset\",\"outset\",\"dashed\",\"dotted\",\"none\"]},corners:{style:[\"rounded\",\"chamfer\",\"notched\",\"angular\",\"organic\",\"shield\",\"hexagon\"],clipPath:\"clipPath\"},card:{shape:[\"rectangle\",\"portrait\",\"landscape\",\"square\",\"hexagon\",\"shield\"],aspectRatio:\"general\",transform:\"transform\",decoration:[\"none\",\"ornate\",\"simple\",\"tech\",\"medieval\",\"gothic\",\"sketchy\",\"pixel\",\"neumorphic\",\"ink-wash\",\"neon\",\"minimal\",\"card3d\"]},decorations:{corners:[\"none\",\"flourish\",\"tech-bracket\",\"rune\",\"simple-dot\"],dividers:[\"solid\",\"dashed\",\"dotted\",\"double\",\"ornate\",\"tech\",\"none\",\"gradient\"],headers:[\"none\",\"underline\",\"banner\",\"ribbon\",\"tech-bar\"],icons:[\"circle\",\"square\",\"rounded\",\"hexagon\",\"diamond\",\"shield\",\"octagon\"]},effects:{overlay:[\"none\",\"noise\",\"scanlines\",\"vignette\",\"gradient\"],innerGlow:[\"none\",\"subtle\",\"medium\",\"strong\"],borderGlow:[\"none\",\"subtle\",\"pulse\",\"strong\"],texture:[\"none\",\"paper\",\"metal\",\"wood\",\"fabric\",\"stone\"],animation:[\"none\",\"float\",\"shimmer\",\"glow-breathe\"]},layout:{density:[\"compact\",\"normal\",\"spacious\"],cardMinWidth:\"dimension\",gridGap:\"dimension\"},buttons:{shape:[\"rounded\",\"pill\",\"angular\",\"hexagon\"],style:[\"filled\",\"outline\",\"ghost\",\"neon\",\"3d\"]},progressBars:{shape:[\"rounded\",\"angular\",\"pointed\"],style:[\"solid\",\"striped\",\"animated\",\"glow\"],segments:\"number\"}};for(const[a,r]of Object.entries(n)){if(!e[a]){t.warnings.push(`è·³è¿‡æœªçŸ¥å½¢æ€ç±»åˆ«: ${a}`);continue}if(!r||\"object\"!=typeof r)continue;const n={},o=e[a];for(const[e,i]of Object.entries(r)){if(!o[e]){t.warnings.push(`å½¢æ€ ${a} è·³è¿‡æœªçŸ¥å±æ€§: ${e}`);continue}const r=o[e];let d=null;if(Array.isArray(r))r.includes(i)?d=i:t.warnings.push(`å½¢æ€ ${a}.${e} å€¼ \"${i}\" ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­`);else if(\"dimension\"===r)d=this._sanitizeValue(String(i),\"dimension\");else if(\"clipPath\"===r)d=this._sanitizeClipPath(i);else if(\"transform\"===r)d=this._sanitizeTransform(i);else if(\"number\"===r){const n=parseInt(i,10);!isNaN(n)&&n>=0&&n<=100&&(d=n)}else d=this._sanitizeValue(String(i),\"general\");null!==d&&(n[e]=d)}Object.keys(n).length>0&&(t.sanitized[a]=n)}return t},_sanitizeClipPath(n){if(!n||\"none\"===n)return\"none\";const t=String(n);if(this._containsDangerous(t))return null;return/^(polygon|circle|ellipse|inset|path)\\s*\\([^)]+\\)$/i.test(t)?t:null},_sanitizeTransform(n){if(!n||\"none\"===n)return\"none\";const t=String(n);if(this._containsDangerous(t))return null;return/^(rotate|scale|translate|skew|matrix|perspective)\\s*\\([^)]+\\)(\\s+(rotate|scale|translate|skew|matrix|perspective)\\s*\\([^)]+\\))*$/i.test(t)||/^-?\\d+(\\.\\d+)?(deg|rad|turn)$/.test(t)?t:null},_validateAndSanitizeOverrides(n){const t={sanitized:{},warnings:[],errors:[]};if(!n||\"object\"!=typeof n)return t;for(const[e,a]of Object.entries(n)){if(!this._isAllowedSelector(e)){t.warnings.push(`è·³è¿‡ä¸å…è®¸çš„é€‰æ‹©å™¨: ${e}`);continue}if(!a||\"object\"!=typeof a)continue;const n={};for(const[r,o]of Object.entries(a)){const a=this._normalizePropName(r);if(this.FORBIDDEN_PROPERTIES.includes(a)){t.warnings.push(`é€‰æ‹©å™¨ ${e} ç§»é™¤ç¦æ­¢å±æ€§: ${r}`);continue}if(!this.ALLOWED_PROPERTIES.includes(a)){t.warnings.push(`é€‰æ‹©å™¨ ${e} è·³è¿‡æœªçŸ¥å±æ€§: ${r}`);continue}const i=this._sanitizeOverrideValue(o,a);null!==i?n[r]=i:t.warnings.push(`é€‰æ‹©å™¨ ${e} å±æ€§ ${r} å€¼æ— æ•ˆ`)}Object.keys(n).length>0&&(t.sanitized[e]=n)}return t},_isAllowedSelector(n){n.split(/:|::|\\.(?=[a-z])/)[0],n.match(/^\\.[a-z-]+/);return this.ALLOWED_CLASS_PATTERNS.some(t=>{if(n.includes(\":\")){const e=n.split(\":\")[0];return t.test(e)}return t.test(n)})},_normalizePropName:n=>n.replace(/([A-Z])/g,\"-$1\").toLowerCase(),_sanitizeOverrideValue(n,t){\"string\"!=typeof n&&(n=String(n));for(const t of this.DANGEROUS_PATTERNS)if(t.test(n))return null;if(t.includes(\"color\")||\"background\"===t||t.includes(\"shadow\")){if(this.VALUE_VALIDATORS.color.test(n)||this.VALUE_VALIDATORS.gradient.test(n)||/^var\\(--dnd-[a-z-]+\\)$/.test(n)||/^none$/.test(n))return n}else if(t.includes(\"radius\")||t.includes(\"width\")||t.includes(\"height\")||t.includes(\"padding\")||t.includes(\"margin\")||t.includes(\"gap\")||t.includes(\"size\")){if(this.VALUE_VALIDATORS.dimension.test(n))return n}else if(t.includes(\"font-weight\")){if(this.VALUE_VALIDATORS.fontWeight.test(n))return n}else if(t.includes(\"font-family\")){if(this.VALUE_VALIDATORS.fontFamily.test(n))return n}else if(t.includes(\"transition\")){if(this.VALUE_VALIDATORS.time.test(n)||/^[\\w\\s,-]+$/.test(n))return n}else if(t.includes(\"border-style\")){if(/^(none|solid|dashed|dotted|double|groove|ridge|inset|outset)$/.test(n))return n}else if(\"opacity\"===t){const t=parseFloat(n);if(!isNaN(t)&&t>=0&&t<=1)return n}else if(\"transform\"===t){if(/^(scale|translate|rotate|skew)\\([^)]+\\)(\\s+(scale|translate|rotate|skew)\\([^)]+\\))*$/.test(n)||\"none\"===n)return n}else if(\"filter\"===t||\"backdrop-filter\"===t){if(/^(blur|brightness|contrast|grayscale|saturate|sepia|drop-shadow)\\([^)]+\\)(\\s+(blur|brightness|contrast|grayscale|saturate|sepia|drop-shadow)\\([^)]+\\))*$/.test(n)||\"none\"===n)return n}else if(n.length<=200&&!/[<>{}]/.test(n))return n;return null},_containsDangerous(n){if(!n)return!1;const t=String(n);for(const n of this.DANGEROUS_PATTERNS)if(n.test(t))return!0;return!1},quickValidate:n=>!(!n||\"object\"!=typeof n)&&!!(n.meta&&n.meta.id&&n.meta.name)},Hr={EFFECTS_STYLE_ID:\"dnd-style-effects\",apply(t){if(!t)return;const e=[];t.morphology?.corners&&e.push(...this._generateCornerStyles(t.morphology.corners,t.colors)),t.morphology?.card&&e.push(...this._generateCardStyles(t.morphology.card,t.colors)),t.morphology?.decorations&&e.push(...this._generateDecorationStyles(t.morphology.decorations,t.colors)),t.morphology?.effects&&e.push(...this._generateEffectStyles(t.morphology.effects,t.colors)),t.morphology?.buttons&&e.push(...this._generateButtonStyles(t.morphology.buttons,t.colors)),t.morphology?.progressBars&&e.push(...this._generateProgressStyles(t.morphology.progressBars,t.colors)),t.morphology?.decorations?.icons&&e.push(...this._generateIconStyles(t.morphology.decorations.icons,t.colors)),t.morphology?.layout&&e.push(...this._generateLayoutStyles(t.morphology.layout)),t.customCSS&&e.push(t.customCSS),this._injectStyles(e.join(\"\\n\")),n.debug(\"StyleEffects: å·²åº”ç”¨\",e.length,\"æ¡ç‰¹æ•ˆè§„åˆ™\")},clear(){const{window:n}=a(),t=(n?.document||document).getElementById(this.EFFECTS_STYLE_ID);t&&t.remove()},_generateCornerStyles(n,t){const e=[],{style:a,clipPath:r}=n;switch(a){case\"chamfer\":e.push(`\\n                    .dnd-char-card,\\n                    .dnd-panel,\\n                    .dnd-dialog {\\n                        clip-path: ${r||\"polygon(12px 0, calc(100% - 12px) 0, 100% 12px, 100% calc(100% - 12px), calc(100% - 12px) 100%, 12px 100%, 0 calc(100% - 12px), 0 12px)\"} !important;\\n                        border-radius: 0 !important;\\n                    }\\n                `);break;case\"notched\":e.push(\"\\n                    .dnd-char-card,\\n                    .dnd-panel {\\n                        clip-path: polygon(\\n                            0 8px, 8px 8px, 8px 0,\\n                            calc(100% - 8px) 0, calc(100% - 8px) 8px, 100% 8px,\\n                            100% calc(100% - 8px), calc(100% - 8px) calc(100% - 8px), calc(100% - 8px) 100%,\\n                            8px 100%, 8px calc(100% - 8px), 0 calc(100% - 8px)\\n                        ) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"angular\":e.push(`\\n                    .dnd-char-card,\\n                    .dnd-panel {\\n                        clip-path: ${r||\"polygon(6px 0, calc(100% - 6px) 0, 100% 6px, 100% calc(100% - 6px), calc(100% - 6px) 100%, 6px 100%, 0 calc(100% - 6px), 0 6px)\"} !important;\\n                        border-radius: 0 !important;\\n                    }\\n                `);break;case\"organic\":e.push(\"\\n                    .dnd-char-card,\\n                    .dnd-panel {\\n                        border-radius: 30% 70% 70% 30% / 30% 30% 70% 70% !important;\\n                    }\\n                \");break;case\"shield\":e.push(\"\\n                    .dnd-char-card {\\n                        clip-path: polygon(0 0, 100% 0, 100% 75%, 50% 100%, 0 75%) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"hexagon\":e.push(\"\\n                    .dnd-char-card {\\n                        clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"cut\":e.push(`\\n                    .dnd-char-card,\\n                    .dnd-panel,\\n                    .dnd-dialog {\\n                        clip-path: ${r||\"polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px)\"} !important;\\n                        border-radius: 0 !important;\\n                    }\\n                `);break;case\"rounded-soft\":e.push(\"\\n                    .dnd-char-card,\\n                    .dnd-panel {\\n                        border-radius: 12px 12px 12px 12px !important;\\n                    }\\n                \");break;case\"rounded-large\":e.push(\"\\n                    .dnd-char-card,\\n                    .dnd-panel {\\n                        border-radius: 20px !important;\\n                    }\\n                \");break;case\"irregular\":e.push(`\\n                    .dnd-char-card {\\n                        clip-path: ${r||\"polygon(2% 0%, 100% 2%, 98% 100%, 0% 98%)\"} !important;\\n                        border-radius: 2px !important;\\n                    }\\n                `);break;case\"ornate\":e.push(`\\n                    .dnd-char-card {\\n                        clip-path: ${r||\"polygon(10px 0, calc(100% - 10px) 0, 100% 10px, 100% calc(100% - 10px), calc(100% - 10px) 100%, 10px 100%, 0 calc(100% - 10px), 0 10px)\"} !important;\\n                        border-radius: 0 !important;\\n                    }\\n                `)}return e},_generateCardStyles(n,t){const e=[],{shape:a,aspectRatio:r,transform:o,decoration:i}=n,d=t?.[\"--dnd-border-gold\"]||\"#9d8b6c\",s=t?.[\"--dnd-text-highlight\"]||\"#ffdb85\";switch(r&&\"auto\"!==r&&e.push(`\\n                .dnd-char-card {\\n                    aspect-ratio: ${r} !important;\\n                }\\n            `),o&&\"none\"!==o&&e.push(`\\n                .dnd-char-card {\\n                    transform: ${o} !important;\\n                }\\n            `),i){case\"ornate\":e.push(`\\n                    .dnd-char-card {\\n                        border: 2px solid ${d} !important;\\n                        box-shadow: \\n                            inset 0 0 0 3px rgba(0,0,0,0.3),\\n                            inset 0 0 0 4px ${d},\\n                            0 4px 20px rgba(0,0,0,0.5) !important;\\n                    }\\n                    .dnd-char-card::before {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        top: 8px; left: 8px; right: 8px; bottom: 8px !important;\\n                        border: 1px dashed ${d}40 !important;\\n                        pointer-events: none !important;\\n                        z-index: 1 !important;\\n                    }\\n                `);break;case\"tech\":e.push(`\\n                    .dnd-char-card {\\n                        border: 1px solid ${d} !important;\\n                        position: relative !important;\\n                    }\\n                    .dnd-char-card::before,\\n                    .dnd-char-card::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        width: 20px !important;\\n                        height: 20px !important;\\n                        border: 2px solid ${s} !important;\\n                        pointer-events: none !important;\\n                        z-index: 10 !important;\\n                    }\\n                    .dnd-char-card::before {\\n                        top: -1px !important;\\n                        left: -1px !important;\\n                        border-right: none !important;\\n                        border-bottom: none !important;\\n                    }\\n                    .dnd-char-card::after {\\n                        bottom: -1px !important;\\n                        right: -1px !important;\\n                        border-left: none !important;\\n                        border-top: none !important;\\n                    }\\n                `);break;case\"medieval\":e.push(`\\n                    .dnd-char-card {\\n                        border: 3px double ${d} !important;\\n                        box-shadow: \\n                            inset 0 0 20px rgba(0,0,0,0.4),\\n                            0 5px 15px rgba(0,0,0,0.5) !important;\\n                    }\\n                `);break;case\"neon\":e.push(`\\n                    .dnd-char-card {\\n                        border: 1px solid ${s} !important;\\n                        box-shadow: \\n                            0 0 10px ${s}40,\\n                            0 0 20px ${s}20,\\n                            inset 0 0 15px ${s}10 !important;\\n                    }\\n                    .dnd-char-card:hover {\\n                        box-shadow: \\n                            0 0 20px ${s}60,\\n                            0 0 40px ${s}30,\\n                            inset 0 0 20px ${s}20 !important;\\n                    }\\n                `);break;case\"minimal\":e.push(`\\n                    .dnd-char-card {\\n                        border: none !important;\\n                        box-shadow: none !important;\\n                        border-bottom: 2px solid ${d} !important;\\n                        border-radius: 0 !important;\\n                    }\\n                `);break;case\"card3d\":e.push(\"\\n                    .dnd-char-card {\\n                        transform-style: preserve-3d !important;\\n                        perspective: 1000px !important;\\n                        transition: transform 0.3s ease !important;\\n                    }\\n                    .dnd-char-card:hover {\\n                        transform: rotateX(-5deg) rotateY(5deg) translateZ(10px) !important;\\n                    }\\n                \");break;case\"vines\":e.push(`\\n                    .dnd-char-card {\\n                        border: 1px solid ${d} !important;\\n                        position: relative !important;\\n                    }\\n                    .dnd-char-card::before {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        top: 0; left: 0; right: 0; bottom: 0 !important;\\n                        border: 2px solid transparent !important;\\n                        border-image: linear-gradient(to bottom right, ${d}, transparent 40%, transparent 60%, ${d}) 1 !important;\\n                        pointer-events: none !important;\\n                        z-index: 1 !important;\\n                    }\\n                `);break;case\"rivets\":e.push(`\\n                    .dnd-char-card {\\n                        border: 2px solid ${d} !important;\\n                        position: relative !important;\\n                        margin: 4px !important;\\n                    }\\n                    .dnd-char-card::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        top: -6px; left: -6px; right: -6px; bottom: -6px !important;\\n                        background-image:\\n                            radial-gradient(circle, ${d} 30%, transparent 35%),\\n                            radial-gradient(circle, ${d} 30%, transparent 35%),\\n                            radial-gradient(circle, ${d} 30%, transparent 35%),\\n                            radial-gradient(circle, ${d} 30%, transparent 35%) !important;\\n                        background-position: 0 0, 100% 0, 0 100%, 100% 100% !important;\\n                        background-repeat: no-repeat !important;\\n                        background-size: 12px 12px !important;\\n                        pointer-events: none !important;\\n                        z-index: 10 !important;\\n                    }\\n                `);break;case\"lcars\":e.push(`\\n                    .dnd-char-card {\\n                        border: none !important;\\n                        border-left: 20px solid ${s} !important;\\n                        border-radius: 0 10px 10px 0 !important;\\n                        background: ${t?.[\"--dnd-bg-card-start\"]||\"#000\"} !important;\\n                    }\\n                    .dnd-card-header {\\n                        background: ${s} !important;\\n                        color: #000 !important;\\n                        margin-left: -20px !important;\\n                        padding-left: 30px !important;\\n                        border-radius: 0 0 20px 0 !important;\\n                        margin-bottom: 10px !important;\\n                    }\\n                `);break;case\"gears\":e.push(`\\n                    .dnd-char-card {\\n                        border: 3px double ${d} !important;\\n                    }\\n                    @keyframes spin-slow {\\n                        0% { transform: rotate(0deg); }\\n                        100% { transform: rotate(360deg); }\\n                    }\\n                    .dnd-char-card::before {\\n                        content: \"âš™ï¸\" !important;\\n                        position: absolute !important;\\n                        font-size: 100px !important;\\n                        opacity: 0.05 !important;\\n                        top: -20px !important;\\n                        right: -20px !important;\\n                        animation: spin-slow 20s linear infinite !important;\\n                        pointer-events: none !important;\\n                    }\\n                `);break;case\"runes\":e.push(`\\n                    .dnd-char-card::before {\\n                        content: \"áš áš¢áš¦áš¨áš±áš²áš·áš¹ášºáš¾á›á›ƒá›‡á›ˆá›‰á›Šá›á›’á›–á›—á›šá›œá›á›Ÿ\" !important;\\n                        position: absolute !important;\\n                        top: 0; left: 0; right: 0; bottom: 0 !important;\\n                        font-size: 24px !important;\\n                        line-height: 24px !important;\\n                        color: ${s} !important;\\n                        opacity: 0.03 !important;\\n                        word-break: break-all !important;\\n                        overflow: hidden !important;\\n                        pointer-events: none !important;\\n                        mix-blend-mode: overlay !important;\\n                    }\\n                `)}return e},_generateDecorationStyles(n,t){const e=[],{corners:a,dividers:r,headers:o}=n,i=t?.[\"--dnd-border-gold\"]||\"#9d8b6c\",d=t?.[\"--dnd-text-highlight\"]||\"#ffdb85\";switch(a){case\"flourish\":e.push(`\\n                    .dnd-card-header::before,\\n                    .dnd-card-header::after {\\n                        content: \"â§\" !important;\\n                        position: absolute !important;\\n                        font-size: 16px !important;\\n                        color: ${i} !important;\\n                        opacity: 0.6 !important;\\n                    }\\n                    .dnd-card-header::before {\\n                        left: 8px !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        right: 8px !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) scaleX(-1) !important;\\n                    }\\n                `);break;case\"tech-bracket\":e.push(`\\n                    .dnd-card-header {\\n                        position: relative !important;\\n                    }\\n                    .dnd-card-header::before,\\n                    .dnd-card-header::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        width: 8px !important;\\n                        height: 60% !important;\\n                        border: 2px solid ${d} !important;\\n                        top: 20% !important;\\n                    }\\n                    .dnd-card-header::before {\\n                        left: 4px !important;\\n                        border-right: none !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        right: 4px !important;\\n                        border-left: none !important;\\n                    }\\n                `);break;case\"rune\":e.push(`\\n                    .dnd-card-header::before {\\n                        content: \"á›­\" !important;\\n                        position: absolute !important;\\n                        left: 10px !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) !important;\\n                        font-size: 14px !important;\\n                        color: ${d} !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        content: \"á›­\" !important;\\n                        position: absolute !important;\\n                        right: 10px !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) !important;\\n                        font-size: 14px !important;\\n                        color: ${d} !important;\\n                    }\\n                `);break;case\"simple-dot\":e.push(`\\n                    .dnd-card-header::before,\\n                    .dnd-card-header::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        width: 6px !important;\\n                        height: 6px !important;\\n                        background: ${i} !important;\\n                        border-radius: 50% !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) !important;\\n                    }\\n                    .dnd-card-header::before { left: 8px !important; }\\n                    .dnd-card-header::after { right: 8px !important; }\\n                `);break;case\"bolts\":e.push(`\\n                    .dnd-card-header::before,\\n                    .dnd-card-header::after {\\n                        content: \"â¬¡\" !important;\\n                        position: absolute !important;\\n                        font-size: 12px !important;\\n                        color: ${i} !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) !important;\\n                        opacity: 0.8 !important;\\n                    }\\n                    .dnd-card-header::before { left: 8px !important; }\\n                    .dnd-card-header::after { right: 8px !important; }\\n                `);break;case\"gears\":e.push(`\\n                    .dnd-card-header::before,\\n                    .dnd-card-header::after {\\n                        content: \"âš™ï¸\" !important;\\n                        position: absolute !important;\\n                        font-size: 14px !important;\\n                        color: ${i} !important;\\n                        top: 50% !important;\\n                        transform: translateY(-50%) !important;\\n                        opacity: 0.8 !important;\\n                    }\\n                    .dnd-card-header::before { left: 6px !important; }\\n                    .dnd-card-header::after { right: 6px !important; }\\n                `)}switch(r){case\"ornate\":e.push(`\\n                    .dnd-card-header {\\n                        border-bottom: none !important;\\n                        position: relative !important;\\n                        padding-bottom: 12px !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        content: \"â”€â”€â”€â”€â”€â”€â”€ âœ¦ â”€â”€â”€â”€â”€â”€â”€\" !important;\\n                        position: absolute !important;\\n                        bottom: 0 !important;\\n                        left: 50% !important;\\n                        transform: translateX(-50%) !important;\\n                        font-size: 10px !important;\\n                        color: ${i} !important;\\n                        white-space: nowrap !important;\\n                    }\\n                `);break;case\"tech\":e.push(`\\n                    .dnd-card-header {\\n                        border-bottom: none !important;\\n                        position: relative !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        bottom: 0 !important;\\n                        left: 10% !important;\\n                        right: 10% !important;\\n                        height: 2px !important;\\n                        background: linear-gradient(90deg, transparent, ${d}, transparent) !important;\\n                    }\\n                `);break;case\"double\":e.push(`\\n                    .dnd-card-header {\\n                        border-bottom: 3px double ${i} !important;\\n                    }\\n                `);break;case\"gradient\":e.push(`\\n                    .dnd-card-header {\\n                        border-bottom: none !important;\\n                        background: linear-gradient(to bottom, transparent 90%, ${i}40 100%) !important;\\n                    }\\n                `);break;case\"leaves\":e.push(`\\n                    .dnd-card-header {\\n                        border-bottom: 1px solid ${i} !important;\\n                        position: relative !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        content: \"ğŸƒ\" !important;\\n                        position: absolute !important;\\n                        bottom: -10px !important;\\n                        left: 50% !important;\\n                        transform: translateX(-50%) !important;\\n                        font-size: 14px !important;\\n                        color: ${d} !important;\\n                        background: var(--dnd-bg-card) !important;\\n                        padding: 0 5px !important;\\n                    }\\n                `);break;case\"pipes\":e.push(`\\n                    .dnd-card-header {\\n                        border-bottom: 4px double ${i} !important;\\n                        margin-bottom: 8px !important;\\n                    }\\n                `)}switch(o){case\"underline\":e.push(`\\n                    .dnd-card-header .dnd-title {\\n                        position: relative !important;\\n                        display: inline-block !important;\\n                    }\\n                    .dnd-card-header .dnd-title::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        bottom: -4px !important;\\n                        left: 0 !important;\\n                        right: 0 !important;\\n                        height: 2px !important;\\n                        background: ${d} !important;\\n                    }\\n                `);break;case\"banner\":e.push(`\\n                    .dnd-card-header {\\n                        background: linear-gradient(135deg, ${i}30, transparent 70%) !important;\\n                        clip-path: polygon(0 0, 100% 0, 95% 100%, 5% 100%) !important;\\n                    }\\n                `);break;case\"ribbon\":e.push(`\\n                    .dnd-card-header {\\n                        position: relative !important;\\n                        margin: 0 -10px !important;\\n                        padding: 8px 20px !important;\\n                        background: ${i}40 !important;\\n                    }\\n                    .dnd-card-header::before,\\n                    .dnd-card-header::after {\\n                        content: \"\" !important;\\n                        position: absolute !important;\\n                        bottom: -8px !important;\\n                        border: 4px solid ${i}60 !important;\\n                        border-bottom-color: transparent !important;\\n                    }\\n                    .dnd-card-header::before {\\n                        left: 0 !important;\\n                        border-left-color: transparent !important;\\n                    }\\n                    .dnd-card-header::after {\\n                        right: 0 !important;\\n                        border-right-color: transparent !important;\\n                    }\\n                `);break;case\"tech-bar\":e.push(`\\n                    .dnd-card-header {\\n                        background: linear-gradient(90deg, ${d}20, transparent 30%, transparent 70%, ${d}20) !important;\\n                        border-left: 3px solid ${d} !important;\\n                    }\\n                `);break;case\"bar\":e.push(`\\n                    .dnd-card-header {\\n                        background: ${d} !important;\\n                        color: #000 !important;\\n                        border-radius: 0 0 10px 0 !important;\\n                    }\\n                    .dnd-char-name {\\n                        color: #000 !important;\\n                        font-weight: 900 !important;\\n                        text-transform: uppercase !important;\\n                    }\\n                `)}return e},_generateEffectStyles(n,t){const e=[],{overlay:a,innerGlow:r,borderGlow:o,texture:i,animation:d}=n,s=t?.[\"--dnd-text-highlight\"]||\"#ffdb85\";if(\"scanlines\"===a&&e.push('\\n                .dnd-char-card::after {\\n                    content: \"\" !important;\\n                    position: absolute !important;\\n                    top: 0; left: 0; right: 0; bottom: 0 !important;\\n                    background: repeating-linear-gradient(\\n                        0deg,\\n                        transparent,\\n                        transparent 2px,\\n                        rgba(0,0,0,0.1) 2px,\\n                        rgba(0,0,0,0.1) 4px\\n                    ) !important;\\n                    pointer-events: none !important;\\n                    z-index: 100 !important;\\n                    animation: scanline 8s linear infinite !important;\\n                }\\n                @keyframes scanline {\\n                    0% { background-position: 0 0; }\\n                    100% { background-position: 0 100px; }\\n                }\\n            '),\"pulse\"===o&&e.push(`\\n                @keyframes borderPulse {\\n                    0%, 100% { box-shadow: 0 0 10px ${s}40; }\\n                    50% { box-shadow: 0 0 25px ${s}80, 0 0 40px ${s}40; }\\n                }\\n                .dnd-char-card {\\n                    animation: borderPulse 3s ease-in-out infinite !important;\\n                }\\n            `),d)switch(d){case\"float\":e.push(\"\\n                        @keyframes cardFloat {\\n                            0%, 100% { transform: translateY(0); }\\n                            50% { transform: translateY(-5px); }\\n                        }\\n                        .dnd-char-card {\\n                            animation: cardFloat 4s ease-in-out infinite !important;\\n                        }\\n                    \");break;case\"shimmer\":e.push('\\n                        @keyframes shimmer {\\n                            0% { background-position: -200% 0; }\\n                            100% { background-position: 200% 0; }\\n                        }\\n                        .dnd-char-card::before {\\n                            content: \"\" !important;\\n                            position: absolute !important;\\n                            top: 0; left: 0; right: 0; bottom: 0 !important;\\n                            background: linear-gradient(\\n                                90deg,\\n                                transparent,\\n                                rgba(255,255,255,0.05),\\n                                transparent\\n                            ) !important;\\n                            background-size: 200% 100% !important;\\n                            animation: shimmer 3s infinite !important;\\n                            pointer-events: none !important;\\n                            z-index: 1 !important;\\n                        }\\n                    ');break;case\"glow-breathe\":e.push(\"\\n                        @keyframes glowBreathe {\\n                            0%, 100% { filter: brightness(1); }\\n                            50% { filter: brightness(1.1); }\\n                        }\\n                        .dnd-char-card {\\n                            animation: glowBreathe 4s ease-in-out infinite !important;\\n                        }\\n                    \")}return e},_generateButtonStyles(n,t){const e=[],{shape:a,style:r}=n,o=t?.[\"--dnd-border-gold\"]||\"#9d8b6c\",i=t?.[\"--dnd-text-highlight\"]||\"#ffdb85\";switch(a){case\"pill\":e.push(\"\\n                    .dnd-btn {\\n                        border-radius: 50px !important;\\n                        padding: 6px 20px !important;\\n                    }\\n                \");break;case\"angular\":e.push(\"\\n                    .dnd-btn {\\n                        border-radius: 0 !important;\\n                        clip-path: polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px) !important;\\n                    }\\n                \");break;case\"hexagon\":e.push(\"\\n                    .dnd-btn {\\n                        clip-path: polygon(10% 0, 90% 0, 100% 50%, 90% 100%, 10% 100%, 0 50%) !important;\\n                        padding: 8px 24px !important;\\n                    }\\n                \")}switch(r){case\"outline\":e.push(`\\n                    .dnd-btn {\\n                        background: transparent !important;\\n                        border: 2px solid ${o} !important;\\n                    }\\n                    .dnd-btn:hover {\\n                        background: ${o}30 !important;\\n                    }\\n                `);break;case\"ghost\":e.push(`\\n                    .dnd-btn {\\n                        background: transparent !important;\\n                        border: none !important;\\n                    }\\n                    .dnd-btn:hover {\\n                        background: ${o}20 !important;\\n                    }\\n                `);break;case\"neon\":e.push(`\\n                    .dnd-btn {\\n                        background: transparent !important;\\n                        border: 1px solid ${i} !important;\\n                        box-shadow: 0 0 10px ${i}40, inset 0 0 10px ${i}20 !important;\\n                        text-shadow: 0 0 5px ${i} !important;\\n                    }\\n                    .dnd-btn:hover {\\n                        box-shadow: 0 0 20px ${i}60, inset 0 0 15px ${i}30 !important;\\n                    }\\n                `);break;case\"3d\":e.push(`\\n                    .dnd-btn {\\n                        box-shadow: 0 4px 0 ${o}80 !important;\\n                        transform: translateY(0) !important;\\n                        transition: all 0.1s ease !important;\\n                    }\\n                    .dnd-btn:hover {\\n                        transform: translateY(2px) !important;\\n                        box-shadow: 0 2px 0 ${o}80 !important;\\n                    }\\n                    .dnd-btn:active {\\n                        transform: translateY(4px) !important;\\n                        box-shadow: 0 0 0 ${o}80 !important;\\n                    }\\n                `)}return e},_generateProgressStyles(n,t){const e=[],{shape:a,style:r,segments:o}=n;switch(a){case\"angular\":e.push(\"\\n                    .dnd-bar, .dnd-bar-fill {\\n                        border-radius: 0 !important;\\n                        clip-path: polygon(4px 0, 100% 0, calc(100% - 4px) 100%, 0 100%) !important;\\n                    }\\n                \");break;case\"pointed\":e.push(\"\\n                    .dnd-bar-fill {\\n                        clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 50%, calc(100% - 8px) 100%, 0 100%) !important;\\n                    }\\n                \")}switch(r){case\"striped\":e.push(\"\\n                    .dnd-bar-fill {\\n                        background-image: linear-gradient(\\n                            45deg,\\n                            rgba(255,255,255,0.15) 25%,\\n                            transparent 25%,\\n                            transparent 50%,\\n                            rgba(255,255,255,0.15) 50%,\\n                            rgba(255,255,255,0.15) 75%,\\n                            transparent 75%,\\n                            transparent\\n                        ) !important;\\n                        background-size: 20px 20px !important;\\n                    }\\n                \");break;case\"animated\":e.push(\"\\n                    @keyframes barStripe {\\n                        0% { background-position: 0 0; }\\n                        100% { background-position: 40px 0; }\\n                    }\\n                    .dnd-bar-fill {\\n                        background-image: linear-gradient(\\n                            45deg,\\n                            rgba(255,255,255,0.15) 25%,\\n                            transparent 25%,\\n                            transparent 50%,\\n                            rgba(255,255,255,0.15) 50%,\\n                            rgba(255,255,255,0.15) 75%,\\n                            transparent 75%,\\n                            transparent\\n                        ) !important;\\n                        background-size: 40px 40px !important;\\n                        animation: barStripe 1s linear infinite !important;\\n                    }\\n                \");break;case\"glow\":e.push(\"\\n                    .dnd-bar-fill {\\n                        box-shadow: 0 0 10px currentColor, inset 0 0 5px rgba(255,255,255,0.3) !important;\\n                    }\\n                \")}return o&&o>0&&e.push(`\\n                .dnd-bar {\\n                    background: repeating-linear-gradient(\\n                        90deg,\\n                        var(--dnd-bar-bg) 0px,\\n                        var(--dnd-bar-bg) calc(100% / ${o} - 2px),\\n                        transparent calc(100% / ${o} - 2px),\\n                        transparent calc(100% / ${o})\\n                    ) !important;\\n                }\\n            `),e},_generateIconStyles(n,t){const e=[];switch(n){case\"square\":e.push(\"\\n                    .dnd-char-avatar,\\n                    .dnd-icon-container {\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"rounded\":e.push(\"\\n                    .dnd-char-avatar,\\n                    .dnd-icon-container {\\n                        border-radius: 8px !important;\\n                    }\\n                \");break;case\"hexagon\":e.push(\"\\n                    .dnd-char-avatar,\\n                    .dnd-icon-container {\\n                        clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"diamond\":e.push(\"\\n                    .dnd-char-avatar,\\n                    .dnd-icon-container {\\n                        clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"shield\":e.push(\"\\n                    .dnd-char-avatar,\\n                    .dnd-icon-container {\\n                        clip-path: polygon(0% 0%, 100% 0%, 100% 70%, 50% 100%, 0% 70%) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"octagon\":e.push(\"\\n                    .dnd-char-avatar,\\n                    .dnd-icon-container {\\n                        clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%) !important;\\n                        border-radius: 0 !important;\\n                    }\\n                \");break;case\"tentacles\":e.push(\"\\n                    .dnd-char-avatar {\\n                        border-radius: 40% 60% 70% 30% / 40% 50% 60% 50% !important;\\n                        animation: blob 5s ease-in-out infinite alternate !important;\\n                    }\\n                    @keyframes blob {\\n                        0% { border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }\\n                        100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }\\n                    }\\n                \")}return e},_generateLayoutStyles(n){const t=[],{density:e,cardMinWidth:a,gridGap:r}=n,o={compact:.7,normal:1,spacious:1.4}[e]||1;return e&&t.push(`\\n                .dnd-grid {\\n                    gap: calc(${r||\"15px\"} * ${o}) !important;\\n                    padding: calc(10px * ${o}) !important;\\n                }\\n                .dnd-char-card {\\n                    padding: calc(12px * ${o}) !important;\\n                }\\n                .dnd-card-header {\\n                    padding: calc(10px * ${o}) calc(12px * ${o}) !important;\\n                    margin: calc(-12px * ${o}) calc(-12px * ${o}) calc(8px * ${o}) !important;\\n                }\\n                .dnd-spacing-sm { margin-bottom: calc(8px * ${o}) !important; }\\n                .dnd-spacing-md { margin-bottom: calc(12px * ${o}) !important; }\\n                .dnd-spacing-lg { margin-bottom: calc(20px * ${o}) !important; }\\n            `),a&&t.push(`\\n                .dnd-grid {\\n                    grid-template-columns: repeat(auto-fill, minmax(${a}, 1fr)) !important;\\n                }\\n            `),t},_injectStyles(n){const{window:t}=a(),e=t?.document||document;if(this.clear(),!n||0===n.trim().length)return;const r=e.createElement(\"style\");r.id=this.EFFECTS_STYLE_ID,r.textContent=n,e.head.appendChild(r)}},Br={\"classic-dnd\":{meta:{id:\"classic-dnd\",name:\"ç»å…¸ç¾Šçš®çº¸\",icon:\"ğŸ“œ\",description:\"ä¼ ç»Ÿçš„D&Dé£æ ¼ï¼Œä»¿ä½›ç½®èº«äºå¤è€çš„ä¹¦å·ä¹‹ä¸­\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#1a100e\",\"--dnd-bg-panel\":\"#2b1b17\",\"--dnd-bg-panel-start\":\"#2b1b17\",\"--dnd-bg-panel-end\":\"#1a100e\",\"--dnd-text-main\":\"#e0cda8\",\"--dnd-text-header\":\"#d4c4a0\",\"--dnd-text-highlight\":\"#ffdb85\",\"--dnd-text-dim\":\"#8a7a6a\",\"--dnd-accent\":\"#8a2be2\",\"--dnd-accent-hover\":\"#9b4dca\",\"--dnd-border\":\"#4a3b2a\",\"--dnd-border-light\":\"#6a5b4a\",\"--dnd-bg-card\":\"#242424\",\"--dnd-bg-card-start\":\"#242424\",\"--dnd-bg-card-end\":\"#1a1a1c\",\"--dnd-btn-primary\":\"#4a148c\",\"--dnd-btn-primary-hover\":\"#6a1b9a\",\"--dnd-btn-text\":\"#e0cda8\",\"--dnd-border-gold\":\"#9d8b6c\",\"--dnd-border-inner\":\"#5c4b35\"},morphology:{border:{style:\"solid\",width:\"2px\",outerStyle:\"none\"},corners:{style:\"rounded\",clipPath:\"none\"},card:{shape:\"normal\",decoration:\"ornate\"},effects:{texture:\"paper\",innerGlow:\"subtle\",borderGlow:\"gold\",overlay:\"vignette\"},layout:{density:\"normal\"},decorations:{corners:\"flourish\",dividers:\"ornate\",headers:\"banner\"},buttons:{style:\"classic\",shape:\"rounded\"},progressBars:{style:\"parchment\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Cinzel\", \"Palatino Linotype\", \"Book Antiqua\", serif',\"--dnd-font-size-base\":\"1rem\",\"--dnd-font-size-header\":\"1.2rem\",\"--dnd-font-weight-header\":\"600\",\"--dnd-letter-spacing\":\"0.03em\"},animations:{\"--dnd-transition-fast\":\"0.2s ease-out\",\"--dnd-transition-normal\":\"0.3s ease-out\",\"--dnd-animation-glow\":\"parchment-glow 4s ease-in-out infinite\"},interactiveStates:{hover:{brightness:1.1,scale:1.02,lift:\"-4px\",shadow:\"0 10px 30px rgba(0,0,0,0.45), 0 0 15px rgba(157, 139, 108, 0.15)\",borderColor:\"#9d8b6c\",glow:\"drop-shadow(0 0 5px rgba(157, 139, 108, 0.3))\",transition:\"0.3s ease-out\"},cardHover:{transform:\"translateY(-8px) rotateX(3deg) rotateY(-2deg) scale(1.02)\",shadow:\"0 25px 50px rgba(0,0,0,0.55), 0 0 40px rgba(157, 139, 108, 0.2)\",borderColor:\"#b8a07a\"},buttonHover:{brightness:1.18,transform:\"translateY(-3px) scale(1.02)\",shadow:\"0 8px 20px rgba(138, 43, 226, 0.4), 0 0 10px rgba(157, 139, 108, 0.3)\"},active:{scale:.96,brightness:.92,transform:\"translateY(2px) scale(0.96)\",shadow:\"0 2px 8px rgba(0,0,0,0.35), inset 0 1px 3px rgba(0,0,0,0.2)\"},buttonActive:{transform:\"translateY(2px) scale(0.97)\",shadow:\"0 1px 4px rgba(0,0,0,0.3), inset 0 2px 4px rgba(0,0,0,0.2)\"},selected:{background:\"linear-gradient(90deg, rgba(157, 139, 108, 0.25), rgba(138, 43, 226, 0.1), transparent)\",borderColor:\"#ffdb85\",borderWidth:\"2px\",glow:\"0 0 15px rgba(157, 139, 108, 0.35)\",textColor:\"#ffdb85\"},navActive:{background:\"linear-gradient(90deg, rgba(157, 139, 108, 0.25), transparent)\",border:\"3px solid #9d8b6c\",indicator:\"#b8a07a\"},focus:{borderColor:\"#9d8b6c\",shadow:\"0 0 0 4px rgba(157, 139, 108, 0.25)\",outline:\"none\"},disabled:{opacity:.45,cursor:\"not-allowed\",filter:\"grayscale(0.6) sepia(0.2) brightness(0.8)\"},iconHover:{glow:\"drop-shadow(0 0 6px rgba(138, 43, 226, 0.6)) drop-shadow(0 0 12px rgba(157, 139, 108, 0.4))\",scale:1.12},inputFocus:{border:\"#9d8b6c\",shadow:\"0 0 10px rgba(157, 139, 108, 0.3), inset 0 0 8px rgba(157, 139, 108, 0.1)\"}},overrides:{\".dnd-char-card\":{\"box-shadow\":\"0 6px 20px rgba(0,0,0,0.45), inset 0 0 40px rgba(0,0,0,0.4), 0 0 20px rgba(157, 139, 108, 0.1)\",border:\"3px double #5c4b35\",\"border-radius\":\"3px\",background:\"linear-gradient(135deg, #2b2420 0%, #1e1815 50%, #1a1510 100%)\"},\".dnd-card-header\":{\"border-bottom\":\"2px solid #5c4b35\",background:\"linear-gradient(to right, rgba(157, 139, 108, 0.18), rgba(92, 75, 53, 0.1), rgba(157, 139, 108, 0.18))\",position:\"relative\",padding:\"12px 16px\"},\".dnd-card-body\":{background:\"repeating-linear-gradient(0deg, transparent, transparent 24px, rgba(92, 75, 53, 0.08) 24px, rgba(92, 75, 53, 0.08) 25px)\",padding:\"15px\"},\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, #2b1b17 0%, #1a100e 100%)\",\"border-right\":\"3px double #5c4b35\"},\".dnd-nav-item\":{\"border-radius\":\"0 8px 8px 0\",margin:\"4px 0\",\"border-left\":\"4px solid transparent\",transition:\"all 0.3s ease-out\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, rgba(157, 139, 108, 0.15), transparent)\",\"border-left-color\":\"#9d8b6c\",\"padding-left\":\"24px\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(157, 139, 108, 0.25), transparent)\",\"box-shadow\":\"inset 4px 0 0 #b8a07a, 0 0 15px rgba(157, 139, 108, 0.2)\",\"border-left-color\":\"#ffdb85\"},\".dnd-bar-container\":{background:\"linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(30,20,15,0.8))\",border:\"1px solid #5c4b35\",\"border-radius\":\"2px\",height:\"10px\",\"box-shadow\":\"inset 0 1px 3px rgba(0,0,0,0.5)\"},\".dnd-bar-fill\":{background:\"linear-gradient(90deg, #5c4b35 0%, #9d8b6c 50%, #b8a07a 75%, #9d8b6c 100%)\",\"box-shadow\":\"0 0 8px rgba(157, 139, 108, 0.5), inset 0 1px 0 rgba(255,255,255,0.2)\",\"border-radius\":\"1px\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #6a2c2c 0%, #8a3c3c 50%, #a04040 75%, #8a3c3c 100%)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #4a3080 0%, #6a40a0 50%, #8050c0 75%, #6a40a0 100%)\"},\".dnd-btn, .dnd-action-btn\":{border:\"2px solid #5c4b35\",background:\"linear-gradient(145deg, #3a2a20 0%, #2a1a15 50%, #1f1510 100%)\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.1), inset 0 -1px 0 rgba(0,0,0,0.2), 0 3px 8px rgba(0,0,0,0.4)\",\"border-radius\":\"4px\",\"text-shadow\":\"0 1px 2px rgba(0,0,0,0.5)\",\"font-family\":'\"Cinzel\", serif',\"letter-spacing\":\"0.05em\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{background:\"linear-gradient(145deg, #4a3a30 0%, #3a2a20 50%, #2a1a15 100%)\",\"border-color\":\"#9d8b6c\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.15), 0 5px 15px rgba(0,0,0,0.5), 0 0 10px rgba(157, 139, 108, 0.2)\"},\".dnd-btn:active, .dnd-action-btn:active\":{background:\"linear-gradient(145deg, #2a1a15 0%, #1f1510 100%)\",\"box-shadow\":\"inset 0 2px 4px rgba(0,0,0,0.4), 0 1px 2px rgba(0,0,0,0.3)\"},\".dnd-stat-row\":{background:\"linear-gradient(90deg, rgba(43, 36, 32, 0.6), rgba(30, 24, 21, 0.4))\",border:\"1px solid rgba(92, 75, 53, 0.3)\",\"border-radius\":\"3px\",padding:\"6px 10px\",margin:\"3px 0\"},\".dnd-stat-row:nth-child(odd)\":{background:\"linear-gradient(90deg, rgba(43, 36, 32, 0.4), rgba(30, 24, 21, 0.2))\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 2px 6px rgba(0,0,0,0.5), 0 0 20px rgba(157, 139, 108, 0.3)\",\"font-family\":'\"Cinzel\", \"Palatino Linotype\", serif',\"letter-spacing\":\"0.08em\"},\".dnd-panel, .dnd-dialog\":{border:\"3px double #5c4b35\",\"border-radius\":\"4px\",\"box-shadow\":\"0 10px 40px rgba(0,0,0,0.6), inset 0 0 60px rgba(0,0,0,0.3)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"rgba(26, 16, 14, 0.8)\",border:\"1px solid #5c4b35\",\"border-radius\":\"3px\",color:\"#e0cda8\"},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#9d8b6c\",\"box-shadow\":\"0 0 8px rgba(157, 139, 108, 0.3), inset 0 0 5px rgba(157, 139, 108, 0.1)\"},\".dnd-table th\":{background:\"linear-gradient(to bottom, #3a2a20, #2a1a15)\",\"border-bottom\":\"2px solid #5c4b35\",color:\"#ffdb85\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(92, 75, 53, 0.3)\"},\".dnd-table tr:hover td\":{background:\"rgba(157, 139, 108, 0.1)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #5c4b35, #3a2a20)\",border:\"1px solid #9d8b6c\",\"border-radius\":\"3px\",\"box-shadow\":\"0 1px 3px rgba(0,0,0,0.3)\"},\"#dnd-mini-hud\":{border:\"2px solid #5c4b35\",\"border-radius\":\"4px\",background:\"linear-gradient(180deg, rgba(43, 27, 23, 0.95), rgba(26, 16, 14, 0.98))\"}},customCSS:\"\\n            /* ====== ç»å…¸ç¾Šçš®çº¸çš®è‚¤ - ç‹¬ç‰¹åŠ¨ç”»ä¸è£…é¥° ====== */\\n            \\n            /* ç¾Šçš®çº¸å‘¼å¸å…‰æ•ˆ */\\n            @keyframes parchment-glow {\\n                0%, 100% {\\n                    box-shadow: 0 6px 20px rgba(0,0,0,0.45), inset 0 0 40px rgba(0,0,0,0.4), 0 0 20px rgba(157, 139, 108, 0.1);\\n                    filter: brightness(1);\\n                }\\n                50% {\\n                    box-shadow: 0 6px 20px rgba(0,0,0,0.45), inset 0 0 40px rgba(0,0,0,0.4), 0 0 35px rgba(157, 139, 108, 0.25);\\n                    filter: brightness(1.02);\\n                }\\n            }\\n            \\n            /* å¢¨æ°´ä¹¦å†™åŠ¨ç”» */\\n            @keyframes ink-write {\\n                0% { width: 0; opacity: 0; }\\n                10% { opacity: 1; }\\n                100% { width: 100%; opacity: 1; }\\n            }\\n            \\n            /* ç¾½æ¯›ç¬”ä¹¦å†™çº¿æ¡åŠ¨ç”» */\\n            @keyframes quill-underline {\\n                0% { transform: scaleX(0); transform-origin: left; }\\n                100% { transform: scaleX(1); transform-origin: left; }\\n            }\\n            \\n            /* èœ¡çƒ›é—ªçƒæ•ˆæœï¼ˆç”¨äºé‡è¦å…ƒç´ ï¼‰ */\\n            @keyframes candle-flicker {\\n                0%, 100% { opacity: 1; filter: brightness(1); }\\n                25% { opacity: 0.95; filter: brightness(0.98); }\\n                50% { opacity: 1; filter: brightness(1.02); }\\n                75% { opacity: 0.97; filter: brightness(0.99); }\\n            }\\n            \\n            /* å¡ç‰‡ - ç¾Šçš®çº¸çº¹ç†ä¸å·è½´è¾¹ç¼˜ */\\n            .dnd-char-card {\\n                position: relative;\\n                animation: parchment-glow 5s ease-in-out infinite;\\n            }\\n            \\n            /* ç¾Šçš®çº¸çº¹ç†å±‚ */\\n            .dnd-char-card::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background:\\n                    url(\\\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='paper'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paper)' opacity='0.03'/%3E%3C/svg%3E\\\"),\\n                    linear-gradient(90deg, rgba(0,0,0,0.1) 0%, transparent 5%, transparent 95%, rgba(0,0,0,0.1) 100%);\\n                pointer-events: none;\\n                border-radius: inherit;\\n                z-index: 0;\\n            }\\n            \\n            /* å†…è¾¹æ¡†è£…é¥°çº¿ */\\n            .dnd-char-card::after {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 6px; left: 6px; right: 6px; bottom: 6px;\\n                border: 1px solid rgba(157, 139, 108, 0.2);\\n                border-radius: 2px;\\n                pointer-events: none;\\n                z-index: 1;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨ - åä¸½æ¨ªå¹…è£…é¥° */\\n            .dnd-card-header::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                left: 50%;\\n                bottom: -8px;\\n                transform: translateX(-50%);\\n                width: 60px;\\n                height: 16px;\\n                background: linear-gradient(to bottom, #5c4b35 0%, #3a2a20 100%);\\n                clip-path: polygon(0 0, 100% 0, 85% 100%, 15% 100%);\\n                z-index: 10;\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \\\"â§\\\";\\n                position: absolute;\\n                left: 50%;\\n                bottom: -5px;\\n                transform: translateX(-50%);\\n                color: #9d8b6c;\\n                font-size: 12px;\\n                z-index: 11;\\n            }\\n            \\n            /* å¯¼èˆªé¡¹ - ä¹¦ç­¾æ ‡ç­¾æ•ˆæœ */\\n            .dnd-nav-item::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                left: 0; top: 0; bottom: 0;\\n                width: 4px;\\n                background: linear-gradient(to bottom, transparent, #9d8b6c, transparent);\\n                opacity: 0;\\n                transition: opacity 0.3s;\\n            }\\n            \\n            .dnd-nav-item:hover::before,\\n            .dnd-nav-item.active::before {\\n                opacity: 1;\\n            }\\n            \\n            .dnd-nav-item.active::after {\\n                content: \\\"â—†\\\";\\n                position: absolute;\\n                right: 10px;\\n                color: #ffdb85;\\n                font-size: 8px;\\n                animation: candle-flicker 2s infinite;\\n            }\\n            \\n            /* æŒ‰é’® - èœ¡å°å°ç« æ•ˆæœ */\\n            .dnd-btn::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 2px; left: 2px; right: 2px; bottom: 2px;\\n                border: 1px dashed rgba(157, 139, 108, 0.2);\\n                border-radius: 2px;\\n                pointer-events: none;\\n            }\\n            \\n            /* è¿›åº¦æ¡åŠ¨ç”» */\\n            .dnd-bar-fill {\\n                position: relative;\\n                overflow: hidden;\\n            }\\n            \\n            .dnd-bar-fill::after {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 0; left: -100%; width: 100%; height: 100%;\\n                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);\\n                animation: progress-shine 3s ease-in-out infinite;\\n            }\\n            \\n            @keyframes progress-shine {\\n                0% { left: -100%; }\\n                50%, 100% { left: 100%; }\\n            }\\n            \\n            /* åˆ†éš”çº¿è£…é¥° */\\n            .dnd-divider {\\n                height: 2px;\\n                background: linear-gradient(90deg, transparent, #5c4b35, #9d8b6c, #5c4b35, transparent);\\n                position: relative;\\n                margin: 10px 0;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \\\"âœ¦\\\";\\n                position: absolute;\\n                left: 50%;\\n                top: 50%;\\n                transform: translate(-50%, -50%);\\n                background: #1a1510;\\n                padding: 0 8px;\\n                color: #9d8b6c;\\n                font-size: 10px;\\n            }\\n            \\n            /* è§’è½è£…é¥°èŠ±çº¹ */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \\\"â¦\\\";\\n                position: absolute;\\n                top: 5px; left: 8px;\\n                color: rgba(157, 139, 108, 0.4);\\n                font-size: 14px;\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \\\"â¦\\\";\\n                position: absolute;\\n                bottom: 5px; right: 8px;\\n                color: rgba(157, 139, 108, 0.4);\\n                font-size: 14px;\\n                transform: rotate(180deg);\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - ç¾Šçš®çº¸é£æ ¼ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 8px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: rgba(26, 16, 14, 0.5);\\n                border-left: 1px solid #5c4b35;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(to bottom, #5c4b35, #3a2a20);\\n                border-radius: 2px;\\n                border: 1px solid #9d8b6c;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(to bottom, #9d8b6c, #5c4b35);\\n            }\\n            \\n            /* æ‚¬æµ®æç¤ºæ¡† */\\n            .dnd-tooltip {\\n                background: linear-gradient(135deg, #2b2420, #1a1510);\\n                border: 2px solid #5c4b35;\\n                border-radius: 4px;\\n                box-shadow: 0 5px 20px rgba(0,0,0,0.5);\\n            }\\n            \\n            .dnd-tooltip::before {\\n                border-color: #5c4b35 transparent transparent transparent;\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - å¤å…¸åœ†å½¢å¾½ç«  */\\n            .dnd-icon-circle {\\n                border: 2px solid #5c4b35;\\n                background: radial-gradient(circle at 30% 30%, #3a2a20, #1a1510);\\n                box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 2px 5px rgba(0,0,0,0.3);\\n            }\\n            \\n            /* å¤´åƒæ¡† - æ¤­åœ†è‚–åƒç”»æ¡† */\\n            .dnd-avatar {\\n                border: 3px solid #9d8b6c;\\n                box-shadow: 0 0 0 2px #5c4b35, 0 4px 10px rgba(0,0,0,0.4);\\n            }\\n        \",background:{type:\"particles\",colors:[\"rgba(255, 219, 133, 0.8)\",\"rgba(157, 139, 108, 0.6)\",\"rgba(255, 255, 255, 0.5)\",\"rgba(138, 43, 226, 0.4)\"],minSize:1,maxSize:4,count:20,speed:.03,glow:!0}},\"cyber-neon\":{meta:{id:\"cyber-neon\",name:\"èµ›åšéœ“è™¹\",icon:\"ğŸŒƒ\",description:\"é«˜å¯¹æ¯”åº¦çš„æœªæ¥ç§‘æŠ€é£æ ¼ï¼Œå……æ»¡éœ“è™¹å…‰å½±\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#050510\",\"--dnd-bg-panel-start\":\"#0a0a1a\",\"--dnd-bg-panel-end\":\"#050510\",\"--dnd-text-main\":\"#00f3ff\",\"--dnd-text-header\":\"#ff00ff\",\"--dnd-text-dim\":\"#007a80\",\"--dnd-text-highlight\":\"#ffff00\",\"--dnd-accent\":\"#ff00ff\",\"--dnd-accent-hover\":\"#ff66ff\",\"--dnd-border-gold\":\"#00f3ff\",\"--dnd-border-inner\":\"#ff00ff\",\"--dnd-bg-card-start\":\"rgba(10, 10, 26, 0.95)\",\"--dnd-bg-card-end\":\"rgba(5, 5, 16, 0.95)\",\"--dnd-btn-primary\":\"rgba(255, 0, 255, 0.25)\",\"--dnd-btn-primary-hover\":\"rgba(255, 0, 255, 0.45)\",\"--dnd-btn-text\":\"#00f3ff\"},morphology:{border:{style:\"solid\",width:\"2px\",outerStyle:\"none\"},corners:{style:\"cut\",clipPath:\"polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px)\"},card:{shape:\"sharp\",decoration:\"tech\"},effects:{texture:\"circuit\",innerGlow:\"neon\",borderGlow:\"neon\",overlay:\"scanlines\"},layout:{density:\"compact\",cardMinWidth:\"300px\"},decorations:{corners:\"tech-bracket\",dividers:\"glitch\",headers:\"hologram\"},buttons:{style:\"cyber\",shape:\"cut\"},progressBars:{style:\"neon\",animated:!0,glitch:!0}},typography:{\"--dnd-font-serif\":'\"Orbitron\", \"Roboto Mono\", \"Consolas\", monospace',\"--dnd-font-size-base\":\"0.9rem\",\"--dnd-font-size-header\":\"1.1rem\",\"--dnd-font-weight-header\":\"700\",\"--dnd-letter-spacing\":\"0.1em\",\"--dnd-text-transform\":\"uppercase\"},animations:{\"--dnd-transition-fast\":\"0.1s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-transition-normal\":\"0.2s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-animation-neon\":\"neon-flicker 3s ease-in-out infinite\",\"--dnd-animation-glitch\":\"cyber-glitch 0.3s ease-in-out\",\"--dnd-animation-scan\":\"scanline 8s linear infinite\"},interactiveStates:{hover:{brightness:1.25,scale:1.03,lift:\"-5px\",shadow:\"0 12px 35px rgba(0, 243, 255, 0.35), 0 0 20px rgba(255, 0, 255, 0.2)\",borderColor:\"#00f3ff\",glow:\"drop-shadow(0 0 12px #00f3ff) drop-shadow(0 0 25px rgba(255, 0, 255, 0.4))\",transition:\"0.15s cubic-bezier(0.4, 0, 0.2, 1)\"},cardHover:{transform:\"translateY(-8px) scale(1.02) perspective(1000px) rotateX(2deg)\",shadow:\"0 0 40px rgba(0, 243, 255, 0.5), 0 0 80px rgba(255, 0, 255, 0.25), inset 0 0 30px rgba(0, 243, 255, 0.08)\",borderColor:\"#ff00ff\"},buttonHover:{brightness:1.35,transform:\"translateY(-4px) scale(1.03)\",shadow:\"0 0 25px rgba(255, 0, 255, 0.6), inset 0 0 15px rgba(0, 243, 255, 0.35), 0 8px 20px rgba(0,0,0,0.4)\"},active:{scale:.94,brightness:.85,transform:\"scale(0.94)\",shadow:\"0 0 15px rgba(0, 243, 255, 0.6), inset 0 0 10px rgba(255, 0, 255, 0.2)\"},buttonActive:{transform:\"translateY(3px) scale(0.97)\",shadow:\"0 0 8px rgba(0, 243, 255, 0.4), inset 0 2px 8px rgba(0,0,0,0.4)\"},selected:{background:\"linear-gradient(90deg, rgba(255, 0, 255, 0.35), rgba(0, 243, 255, 0.15), transparent)\",borderColor:\"#00f3ff\",borderWidth:\"2px\",glow:\"0 0 20px rgba(0, 243, 255, 0.6), 0 0 40px rgba(255, 0, 255, 0.2)\",textColor:\"#ffff00\"},navActive:{background:\"linear-gradient(90deg, rgba(0, 243, 255, 0.25), rgba(255, 0, 255, 0.1), transparent)\",border:\"2px solid #ff00ff\",indicator:\"#00f3ff\"},focus:{borderColor:\"#ff00ff\",shadow:\"0 0 0 4px rgba(255, 0, 255, 0.35), 0 0 20px rgba(0, 243, 255, 0.3)\",outline:\"none\"},disabled:{opacity:.35,cursor:\"not-allowed\",filter:\"grayscale(0.85) brightness(0.5)\"},iconHover:{glow:\"drop-shadow(0 0 10px #00f3ff) drop-shadow(0 0 20px #ff00ff) drop-shadow(0 0 30px rgba(255, 255, 0, 0.3))\",scale:1.18},inputFocus:{border:\"#00f3ff\",shadow:\"0 0 15px rgba(0, 243, 255, 0.5), inset 0 0 8px rgba(0, 243, 255, 0.15), 0 0 30px rgba(255, 0, 255, 0.15)\"}},overrides:{\".dnd-char-card\":{\"box-shadow\":\"0 0 25px rgba(0, 243, 255, 0.3), inset 0 0 30px rgba(0, 243, 255, 0.1), 0 0 80px rgba(255, 0, 255, 0.15)\",border:\"2px solid #00f3ff\",\"border-radius\":\"0\",\"clip-path\":\"polygon(20px 0, calc(100% - 20px) 0, 100% 20px, 100% calc(100% - 20px), calc(100% - 20px) 100%, 20px 100%, 0 calc(100% - 20px), 0 20px)\",background:\"linear-gradient(135deg, rgba(10, 10, 30, 0.95) 0%, rgba(5, 5, 20, 0.98) 100%)\"},\".dnd-card-header\":{\"border-bottom\":\"2px solid #ff00ff\",background:\"linear-gradient(90deg, rgba(255, 0, 255, 0.2), rgba(0,0,0,0.5), rgba(0, 243, 255, 0.15))\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.2em\",padding:\"14px 18px\",position:\"relative\"},\".dnd-card-body\":{background:\"repeating-linear-gradient(0deg, transparent, transparent 30px, rgba(0, 243, 255, 0.02) 30px, rgba(0, 243, 255, 0.02) 31px)\",padding:\"16px\"},\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, rgba(10, 10, 26, 0.98), rgba(5, 5, 16, 1))\",\"border-right\":\"3px solid #ff00ff\",\"box-shadow\":\"5px 0 30px rgba(255, 0, 255, 0.2)\"},\".dnd-nav-item\":{\"clip-path\":\"polygon(0 0, calc(100% - 8px) 0, 100% 50%, calc(100% - 8px) 100%, 0 100%)\",margin:\"4px 0\",padding:\"12px 20px\",\"border-left\":\"3px solid transparent\",background:\"rgba(0, 243, 255, 0.05)\",transition:\"all 0.15s cubic-bezier(0.4, 0, 0.2, 1)\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, rgba(0, 243, 255, 0.2), rgba(255, 0, 255, 0.1))\",\"border-left-color\":\"#00f3ff\",\"text-shadow\":\"0 0 10px #00f3ff\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(255, 0, 255, 0.4), rgba(0, 243, 255, 0.15), transparent)\",\"box-shadow\":\"inset 4px 0 0 #00f3ff, 0 0 25px rgba(0, 243, 255, 0.3), 0 0 40px rgba(255, 0, 255, 0.15)\",\"border-left-color\":\"#ffff00\"},\".dnd-bar-container\":{background:\"rgba(0, 0, 0, 0.8)\",border:\"1px solid rgba(0, 243, 255, 0.5)\",\"border-radius\":\"0\",height:\"12px\",\"clip-path\":\"polygon(5px 0, calc(100% - 5px) 0, 100% 50%, calc(100% - 5px) 100%, 5px 100%, 0 50%)\",\"box-shadow\":\"inset 0 0 10px rgba(0, 0, 0, 0.8)\"},\".dnd-bar-fill\":{background:\"linear-gradient(90deg, #ff00ff, #00f3ff, #ffff00, #00f3ff, #ff00ff)\",\"background-size\":\"300% 100%\",\"box-shadow\":\"0 0 15px rgba(0, 243, 255, 0.7), 0 0 30px rgba(255, 0, 255, 0.4)\",\"border-radius\":\"0\",animation:\"neon-progress 3s linear infinite\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #ff0040, #ff00ff, #ff0080, #ff00ff, #ff0040)\",\"background-size\":\"300% 100%\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #8000ff, #00f3ff, #ff00ff, #00f3ff, #8000ff)\",\"background-size\":\"300% 100%\"},\".dnd-btn, .dnd-action-btn\":{\"text-transform\":\"uppercase\",\"letter-spacing\":\"3px\",\"clip-path\":\"polygon(12px 0, 100% 0, 100% calc(100% - 12px), calc(100% - 12px) 100%, 0 100%, 0 12px)\",border:\"2px solid #ff00ff\",background:\"linear-gradient(135deg, rgba(255, 0, 255, 0.15), rgba(0, 243, 255, 0.08))\",\"box-shadow\":\"0 0 15px rgba(255, 0, 255, 0.3), inset 0 0 20px rgba(0, 243, 255, 0.1)\",\"font-family\":'\"Orbitron\", monospace',position:\"relative\",overflow:\"hidden\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{background:\"linear-gradient(135deg, rgba(0, 243, 255, 0.25), rgba(255, 0, 255, 0.15))\",\"border-color\":\"#00f3ff\",\"box-shadow\":\"0 0 30px rgba(0, 243, 255, 0.5), 0 0 60px rgba(255, 0, 255, 0.3), inset 0 0 25px rgba(0, 243, 255, 0.15)\"},\".dnd-btn:active, .dnd-action-btn:active\":{background:\"linear-gradient(135deg, rgba(255, 255, 0, 0.2), rgba(255, 0, 255, 0.1))\",\"box-shadow\":\"inset 0 0 30px rgba(0, 243, 255, 0.3)\"},\".dnd-stat-row\":{background:\"linear-gradient(90deg, rgba(0, 243, 255, 0.08), rgba(255, 0, 255, 0.05), transparent)\",border:\"1px solid rgba(0, 243, 255, 0.2)\",\"border-left\":\"3px solid #ff00ff\",\"border-radius\":\"0\",\"clip-path\":\"polygon(0 0, 100% 0, calc(100% - 5px) 100%, 0 100%)\",padding:\"8px 12px\",margin:\"4px 0\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(90deg, rgba(0, 243, 255, 0.15), rgba(255, 0, 255, 0.1), transparent)\",\"border-left-color\":\"#00f3ff\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 0 10px #00f3ff, 0 0 20px #ff00ff, 0 0 40px rgba(255, 255, 0, 0.6), 0 2px 0 #000\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.25em\",\"font-family\":'\"Orbitron\", monospace'},\".dnd-panel, .dnd-dialog\":{border:\"2px solid #00f3ff\",\"border-radius\":\"0\",\"clip-path\":\"polygon(15px 0, calc(100% - 15px) 0, 100% 15px, 100% calc(100% - 15px), calc(100% - 15px) 100%, 15px 100%, 0 calc(100% - 15px), 0 15px)\",\"box-shadow\":\"0 0 40px rgba(0, 243, 255, 0.3), 0 0 80px rgba(255, 0, 255, 0.15), inset 0 0 50px rgba(0, 243, 255, 0.05)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"rgba(0, 0, 0, 0.8)\",border:\"1px solid #ff00ff\",\"border-radius\":\"0\",color:\"#00f3ff\",\"font-family\":'\"Roboto Mono\", monospace',\"clip-path\":\"polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px)\"},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#00f3ff\",\"box-shadow\":\"0 0 20px rgba(0, 243, 255, 0.5), inset 0 0 10px rgba(0, 243, 255, 0.1)\"},\".dnd-table\":{border:\"1px solid rgba(0, 243, 255, 0.3)\"},\".dnd-table th\":{background:\"linear-gradient(180deg, rgba(255, 0, 255, 0.2), rgba(0, 0, 0, 0.8))\",\"border-bottom\":\"2px solid #00f3ff\",color:\"#ffff00\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.1em\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(0, 243, 255, 0.2)\",\"border-right\":\"1px solid rgba(255, 0, 255, 0.1)\"},\".dnd-table tr:hover td\":{background:\"rgba(0, 243, 255, 0.1)\",\"text-shadow\":\"0 0 5px #00f3ff\"},\".dnd-badge\":{background:\"linear-gradient(135deg, rgba(255, 0, 255, 0.3), rgba(0, 243, 255, 0.2))\",border:\"1px solid #00f3ff\",\"border-radius\":\"0\",\"clip-path\":\"polygon(5px 0, 100% 0, 100% calc(100% - 5px), calc(100% - 5px) 100%, 0 100%, 0 5px)\",\"box-shadow\":\"0 0 10px rgba(0, 243, 255, 0.4)\"},\"#dnd-mini-hud\":{border:\"2px solid #ff00ff\",\"border-radius\":\"0\",\"clip-path\":\"polygon(10px 0, calc(100% - 10px) 0, 100% 10px, 100% calc(100% - 10px), calc(100% - 10px) 100%, 10px 100%, 0 calc(100% - 10px), 0 10px)\",background:\"linear-gradient(180deg, rgba(10, 10, 26, 0.98), rgba(5, 5, 16, 1))\",\"box-shadow\":\"0 0 30px rgba(255, 0, 255, 0.3)\"},\".dnd-icon\":{filter:\"drop-shadow(0 0 5px #00f3ff)\"}},customCSS:'\\n            /* ====== èµ›åšéœ“è™¹çš®è‚¤ - å…¨æ¯ç§‘æŠ€åŠ¨ç”»ä¸ç‰¹æ•ˆ ====== */\\n            \\n            /* éœ“è™¹é—ªçƒåŠ¨ç”» */\\n            @keyframes neon-flicker {\\n                0%, 18%, 22%, 25%, 53%, 57%, 100% {\\n                    box-shadow: 0 0 25px rgba(0, 243, 255, 0.3), inset 0 0 30px rgba(0, 243, 255, 0.1), 0 0 80px rgba(255, 0, 255, 0.15);\\n                    filter: brightness(1);\\n                }\\n                20%, 24%, 55% {\\n                    box-shadow: 0 0 8px rgba(0, 243, 255, 0.15), inset 0 0 15px rgba(0, 243, 255, 0.05), 0 0 30px rgba(255, 0, 255, 0.08);\\n                    filter: brightness(0.9);\\n                }\\n            }\\n            \\n            /* æ•…éšœæ•ˆæœåŠ¨ç”» */\\n            @keyframes cyber-glitch {\\n                0%, 100% { transform: translate(0) skewX(0); filter: hue-rotate(0deg); }\\n                10% { transform: translate(-3px, 2px) skewX(-2deg); filter: hue-rotate(90deg); }\\n                20% { transform: translate(3px, -2px) skewX(2deg); filter: hue-rotate(-90deg); }\\n                30% { transform: translate(-2px, -1px); filter: hue-rotate(180deg); }\\n                40% { transform: translate(2px, 1px); filter: hue-rotate(0deg); }\\n                50% { transform: translate(-1px, 2px) skewX(-1deg); }\\n                60% { transform: translate(1px, -2px) skewX(1deg); }\\n            }\\n            \\n            /* æ‰«æçº¿åŠ¨ç”» */\\n            @keyframes scanline-sweep {\\n                0% { top: -10%; }\\n                100% { top: 110%; }\\n            }\\n            \\n            /* éœ“è™¹è¿›åº¦æ¡åŠ¨ç”» */\\n            @keyframes neon-progress {\\n                0% { background-position: 0% 50%; }\\n                100% { background-position: 300% 50%; }\\n            }\\n            \\n            /* æ•°æ®æµåŠ¨ç”» */\\n            @keyframes data-flow {\\n                0% { background-position: 0 0; }\\n                100% { background-position: 50px 50px; }\\n            }\\n            \\n            /* å…¨æ¯é—ªçƒ */\\n            @keyframes hologram-flicker {\\n                0%, 100% { opacity: 1; }\\n                50% { opacity: 0.95; }\\n                52% { opacity: 0.85; }\\n                54% { opacity: 1; }\\n            }\\n            \\n            /* è¾¹æ¡†æµå…‰ */\\n            @keyframes border-flow {\\n                0% { background-position: 0% 50%; }\\n                50% { background-position: 100% 50%; }\\n                100% { background-position: 0% 50%; }\\n            }\\n            \\n            /* å¡ç‰‡ - èµ›åšæœ‹å…‹ç§‘æŠ€é¢æ¿ */\\n            .dnd-char-card {\\n                position: relative;\\n                animation: neon-flicker 4s ease-in-out infinite;\\n            }\\n            \\n            /* æ‰«æçº¿å åŠ å±‚ */\\n            .dnd-char-card::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background:\\n                    repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 243, 255, 0.03) 2px, rgba(0, 243, 255, 0.03) 4px),\\n                    repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(255, 0, 255, 0.02) 50px, rgba(255, 0, 255, 0.02) 51px);\\n                pointer-events: none;\\n                z-index: 2;\\n            }\\n            \\n            /* å¤–å‘å…‰è¾¹æ¡† */\\n            .dnd-char-card::after {\\n                content: \"\";\\n                position: absolute;\\n                top: -4px; left: -4px; right: -4px; bottom: -4px;\\n                background: linear-gradient(45deg, #00f3ff, #ff00ff, #ffff00, #00f3ff);\\n                background-size: 400% 400%;\\n                z-index: -1;\\n                opacity: 0.6;\\n                filter: blur(12px);\\n                animation: border-flow 5s ease infinite;\\n            }\\n            \\n            /* åŠ¨æ€æ‰«æçº¿ */\\n            .dnd-char-card > .dnd-card-body::after {\\n                content: \"\";\\n                position: absolute;\\n                left: 0; right: 0;\\n                height: 3px;\\n                background: linear-gradient(90deg, transparent, #00f3ff, transparent);\\n                opacity: 0.5;\\n                animation: scanline-sweep 3s linear infinite;\\n                pointer-events: none;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨ - å…¨æ¯æ ‡é¢˜æ  */\\n            .dnd-card-header::before {\\n                content: \"â—¢\";\\n                position: absolute;\\n                left: 8px; top: 50%;\\n                transform: translateY(-50%);\\n                color: #00f3ff;\\n                font-size: 12px;\\n                text-shadow: 0 0 10px #00f3ff;\\n                animation: hologram-flicker 2s infinite;\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \"â—£\";\\n                position: absolute;\\n                right: 8px; top: 50%;\\n                transform: translateY(-50%);\\n                color: #ff00ff;\\n                font-size: 12px;\\n                text-shadow: 0 0 10px #ff00ff;\\n                animation: hologram-flicker 2s infinite 0.5s;\\n            }\\n            \\n            /* å¯¼èˆªé¡¹ - éœ“è™¹æŒ‡ç¤ºç¯æ•ˆæœ */\\n            .dnd-nav-item::before {\\n                content: \"\";\\n                position: absolute;\\n                left: 0; top: 50%;\\n                transform: translateY(-50%);\\n                width: 4px; height: 0;\\n                background: linear-gradient(to bottom, #00f3ff, #ff00ff);\\n                box-shadow: 0 0 10px #00f3ff;\\n                transition: height 0.2s ease-out;\\n            }\\n            \\n            .dnd-nav-item:hover::before {\\n                height: 80%;\\n            }\\n            \\n            .dnd-nav-item.active::before {\\n                height: 100%;\\n                box-shadow: 0 0 20px #00f3ff, 0 0 40px #ff00ff;\\n            }\\n            \\n            .dnd-nav-item.active::after {\\n                content: \"â–¶\";\\n                position: absolute;\\n                right: 12px;\\n                color: #ffff00;\\n                font-size: 10px;\\n                text-shadow: 0 0 10px #ffff00;\\n                animation: hologram-flicker 1.5s infinite;\\n            }\\n            \\n            /* æŒ‰é’® - å…¨æ¯è§¦æ§åé¦ˆ */\\n            .dnd-btn::before,\\n            .dnd-action-btn::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: -100%;\\n                width: 100%; height: 100%;\\n                background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.4), transparent);\\n                transition: left 0.4s ease;\\n            }\\n            \\n            .dnd-btn:hover::before,\\n            .dnd-action-btn:hover::before {\\n                left: 100%;\\n            }\\n            \\n            .dnd-btn::after,\\n            .dnd-action-btn::after {\\n                content: \"\";\\n                position: absolute;\\n                bottom: 2px; left: 10%; right: 10%;\\n                height: 1px;\\n                background: linear-gradient(90deg, transparent, #00f3ff, transparent);\\n                opacity: 0;\\n                transition: opacity 0.3s;\\n            }\\n            \\n            .dnd-btn:hover::after,\\n            .dnd-action-btn:hover::after {\\n                opacity: 1;\\n            }\\n            \\n            /* è¿›åº¦æ¡ - æ•°æ®æµåŠ¨æ•ˆæœ */\\n            .dnd-bar-fill::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background: repeating-linear-gradient(\\n                    -45deg,\\n                    transparent,\\n                    transparent 5px,\\n                    rgba(255,255,255,0.1) 5px,\\n                    rgba(255,255,255,0.1) 10px\\n                );\\n                animation: data-flow 1s linear infinite;\\n            }\\n            \\n            /* åˆ†éš”çº¿ - éœ“è™¹çº¿ */\\n            .dnd-divider {\\n                height: 2px;\\n                background: linear-gradient(90deg, transparent, #ff00ff, #00f3ff, #ff00ff, transparent);\\n                box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);\\n                position: relative;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \"â—‡\";\\n                position: absolute;\\n                left: 50%; top: 50%;\\n                transform: translate(-50%, -50%);\\n                background: #050510;\\n                padding: 0 10px;\\n                color: #00f3ff;\\n                font-size: 10px;\\n                text-shadow: 0 0 10px #00f3ff;\\n            }\\n            \\n            /* é¢æ¿è§’è½è£…é¥° */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \"ã€Œ\";\\n                position: absolute;\\n                top: 5px; left: 8px;\\n                color: #00f3ff;\\n                font-size: 18px;\\n                text-shadow: 0 0 10px #00f3ff;\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \"ã€\";\\n                position: absolute;\\n                bottom: 5px; right: 8px;\\n                color: #ff00ff;\\n                font-size: 18px;\\n                text-shadow: 0 0 10px #ff00ff;\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - éœ“è™¹é£æ ¼ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 8px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: rgba(0, 0, 0, 0.8);\\n                border-left: 1px solid #ff00ff;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(to bottom, #ff00ff, #00f3ff);\\n                box-shadow: 0 0 10px #00f3ff;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(to bottom, #00f3ff, #ffff00);\\n                box-shadow: 0 0 15px #ffff00;\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - å…­è¾¹å½¢ */\\n            .dnd-icon-circle {\\n                clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);\\n                border: none;\\n                background: linear-gradient(135deg, rgba(0, 243, 255, 0.2), rgba(255, 0, 255, 0.2));\\n                box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);\\n            }\\n            \\n            /* å¤´åƒæ¡† - è±å½¢ */\\n            .dnd-avatar {\\n                clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);\\n                border: 2px solid #00f3ff;\\n                box-shadow: 0 0 20px rgba(0, 243, 255, 0.5), 0 0 40px rgba(255, 0, 255, 0.3);\\n            }\\n            \\n            /* æ•…éšœæ•ˆæœè§¦å‘ */\\n            .dnd-char-card:hover {\\n                animation: cyber-glitch 0.3s ease-in-out;\\n            }\\n            \\n            /* å·¥å…·æç¤º */\\n            .dnd-tooltip {\\n                background: rgba(5, 5, 16, 0.98);\\n                border: 1px solid #00f3ff;\\n                clip-path: polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px);\\n                box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);\\n            }\\n        ',background:{type:\"radar\",gridColor:\"rgba(0, 243, 255, 0.18)\",sweepColor:\"rgba(0, 243, 255, 0.35)\",accentColor:\"rgba(255, 0, 255, 0.2)\",speed:.025,gridSize:40,animated:!0}},\"gothic-horror\":{meta:{id:\"gothic-horror\",name:\"æš—é»‘å“¥ç‰¹\",icon:\"ğŸ§›\",description:\"æ·±é‚ƒå‹æŠ‘çš„è¡€è‰²é£æ ¼ï¼Œé€‚åˆææ€–æˆ˜å½¹\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#0a0a0a\",\"--dnd-bg-panel-start\":\"#1a0505\",\"--dnd-bg-panel-end\":\"#000000\",\"--dnd-text-main\":\"#b3b3b3\",\"--dnd-text-header\":\"#cc0000\",\"--dnd-text-dim\":\"#666666\",\"--dnd-text-highlight\":\"#ff3333\",\"--dnd-accent\":\"#8a0a0a\",\"--dnd-accent-hover\":\"#aa2020\",\"--dnd-border-gold\":\"#4d0000\",\"--dnd-border-inner\":\"#2a0000\",\"--dnd-bg-card-start\":\"#140a0a\",\"--dnd-bg-card-end\":\"#0a0505\",\"--dnd-btn-primary\":\"#3d0000\",\"--dnd-btn-primary-hover\":\"#5c0000\",\"--dnd-btn-text\":\"#cccccc\"},morphology:{border:{style:\"double\",width:\"4px\",outerStyle:\"none\"},corners:{style:\"sharp\",clipPath:\"none\"},card:{shape:\"gothic\",decoration:\"ornate\"},effects:{texture:\"fabric\",innerGlow:\"none\",borderGlow:\"evil\",overlay:\"blood-vignette\"},layout:{density:\"spacious\"},decorations:{headers:\"banner\",corners:\"flourish\"},buttons:{style:\"gothic\",shape:\"pointed\"},progressBars:{style:\"blood\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Cinzel\", \"Times New Roman\", serif',\"--dnd-font-size-header\":\"1.3rem\",\"--dnd-letter-spacing\":\"0.05em\"},animations:{\"--dnd-transition-fast\":\"0.15s ease-out\",\"--dnd-transition-normal\":\"0.3s ease-out\",\"--dnd-animation-pulse\":\"gothic-pulse 3s ease-in-out infinite\"},interactiveStates:{hover:{brightness:1.15,scale:1.02,lift:\"-4px\",shadow:\"0 12px 35px rgba(138, 10, 10, 0.5), 0 0 20px rgba(138, 10, 10, 0.3)\",borderColor:\"#8a0a0a\",glow:\"drop-shadow(0 0 8px rgba(138, 10, 10, 0.6))\",transition:\"0.3s cubic-bezier(0.25, 0.8, 0.25, 1)\"},cardHover:{transform:\"translateY(-8px) scale(1.02) rotateX(2deg)\",shadow:\"0 25px 50px rgba(0,0,0,0.8), 0 0 40px rgba(138, 10, 10, 0.4), inset 0 0 30px rgba(138, 10, 10, 0.1)\",borderColor:\"#cc0000\"},buttonHover:{brightness:1.3,transform:\"translateY(-3px) scale(1.03)\",shadow:\"0 8px 25px rgba(138, 10, 10, 0.6), 0 0 15px rgba(255, 0, 0, 0.4)\"},active:{scale:.95,brightness:.85,transform:\"translateY(2px) scale(0.95)\",shadow:\"0 2px 10px rgba(0,0,0,0.6), inset 0 0 10px rgba(0,0,0,0.3)\"},buttonActive:{transform:\"translateY(3px) scale(0.97)\",shadow:\"0 1px 5px rgba(0,0,0,0.5), inset 0 2px 5px rgba(0,0,0,0.3)\"},selected:{background:\"linear-gradient(90deg, rgba(138, 10, 10, 0.4), rgba(77, 0, 0, 0.2), transparent)\",borderColor:\"#ff3333\",borderWidth:\"2px\",glow:\"0 0 20px rgba(138, 10, 10, 0.5)\",textColor:\"#ff6666\"},navActive:{background:\"linear-gradient(90deg, rgba(138, 10, 10, 0.5), rgba(77, 0, 0, 0.3), transparent)\",border:\"3px solid #8a0a0a\",indicator:\"#cc0000\"},focus:{borderColor:\"#cc0000\",shadow:\"0 0 0 4px rgba(138, 10, 10, 0.3), 0 0 20px rgba(138, 10, 10, 0.2)\",outline:\"none\"},disabled:{opacity:.35,cursor:\"not-allowed\",filter:\"grayscale(0.7) brightness(0.5)\"},iconHover:{glow:\"drop-shadow(0 0 10px rgba(255, 0, 0, 0.8)) drop-shadow(0 0 20px rgba(138, 10, 10, 0.5))\",scale:1.2},inputFocus:{border:\"#8a0a0a\",shadow:\"0 0 15px rgba(138, 10, 10, 0.4), inset 0 0 10px rgba(138, 10, 10, 0.15)\"}},overrides:{\".dnd-char-card\":{border:\"3px double #4d0000\",\"border-radius\":\"0\",\"clip-path\":\"polygon(0 15px, 15px 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 0 100%)\",\"box-shadow\":\"0 10px 40px rgba(0,0,0,0.95), inset 0 0 60px rgba(138, 10, 10, 0.15), 0 0 30px rgba(138, 10, 10, 0.2)\",background:\"linear-gradient(180deg, #140a0a 0%, #0a0505 50%, #050202 100%)\"},\".dnd-card-header\":{\"border-bottom\":\"2px solid #4d0000\",background:\"linear-gradient(to right, rgba(138, 10, 10, 0.35), rgba(0,0,0,0.8), rgba(138, 10, 10, 0.35))\",padding:\"14px 18px\",position:\"relative\"},\".dnd-card-body\":{background:\"repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(138, 10, 10, 0.03) 40px, rgba(138, 10, 10, 0.03) 41px)\",padding:\"16px\"},\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, #1a0505 0%, #0a0202 100%)\",\"border-right\":\"3px solid #4d0000\",\"box-shadow\":\"5px 0 20px rgba(0,0,0,0.8)\"},\".dnd-nav-item\":{\"border-left\":\"4px solid transparent\",margin:\"2px 0\",padding:\"14px 20px\",background:\"rgba(138, 10, 10, 0.05)\",transition:\"all 0.3s ease-out\",\"clip-path\":\"polygon(0 0, calc(100% - 8px) 0, 100% 50%, calc(100% - 8px) 100%, 0 100%)\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, rgba(138, 10, 10, 0.3), rgba(77, 0, 0, 0.15))\",\"border-left-color\":\"#8a0a0a\",\"text-shadow\":\"0 0 8px rgba(255, 0, 0, 0.5)\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(138, 10, 10, 0.5), rgba(77, 0, 0, 0.25), transparent)\",\"box-shadow\":\"inset 4px 0 0 #cc0000, 0 0 25px rgba(138, 10, 10, 0.4)\",\"border-left-color\":\"#ff3333\"},\".dnd-bar-container\":{background:\"linear-gradient(180deg, rgba(0,0,0,0.9), rgba(20,5,5,0.8))\",border:\"1px solid #4d0000\",\"border-radius\":\"0\",height:\"10px\",\"box-shadow\":\"inset 0 2px 5px rgba(0,0,0,0.8)\"},\".dnd-bar-fill\":{background:\"linear-gradient(90deg, #3d0000 0%, #8a0a0a 40%, #cc0000 60%, #8a0a0a 80%, #3d0000 100%)\",\"box-shadow\":\"0 0 12px rgba(204, 0, 0, 0.6), inset 0 0 5px rgba(255, 100, 100, 0.3)\",\"border-radius\":\"0\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #2a0000 0%, #6a0000 40%, #aa0000 60%, #6a0000 80%, #2a0000 100%)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #200020 0%, #400040 40%, #600060 60%, #400040 80%, #200020 100%)\"},\".dnd-btn, .dnd-action-btn\":{\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.12em\",border:\"2px solid #4d0000\",background:\"linear-gradient(180deg, #2a0a0a 0%, #1a0505 50%, #0f0303 100%)\",\"box-shadow\":\"inset 0 1px 0 rgba(255,100,100,0.1), 0 4px 10px rgba(0,0,0,0.6)\",\"clip-path\":\"polygon(8px 0, calc(100% - 8px) 0, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px), 0 8px)\",\"font-family\":'\"Cinzel\", serif',position:\"relative\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{background:\"linear-gradient(180deg, #3d0a0a 0%, #2a0505 50%, #1a0303 100%)\",\"border-color\":\"#8a0a0a\",\"box-shadow\":\"0 0 20px rgba(138, 10, 10, 0.5), 0 6px 15px rgba(0,0,0,0.7)\"},\".dnd-btn:active, .dnd-action-btn:active\":{background:\"linear-gradient(180deg, #1a0505 0%, #0f0303 100%)\",\"box-shadow\":\"inset 0 3px 8px rgba(0,0,0,0.6)\"},\".dnd-stat-row\":{background:\"linear-gradient(90deg, rgba(77, 0, 0, 0.15), rgba(20, 10, 10, 0.3), rgba(77, 0, 0, 0.15))\",border:\"1px solid rgba(77, 0, 0, 0.4)\",\"border-top\":\"1px solid rgba(138, 10, 10, 0.3)\",\"border-radius\":\"0\",padding:\"8px 12px\",margin:\"3px 0\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(90deg, rgba(138, 10, 10, 0.25), rgba(20, 10, 10, 0.4), rgba(138, 10, 10, 0.25))\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 0 10px #ff0000, 0 0 25px rgba(255, 0, 0, 0.6), 0 2px 4px rgba(0,0,0,0.8)\",\"font-family\":'\"Cinzel\", serif',\"letter-spacing\":\"0.1em\"},\".dnd-panel, .dnd-dialog\":{border:\"3px double #4d0000\",\"border-radius\":\"0\",\"clip-path\":\"polygon(0 20px, 20px 0, calc(100% - 20px) 0, 100% 20px, 100% 100%, 0 100%)\",\"box-shadow\":\"0 15px 50px rgba(0,0,0,0.9), inset 0 0 80px rgba(138, 10, 10, 0.1)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"rgba(10, 5, 5, 0.9)\",border:\"1px solid #4d0000\",\"border-radius\":\"0\",color:\"#b3b3b3\"},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#8a0a0a\",\"box-shadow\":\"0 0 15px rgba(138, 10, 10, 0.4), inset 0 0 8px rgba(138, 10, 10, 0.15)\"},\".dnd-table\":{border:\"1px solid #4d0000\"},\".dnd-table th\":{background:\"linear-gradient(180deg, #2a0505, #1a0303)\",\"border-bottom\":\"2px solid #8a0a0a\",color:\"#ff3333\",\"letter-spacing\":\"0.08em\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(77, 0, 0, 0.4)\"},\".dnd-table tr:hover td\":{background:\"rgba(138, 10, 10, 0.15)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #4d0000, #2a0000)\",border:\"1px solid #8a0a0a\",\"border-radius\":\"0\",\"clip-path\":\"polygon(5px 0, 100% 0, 100% calc(100% - 5px), calc(100% - 5px) 100%, 0 100%, 0 5px)\"},\"#dnd-mini-hud\":{border:\"2px solid #4d0000\",\"border-radius\":\"0\",\"clip-path\":\"polygon(0 10px, 10px 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 0 100%)\",background:\"linear-gradient(180deg, rgba(26, 5, 5, 0.98), rgba(10, 2, 2, 1))\"}},customCSS:'\\n            /* ====== æš—é»‘å“¥ç‰¹çš®è‚¤ - ææ€–æ°›å›´åŠ¨ç”»ä¸è£…é¥° ====== */\\n            \\n            /* è¡€çº¢è„‰åŠ¨å…‰æ•ˆ */\\n            @keyframes gothic-pulse {\\n                0%, 100% {\\n                    box-shadow: 0 10px 40px rgba(0,0,0,0.95), inset 0 0 60px rgba(138, 10, 10, 0.15), 0 0 30px rgba(138, 10, 10, 0.2);\\n                    filter: brightness(1);\\n                }\\n                50% {\\n                    box-shadow: 0 10px 40px rgba(0,0,0,0.95), inset 0 0 80px rgba(138, 10, 10, 0.25), 0 0 50px rgba(138, 10, 10, 0.35);\\n                    filter: brightness(1.03);\\n                }\\n            }\\n            \\n            /* è¡€æ¶²æ»´è½åŠ¨ç”» */\\n            @keyframes blood-drip {\\n                0% { height: 0; opacity: 0; }\\n                10% { opacity: 1; }\\n                90% { opacity: 1; }\\n                100% { height: 30px; opacity: 0; }\\n            }\\n            \\n            /* é˜´å½±å‘¼å¸æ•ˆæœ */\\n            @keyframes shadow-breathe {\\n                0%, 100% { opacity: 0.4; transform: scale(1); }\\n                50% { opacity: 0.6; transform: scale(1.02); }\\n            }\\n            \\n            /* ææ€–é—ªçƒ */\\n            @keyframes horror-flicker {\\n                0%, 100% { opacity: 1; }\\n                92% { opacity: 1; }\\n                93% { opacity: 0.3; }\\n                94% { opacity: 1; }\\n                96% { opacity: 0.5; }\\n                97% { opacity: 1; }\\n            }\\n            \\n            /* è¡€çº¢è¾¹æ¡†æµåŠ¨ */\\n            @keyframes blood-flow {\\n                0% { background-position: 0% 0%; }\\n                100% { background-position: 200% 0%; }\\n            }\\n            \\n            /* å¡ç‰‡ - å“¥ç‰¹å¼ææ€–æ°›å›´ */\\n            .dnd-char-card {\\n                position: relative;\\n                animation: gothic-pulse 4s ease-in-out infinite;\\n            }\\n            \\n            /* è¡€è‰²æš—è§’å åŠ  */\\n            .dnd-char-card::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background: radial-gradient(ellipse at center, transparent 30%, rgba(0,0,0,0.5) 80%, rgba(0,0,0,0.8) 100%);\\n                pointer-events: none;\\n                z-index: 1;\\n            }\\n            \\n            /* è£…é¥°æ€§è£‚ç—•çº¹ç† */\\n            .dnd-char-card::after {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background:\\n                    linear-gradient(45deg, transparent 48%, rgba(77, 0, 0, 0.1) 49%, rgba(77, 0, 0, 0.1) 51%, transparent 52%),\\n                    linear-gradient(-45deg, transparent 48%, rgba(77, 0, 0, 0.1) 49%, rgba(77, 0, 0, 0.1) 51%, transparent 52%);\\n                background-size: 40px 40px;\\n                pointer-events: none;\\n                z-index: 0;\\n                opacity: 0.5;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨ - å°–é¡¶æ‹±é—¨è£…é¥° */\\n            .dnd-card-header::before {\\n                content: \"â€ \";\\n                position: absolute;\\n                left: 12px; top: 50%;\\n                transform: translateY(-50%);\\n                color: #8a0a0a;\\n                font-size: 16px;\\n                text-shadow: 0 0 10px rgba(138, 10, 10, 0.8);\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \"â€ \";\\n                position: absolute;\\n                right: 12px; top: 50%;\\n                transform: translateY(-50%);\\n                color: #8a0a0a;\\n                font-size: 16px;\\n                text-shadow: 0 0 10px rgba(138, 10, 10, 0.8);\\n            }\\n            \\n            /* å¯¼èˆªé¡¹ - è¡€è¿¹æŒ‡ç¤º */\\n            .dnd-nav-item::before {\\n                content: \"\";\\n                position: absolute;\\n                left: 0; top: 50%;\\n                transform: translateY(-50%);\\n                width: 4px; height: 0;\\n                background: linear-gradient(to bottom, #cc0000, #8a0a0a);\\n                transition: height 0.3s ease-out;\\n                box-shadow: 0 0 10px rgba(204, 0, 0, 0.5);\\n            }\\n            \\n            .dnd-nav-item:hover::before {\\n                height: 70%;\\n            }\\n            \\n            .dnd-nav-item.active::before {\\n                height: 100%;\\n                box-shadow: 0 0 15px rgba(204, 0, 0, 0.8);\\n            }\\n            \\n            .dnd-nav-item.active::after {\\n                content: \"â›§\";\\n                position: absolute;\\n                right: 12px;\\n                color: #cc0000;\\n                font-size: 12px;\\n                text-shadow: 0 0 8px rgba(204, 0, 0, 0.8);\\n                animation: horror-flicker 3s infinite;\\n            }\\n            \\n            /* æŒ‰é’® - çŸ³ç¢‘é›•åˆ»æ•ˆæœ */\\n            .dnd-btn::before,\\n            .dnd-action-btn::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 3px; left: 3px; right: 3px; bottom: 3px;\\n                border: 1px solid rgba(138, 10, 10, 0.2);\\n                pointer-events: none;\\n            }\\n            \\n            /* è¿›åº¦æ¡ - è¡€æ¶²æµåŠ¨æ•ˆæœ */\\n            .dnd-bar-fill {\\n                position: relative;\\n                overflow: hidden;\\n            }\\n            \\n            .dnd-bar-fill::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: -100%; width: 100%; height: 100%;\\n                background: linear-gradient(90deg, transparent, rgba(255, 100, 100, 0.3), transparent);\\n                animation: blood-flow 2s ease-in-out infinite;\\n            }\\n            \\n            /* åˆ†éš”çº¿ - é“æ …æ  */\\n            .dnd-divider {\\n                height: 3px;\\n                background:\\n                    linear-gradient(90deg, transparent, #4d0000 20%, #8a0a0a 50%, #4d0000 80%, transparent),\\n                    repeating-linear-gradient(90deg, transparent, transparent 10px, #2a0000 10px, #2a0000 11px);\\n                position: relative;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \"â˜ \";\\n                position: absolute;\\n                left: 50%; top: 50%;\\n                transform: translate(-50%, -50%);\\n                background: #0a0505;\\n                padding: 0 12px;\\n                color: #8a0a0a;\\n                font-size: 14px;\\n                text-shadow: 0 0 8px rgba(138, 10, 10, 0.6);\\n            }\\n            \\n            /* é¢æ¿è§’è½ - å“¥ç‰¹å¼è£…é¥° */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \"âšœ\";\\n                position: absolute;\\n                top: 8px; left: 10px;\\n                color: #4d0000;\\n                font-size: 16px;\\n                text-shadow: 0 0 5px rgba(77, 0, 0, 0.5);\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \"âšœ\";\\n                position: absolute;\\n                bottom: 8px; right: 10px;\\n                color: #4d0000;\\n                font-size: 16px;\\n                text-shadow: 0 0 5px rgba(77, 0, 0, 0.5);\\n                transform: rotate(180deg);\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - è¡€è¿¹é£æ ¼ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 10px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: #0a0505;\\n                border-left: 1px solid #4d0000;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(to bottom, #4d0000, #8a0a0a, #4d0000);\\n                border: 1px solid #2a0000;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(to bottom, #8a0a0a, #cc0000, #8a0a0a);\\n                box-shadow: 0 0 10px rgba(204, 0, 0, 0.5);\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - äº”èŠ’æ˜Ÿå½¢ */\\n            .dnd-icon-circle {\\n                clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);\\n                border: none;\\n                background: linear-gradient(135deg, #4d0000, #2a0000);\\n                box-shadow: 0 0 15px rgba(138, 10, 10, 0.5);\\n            }\\n            \\n            /* å¤´åƒæ¡† - æ£ºæå½¢ */\\n            .dnd-avatar {\\n                clip-path: polygon(20% 0%, 80% 0%, 100% 15%, 100% 85%, 80% 100%, 20% 100%, 0% 85%, 0% 15%);\\n                border: 2px solid #4d0000;\\n                box-shadow: 0 0 20px rgba(138, 10, 10, 0.4);\\n            }\\n            \\n            /* æ‚¬åœæ—¶çš„ææ€–æ•ˆæœ */\\n            .dnd-char-card:hover {\\n                animation: horror-flicker 0.5s ease-in-out;\\n            }\\n            \\n            /* å·¥å…·æç¤º - å¢“ç¢‘ */\\n            .dnd-tooltip {\\n                background: linear-gradient(180deg, #1a0505, #0a0303);\\n                border: 2px solid #4d0000;\\n                clip-path: polygon(0 10px, 10px 0, calc(100% - 10px) 0, 100% 10px, 100% 100%, 0 100%);\\n                box-shadow: 0 5px 20px rgba(0,0,0,0.8);\\n            }\\n        ',background:{type:\"particles\",colors:[\"rgba(138, 10, 10, 0.6)\",\"rgba(50, 0, 0, 0.8)\",\"rgba(20, 0, 0, 0.9)\"],minSize:1,maxSize:4,count:30,speed:.08,shape:\"circle\",glow:!0}},\"elven-forest\":{meta:{id:\"elven-forest\",name:\"ç²¾çµä¹‹æ£®\",icon:\"ğŸƒ\",description:\"æ¸…æ–°è‡ªç„¶çš„æ£®æ—é£æ ¼ï¼Œå¸¦æœ‰æœ¨è´¨çº¹ç†\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#1a261a\",\"--dnd-bg-panel-start\":\"#2d402d\",\"--dnd-bg-panel-end\":\"#1e2b1e\",\"--dnd-text-main\":\"#e0f2e0\",\"--dnd-text-header\":\"#aaddaa\",\"--dnd-text-highlight\":\"#ffffff\",\"--dnd-text-dim\":\"#8ba38b\",\"--dnd-accent\":\"#4caf50\",\"--dnd-accent-hover\":\"#66bb6a\",\"--dnd-border-gold\":\"#8a9a5b\",\"--dnd-border-inner\":\"#3e5c3e\",\"--dnd-bg-card-start\":\"rgba(45, 64, 45, 0.9)\",\"--dnd-bg-card-end\":\"rgba(30, 43, 30, 0.9)\",\"--dnd-btn-primary\":\"#2e7d32\",\"--dnd-btn-primary-hover\":\"#388e3c\",\"--dnd-btn-text\":\"#ffffff\"},morphology:{border:{style:\"solid\",width:\"2px\",outerStyle:\"none\"},corners:{style:\"organic\",clipPath:\"none\"},card:{shape:\"organic\",decoration:\"vines\"},effects:{texture:\"wood\",innerGlow:\"subtle\",borderGlow:\"none\",overlay:\"gradient\"},layout:{density:\"normal\"},decorations:{dividers:\"leaves\",corners:\"flourish\"},buttons:{style:\"leaf\",shape:\"rounded\"},progressBars:{style:\"nature\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Palatino Linotype\", \"Book Antiqua\", Palatino, serif',\"--dnd-font-size-base\":\"0.95rem\",\"--dnd-letter-spacing\":\"0.02em\"},animations:{\"--dnd-transition-fast\":\"0.2s ease-out\",\"--dnd-transition-normal\":\"0.35s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-animation-sway\":\"elven-sway 4s ease-in-out infinite\"},interactiveStates:{hover:{brightness:1.12,scale:1.02,lift:\"-4px\",shadow:\"0 10px 30px rgba(76, 175, 80, 0.25), 0 0 15px rgba(139, 195, 74, 0.2)\",borderColor:\"#8a9a5b\",glow:\"drop-shadow(0 0 6px rgba(76, 175, 80, 0.4))\",transition:\"0.35s cubic-bezier(0.4, 0, 0.2, 1)\"},cardHover:{transform:\"translateY(-6px) scale(1.015) rotate(-0.5deg)\",shadow:\"0 18px 40px rgba(30, 43, 30, 0.5), 0 0 25px rgba(76, 175, 80, 0.2)\",borderColor:\"#aaddaa\"},buttonHover:{brightness:1.2,transform:\"translateY(-2px) scale(1.03)\",shadow:\"0 6px 20px rgba(76, 175, 80, 0.4), 0 0 10px rgba(139, 195, 74, 0.3)\"},active:{scale:.97,brightness:.92,transform:\"translateY(1px) scale(0.97)\",shadow:\"0 2px 8px rgba(0,0,0,0.3)\"},buttonActive:{transform:\"translateY(2px) scale(0.98)\",shadow:\"0 1px 4px rgba(0,0,0,0.3), inset 0 1px 3px rgba(0,0,0,0.2)\"},selected:{background:\"linear-gradient(90deg, rgba(76, 175, 80, 0.25), rgba(139, 195, 74, 0.15), transparent)\",borderColor:\"#aaddaa\",borderWidth:\"2px\",glow:\"0 0 15px rgba(76, 175, 80, 0.3)\",textColor:\"#ffffff\"},navActive:{background:\"linear-gradient(90deg, rgba(76, 175, 80, 0.3), rgba(139, 195, 74, 0.15), transparent)\",border:\"3px solid #8a9a5b\",indicator:\"#4caf50\"},focus:{borderColor:\"#4caf50\",shadow:\"0 0 0 3px rgba(76, 175, 80, 0.25)\",outline:\"none\"},disabled:{opacity:.45,cursor:\"not-allowed\",filter:\"grayscale(0.6) brightness(0.7)\"},iconHover:{glow:\"drop-shadow(0 0 8px rgba(76, 175, 80, 0.7)) drop-shadow(0 0 15px rgba(139, 195, 74, 0.4))\",scale:1.15},inputFocus:{border:\"#4caf50\",shadow:\"0 0 12px rgba(76, 175, 80, 0.35), inset 0 0 8px rgba(76, 175, 80, 0.1)\"}},overrides:{\".dnd-char-card\":{\"border-radius\":\"25px 8px 25px 8px\",border:\"2px solid #3e5c3e\",\"box-shadow\":\"0 8px 30px rgba(30, 43, 30, 0.5), inset 0 0 40px rgba(76, 175, 80, 0.08), 0 0 20px rgba(139, 195, 74, 0.1)\",background:\"linear-gradient(135deg, rgba(45, 64, 45, 0.95) 0%, rgba(35, 50, 35, 0.97) 50%, rgba(30, 43, 30, 0.98) 100%)\"},\".dnd-card-header\":{\"border-bottom\":\"2px solid #3e5c3e\",background:\"linear-gradient(to right, rgba(76, 175, 80, 0.2), rgba(62, 92, 62, 0.15), rgba(139, 195, 74, 0.15))\",\"border-radius\":\"23px 6px 0 0\",padding:\"14px 18px\",position:\"relative\"},\".dnd-card-body\":{background:\"radial-gradient(ellipse at bottom right, rgba(76, 175, 80, 0.05), transparent 70%)\",padding:\"16px\"},\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, #2d402d 0%, #1e2b1e 100%)\",\"border-right\":\"3px solid #3e5c3e\",\"box-shadow\":\"3px 0 15px rgba(30, 43, 30, 0.4)\"},\".dnd-nav-item\":{\"border-radius\":\"0 20px 20px 0\",margin:\"4px 0\",padding:\"12px 20px\",\"border-left\":\"4px solid transparent\",background:\"rgba(76, 175, 80, 0.03)\",transition:\"all 0.35s cubic-bezier(0.4, 0, 0.2, 1)\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.1), transparent)\",\"border-left-color\":\"#8bc34a\",\"padding-left\":\"24px\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(76, 175, 80, 0.3), rgba(139, 195, 74, 0.15), transparent)\",\"border-left-color\":\"#4caf50\",\"box-shadow\":\"inset 4px 0 0 #8bc34a, 0 0 20px rgba(76, 175, 80, 0.25)\",\"border-radius\":\"0 20px 20px 0\"},\".dnd-bar-container\":{background:\"linear-gradient(180deg, rgba(30, 43, 30, 0.8), rgba(45, 64, 45, 0.6))\",border:\"1px solid #3e5c3e\",\"border-radius\":\"10px\",height:\"10px\",\"box-shadow\":\"inset 0 1px 4px rgba(0,0,0,0.4)\"},\".dnd-bar-fill\":{background:\"linear-gradient(90deg, #2e7d32 0%, #4caf50 40%, #8bc34a 70%, #4caf50 100%)\",\"box-shadow\":\"0 0 10px rgba(76, 175, 80, 0.5), inset 0 1px 0 rgba(255,255,255,0.2)\",\"border-radius\":\"8px\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #1b5e20 0%, #2e7d32 40%, #43a047 70%, #2e7d32 100%)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #33691e 0%, #558b2f 40%, #7cb342 70%, #558b2f 100%)\"},\".dnd-btn, .dnd-action-btn\":{border:\"2px solid #3e5c3e\",background:\"linear-gradient(135deg, #2d402d 0%, #243424 100%)\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.1), 0 3px 8px rgba(0,0,0,0.3)\",\"border-radius\":\"20px 8px 20px 8px\",\"font-family\":'\"Palatino Linotype\", serif',position:\"relative\",overflow:\"hidden\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{background:\"linear-gradient(135deg, #3d503d 0%, #2d402d 100%)\",\"border-color\":\"#4caf50\",\"box-shadow\":\"0 0 15px rgba(76, 175, 80, 0.3), 0 5px 12px rgba(0,0,0,0.4)\"},\".dnd-btn:active, .dnd-action-btn:active\":{background:\"linear-gradient(135deg, #243424 0%, #1a261a 100%)\",\"box-shadow\":\"inset 0 2px 4px rgba(0,0,0,0.3)\"},\".dnd-stat-row\":{background:\"linear-gradient(90deg, rgba(76, 175, 80, 0.1), rgba(62, 92, 62, 0.15), rgba(76, 175, 80, 0.08))\",border:\"1px solid rgba(62, 92, 62, 0.3)\",\"border-radius\":\"12px 4px 12px 4px\",padding:\"8px 12px\",margin:\"4px 0\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(90deg, rgba(76, 175, 80, 0.18), rgba(62, 92, 62, 0.2), rgba(76, 175, 80, 0.15))\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 2px 10px rgba(76, 175, 80, 0.4), 0 0 20px rgba(139, 195, 74, 0.2)\",\"font-family\":'\"Palatino Linotype\", \"Book Antiqua\", serif',\"letter-spacing\":\"0.05em\"},\".dnd-panel, .dnd-dialog\":{border:\"2px solid #3e5c3e\",\"border-radius\":\"30px 10px 30px 10px\",\"box-shadow\":\"0 10px 40px rgba(30, 43, 30, 0.6), inset 0 0 50px rgba(76, 175, 80, 0.05)\"},\"#dnd-mini-hud\":{border:\"2px solid #3e5c3e\",\"border-radius\":\"20px 6px 20px 6px\",background:\"linear-gradient(180deg, rgba(45, 64, 45, 0.98), rgba(30, 43, 30, 0.99))\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"rgba(30, 43, 30, 0.8)\",border:\"1px solid #3e5c3e\",\"border-radius\":\"12px 4px 12px 4px\",color:\"#e0f2e0\"},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#4caf50\",\"box-shadow\":\"0 0 12px rgba(76, 175, 80, 0.4), inset 0 0 6px rgba(76, 175, 80, 0.1)\"},\".dnd-table th\":{background:\"linear-gradient(180deg, #2d402d, #243424)\",\"border-bottom\":\"2px solid #4caf50\",color:\"#aaddaa\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(62, 92, 62, 0.3)\"},\".dnd-table tr:hover td\":{background:\"rgba(76, 175, 80, 0.1)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #3e5c3e, #2d402d)\",border:\"1px solid #4caf50\",\"border-radius\":\"15px 5px 15px 5px\"}},customCSS:\"\\n            /* ====== ç²¾çµä¹‹æ£®çš®è‚¤ - è‡ªç„¶æœ‰æœºåŠ¨ç”»ä¸è£…é¥° ====== */\\n            \\n            /* è½»æŸ”æ‘‡æ‘†åŠ¨ç”» */\\n            @keyframes elven-sway {\\n                0%, 100% { transform: rotate(0deg) translateY(0); }\\n                25% { transform: rotate(0.5deg) translateY(-1px); }\\n                50% { transform: rotate(0deg) translateY(0); }\\n                75% { transform: rotate(-0.5deg) translateY(-1px); }\\n            }\\n            \\n            /* å¶ç‰‡é£˜è½åŠ¨ç”» */\\n            @keyframes leaf-fall {\\n                0% { transform: translateY(-10px) rotate(0deg); opacity: 0; }\\n                10% { opacity: 1; }\\n                100% { transform: translateY(100px) rotate(360deg); opacity: 0; }\\n            }\\n            \\n            /* è¤ç«è™«å…‰æ•ˆ */\\n            @keyframes firefly-glow {\\n                0%, 100% { opacity: 0.3; box-shadow: 0 0 5px rgba(200, 230, 100, 0.5); }\\n                50% { opacity: 1; box-shadow: 0 0 15px rgba(200, 230, 100, 0.8); }\\n            }\\n            \\n            /* è—¤è”“ç”Ÿé•¿åŠ¨ç”» */\\n            @keyframes vine-grow {\\n                0% { width: 0; }\\n                100% { width: 100%; }\\n            }\\n            \\n            /* éœ²ç é—ªçƒ */\\n            @keyframes dewdrop-sparkle {\\n                0%, 100% { opacity: 0.5; transform: scale(1); }\\n                50% { opacity: 1; transform: scale(1.2); }\\n            }\\n            \\n            /* å¡ç‰‡ - æ£®æ—æ ‘å¶å½¢æ€ */\\n            .dnd-char-card {\\n                position: relative;\\n                animation: elven-sway 6s ease-in-out infinite;\\n            }\\n            \\n            /* å¤–å‘å…‰è¾¹æ¡† - è‡ªç„¶å…‰æ™• */\\n            .dnd-char-card::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: -3px; left: -3px; right: -3px; bottom: -3px;\\n                background: linear-gradient(135deg, rgba(76, 175, 80, 0.4) 0%, transparent 25%, transparent 75%, rgba(139, 195, 74, 0.3) 100%);\\n                border-radius: 27px 10px 27px 10px;\\n                pointer-events: none;\\n                z-index: -1;\\n                filter: blur(3px);\\n            }\\n            \\n            /* æœ¨çº¹/æ ‘çš®çº¹ç†å åŠ  */\\n            .dnd-char-card::after {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background: url(\\\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='wood'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.02 0.08' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23wood)' opacity='0.04'/%3E%3C/svg%3E\\\");\\n                pointer-events: none;\\n                border-radius: inherit;\\n                z-index: 0;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨ - æ ‘æè£…é¥° */\\n            .dnd-card-header::before {\\n                content: \\\"â§\\\";\\n                position: absolute;\\n                left: 12px; top: 50%;\\n                transform: translateY(-50%);\\n                color: #4caf50;\\n                font-size: 14px;\\n                opacity: 0.6;\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \\\"â§\\\";\\n                position: absolute;\\n                right: 12px; top: 50%;\\n                transform: translateY(-50%) scaleX(-1);\\n                color: #8bc34a;\\n                font-size: 14px;\\n                opacity: 0.6;\\n            }\\n            \\n            /* å¯¼èˆªé¡¹ - è—¤è”“å»¶ä¼¸æ•ˆæœ */\\n            .dnd-nav-item::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                left: 0; top: 50%;\\n                transform: translateY(-50%);\\n                width: 0; height: 3px;\\n                background: linear-gradient(90deg, #4caf50, #8bc34a);\\n                transition: width 0.3s ease-out;\\n                border-radius: 0 3px 3px 0;\\n            }\\n            \\n            .dnd-nav-item:hover::before {\\n                width: 20px;\\n            }\\n            \\n            .dnd-nav-item.active::before {\\n                width: 30px;\\n                box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);\\n            }\\n            \\n            .dnd-nav-item.active::after {\\n                content: \\\"ğŸƒ\\\";\\n                position: absolute;\\n                right: 12px;\\n                font-size: 12px;\\n                animation: elven-sway 3s ease-in-out infinite;\\n            }\\n            \\n            /* æŒ‰é’® - å¶è„‰çº¹ç† */\\n            .dnd-btn::before,\\n            .dnd-action-btn::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 50%; left: 10%;\\n                width: 80%; height: 1px;\\n                background: linear-gradient(90deg, transparent, rgba(139, 195, 74, 0.3), transparent);\\n                opacity: 0;\\n                transition: opacity 0.3s;\\n            }\\n            \\n            .dnd-btn:hover::before,\\n            .dnd-action-btn:hover::before {\\n                opacity: 1;\\n            }\\n            \\n            /* è¿›åº¦æ¡ - ç”Ÿé•¿åŠ¨ç”» */\\n            .dnd-bar-fill {\\n                position: relative;\\n                overflow: hidden;\\n            }\\n            \\n            .dnd-bar-fill::before {\\n                content: \\\"\\\";\\n                position: absolute;\\n                top: 0; left: -50%; width: 50%; height: 100%;\\n                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);\\n                animation: vine-grow 2s ease-in-out infinite;\\n            }\\n            \\n            /* åˆ†éš”çº¿ - è—¤è”“ */\\n            .dnd-divider {\\n                height: 2px;\\n                background: linear-gradient(90deg, transparent, #3e5c3e, #4caf50, #8bc34a, #4caf50, #3e5c3e, transparent);\\n                position: relative;\\n                margin: 12px 0;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \\\"âœ¿\\\";\\n                position: absolute;\\n                left: 50%; top: 50%;\\n                transform: translate(-50%, -50%);\\n                background: #1e2b1e;\\n                padding: 0 10px;\\n                color: #4caf50;\\n                font-size: 12px;\\n            }\\n            \\n            /* é¢æ¿è§’è½ - æ ‘å¶è£…é¥° */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \\\"ğŸŒ¿\\\";\\n                position: absolute;\\n                top: 8px; left: 10px;\\n                font-size: 14px;\\n                opacity: 0.6;\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \\\"ğŸŒ¿\\\";\\n                position: absolute;\\n                bottom: 8px; right: 10px;\\n                font-size: 14px;\\n                opacity: 0.6;\\n                transform: rotate(180deg);\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - æ ‘å¹²é£æ ¼ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 10px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: rgba(30, 43, 30, 0.5);\\n                border-left: 1px solid #3e5c3e;\\n                border-radius: 5px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(to bottom, #3e5c3e, #4caf50, #3e5c3e);\\n                border-radius: 5px;\\n                border: 1px solid #2d402d;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(to bottom, #4caf50, #8bc34a, #4caf50);\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - èŠ±æœµå½¢ */\\n            .dnd-icon-circle {\\n                border-radius: 50%;\\n                border: 2px solid #4caf50;\\n                background: radial-gradient(circle at 30% 30%, #3e5c3e, #2d402d);\\n                box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);\\n            }\\n            \\n            /* å¤´åƒæ¡† - æœ‰æœºä¸è§„åˆ™å½¢ */\\n            .dnd-avatar {\\n                border-radius: 60% 40% 50% 50% / 50% 50% 40% 60%;\\n                border: 2px solid #4caf50;\\n                box-shadow: 0 0 15px rgba(76, 175, 80, 0.3), 0 0 30px rgba(139, 195, 74, 0.15);\\n            }\\n            \\n            /* å·¥å…·æç¤º */\\n            .dnd-tooltip {\\n                background: linear-gradient(135deg, #2d402d, #1e2b1e);\\n                border: 1px solid #4caf50;\\n                border-radius: 15px 5px 15px 5px;\\n                box-shadow: 0 5px 20px rgba(30, 43, 30, 0.6);\\n            }\\n            \\n            /* æ‚¬æµ®å…‰æ•ˆ */\\n            .dnd-char-card:hover {\\n                box-shadow: 0 12px 40px rgba(30, 43, 30, 0.6), inset 0 0 50px rgba(76, 175, 80, 0.1), 0 0 30px rgba(139, 195, 74, 0.2);\\n            }\\n        \",background:{type:\"particles\",colors:[\"rgba(76, 175, 80, 0.5)\",\"rgba(139, 195, 74, 0.4)\",\"rgba(255, 255, 255, 0.4)\",\"rgba(200, 230, 200, 0.3)\"],minSize:2,maxSize:6,count:25,speed:.05,shape:\"circle\",glow:!0}},\"dwarven-forge\":{meta:{id:\"dwarven-forge\",name:\"çŸ®äººé”»ç‚‰\",icon:\"âš’ï¸\",description:\"åšå›ºç¡¬æœ—çš„é‡‘å±é£æ ¼ï¼Œä»¿ä½›åˆšå‡ºç‚‰çš„å…µå™¨\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#1c1c1c\",\"--dnd-bg-panel-start\":\"#2b2b2b\",\"--dnd-bg-panel-end\":\"#1f1f1f\",\"--dnd-text-main\":\"#dcdcdc\",\"--dnd-text-header\":\"#ffaa00\",\"--dnd-text-highlight\":\"#ffcc00\",\"--dnd-text-dim\":\"#909090\",\"--dnd-accent\":\"#ff9800\",\"--dnd-accent-hover\":\"#ffb74d\",\"--dnd-border-gold\":\"#cd7f32\",\"--dnd-border-inner\":\"#555555\",\"--dnd-bg-card-start\":\"#333333\",\"--dnd-bg-card-end\":\"#262626\",\"--dnd-btn-primary\":\"#e65100\",\"--dnd-btn-primary-hover\":\"#f57c00\",\"--dnd-btn-text\":\"#ffffff\"},morphology:{border:{style:\"groove\",width:\"4px\",outerStyle:\"none\"},corners:{style:\"chamfer\",clipPath:\"polygon(8px 0, 100% 0, 100% calc(100% - 8px), calc(100% - 8px) 100%, 0 100%, 0 8px)\"},card:{shape:\"blocky\",decoration:\"rivets\"},effects:{texture:\"metal\",innerGlow:\"none\",borderGlow:\"gold\",overlay:\"none\"},layout:{density:\"compact\"},decorations:{corners:\"bolts\",dividers:\"bars\"},buttons:{style:\"metallic\",shape:\"chamfer\"},progressBars:{style:\"molten\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Trebuchet MS\", Arial, sans-serif',\"--dnd-font-size-header\":\"1.1rem\",\"--dnd-font-weight-header\":\"700\",\"--dnd-letter-spacing\":\"0.03em\"},animations:{\"--dnd-transition-fast\":\"0.15s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-transition-normal\":\"0.25s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-animation-forge\":\"forge-glow 2s ease-in-out infinite\"},interactiveStates:{hover:{brightness:1.15,scale:1.01,lift:\"-2px\",shadow:\"0 6px 20px rgba(255, 152, 0, 0.3), 0 0 10px rgba(205, 127, 50, 0.4)\",borderColor:\"#cd7f32\",glow:\"drop-shadow(0 0 5px rgba(255, 152, 0, 0.5))\",transition:\"0.2s cubic-bezier(0.4, 0, 0.2, 1)\"},cardHover:{transform:\"translateY(-4px) scale(1.01)\",shadow:\"0 12px 30px rgba(0,0,0,0.6), 0 0 20px rgba(255, 152, 0, 0.25), inset 0 1px 0 rgba(255,255,255,0.1)\",borderColor:\"#ffaa00\"},buttonHover:{brightness:1.25,transform:\"translateY(-2px) scale(1.02)\",shadow:\"0 6px 18px rgba(230, 81, 0, 0.5), 0 0 8px rgba(255, 152, 0, 0.4), inset 0 1px 0 rgba(255,255,255,0.2)\"},active:{scale:.98,brightness:.9,transform:\"translateY(2px) scale(0.98)\",shadow:\"inset 0 3px 8px rgba(0,0,0,0.5), 0 1px 2px rgba(0,0,0,0.3)\"},buttonActive:{transform:\"translateY(2px) scale(0.97)\",shadow:\"inset 0 3px 10px rgba(0,0,0,0.6), 0 0 0 1px rgba(0,0,0,0.3)\"},selected:{background:\"linear-gradient(90deg, rgba(255, 152, 0, 0.3), rgba(205, 127, 50, 0.2), transparent)\",borderColor:\"#ffcc00\",borderWidth:\"3px\",glow:\"0 0 15px rgba(255, 152, 0, 0.4)\",textColor:\"#ffcc00\"},navActive:{background:\"linear-gradient(90deg, rgba(255, 152, 0, 0.35), rgba(205, 127, 50, 0.2), transparent)\",border:\"3px solid #cd7f32\",indicator:\"#ff9800\"},focus:{borderColor:\"#ff9800\",shadow:\"0 0 0 3px rgba(255, 152, 0, 0.3)\",outline:\"none\"},disabled:{opacity:.4,cursor:\"not-allowed\",filter:\"grayscale(0.6) brightness(0.6)\"},iconHover:{glow:\"drop-shadow(0 0 6px rgba(255, 170, 0, 0.8)) drop-shadow(0 0 12px rgba(205, 127, 50, 0.5))\",scale:1.12},inputFocus:{border:\"#cd7f32\",shadow:\"0 0 10px rgba(205, 127, 50, 0.4), inset 0 1px 3px rgba(0,0,0,0.3)\"}},overrides:{\".dnd-char-card\":{\"box-shadow\":\"inset 0 0 10px rgba(0,0,0,0.9), 5px 5px 0px rgba(0,0,0,0.6), 0 0 20px rgba(205, 127, 50, 0.2)\",border:\"4px solid #555\",\"border-radius\":\"0\",\"clip-path\":\"polygon(10px 0, calc(100% - 10px) 0, 100% 10px, 100% calc(100% - 10px), calc(100% - 10px) 100%, 10px 100%, 0 calc(100% - 10px), 0 10px)\",background:\"linear-gradient(135deg, #404040 0%, #2e2e2e 30%, #282828 70%, #222222 100%)\"},\".dnd-card-header\":{background:\"linear-gradient(180deg, #454545 0%, #353535 50%, #303030 100%)\",\"border-bottom\":\"4px solid #cd7f32\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.1), inset 0 -2px 0 rgba(0,0,0,0.3), 0 2px 5px rgba(0,0,0,0.4)\",padding:\"14px 18px\",position:\"relative\"},\".dnd-card-body\":{background:\"repeating-linear-gradient(90deg, transparent, transparent 4px, rgba(0,0,0,0.1) 4px, rgba(0,0,0,0.1) 5px)\",padding:\"16px\"},\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, #2b2b2b 0%, #1f1f1f 100%)\",\"border-right\":\"4px solid #555\",\"box-shadow\":\"4px 0 10px rgba(0,0,0,0.5)\"},\".dnd-nav-item\":{\"clip-path\":\"polygon(0 0, calc(100% - 6px) 0, 100% 6px, 100% calc(100% - 6px), calc(100% - 6px) 100%, 0 100%)\",margin:\"3px 0\",padding:\"12px 20px\",\"border-left\":\"5px solid transparent\",background:\"linear-gradient(90deg, rgba(85, 85, 85, 0.3), transparent)\",transition:\"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, rgba(255, 152, 0, 0.2), rgba(205, 127, 50, 0.1), transparent)\",\"border-left-color\":\"#cd7f32\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(255, 152, 0, 0.35), rgba(205, 127, 50, 0.2), transparent)\",\"box-shadow\":\"inset 5px 0 0 #ff9800, 0 0 15px rgba(255, 152, 0, 0.25)\",\"border-left-color\":\"#ffaa00\"},\".dnd-bar-container\":{background:\"linear-gradient(180deg, #1a1a1a, #252525, #1a1a1a)\",border:\"2px solid #555\",\"border-radius\":\"0\",height:\"14px\",\"box-shadow\":\"inset 0 2px 5px rgba(0,0,0,0.8), 0 1px 0 rgba(255,255,255,0.05)\"},\".dnd-bar-fill\":{background:\"linear-gradient(90deg, #8B0000 0%, #bf360c 20%, #e65100 40%, #ff9800 60%, #ffb74d 80%, #ff9800 100%)\",\"background-size\":\"200% 100%\",\"box-shadow\":\"0 0 15px rgba(255, 152, 0, 0.6), inset 0 0 8px rgba(255, 200, 100, 0.4)\",\"border-radius\":\"0\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #4a0000 0%, #7a0000 30%, #aa2020 60%, #7a0000 100%)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #1a237e 0%, #303f9f 30%, #5c6bc0 60%, #303f9f 100%)\"},\".dnd-btn, .dnd-action-btn\":{background:\"linear-gradient(180deg, #505050 0%, #3a3a3a 40%, #2a2a2a 100%)\",border:\"3px solid #555\",\"border-radius\":\"0\",\"clip-path\":\"polygon(6px 0, calc(100% - 6px) 0, 100% 6px, 100% calc(100% - 6px), calc(100% - 6px) 100%, 6px 100%, 0 calc(100% - 6px), 0 6px)\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.15), inset 0 -1px 0 rgba(0,0,0,0.3), 0 3px 6px rgba(0,0,0,0.4)\",\"font-family\":'\"Trebuchet MS\", sans-serif',\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.05em\",position:\"relative\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{background:\"linear-gradient(180deg, #606060 0%, #4a4a4a 40%, #3a3a3a 100%)\",\"border-color\":\"#cd7f32\",\"box-shadow\":\"0 0 15px rgba(255, 152, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.2), 0 4px 10px rgba(0,0,0,0.5)\"},\".dnd-btn:active, .dnd-action-btn:active\":{background:\"linear-gradient(180deg, #2a2a2a 0%, #1f1f1f 100%)\",\"box-shadow\":\"inset 0 3px 8px rgba(0,0,0,0.6)\"},\".dnd-stat-row\":{background:\"linear-gradient(180deg, rgba(60, 60, 60, 0.5), rgba(40, 40, 40, 0.6))\",border:\"1px solid #444\",\"border-top-color\":\"#555\",\"border-radius\":\"0\",padding:\"8px 12px\",margin:\"3px 0\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.05), inset 0 -1px 2px rgba(0,0,0,0.3)\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(180deg, rgba(80, 80, 80, 0.5), rgba(60, 60, 60, 0.6))\",\"border-color\":\"#cd7f32\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 2px 4px rgba(0,0,0,0.6), 0 0 15px rgba(255, 152, 0, 0.4), 0 0 30px rgba(205, 127, 50, 0.2)\",\"font-family\":'\"Trebuchet MS\", Arial, sans-serif',\"letter-spacing\":\"0.08em\"},\".dnd-panel, .dnd-dialog\":{border:\"4px solid #555\",\"border-radius\":\"0\",\"clip-path\":\"polygon(15px 0, calc(100% - 15px) 0, 100% 15px, 100% calc(100% - 15px), calc(100% - 15px) 100%, 15px 100%, 0 calc(100% - 15px), 0 15px)\",\"box-shadow\":\"5px 5px 0 rgba(0,0,0,0.5), inset 0 0 50px rgba(0,0,0,0.3)\"},\"#dnd-mini-hud\":{border:\"3px solid #555\",\"border-radius\":\"0\",\"clip-path\":\"polygon(8px 0, calc(100% - 8px) 0, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0 calc(100% - 8px), 0 8px)\",background:\"linear-gradient(180deg, #2b2b2b 0%, #1f1f1f 100%)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"#1a1a1a\",border:\"2px solid #555\",\"border-radius\":\"0\",color:\"#dcdcdc\",\"box-shadow\":\"inset 0 2px 4px rgba(0,0,0,0.5)\"},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#cd7f32\",\"box-shadow\":\"0 0 10px rgba(205, 127, 50, 0.3), inset 0 2px 4px rgba(0,0,0,0.5)\"},\".dnd-table\":{border:\"2px solid #555\"},\".dnd-table th\":{background:\"linear-gradient(180deg, #404040, #303030)\",\"border-bottom\":\"3px solid #cd7f32\",color:\"#ffaa00\",\"text-transform\":\"uppercase\"},\".dnd-table td\":{\"border-bottom\":\"1px solid #444\"},\".dnd-table tr:hover td\":{background:\"rgba(255, 152, 0, 0.1)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #555, #333)\",border:\"2px solid #cd7f32\",\"border-radius\":\"0\",\"clip-path\":\"polygon(4px 0, 100% 0, 100% calc(100% - 4px), calc(100% - 4px) 100%, 0 100%, 0 4px)\"}},customCSS:'\\n            /* ====== çŸ®äººé”»ç‚‰çš®è‚¤ - å·¥ä¸šé‡‘å±åŠ¨ç”»ä¸è£…é¥° ====== */\\n            \\n            /* ç†”ç‚‰è„‰åŠ¨å…‰æ•ˆ */\\n            @keyframes forge-glow {\\n                0%, 100% {\\n                    box-shadow: inset 0 0 10px rgba(0,0,0,0.9), 5px 5px 0px rgba(0,0,0,0.6), 0 0 20px rgba(205, 127, 50, 0.2);\\n                    filter: brightness(1);\\n                }\\n                50% {\\n                    box-shadow: inset 0 0 10px rgba(0,0,0,0.9), 5px 5px 0px rgba(0,0,0,0.6), 0 0 35px rgba(255, 152, 0, 0.4);\\n                    filter: brightness(1.02);\\n                }\\n            }\\n            \\n            /* ç†”å²©æµåŠ¨åŠ¨ç”» */\\n            @keyframes molten-flow {\\n                0% { background-position: 0% 50%; }\\n                100% { background-position: 200% 50%; }\\n            }\\n            \\n            /* ç«èŠ±é£æº… */\\n            @keyframes spark-fly {\\n                0% { transform: translateY(0) scale(1); opacity: 1; }\\n                100% { transform: translateY(-30px) scale(0); opacity: 0; }\\n            }\\n            \\n            /* é”¤å‡»éœ‡åŠ¨ */\\n            @keyframes hammer-shake {\\n                0%, 100% { transform: translateX(0); }\\n                25% { transform: translateX(-2px); }\\n                75% { transform: translateX(2px); }\\n            }\\n            \\n            /* é‡‘å±å…‰æ³½é—ªåŠ¨ */\\n            @keyframes metal-shine {\\n                0% { left: -100%; }\\n                50%, 100% { left: 100%; }\\n            }\\n            \\n            /* å¡ç‰‡ - é‡‘å±é¢æ¿æ•ˆæœ */\\n            .dnd-char-card {\\n                position: relative;\\n                animation: forge-glow 3s ease-in-out infinite;\\n            }\\n            \\n            /* é‡‘å±é«˜å…‰çº¿ */\\n            .dnd-char-card::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0;\\n                height: 3px;\\n                background: linear-gradient(90deg, transparent 20%, rgba(255, 200, 100, 0.4) 50%, transparent 80%);\\n                pointer-events: none;\\n                z-index: 10;\\n            }\\n            \\n            /* å››è§’é“†é’‰è£…é¥° */\\n            .dnd-char-card::after {\\n                content: \"\";\\n                position: absolute;\\n                top: 8px; left: 8px;\\n                width: 12px; height: 12px;\\n                background: radial-gradient(circle at 30% 30%, #777 0%, #555 40%, #333 100%);\\n                border-radius: 50%;\\n                border: 1px solid #666;\\n                box-shadow:\\n                    calc(100% - 28px) 0 0 0 #555,\\n                    0 calc(100% - 28px) 0 0 #555,\\n                    calc(100% - 28px) calc(100% - 28px) 0 0 #555,\\n                    inset 0 -1px 2px rgba(0,0,0,0.5),\\n                    inset 0 1px 1px rgba(255,255,255,0.2);\\n                pointer-events: none;\\n                z-index: 10;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨ - é“æ¿æ ‡é¢˜æ  */\\n            .dnd-card-header::before {\\n                content: \"âš’\";\\n                position: absolute;\\n                left: 14px; top: 50%;\\n                transform: translateY(-50%);\\n                color: #cd7f32;\\n                font-size: 14px;\\n                text-shadow: 0 0 5px rgba(205, 127, 50, 0.5);\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \"\";\\n                position: absolute;\\n                right: 14px; top: 50%;\\n                transform: translateY(-50%);\\n                width: 30px; height: 6px;\\n                background: repeating-linear-gradient(90deg, #cd7f32, #cd7f32 4px, transparent 4px, transparent 8px);\\n            }\\n            \\n            /* å¯¼èˆªé¡¹ - é‡‘å±æ ‡ç­¾ */\\n            .dnd-nav-item::before {\\n                content: \"\";\\n                position: absolute;\\n                left: 0; top: 50%;\\n                transform: translateY(-50%);\\n                width: 5px; height: 0;\\n                background: linear-gradient(to bottom, #ff9800, #cd7f32);\\n                transition: height 0.2s ease-out;\\n            }\\n            \\n            .dnd-nav-item:hover::before {\\n                height: 60%;\\n            }\\n            \\n            .dnd-nav-item.active::before {\\n                height: 80%;\\n                box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);\\n            }\\n            \\n            .dnd-nav-item.active::after {\\n                content: \"â–¸\";\\n                position: absolute;\\n                right: 12px;\\n                color: #ffaa00;\\n                font-size: 14px;\\n            }\\n            \\n            /* æŒ‰é’® - é”»é€ æŒ‰å‹æ•ˆæœ */\\n            .dnd-btn::before,\\n            .dnd-action-btn::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: -100%;\\n                width: 50%; height: 100%;\\n                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);\\n                transition: left 0.4s;\\n            }\\n            \\n            .dnd-btn:hover::before,\\n            .dnd-action-btn:hover::before {\\n                left: 150%;\\n            }\\n            \\n            /* è¿›åº¦æ¡ - ç†”å²©åŠ¨ç”» */\\n            .dnd-bar-fill {\\n                position: relative;\\n                overflow: hidden;\\n                animation: molten-flow 3s linear infinite;\\n            }\\n            \\n            .dnd-bar-fill::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; bottom: 0; left: 0; right: 0;\\n                background: repeating-linear-gradient(\\n                    110deg,\\n                    transparent,\\n                    transparent 8px,\\n                    rgba(255,255,255,0.1) 8px,\\n                    rgba(255,255,255,0.1) 16px\\n                );\\n            }\\n            \\n            /* åˆ†éš”çº¿ - é“æ¡ */\\n            .dnd-divider {\\n                height: 4px;\\n                background: linear-gradient(180deg, #555 0%, #333 50%, #555 100%);\\n                border-top: 1px solid #666;\\n                border-bottom: 1px solid #222;\\n                position: relative;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \"âš™\";\\n                position: absolute;\\n                left: 50%; top: 50%;\\n                transform: translate(-50%, -50%);\\n                background: #2b2b2b;\\n                padding: 0 12px;\\n                color: #cd7f32;\\n                font-size: 14px;\\n            }\\n            \\n            /* é¢æ¿è§’è½ - é‡‘å±é“†é’‰ */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 10px; left: 10px;\\n                width: 14px; height: 14px;\\n                background: radial-gradient(circle at 30% 30%, #888, #555, #333);\\n                border-radius: 50%;\\n                border: 1px solid #666;\\n                box-shadow: inset 0 -1px 2px rgba(0,0,0,0.5);\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \"\";\\n                position: absolute;\\n                bottom: 10px; right: 10px;\\n                width: 14px; height: 14px;\\n                background: radial-gradient(circle at 30% 30%, #888, #555, #333);\\n                border-radius: 50%;\\n                border: 1px solid #666;\\n                box-shadow: inset 0 -1px 2px rgba(0,0,0,0.5);\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - é‡‘å±é£æ ¼ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 12px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: #1a1a1a;\\n                border-left: 1px solid #555;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(to bottom, #555, #444, #555);\\n                border: 1px solid #666;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(to bottom, #666, #555, #666);\\n                border-color: #cd7f32;\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - é½¿è½®å½¢ */\\n            .dnd-icon-circle {\\n                clip-path: polygon(50% 0%, 63% 5%, 75% 0%, 80% 12%, 100% 20%, 95% 35%, 100% 50%, 95% 65%, 100% 80%, 80% 88%, 75% 100%, 63% 95%, 50% 100%, 37% 95%, 25% 100%, 20% 88%, 0% 80%, 5% 65%, 0% 50%, 5% 35%, 0% 20%, 20% 12%, 25% 0%, 37% 5%);\\n                border: none;\\n                background: linear-gradient(135deg, #555, #333);\\n                box-shadow: 0 0 10px rgba(205, 127, 50, 0.3);\\n            }\\n            \\n            /* å¤´åƒæ¡† - å…«è¾¹å½¢ç›¾ç‰Œ */\\n            .dnd-avatar {\\n                clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);\\n                border: 3px solid #cd7f32;\\n                box-shadow: 0 0 15px rgba(205, 127, 50, 0.4);\\n            }\\n            \\n            /* æ‚¬åœéœ‡åŠ¨æ•ˆæœ */\\n            .dnd-char-card:hover {\\n                animation: hammer-shake 0.3s ease-in-out;\\n            }\\n            \\n            /* å·¥å…·æç¤º */\\n            .dnd-tooltip {\\n                background: linear-gradient(135deg, #3a3a3a, #2a2a2a);\\n                border: 2px solid #555;\\n                clip-path: polygon(6px 0, 100% 0, 100% calc(100% - 6px), calc(100% - 6px) 100%, 0 100%, 0 6px);\\n                box-shadow: 3px 3px 0 rgba(0,0,0,0.4);\\n            }\\n        ',background:{type:\"blueprint\",majorColor:\"rgba(255, 152, 0, 0.12)\",minorColor:\"rgba(255, 152, 0, 0.06)\",gridSize:30,animated:!0}},\"star-trek\":{meta:{id:\"star-trek\",name:\"æ˜Ÿé™…è”é‚¦\",icon:\"ğŸš€\",description:\"æç®€å¹²å‡€çš„ç§‘å¹»é£æ ¼ï¼Œç±»ä¼¼äºLCARSç•Œé¢\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#000000\",\"--dnd-bg-panel-start\":\"#000000\",\"--dnd-bg-panel-end\":\"#0a0a0a\",\"--dnd-text-main\":\"#ffcc00\",\"--dnd-text-header\":\"#ff9900\",\"--dnd-text-highlight\":\"#ffffff\",\"--dnd-text-dim\":\"#99ccff\",\"--dnd-accent\":\"#ff9900\",\"--dnd-accent-hover\":\"#ffbb33\",\"--dnd-border-gold\":\"#ff9900\",\"--dnd-border-inner\":\"#000000\",\"--dnd-bg-card-start\":\"#000000\",\"--dnd-bg-card-end\":\"#050505\",\"--dnd-btn-primary\":\"#cc0000\",\"--dnd-btn-primary-hover\":\"#ff3333\",\"--dnd-btn-text\":\"#000000\"},morphology:{border:{style:\"none\",width:\"0\",outerStyle:\"none\"},corners:{style:\"rounded-large\",clipPath:\"none\"},card:{shape:\"pill\",decoration:\"lcars\"},effects:{texture:\"stars\",innerGlow:\"none\",borderGlow:\"none\",overlay:\"none\"},layout:{density:\"spacious\",cardMinWidth:\"320px\"},decorations:{headers:\"bar\",dividers:\"solid\"},buttons:{style:\"lcars\",shape:\"pill\"},progressBars:{style:\"lcars\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Helvetica Neue\", Arial, sans-serif',\"--dnd-font-size-base\":\"0.95rem\",\"--dnd-font-weight-header\":\"600\",\"--dnd-letter-spacing\":\"0.05em\",\"--dnd-text-transform\":\"uppercase\"},animations:{\"--dnd-transition-fast\":\"0.1s ease-out\",\"--dnd-transition-normal\":\"0.2s ease-out\",\"--dnd-animation-blink\":\"lcars-blink 1.5s ease-in-out infinite\"},interactiveStates:{hover:{brightness:1.2,scale:1.01,lift:\"-2px\",shadow:\"0 4px 15px rgba(255, 153, 0, 0.3)\",borderColor:\"#ff9900\",glow:\"drop-shadow(0 0 8px rgba(255, 153, 0, 0.5))\",transition:\"0.15s ease-out\"},cardHover:{transform:\"translateY(-3px) scale(1.01)\",shadow:\"0 8px 25px rgba(0,0,0,0.5), 0 0 20px rgba(255, 153, 0, 0.2)\",borderColor:\"#ffcc00\"},buttonHover:{brightness:1.3,transform:\"translateY(-1px) scale(1.02)\",shadow:\"0 4px 12px rgba(204, 0, 0, 0.4), 0 0 10px rgba(255, 51, 51, 0.3)\"},active:{scale:.98,brightness:.85,transform:\"translateY(1px) scale(0.98)\",shadow:\"0 1px 5px rgba(0,0,0,0.4)\"},buttonActive:{transform:\"translateY(1px) scale(0.97)\",shadow:\"0 1px 3px rgba(0,0,0,0.4)\"},selected:{background:\"#ff9900\",borderColor:\"#ffcc00\",borderWidth:\"2px\",glow:\"0 0 10px rgba(255, 153, 0, 0.4)\",textColor:\"#000000\"},navActive:{background:\"#ff9900\",border:\"none\",indicator:\"#ffcc00\"},focus:{borderColor:\"#ffcc00\",shadow:\"0 0 0 3px rgba(255, 204, 0, 0.3)\",outline:\"none\"},disabled:{opacity:.35,cursor:\"not-allowed\",filter:\"grayscale(0.8) brightness(0.5)\"},iconHover:{glow:\"drop-shadow(0 0 8px rgba(255, 204, 0, 0.8))\",scale:1.1},inputFocus:{border:\"#ff9900\",shadow:\"0 0 10px rgba(255, 153, 0, 0.3)\"}},overrides:{\".dnd-nav-sidebar\":{\"border-right\":\"none\",padding:\"15px 0 15px 20px\",background:\"linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(10,10,20,0.9) 100%)\",position:\"relative\"},\".dnd-nav-item\":{background:\"#99ccff\",color:\"#000\",\"margin-bottom\":\"6px\",\"border-radius\":\"25px 0 0 25px\",\"justify-content\":\"flex-end\",padding:\"12px 20px 12px 30px\",\"font-weight\":\"700\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.08em\",\"font-size\":\"0.85rem\",position:\"relative\",transition:\"all 0.15s ease-out\",\"clip-path\":\"polygon(0% 0%, 100% 0%, 100% 100%, 15px 100%, 0% calc(100% - 15px))\"},\".dnd-nav-item:hover\":{background:\"#cc9933\",transform:\"translateX(5px)\",\"box-shadow\":\"0 0 15px rgba(255, 153, 0, 0.4)\"},\".dnd-nav-item.active\":{background:\"#ff9900\",color:\"#000\",transform:\"translateX(10px)\",\"box-shadow\":\"0 0 20px rgba(255, 153, 0, 0.6), inset 0 0 10px rgba(255,255,255,0.2)\",\"z-index\":\"10\"},\".dnd-char-card\":{border:\"none\",\"border-radius\":\"30px\",background:\"#000\",\"box-shadow\":\"0 0 30px rgba(153, 204, 255, 0.15)\",position:\"relative\",\"margin-left\":\"35px\",overflow:\"visible\"},\".dnd-card-header\":{\"border-bottom\":\"none\",background:\"linear-gradient(90deg, #ff9900 0%, #ff9900 calc(100% - 80px), transparent calc(100% - 80px))\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.12em\",color:\"#000\",\"font-weight\":\"700\",padding:\"12px 90px 12px 25px\",\"border-radius\":\"30px 30px 0 0\",position:\"relative\",\"clip-path\":\"polygon(0 0, 100% 0, 100% 100%, 60px 100%, 0 calc(100% - 10px))\"},\".dnd-card-body\":{padding:\"20px 20px 20px 25px\",\"border-left\":\"25px solid #99ccff\",\"border-bottom\":\"15px solid #cc6699\",\"border-radius\":\"0 0 20px 0\",position:\"relative\"},\".dnd-bar-container\":{background:\"#1a1a2e\",\"border-radius\":\"12px\",height:\"22px\",border:\"none\",position:\"relative\",overflow:\"hidden\"},\".dnd-bar-fill\":{\"border-radius\":\"12px\",transition:\"width 0.4s ease-out\",position:\"relative\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #cc0000 0%, #ff3333 50%, #ff6666 100%)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #ff9900 0%, #ffcc00 50%, #ffee88 100%)\"},\".dnd-btn, .dnd-action-btn\":{\"border-radius\":\"20px\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.08em\",\"font-weight\":\"700\",padding:\"10px 25px\",border:\"none\",position:\"relative\",overflow:\"hidden\",\"clip-path\":\"polygon(15px 0, 100% 0, 100% 100%, 0 100%, 0 15px)\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{filter:\"brightness(1.3)\",\"box-shadow\":\"0 0 20px rgba(255, 153, 0, 0.5)\"},\".dnd-btn:active, .dnd-action-btn:active\":{transform:\"scale(0.97)\",filter:\"brightness(0.9)\"},\".dnd-stat-row\":{padding:\"10px 15px\",margin:\"4px 0\",background:\"linear-gradient(90deg, rgba(153, 204, 255, 0.1) 0%, transparent 100%)\",\"border-left\":\"4px solid #99ccff\",position:\"relative\",transition:\"all 0.2s ease\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(90deg, rgba(255, 153, 0, 0.15) 0%, transparent 100%)\",\"border-left-color\":\"#ff9900\"},\".dnd-title, .dnd-char-name\":{\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.2em\",\"font-weight\":\"300\",\"text-shadow\":\"0 0 10px rgba(255, 204, 0, 0.5)\"},\".dnd-panel, .dnd-dialog\":{background:\"#000\",border:\"none\",\"border-radius\":\"25px\",position:\"relative\",overflow:\"visible\",\"box-shadow\":\"0 0 30px rgba(153, 204, 255, 0.2)\"},\"#dnd-mini-hud\":{background:\"rgba(0, 0, 0, 0.95)\",border:\"3px solid #99ccff\",\"border-radius\":\"20px\",\"box-shadow\":\"0 0 20px rgba(153, 204, 255, 0.3)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"rgba(20, 20, 40, 0.9)\",border:\"2px solid #336699\",\"border-radius\":\"10px\",color:\"#99ccff\",\"font-family\":'\"Helvetica Neue\", Arial, sans-serif'},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#ff9900\",\"box-shadow\":\"0 0 15px rgba(255, 153, 0, 0.3)\"},\".dnd-table th\":{background:\"linear-gradient(90deg, #99ccff 0%, #6699cc 100%)\",color:\"#000\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.1em\",\"font-weight\":\"700\",\"border-radius\":\"0\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(153, 204, 255, 0.2)\",padding:\"12px\"},\".dnd-table tr:hover td\":{background:\"rgba(255, 153, 0, 0.1)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #cc0000, #ff3333)\",\"border-radius\":\"15px\",\"text-transform\":\"uppercase\",\"font-weight\":\"700\",\"letter-spacing\":\"0.05em\"}},customCSS:'\\n            /* LCARSåŠ¨ç”» */\\n            @keyframes lcars-blink {\\n                0%, 100% { opacity: 1; }\\n                50% { opacity: 0.6; }\\n            }\\n            \\n            @keyframes lcars-scan {\\n                0% { transform: translateX(-100%); }\\n                100% { transform: translateX(200%); }\\n            }\\n            \\n            @keyframes lcars-pulse {\\n                0%, 100% { box-shadow: 0 0 10px rgba(255, 153, 0, 0.3); }\\n                50% { box-shadow: 0 0 25px rgba(255, 153, 0, 0.6); }\\n            }\\n            \\n            @keyframes warp-stars {\\n                0% { transform: translateZ(0) scale(1); opacity: 1; }\\n                100% { transform: translateZ(200px) scale(0); opacity: 0; }\\n            }\\n            \\n            /* å¡ç‰‡å·¦ä¾§LCARSæ¡å¸¦ */\\n            .dnd-char-card::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0;\\n                left: -35px;\\n                width: 30px;\\n                height: 100%;\\n                background: linear-gradient(\\n                    to bottom,\\n                    #99ccff 0%,\\n                    #99ccff 25%,\\n                    #ff9900 25%,\\n                    #ff9900 50%,\\n                    #cc6699 50%,\\n                    #cc6699 75%,\\n                    #9966cc 75%,\\n                    #9966cc 100%\\n                );\\n                border-radius: 15px 0 0 15px;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨è£…é¥°å— */\\n            .dnd-card-header::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0;\\n                right: 0;\\n                width: 70px;\\n                height: 100%;\\n                background: linear-gradient(to bottom, #cc6699 0%, #cc6699 50%, #9966cc 50%, #9966cc 100%);\\n                border-radius: 0 30px 0 0;\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \"â—â—â—\";\\n                position: absolute;\\n                top: 50%;\\n                right: 80px;\\n                transform: translateY(-50%);\\n                color: #99ccff;\\n                font-size: 10px;\\n                letter-spacing: 3px;\\n                animation: lcars-blink 2s ease-in-out infinite;\\n            }\\n            \\n            /* è¿›åº¦æ¡æ‰«ææ•ˆæœ */\\n            .dnd-bar-fill::after {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; bottom: 0;\\n                left: 0;\\n                width: 50%;\\n                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);\\n                animation: lcars-scan 2s ease-in-out infinite;\\n            }\\n            \\n            /* å¯¼èˆªé¡¹è£…é¥° */\\n            .dnd-nav-item::before {\\n                content: \"\";\\n                position: absolute;\\n                left: 0;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                width: 12px;\\n                height: 12px;\\n                background: #000;\\n                border-radius: 50%;\\n            }\\n            \\n            .dnd-nav-item::after {\\n                content: \"\";\\n                position: absolute;\\n                right: -5px;\\n                top: 0;\\n                height: 100%;\\n                width: 5px;\\n                background: inherit;\\n            }\\n            \\n            /* LCARSåˆ†éš”çº¿ */\\n            .dnd-divider {\\n                height: 3px;\\n                background: linear-gradient(90deg, #99ccff 0%, #99ccff 20%, transparent 20%, transparent 80%, #ff9900 80%, #ff9900 100%);\\n                position: relative;\\n                margin: 15px 0;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \"\";\\n                position: absolute;\\n                left: 20%;\\n                top: -5px;\\n                width: 60%;\\n                height: 13px;\\n                background: linear-gradient(90deg, #1a1a2e, #0a0a1e, #1a1a2e);\\n                border: 1px solid #336699;\\n                border-radius: 6px;\\n            }\\n            \\n            /* é¢æ¿è§’è½è£…é¥° */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0;\\n                width: 80px;\\n                height: 25px;\\n                background: #99ccff;\\n                border-radius: 25px 0 15px 0;\\n                z-index: 1;\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \"\";\\n                position: absolute;\\n                bottom: 0; right: 0;\\n                width: 60px;\\n                height: 20px;\\n                background: #cc6699;\\n                border-radius: 15px 0 25px 0;\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - LCARSé£æ ¼ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 15px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: #0a0a1e;\\n                border-left: 2px solid #336699;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(to bottom, #99ccff, #6699cc);\\n                border-radius: 10px;\\n                border: 2px solid #0a0a1e;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(to bottom, #ff9900, #cc7700);\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - åœ†å½¢å¾½ç«  */\\n            .dnd-icon-circle {\\n                border-radius: 50%;\\n                border: 3px solid #99ccff;\\n                background: linear-gradient(135deg, #1a1a3e, #0a0a2e);\\n                box-shadow: 0 0 15px rgba(153, 204, 255, 0.4);\\n                position: relative;\\n            }\\n            \\n            .dnd-icon-circle::after {\\n                content: \"\";\\n                position: absolute;\\n                inset: 3px;\\n                border: 1px solid rgba(153, 204, 255, 0.3);\\n                border-radius: 50%;\\n            }\\n            \\n            /* å¤´åƒæ¡† - æ˜Ÿé™…è”é‚¦å¾½ç«  */\\n            .dnd-avatar {\\n                border-radius: 50%;\\n                border: 4px solid #ff9900;\\n                box-shadow:\\n                    0 0 0 3px #000,\\n                    0 0 0 6px #99ccff,\\n                    0 0 20px rgba(255, 153, 0, 0.5);\\n                position: relative;\\n            }\\n            \\n            .dnd-avatar::before {\\n                content: \"\";\\n                position: absolute;\\n                inset: -15px;\\n                border: 2px solid rgba(153, 204, 255, 0.3);\\n                border-radius: 50%;\\n                animation: lcars-pulse 3s ease-in-out infinite;\\n            }\\n            \\n            /* çŠ¶æ€æŒ‡ç¤ºç¯ */\\n            .dnd-status-indicator {\\n                width: 12px;\\n                height: 12px;\\n                border-radius: 50%;\\n                animation: lcars-blink 1.5s ease-in-out infinite;\\n            }\\n            \\n            .dnd-status-indicator.active {\\n                background: #00ff00;\\n                box-shadow: 0 0 10px #00ff00;\\n            }\\n            \\n            .dnd-status-indicator.warning {\\n                background: #ff9900;\\n                box-shadow: 0 0 10px #ff9900;\\n            }\\n            \\n            .dnd-status-indicator.danger {\\n                background: #cc0000;\\n                box-shadow: 0 0 10px #cc0000;\\n            }\\n            \\n            /* å·¥å…·æç¤º */\\n            .dnd-tooltip {\\n                background: rgba(10, 10, 30, 0.95);\\n                border: 2px solid #99ccff;\\n                border-radius: 15px;\\n                box-shadow: 0 0 20px rgba(153, 204, 255, 0.3);\\n                padding: 10px 20px;\\n            }\\n            \\n            .dnd-tooltip::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0;\\n                width: 40px;\\n                height: 8px;\\n                background: #ff9900;\\n                border-radius: 15px 0 8px 0;\\n            }\\n            \\n            /* æ•°æ®æ ‡ç­¾ */\\n            .dnd-stat-label {\\n                color: #99ccff;\\n                text-transform: uppercase;\\n                letter-spacing: 0.1em;\\n                font-size: 0.8em;\\n            }\\n            \\n            .dnd-stat-value {\\n                color: #ffcc00;\\n                font-weight: 700;\\n                text-shadow: 0 0 5px rgba(255, 204, 0, 0.5);\\n            }\\n            \\n            /* å¡ç‰‡æ‚¬åœæ•ˆæœ */\\n            .dnd-char-card:hover {\\n                box-shadow: 0 0 40px rgba(255, 153, 0, 0.3);\\n            }\\n            \\n            .dnd-char-card:hover::before {\\n                filter: brightness(1.2);\\n            }\\n        ',background:{type:\"starfield\",colors:[\"rgba(255, 255, 255, 0.9)\",\"rgba(153, 204, 255, 0.8)\",\"rgba(255, 204, 0, 0.7)\"],density:150,speed:.02,twinkle:!0}},lovecraftian:{meta:{id:\"lovecraftian\",name:\"æ—§æ—¥æ”¯é…è€…\",icon:\"ğŸ™\",description:\"æ··æ²Œæ‰­æ›²çš„å…‹è‹é²é£æ ¼ï¼ŒæŒ‘æˆ˜ä½ çš„ç†æ™º\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#051010\",\"--dnd-bg-panel-start\":\"#0a1a15\",\"--dnd-bg-panel-end\":\"#050a0a\",\"--dnd-text-main\":\"#a0c0a0\",\"--dnd-text-header\":\"#d0a0d0\",\"--dnd-text-highlight\":\"#00ffaa\",\"--dnd-text-dim\":\"#507060\",\"--dnd-accent\":\"#800080\",\"--dnd-accent-hover\":\"#a020a0\",\"--dnd-border-gold\":\"#306040\",\"--dnd-border-inner\":\"#204030\",\"--dnd-bg-card-start\":\"rgba(10, 26, 21, 0.9)\",\"--dnd-bg-card-end\":\"rgba(5, 16, 16, 0.95)\",\"--dnd-btn-primary\":\"#402060\",\"--dnd-btn-primary-hover\":\"#603080\",\"--dnd-btn-text\":\"#a0c0a0\"},morphology:{border:{style:\"solid\",width:\"1px\",outerStyle:\"none\"},corners:{style:\"irregular\",clipPath:\"polygon(0% 0%, 100% 2%, 98% 100%, 2% 98%)\"},card:{shape:\"distorted\",decoration:\"runes\"},effects:{texture:\"scales\",innerGlow:\"medium\",borderGlow:\"subtle\",overlay:\"noise\"},layout:{density:\"normal\"},decorations:{icons:\"tentacles\",corners:\"tentacle\"},buttons:{style:\"eldritch\",shape:\"irregular\"},progressBars:{style:\"sanity\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Courier New\", monospace',\"--dnd-font-size-base\":\"0.95rem\",\"--dnd-letter-spacing\":\"0.03em\"},animations:{\"--dnd-transition-fast\":\"0.2s cubic-bezier(0.4, 0, 0.6, 1)\",\"--dnd-transition-normal\":\"0.4s cubic-bezier(0.4, 0, 0.6, 1)\",\"--dnd-animation-madness\":\"eldritch-pulse 4s ease-in-out infinite\",\"--dnd-animation-distort\":\"subtle-distort 8s ease-in-out infinite\"},interactiveStates:{hover:{brightness:1.15,scale:1.02,lift:\"-3px\",shadow:\"0 8px 25px rgba(0, 255, 170, 0.2), 0 0 15px rgba(128, 0, 128, 0.3)\",borderColor:\"#00ffaa\",glow:\"drop-shadow(0 0 8px rgba(0, 255, 170, 0.4)) drop-shadow(0 0 15px rgba(128, 0, 128, 0.3))\",transition:\"0.3s cubic-bezier(0.4, 0, 0.6, 1)\"},cardHover:{transform:\"translateY(-5px) rotate(0.8deg) scale(1.01)\",shadow:\"0 15px 40px rgba(5, 16, 16, 0.8), 0 0 30px rgba(0, 255, 170, 0.15), 0 0 50px rgba(128, 0, 128, 0.1)\",borderColor:\"#00ffaa\"},buttonHover:{brightness:1.25,transform:\"translateY(-2px) scale(1.02) skewX(-1deg)\",shadow:\"0 6px 20px rgba(128, 0, 128, 0.5), 0 0 12px rgba(0, 255, 170, 0.3)\"},active:{scale:.96,brightness:.85,transform:\"translateY(2px) scale(0.96) rotate(-0.5deg)\",shadow:\"0 2px 8px rgba(0,0,0,0.6), inset 0 0 15px rgba(0, 255, 170, 0.1)\"},buttonActive:{transform:\"translateY(2px) scale(0.97) skewX(1deg)\",shadow:\"0 1px 4px rgba(0,0,0,0.5), inset 0 2px 6px rgba(0,0,0,0.4)\"},selected:{background:\"linear-gradient(90deg, rgba(0, 255, 170, 0.2), rgba(128, 0, 128, 0.15), transparent)\",borderColor:\"#00ffaa\",borderWidth:\"2px\",glow:\"0 0 20px rgba(0, 255, 170, 0.3), 0 0 40px rgba(128, 0, 128, 0.15)\",textColor:\"#00ffaa\"},navActive:{background:\"linear-gradient(90deg, rgba(0, 255, 170, 0.25), rgba(128, 0, 128, 0.15), transparent)\",border:\"2px solid #306040\",indicator:\"#00ffaa\"},focus:{borderColor:\"#800080\",shadow:\"0 0 0 3px rgba(128, 0, 128, 0.3), 0 0 15px rgba(0, 255, 170, 0.2)\",outline:\"none\"},disabled:{opacity:.3,cursor:\"not-allowed\",filter:\"grayscale(0.7) brightness(0.5) hue-rotate(30deg)\"},iconHover:{glow:\"drop-shadow(0 0 10px rgba(0, 255, 170, 0.8)) drop-shadow(0 0 20px rgba(128, 0, 128, 0.5))\",scale:1.15},inputFocus:{border:\"#306040\",shadow:\"0 0 15px rgba(0, 255, 170, 0.3), inset 0 0 10px rgba(128, 0, 128, 0.15)\"}},overrides:{\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, rgba(10, 26, 21, 0.98) 0%, rgba(5, 16, 16, 0.95) 100%)\",\"border-right\":\"2px solid #306040\",position:\"relative\",overflow:\"visible\"},\".dnd-nav-item\":{background:\"linear-gradient(90deg, rgba(48, 96, 64, 0.3), transparent)\",border:\"1px solid rgba(48, 96, 64, 0.5)\",\"border-radius\":\"0\",margin:\"8px 10px\",padding:\"12px 15px\",position:\"relative\",transition:\"all 0.4s cubic-bezier(0.4, 0, 0.6, 1)\",\"clip-path\":\"polygon(0% 0%, 95% 0%, 100% 50%, 95% 100%, 0% 100%, 5% 50%)\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, rgba(0, 255, 170, 0.15), rgba(128, 0, 128, 0.1), transparent)\",transform:\"skewX(-2deg) translateX(5px)\",\"border-color\":\"#00ffaa\",\"box-shadow\":\"0 0 20px rgba(0, 255, 170, 0.3)\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(0, 255, 170, 0.25), rgba(128, 0, 128, 0.15), transparent)\",\"box-shadow\":\"inset 0 0 20px rgba(0, 255, 170, 0.2), 0 0 25px rgba(128, 0, 128, 0.3)\",transform:\"skewX(-3deg) translateX(8px)\",\"border-color\":\"#00ffaa\"},\".dnd-char-card\":{transform:\"rotate(0.5deg)\",\"border-radius\":\"0\",border:\"2px solid #306040\",\"box-shadow\":\"0 10px 30px rgba(5, 16, 16, 0.8), inset 0 0 40px rgba(0, 255, 170, 0.05)\",position:\"relative\",\"clip-path\":\"polygon(0% 2%, 3% 0%, 97% 0%, 100% 3%, 100% 97%, 98% 100%, 2% 100%, 0% 98%)\",overflow:\"visible\"},\".dnd-char-card:nth-child(even)\":{transform:\"rotate(-0.5deg)\"},\".dnd-card-header\":{\"border-bottom\":\"2px solid #306040\",background:\"linear-gradient(to right, rgba(128, 0, 128, 0.15), rgba(10, 26, 21, 0.9), rgba(0, 255, 170, 0.08))\",padding:\"15px 20px\",position:\"relative\"},\".dnd-card-body\":{padding:\"20px\",background:\"linear-gradient(180deg, rgba(10, 26, 21, 0.6) 0%, rgba(5, 16, 16, 0.8) 100%)\",position:\"relative\"},\".dnd-bar-container\":{background:\"linear-gradient(90deg, #0a1a15, #051010, #0a1a15)\",border:\"1px solid #306040\",\"border-radius\":\"0\",height:\"20px\",position:\"relative\",\"clip-path\":\"polygon(5px 0, 100% 0, calc(100% - 5px) 100%, 0 100%)\"},\".dnd-bar-fill\":{\"border-radius\":\"0\",position:\"relative\",overflow:\"hidden\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #402060, #800080, #00ffaa, #800080)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #204030, #306040, #00ffaa)\"},\".dnd-btn, .dnd-action-btn\":{border:\"2px solid #306040\",\"border-radius\":\"0\",transform:\"skewX(-3deg)\",background:\"linear-gradient(135deg, rgba(64, 32, 96, 0.8), rgba(32, 64, 48, 0.8))\",position:\"relative\",overflow:\"hidden\",\"text-shadow\":\"0 0 5px rgba(0, 255, 170, 0.5)\",\"clip-path\":\"polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%)\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{\"border-color\":\"#00ffaa\",\"box-shadow\":\"0 0 25px rgba(0, 255, 170, 0.4), inset 0 0 15px rgba(128, 0, 128, 0.3)\",transform:\"skewX(-3deg) translateY(-2px)\"},\".dnd-btn:active, .dnd-action-btn:active\":{transform:\"skewX(-3deg) scale(0.97)\",\"box-shadow\":\"inset 0 0 20px rgba(0, 255, 170, 0.2)\"},\".dnd-stat-row\":{padding:\"10px 15px\",margin:\"4px 0\",background:\"linear-gradient(90deg, rgba(48, 96, 64, 0.1), transparent)\",\"border-left\":\"3px solid transparent\",position:\"relative\",transition:\"all 0.3s cubic-bezier(0.4, 0, 0.6, 1)\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(90deg, rgba(0, 255, 170, 0.1), rgba(128, 0, 128, 0.05), transparent)\",\"border-left-color\":\"#00ffaa\",transform:\"skewX(-1deg)\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 0 15px rgba(208, 160, 208, 0.6), 0 0 30px rgba(128, 0, 128, 0.4)\",\"letter-spacing\":\"0.15em\",\"font-style\":\"italic\"},\".dnd-panel, .dnd-dialog\":{background:\"linear-gradient(135deg, rgba(10, 26, 21, 0.98), rgba(5, 16, 16, 0.95))\",border:\"2px solid #306040\",\"border-radius\":\"0\",\"box-shadow\":\"0 0 40px rgba(5, 16, 16, 0.9), inset 0 0 60px rgba(128, 0, 128, 0.05)\",position:\"relative\",\"clip-path\":\"polygon(0% 3%, 3% 0%, 97% 0%, 100% 3%, 100% 97%, 97% 100%, 3% 100%, 0% 97%)\"},\"#dnd-mini-hud\":{background:\"rgba(5, 16, 16, 0.95)\",border:\"2px solid #306040\",\"box-shadow\":\"0 0 30px rgba(0, 255, 170, 0.2), inset 0 0 20px rgba(128, 0, 128, 0.1)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"rgba(5, 10, 10, 0.9)\",border:\"1px solid #306040\",\"border-radius\":\"0\",color:\"#a0c0a0\",\"font-family\":'\"Courier New\", monospace'},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#00ffaa\",\"box-shadow\":\"0 0 15px rgba(0, 255, 170, 0.3), inset 0 0 10px rgba(128, 0, 128, 0.15)\"},\".dnd-table th\":{background:\"linear-gradient(90deg, rgba(64, 32, 96, 0.6), rgba(32, 64, 48, 0.6))\",color:\"#d0a0d0\",\"border-bottom\":\"2px solid #306040\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.1em\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(48, 96, 64, 0.3)\",padding:\"12px\"},\".dnd-table tr:hover td\":{background:\"rgba(0, 255, 170, 0.05)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #402060, #204030)\",border:\"1px solid #00ffaa\",\"border-radius\":\"0\",\"clip-path\":\"polygon(10% 0, 90% 0, 100% 50%, 90% 100%, 10% 100%, 0% 50%)\",\"text-shadow\":\"0 0 5px rgba(0, 255, 170, 0.8)\"}},customCSS:'\\n            /* å…‹è‹é²åŠ¨ç”» */\\n            @keyframes eldritch-pulse {\\n                0%, 100% {\\n                    box-shadow: 0 10px 30px rgba(5, 16, 16, 0.8), inset 0 0 40px rgba(0, 255, 170, 0.05);\\n                    filter: hue-rotate(0deg);\\n                }\\n                25% {\\n                    box-shadow: 0 10px 35px rgba(5, 16, 16, 0.85), inset 0 0 50px rgba(128, 0, 128, 0.1);\\n                    filter: hue-rotate(8deg);\\n                }\\n                50% {\\n                    box-shadow: 0 10px 40px rgba(5, 16, 16, 0.8), inset 0 0 60px rgba(0, 255, 170, 0.08);\\n                    filter: hue-rotate(-5deg);\\n                }\\n                75% {\\n                    box-shadow: 0 10px 35px rgba(5, 16, 16, 0.85), inset 0 0 50px rgba(128, 0, 128, 0.08);\\n                    filter: hue-rotate(5deg);\\n                }\\n            }\\n            \\n            @keyframes subtle-distort {\\n                0%, 100% { transform: rotate(0.5deg) skewX(0deg); }\\n                20% { transform: rotate(0.8deg) skewX(0.5deg); }\\n                40% { transform: rotate(0.2deg) skewX(-0.3deg); }\\n                60% { transform: rotate(0.7deg) skewX(0.4deg); }\\n                80% { transform: rotate(0.4deg) skewX(-0.2deg); }\\n            }\\n            \\n            @keyframes tentacle-writhe {\\n                0%, 100% {\\n                    transform: rotate(0deg) scale(1);\\n                    opacity: 0.6;\\n                }\\n                25% {\\n                    transform: rotate(5deg) scale(1.05);\\n                    opacity: 0.8;\\n                }\\n                50% {\\n                    transform: rotate(-3deg) scale(0.95);\\n                    opacity: 0.5;\\n                }\\n                75% {\\n                    transform: rotate(4deg) scale(1.02);\\n                    opacity: 0.7;\\n                }\\n            }\\n            \\n            @keyframes madness-flicker {\\n                0%, 95%, 100% { opacity: 1; filter: none; }\\n                96% { opacity: 0.8; filter: hue-rotate(30deg) saturate(1.5); }\\n                97% { opacity: 1; filter: none; }\\n                98% { opacity: 0.6; filter: hue-rotate(-20deg) brightness(1.2); }\\n                99% { opacity: 0.9; filter: hue-rotate(10deg); }\\n            }\\n            \\n            @keyframes sanity-drain {\\n                0% { background-position: 0% 50%; }\\n                50% { background-position: 100% 50%; }\\n                100% { background-position: 0% 50%; }\\n            }\\n            \\n            @keyframes void-gaze {\\n                0%, 100% {\\n                    box-shadow: 0 0 30px rgba(0, 255, 170, 0.2);\\n                    border-color: #306040;\\n                }\\n                50% {\\n                    box-shadow: 0 0 50px rgba(128, 0, 128, 0.4);\\n                    border-color: #800080;\\n                }\\n            }\\n            \\n            /* å¡ç‰‡å™ªç‚¹çº¹ç† */\\n            .dnd-char-card::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background: url(\"data:image/svg+xml,%3Csvg viewBox=\\'0 0 200 200\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cfilter id=\\'noise\\'%3E%3CfeTurbulence type=\\'fractalNoise\\' baseFrequency=\\'0.9\\' numOctaves=\\'4\\' stitchTiles=\\'stitch\\'/%3E%3C/filter%3E%3Crect width=\\'100%25\\' height=\\'100%25\\' filter=\\'url(%23noise)\\' opacity=\\'0.04\\'/%3E%3C/svg%3E\");\\n                pointer-events: none;\\n                z-index: 1;\\n            }\\n            \\n            /* å¡ç‰‡è§¦æ‰‹è£…é¥° */\\n            .dnd-char-card::after {\\n                content: \"ğŒ\";\\n                position: absolute;\\n                top: -15px;\\n                right: -15px;\\n                font-size: 40px;\\n                color: rgba(0, 255, 170, 0.3);\\n                text-shadow: 0 0 20px rgba(128, 0, 128, 0.5);\\n                animation: tentacle-writhe 6s ease-in-out infinite;\\n                z-index: 10;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨ç¬¦æ–‡ */\\n            .dnd-card-header::before {\\n                content: \"âŸ âŠ âŸ\";\\n                position: absolute;\\n                left: 15px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                color: rgba(0, 255, 170, 0.4);\\n                font-size: 12px;\\n                letter-spacing: 5px;\\n                animation: madness-flicker 10s ease-in-out infinite;\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \"\";\\n                position: absolute;\\n                bottom: 0;\\n                left: 0;\\n                right: 0;\\n                height: 2px;\\n                background: linear-gradient(90deg, transparent, #00ffaa, #800080, #00ffaa, transparent);\\n            }\\n            \\n            /* è¿›åº¦æ¡ - ç†æ™ºæµå¤±æ•ˆæœ */\\n            .dnd-bar-fill::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; bottom: 0; left: 0; right: 0;\\n                background: linear-gradient(90deg,\\n                    transparent,\\n                    rgba(128, 0, 128, 0.3),\\n                    transparent,\\n                    rgba(0, 255, 170, 0.2),\\n                    transparent\\n                );\\n                background-size: 200% 100%;\\n                animation: sanity-drain 4s ease-in-out infinite;\\n            }\\n            \\n            .dnd-bar-fill::after {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; bottom: 0;\\n                right: 0;\\n                width: 20px;\\n                background: linear-gradient(90deg, transparent, rgba(0, 255, 170, 0.8));\\n                filter: blur(3px);\\n            }\\n            \\n            /* å¯¼èˆªé¡¹è§¦æ‰‹è£…é¥° */\\n            .dnd-nav-item::before {\\n                content: \"âŒ¬\";\\n                position: absolute;\\n                left: 10px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                color: rgba(0, 255, 170, 0.5);\\n                font-size: 14px;\\n            }\\n            \\n            .dnd-nav-item::after {\\n                content: \"\";\\n                position: absolute;\\n                right: 0;\\n                top: 0;\\n                height: 100%;\\n                width: 3px;\\n                background: linear-gradient(180deg, transparent, #800080, #00ffaa, #800080, transparent);\\n                opacity: 0;\\n                transition: opacity 0.3s;\\n            }\\n            \\n            .dnd-nav-item:hover::after,\\n            .dnd-nav-item.active::after {\\n                opacity: 1;\\n            }\\n            \\n            /* åˆ†éš”çº¿ - è™šç©ºè£‚ç¼ */\\n            .dnd-divider {\\n                height: 3px;\\n                background: linear-gradient(90deg,\\n                    transparent,\\n                    #306040,\\n                    #00ffaa,\\n                    #800080,\\n                    #00ffaa,\\n                    #306040,\\n                    transparent\\n                );\\n                position: relative;\\n                margin: 20px 0;\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \"â—ˆ\";\\n                position: absolute;\\n                left: 50%;\\n                top: 50%;\\n                transform: translate(-50%, -50%);\\n                background: #051010;\\n                padding: 0 15px;\\n                color: #00ffaa;\\n                font-size: 16px;\\n                text-shadow: 0 0 10px rgba(128, 0, 128, 0.8);\\n            }\\n            \\n            /* é¢æ¿è§’è½è§¦æ‰‹ */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \"â”\";\\n                position: absolute;\\n                top: 10px;\\n                left: 10px;\\n                font-size: 24px;\\n                color: rgba(0, 255, 170, 0.4);\\n                animation: tentacle-writhe 8s ease-in-out infinite;\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \"â”\";\\n                position: absolute;\\n                bottom: 10px;\\n                right: 10px;\\n                font-size: 24px;\\n                color: rgba(128, 0, 128, 0.4);\\n                transform: rotate(180deg);\\n                animation: tentacle-writhe 8s ease-in-out infinite reverse;\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - æ·±æ¸Šé€šé“ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 12px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: #051010;\\n                border-left: 1px solid #306040;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(180deg, #306040, #204030, #306040);\\n                border: 1px solid #306040;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(180deg, #00ffaa, #306040, #800080, #306040, #00ffaa);\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - é‚ªçœ¼ */\\n            .dnd-icon-circle {\\n                border-radius: 50%;\\n                border: 2px solid #306040;\\n                background: radial-gradient(circle at 30% 30%, #0a1a15, #051010);\\n                box-shadow: 0 0 20px rgba(0, 255, 170, 0.3), inset 0 0 15px rgba(128, 0, 128, 0.2);\\n                position: relative;\\n                animation: void-gaze 5s ease-in-out infinite;\\n            }\\n            \\n            .dnd-icon-circle::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 50%;\\n                left: 50%;\\n                transform: translate(-50%, -50%);\\n                width: 40%;\\n                height: 40%;\\n                background: radial-gradient(circle, #00ffaa, transparent);\\n                border-radius: 50%;\\n                opacity: 0.6;\\n            }\\n            \\n            /* å¤´åƒæ¡† - æ·±æ¸Šå‡è§† */\\n            .dnd-avatar {\\n                border-radius: 0;\\n                clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);\\n                border: 3px solid #306040;\\n                box-shadow: 0 0 30px rgba(0, 255, 170, 0.3), 0 0 60px rgba(128, 0, 128, 0.2);\\n                position: relative;\\n            }\\n            \\n            .dnd-avatar::before {\\n                content: \"\";\\n                position: absolute;\\n                inset: -5px;\\n                clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);\\n                background: linear-gradient(45deg, #00ffaa, transparent, #800080, transparent);\\n                z-index: -1;\\n                animation: void-gaze 4s ease-in-out infinite;\\n            }\\n            \\n            /* æ‚¬åœ - ç–¯ç‹‚ä¾µèš€ */\\n            .dnd-char-card:hover {\\n                animation: eldritch-pulse 2s ease-in-out infinite, subtle-distort 4s ease-in-out infinite;\\n            }\\n            \\n            .dnd-char-card:hover::after {\\n                animation: tentacle-writhe 2s ease-in-out infinite;\\n                color: rgba(0, 255, 170, 0.6);\\n            }\\n            \\n            /* å·¥å…·æç¤º - ç¦å¿ŒçŸ¥è¯† */\\n            .dnd-tooltip {\\n                background: rgba(5, 16, 16, 0.98);\\n                border: 1px solid #306040;\\n                clip-path: polygon(0% 5%, 5% 0%, 95% 0%, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0% 95%);\\n                box-shadow: 0 0 30px rgba(0, 255, 170, 0.3), 0 0 50px rgba(128, 0, 128, 0.2);\\n            }\\n            \\n            .dnd-tooltip::before {\\n                content: \"âŸ\";\\n                position: absolute;\\n                top: 5px;\\n                left: 10px;\\n                color: #00ffaa;\\n                font-size: 12px;\\n            }\\n            \\n            /* éšæœºæ‰­æ›²æ•ˆæœ */\\n            .dnd-char-card:nth-child(3n)::after {\\n                content: \"â˜ \";\\n                color: rgba(128, 0, 128, 0.4);\\n            }\\n            \\n            .dnd-char-card:nth-child(3n+1)::after {\\n                content: \"â›§\";\\n                color: rgba(0, 255, 170, 0.4);\\n            }\\n            \\n            .dnd-char-card:nth-child(3n+2)::after {\\n                content: \"âŒ˜\";\\n                color: rgba(208, 160, 208, 0.4);\\n            }\\n        ',background:{type:\"runes\",colors:[\"rgba(0, 255, 170, 0.25)\",\"rgba(128, 0, 128, 0.2)\",\"rgba(208, 160, 208, 0.15)\"],count:15,speed:.03,glow:!0,animated:!0}},steampunk:{meta:{id:\"steampunk\",name:\"è’¸æ±½çºªå…ƒ\",icon:\"âš™ï¸\",description:\"ç»´å¤šåˆ©äºšæ—¶ä»£çš„æœºæ¢°ç¾å­¦ï¼Œé»„é“œä¸çš®é©çš„äº¤å“\",author:\"System\"},colors:{\"--dnd-bg-main\":\"#2b2015\",\"--dnd-bg-panel-start\":\"#3e3020\",\"--dnd-bg-panel-end\":\"#2b2015\",\"--dnd-text-main\":\"#e6d0a0\",\"--dnd-text-header\":\"#ffddaa\",\"--dnd-text-highlight\":\"#ffffaa\",\"--dnd-text-dim\":\"#a69070\",\"--dnd-accent\":\"#cd7f32\",\"--dnd-accent-hover\":\"#daa060\",\"--dnd-border-gold\":\"#b8860b\",\"--dnd-border-inner\":\"#8b4513\",\"--dnd-bg-card-start\":\"#3a2a1a\",\"--dnd-bg-card-end\":\"#2a1f15\",\"--dnd-btn-primary\":\"#8b4513\",\"--dnd-btn-primary-hover\":\"#a0522d\",\"--dnd-btn-text\":\"#e6d0a0\"},morphology:{border:{style:\"ridge\",width:\"3px\",outerStyle:\"dashed\"},corners:{style:\"ornate\",clipPath:\"polygon(10px 0, calc(100% - 10px) 0, 100% 10px, 100% calc(100% - 10px), calc(100% - 10px) 100%, 10px 100%, 0 calc(100% - 10px), 0 10px)\"},card:{shape:\"panel\",decoration:\"gears\"},effects:{texture:\"fabric\",innerGlow:\"gold\",borderGlow:\"none\",overlay:\"vignette\"},layout:{density:\"normal\"},decorations:{corners:\"gears\",dividers:\"pipes\",headers:\"banner\"},buttons:{style:\"brass\",shape:\"rounded\"},progressBars:{style:\"gauge\",animated:!0}},typography:{\"--dnd-font-serif\":'\"Georgia\", \"Times New Roman\", serif',\"--dnd-font-size-header\":\"1.15rem\",\"--dnd-font-weight-header\":\"600\",\"--dnd-letter-spacing\":\"0.04em\"},animations:{\"--dnd-transition-fast\":\"0.2s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-transition-normal\":\"0.35s cubic-bezier(0.4, 0, 0.2, 1)\",\"--dnd-animation-gear\":\"gear-rotate 10s linear infinite\"},interactiveStates:{hover:{brightness:1.12,scale:1.02,lift:\"-4px\",shadow:\"0 10px 30px rgba(139, 69, 19, 0.4), 0 0 15px rgba(184, 134, 11, 0.3)\",borderColor:\"#b8860b\",glow:\"drop-shadow(0 0 6px rgba(205, 127, 50, 0.5))\",transition:\"0.3s cubic-bezier(0.4, 0, 0.2, 1)\"},cardHover:{transform:\"translateY(-6px) scale(1.015)\",shadow:\"0 18px 45px rgba(43, 32, 21, 0.6), 0 0 25px rgba(184, 134, 11, 0.25), inset 0 0 20px rgba(205, 127, 50, 0.08)\",borderColor:\"#cd7f32\"},buttonHover:{brightness:1.2,transform:\"translateY(-2px) scale(1.03)\",shadow:\"0 6px 18px rgba(139, 69, 19, 0.5), 0 0 10px rgba(184, 134, 11, 0.4), inset 0 1px 0 rgba(255,255,255,0.2)\"},active:{scale:.97,brightness:.9,transform:\"translateY(2px) scale(0.97)\",shadow:\"inset 0 3px 8px rgba(0,0,0,0.4), 0 1px 3px rgba(0,0,0,0.3)\"},buttonActive:{transform:\"translateY(2px) scale(0.97)\",shadow:\"inset 0 3px 10px rgba(0,0,0,0.5), 0 0 0 1px rgba(0,0,0,0.2)\"},selected:{background:\"linear-gradient(90deg, rgba(184, 134, 11, 0.3), rgba(139, 69, 19, 0.2), transparent)\",borderColor:\"#ffddaa\",borderWidth:\"3px\",glow:\"0 0 15px rgba(184, 134, 11, 0.4)\",textColor:\"#ffffaa\"},navActive:{background:\"linear-gradient(90deg, rgba(184, 134, 11, 0.35), rgba(139, 69, 19, 0.2), transparent)\",border:\"3px solid #b8860b\",indicator:\"#cd7f32\"},focus:{borderColor:\"#cd7f32\",shadow:\"0 0 0 3px rgba(205, 127, 50, 0.3)\",outline:\"none\"},disabled:{opacity:.4,cursor:\"not-allowed\",filter:\"grayscale(0.5) sepia(0.3) brightness(0.7)\"},iconHover:{glow:\"drop-shadow(0 0 8px rgba(184, 134, 11, 0.8)) drop-shadow(0 0 15px rgba(205, 127, 50, 0.5))\",scale:1.15},inputFocus:{border:\"#b8860b\",shadow:\"0 0 12px rgba(184, 134, 11, 0.4), inset 0 1px 3px rgba(0,0,0,0.2)\"}},overrides:{\".dnd-nav-sidebar\":{background:\"linear-gradient(180deg, #3e3020 0%, #2b2015 100%)\",\"border-right\":\"4px solid #8b4513\",position:\"relative\",\"box-shadow\":\"inset -5px 0 15px rgba(0,0,0,0.3)\"},\".dnd-nav-item\":{background:\"linear-gradient(90deg, #4a3a2a, #3a2a1a)\",border:\"2px solid #8b4513\",\"border-radius\":\"8px 0 0 8px\",margin:\"8px 0 8px 10px\",padding:\"12px 15px\",position:\"relative\",transition:\"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.1), 2px 2px 5px rgba(0,0,0,0.3)\"},\".dnd-nav-item:hover\":{background:\"linear-gradient(90deg, #5a4a3a, #4a3a2a)\",\"border-color\":\"#b8860b\",transform:\"translateX(5px)\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.2), 3px 3px 10px rgba(0,0,0,0.4), 0 0 15px rgba(184, 134, 11, 0.2)\"},\".dnd-nav-item.active\":{background:\"linear-gradient(90deg, rgba(184, 134, 11, 0.4), rgba(139, 69, 19, 0.3))\",\"box-shadow\":\"inset 0 0 20px rgba(184, 134, 11, 0.2), 0 0 20px rgba(205, 127, 50, 0.3)\",\"border-color\":\"#cd7f32\",transform:\"translateX(8px)\"},\".dnd-char-card\":{\"box-shadow\":\"0 0 0 4px #3e3020, 0 0 0 7px #b8860b, 0 0 0 9px #5c3a1a, 0 12px 35px rgba(43, 32, 21, 0.6)\",border:\"3px solid #8b4513\",\"border-radius\":\"12px\",background:\"linear-gradient(135deg, #3a2a1a 0%, #2f2318 50%, #2a1f15 100%)\",position:\"relative\",overflow:\"visible\"},\".dnd-card-header\":{\"border-bottom\":\"4px double #b8860b\",background:\"linear-gradient(90deg, rgba(184, 134, 11, 0.2), rgba(139, 69, 19, 0.15), rgba(184, 134, 11, 0.2))\",padding:\"15px 20px\",position:\"relative\",\"border-radius\":\"9px 9px 0 0\"},\".dnd-card-body\":{padding:\"20px\",background:\"linear-gradient(180deg, rgba(58, 42, 26, 0.5) 0%, rgba(42, 31, 21, 0.8) 100%)\",position:\"relative\"},\".dnd-bar-container\":{background:\"linear-gradient(180deg, #1a1510, #2a2015, #1a1510)\",border:\"3px solid #8b4513\",\"border-radius\":\"10px\",height:\"24px\",position:\"relative\",\"box-shadow\":\"inset 0 2px 5px rgba(0,0,0,0.5), 0 1px 0 rgba(255,255,255,0.1)\"},\".dnd-bar-fill\":{\"border-radius\":\"7px\",position:\"relative\",overflow:\"hidden\"},\".dnd-bar-hp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #8b4513, #cd7f32, #daa060, #cd7f32, #8b4513)\"},\".dnd-bar-exp .dnd-bar-fill\":{background:\"linear-gradient(90deg, #5c3a1a, #b8860b, #ffddaa, #b8860b, #5c3a1a)\"},\".dnd-btn, .dnd-action-btn\":{border:\"3px solid #8b4513\",\"border-radius\":\"8px\",background:\"linear-gradient(180deg, #5a4a3a 0%, #4a3a2a 50%, #3a2a1a 100%)\",\"box-shadow\":\"inset 0 2px 0 rgba(255,255,255,0.15), inset 0 -2px 5px rgba(0,0,0,0.3), 0 3px 8px rgba(0,0,0,0.4)\",position:\"relative\",\"text-shadow\":\"0 1px 2px rgba(0,0,0,0.5)\"},\".dnd-btn:hover, .dnd-action-btn:hover\":{background:\"linear-gradient(180deg, #6a5a4a 0%, #5a4a3a 50%, #4a3a2a 100%)\",\"border-color\":\"#b8860b\",\"box-shadow\":\"inset 0 2px 0 rgba(255,255,255,0.2), 0 5px 15px rgba(184, 134, 11, 0.3), 0 0 20px rgba(205, 127, 50, 0.2)\"},\".dnd-btn:active, .dnd-action-btn:active\":{background:\"linear-gradient(180deg, #3a2a1a 0%, #4a3a2a 50%, #5a4a3a 100%)\",\"box-shadow\":\"inset 0 3px 8px rgba(0,0,0,0.5), 0 1px 2px rgba(0,0,0,0.3)\"},\".dnd-stat-row\":{padding:\"10px 15px\",margin:\"4px 0\",background:\"linear-gradient(90deg, rgba(139, 69, 19, 0.1), transparent)\",\"border-left\":\"4px solid #8b4513\",position:\"relative\",transition:\"all 0.25s ease\"},\".dnd-stat-row:hover\":{background:\"linear-gradient(90deg, rgba(184, 134, 11, 0.15), rgba(139, 69, 19, 0.1), transparent)\",\"border-left-color\":\"#cd7f32\",\"padding-left\":\"20px\"},\".dnd-title, .dnd-char-name\":{\"text-shadow\":\"0 2px 4px rgba(0,0,0,0.5), 0 0 15px rgba(184, 134, 11, 0.4)\",\"letter-spacing\":\"0.08em\",\"font-weight\":\"600\"},\".dnd-panel, .dnd-dialog\":{background:\"linear-gradient(135deg, #3e3020, #2b2015)\",border:\"4px solid #8b4513\",\"border-radius\":\"15px\",\"box-shadow\":\"0 0 0 2px #5c3a1a, 0 0 0 5px #b8860b, 0 10px 40px rgba(43, 32, 21, 0.7)\",position:\"relative\"},\"#dnd-mini-hud\":{background:\"linear-gradient(135deg, #3a2a1a, #2a1f15)\",border:\"3px solid #b8860b\",\"border-radius\":\"12px\",\"box-shadow\":\"0 0 20px rgba(184, 134, 11, 0.3), inset 0 0 30px rgba(0,0,0,0.3)\"},\".dnd-input, .dnd-select, .dnd-textarea\":{background:\"linear-gradient(180deg, #2a2015, #3a2a1a)\",border:\"2px solid #8b4513\",\"border-radius\":\"6px\",color:\"#e6d0a0\",\"box-shadow\":\"inset 0 2px 5px rgba(0,0,0,0.3)\"},\".dnd-input:focus, .dnd-select:focus, .dnd-textarea:focus\":{\"border-color\":\"#cd7f32\",\"box-shadow\":\"inset 0 2px 5px rgba(0,0,0,0.3), 0 0 15px rgba(184, 134, 11, 0.3)\"},\".dnd-table th\":{background:\"linear-gradient(180deg, #5a4a3a, #4a3a2a)\",color:\"#ffddaa\",\"border-bottom\":\"3px solid #b8860b\",\"text-transform\":\"uppercase\",\"letter-spacing\":\"0.08em\",\"font-weight\":\"600\"},\".dnd-table td\":{\"border-bottom\":\"1px solid rgba(139, 69, 19, 0.3)\",padding:\"12px\"},\".dnd-table tr:hover td\":{background:\"rgba(184, 134, 11, 0.1)\"},\".dnd-badge\":{background:\"linear-gradient(135deg, #cd7f32, #b8860b, #8b4513)\",border:\"2px solid #5c3a1a\",\"border-radius\":\"5px\",\"box-shadow\":\"inset 0 1px 0 rgba(255,255,255,0.3), 0 2px 5px rgba(0,0,0,0.3)\",color:\"#2b2015\",\"font-weight\":\"700\"}},customCSS:'\\n            /* è’¸æ±½æœ‹å…‹åŠ¨ç”» */\\n            @keyframes gear-rotate {\\n                from { transform: rotate(0deg); }\\n                to { transform: rotate(360deg); }\\n            }\\n            \\n            @keyframes gear-rotate-reverse {\\n                from { transform: rotate(360deg); }\\n                to { transform: rotate(0deg); }\\n            }\\n            \\n            @keyframes steam-release {\\n                0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }\\n                20% { opacity: 0.8; }\\n                100% { opacity: 0; transform: translateY(-30px) scale(1.5); }\\n            }\\n            \\n            @keyframes pressure-pulse {\\n                0%, 100% { box-shadow: inset 0 0 10px rgba(205, 127, 50, 0.3); }\\n                50% { box-shadow: inset 0 0 20px rgba(255, 200, 100, 0.5); }\\n            }\\n            \\n            @keyframes piston-move {\\n                0%, 100% { transform: translateX(0); }\\n                50% { transform: translateX(3px); }\\n            }\\n            \\n            @keyframes dial-flicker {\\n                0%, 90%, 100% { opacity: 1; }\\n                92%, 98% { opacity: 0.7; }\\n            }\\n            \\n            /* å¡ç‰‡é½¿è½®è£…é¥° - å³ä¸Šè§’å¤§é½¿è½® */\\n            .dnd-char-card::before {\\n                content: \"âš™\";\\n                position: absolute;\\n                top: -15px;\\n                right: -15px;\\n                font-size: 45px;\\n                color: #b8860b;\\n                text-shadow:\\n                    2px 2px 0 #5c3a1a,\\n                    -1px -1px 0 #cd7f32,\\n                    0 0 10px rgba(184, 134, 11, 0.5);\\n                animation: gear-rotate 12s linear infinite;\\n                z-index: 10;\\n            }\\n            \\n            /* å¡ç‰‡é½¿è½®è£…é¥° - å·¦ä¸‹è§’å°é½¿è½® */\\n            .dnd-char-card::after {\\n                content: \"âš™\";\\n                position: absolute;\\n                bottom: -10px;\\n                left: -10px;\\n                font-size: 30px;\\n                color: #8b4513;\\n                text-shadow:\\n                    1px 1px 0 #5c3a1a,\\n                    0 0 8px rgba(139, 69, 19, 0.5);\\n                animation: gear-rotate-reverse 8s linear infinite;\\n                z-index: 10;\\n            }\\n            \\n            /* å¡ç‰‡å¤´éƒ¨é“†é’‰è£…é¥° */\\n            .dnd-card-header::before {\\n                content: \"â— â— â—\";\\n                position: absolute;\\n                left: 15px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                color: #cd7f32;\\n                font-size: 8px;\\n                letter-spacing: 8px;\\n                text-shadow:\\n                    0 1px 0 #5c3a1a,\\n                    0 -1px 0 rgba(255,255,255,0.3);\\n            }\\n            \\n            .dnd-card-header::after {\\n                content: \"â— â— â—\";\\n                position: absolute;\\n                right: 15px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                color: #cd7f32;\\n                font-size: 8px;\\n                letter-spacing: 8px;\\n                text-shadow:\\n                    0 1px 0 #5c3a1a,\\n                    0 -1px 0 rgba(255,255,255,0.3);\\n            }\\n            \\n            /* è¿›åº¦æ¡ - å‹åŠ›è¡¨æ•ˆæœ */\\n            .dnd-bar-fill::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; bottom: 0; left: 0; right: 0;\\n                background: repeating-linear-gradient(\\n                    90deg,\\n                    transparent,\\n                    transparent 8px,\\n                    rgba(0,0,0,0.2) 8px,\\n                    rgba(0,0,0,0.2) 10px\\n                );\\n            }\\n            \\n            .dnd-bar-fill::after {\\n                content: \"\";\\n                position: absolute;\\n                top: 2px;\\n                left: 0;\\n                right: 0;\\n                height: 40%;\\n                background: linear-gradient(180deg, rgba(255,255,255,0.3), transparent);\\n                border-radius: 5px 5px 0 0;\\n            }\\n            \\n            /* è¿›åº¦æ¡å®¹å™¨å‹åŠ›è¡¨åˆ»åº¦ */\\n            .dnd-bar-container::before {\\n                content: \"\";\\n                position: absolute;\\n                top: -8px;\\n                left: 10%;\\n                width: 80%;\\n                height: 5px;\\n                background: repeating-linear-gradient(\\n                    90deg,\\n                    #8b4513,\\n                    #8b4513 2px,\\n                    transparent 2px,\\n                    transparent 10px\\n                );\\n            }\\n            \\n            .dnd-bar-container::after {\\n                content: \"PSI\";\\n                position: absolute;\\n                right: 5px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                font-size: 8px;\\n                color: #b8860b;\\n                font-weight: 700;\\n                letter-spacing: 1px;\\n            }\\n            \\n            /* å¯¼èˆªé¡¹é½¿è½®å›¾æ ‡ */\\n            .dnd-nav-item::before {\\n                content: \"âš™\";\\n                position: absolute;\\n                left: 10px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                color: #8b4513;\\n                font-size: 14px;\\n                transition: transform 0.5s ease;\\n            }\\n            \\n            .dnd-nav-item:hover::before,\\n            .dnd-nav-item.active::before {\\n                animation: gear-rotate 2s linear infinite;\\n                color: #cd7f32;\\n            }\\n            \\n            .dnd-nav-item::after {\\n                content: \"\";\\n                position: absolute;\\n                right: 5px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                width: 8px;\\n                height: 8px;\\n                background: radial-gradient(circle, #cd7f32, #8b4513);\\n                border-radius: 50%;\\n                border: 2px solid #5c3a1a;\\n                box-shadow: inset 0 -1px 2px rgba(0,0,0,0.5);\\n            }\\n            \\n            /* åˆ†éš”çº¿ - é“œç®¡ */\\n            .dnd-divider {\\n                height: 8px;\\n                background: linear-gradient(180deg,\\n                    #5c3a1a 0%,\\n                    #cd7f32 20%,\\n                    #ffddaa 50%,\\n                    #cd7f32 80%,\\n                    #5c3a1a 100%\\n                );\\n                border-radius: 4px;\\n                position: relative;\\n                margin: 20px 0;\\n                box-shadow: 0 2px 5px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.3);\\n            }\\n            \\n            .dnd-divider::before {\\n                content: \"\";\\n                position: absolute;\\n                left: 20px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                width: 16px;\\n                height: 16px;\\n                background: radial-gradient(circle at 30% 30%, #cd7f32, #8b4513);\\n                border-radius: 50%;\\n                border: 2px solid #5c3a1a;\\n                box-shadow: inset 0 -2px 4px rgba(0,0,0,0.4);\\n            }\\n            \\n            .dnd-divider::after {\\n                content: \"\";\\n                position: absolute;\\n                right: 20px;\\n                top: 50%;\\n                transform: translateY(-50%);\\n                width: 16px;\\n                height: 16px;\\n                background: radial-gradient(circle at 30% 30%, #cd7f32, #8b4513);\\n                border-radius: 50%;\\n                border: 2px solid #5c3a1a;\\n                box-shadow: inset 0 -2px 4px rgba(0,0,0,0.4);\\n            }\\n            \\n            /* é¢æ¿è§’è½é½¿è½®è£…é¥° */\\n            .dnd-panel::before,\\n            .dnd-dialog::before {\\n                content: \"âš™\";\\n                position: absolute;\\n                top: 10px;\\n                left: 10px;\\n                font-size: 24px;\\n                color: #b8860b;\\n                text-shadow: 1px 1px 0 #5c3a1a;\\n                animation: gear-rotate 15s linear infinite;\\n            }\\n            \\n            .dnd-panel::after,\\n            .dnd-dialog::after {\\n                content: \"âš™\";\\n                position: absolute;\\n                bottom: 10px;\\n                right: 10px;\\n                font-size: 20px;\\n                color: #8b4513;\\n                text-shadow: 1px 1px 0 #5c3a1a;\\n                animation: gear-rotate-reverse 10s linear infinite;\\n            }\\n            \\n            /* æ»šåŠ¨æ¡ - é“œç®¡è½¨é“ */\\n            .dnd-content-area::-webkit-scrollbar {\\n                width: 14px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-track {\\n                background: linear-gradient(90deg, #2a2015, #3a2a1a, #2a2015);\\n                border: 2px solid #5c3a1a;\\n                border-radius: 7px;\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb {\\n                background: linear-gradient(180deg, #cd7f32, #b8860b, #8b4513, #b8860b, #cd7f32);\\n                border-radius: 7px;\\n                border: 2px solid #5c3a1a;\\n                box-shadow: inset 0 0 5px rgba(255,255,255,0.2);\\n            }\\n            \\n            .dnd-content-area::-webkit-scrollbar-thumb:hover {\\n                background: linear-gradient(180deg, #daa060, #cd7f32, #b8860b, #cd7f32, #daa060);\\n            }\\n            \\n            /* å›¾æ ‡å®¹å™¨ - åœ†å½¢å‹åŠ›è¡¨ */\\n            .dnd-icon-circle {\\n                border-radius: 50%;\\n                border: 4px solid #8b4513;\\n                background: radial-gradient(circle at 30% 30%, #4a3a2a, #2a1f15);\\n                box-shadow:\\n                    0 0 0 2px #b8860b,\\n                    0 0 15px rgba(184, 134, 11, 0.4),\\n                    inset 0 0 20px rgba(0,0,0,0.5);\\n                position: relative;\\n            }\\n            \\n            .dnd-icon-circle::before {\\n                content: \"\";\\n                position: absolute;\\n                inset: 3px;\\n                border: 1px solid rgba(184, 134, 11, 0.3);\\n                border-radius: 50%;\\n            }\\n            \\n            .dnd-icon-circle::after {\\n                content: \"\";\\n                position: absolute;\\n                top: 5px;\\n                left: 20%;\\n                width: 60%;\\n                height: 30%;\\n                background: linear-gradient(180deg, rgba(255,255,255,0.2), transparent);\\n                border-radius: 50%;\\n            }\\n            \\n            /* å¤´åƒæ¡† - å…«è§’é“œæ¡† */\\n            .dnd-avatar {\\n                clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);\\n                border: 4px solid #b8860b;\\n                box-shadow:\\n                    0 0 0 3px #5c3a1a,\\n                    0 0 20px rgba(184, 134, 11, 0.4);\\n                position: relative;\\n            }\\n            \\n            .dnd-avatar::before {\\n                content: \"\";\\n                position: absolute;\\n                inset: -8px;\\n                clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);\\n                background: linear-gradient(135deg, #cd7f32, #8b4513, #b8860b);\\n                z-index: -1;\\n            }\\n            \\n            /* å¡ç‰‡æ‚¬åœè’¸æ±½æ•ˆæœ */\\n            .dnd-char-card:hover {\\n                box-shadow:\\n                    0 0 0 4px #3e3020,\\n                    0 0 0 7px #cd7f32,\\n                    0 0 0 9px #5c3a1a,\\n                    0 15px 45px rgba(43, 32, 21, 0.7),\\n                    0 0 30px rgba(184, 134, 11, 0.3);\\n            }\\n            \\n            .dnd-char-card:hover::before {\\n                animation: gear-rotate 4s linear infinite;\\n                text-shadow:\\n                    2px 2px 0 #5c3a1a,\\n                    -1px -1px 0 #cd7f32,\\n                    0 0 20px rgba(255, 200, 100, 0.8);\\n            }\\n            \\n            /* å·¥å…·æç¤º - é“œç‰Œ */\\n            .dnd-tooltip {\\n                background: linear-gradient(135deg, #3e3020, #2b2015);\\n                border: 3px solid #8b4513;\\n                border-radius: 8px;\\n                box-shadow:\\n                    0 0 0 1px #b8860b,\\n                    0 5px 20px rgba(0,0,0,0.5);\\n            }\\n            \\n            .dnd-tooltip::before {\\n                content: \"âš™\";\\n                position: absolute;\\n                top: 5px;\\n                left: 8px;\\n                color: #cd7f32;\\n                font-size: 12px;\\n            }\\n            \\n            /* çš®é©çº¹ç†å åŠ  */\\n            .dnd-char-card > .dnd-card-body::before {\\n                content: \"\";\\n                position: absolute;\\n                top: 0; left: 0; right: 0; bottom: 0;\\n                background: url(\"data:image/svg+xml,%3Csvg viewBox=\\'0 0 100 100\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cfilter id=\\'noise\\'%3E%3CfeTurbulence type=\\'fractalNoise\\' baseFrequency=\\'0.8\\' numOctaves=\\'3\\'/%3E%3C/filter%3E%3Crect width=\\'100%25\\' height=\\'100%25\\' filter=\\'url(%23noise)\\' opacity=\\'0.03\\'/%3E%3C/svg%3E\");\\n                pointer-events: none;\\n            }\\n            \\n            /* ä¸åŒä½ç½®å¡ç‰‡çš„é½¿è½®å˜åŒ– */\\n            .dnd-char-card:nth-child(2n)::before {\\n                content: \"âš™\";\\n                top: -12px;\\n                right: auto;\\n                left: -12px;\\n                animation-direction: reverse;\\n            }\\n            \\n            .dnd-char-card:nth-child(2n)::after {\\n                bottom: auto;\\n                top: -8px;\\n                left: auto;\\n                right: -8px;\\n            }\\n            \\n            .dnd-char-card:nth-child(3n)::before {\\n                font-size: 35px;\\n                animation-duration: 8s;\\n            }\\n        ',background:{type:\"gears\",colors:[\"rgba(184, 134, 11, 0.35)\",\"rgba(139, 69, 19, 0.3)\",\"rgba(205, 127, 50, 0.25)\"],count:8,speed:.01,size:{min:40,max:100},animated:!0}}},Gr=n=>n in Br,Xr={currentStyleId:\"classic-dnd\",customStyles:{},STYLE_ELEMENT_ID:\"dnd-style-manager-overrides\",async init(){try{const e=await t.getSetting(o.STORAGE_KEYS.CUSTOM_STYLES);if(e)try{this.customStyles=JSON.parse(e),n.info(\"å·²åŠ è½½è‡ªå®šä¹‰é£æ ¼:\",Object.keys(this.customStyles).length)}catch(t){n.error(\"è§£æè‡ªå®šä¹‰é£æ ¼å¤±è´¥:\",t),this.customStyles={}}const a=await t.getSetting(o.STORAGE_KEYS.CURRENT_STYLE);a?await this.apply(a,!1):await this.apply(\"classic-dnd\",!1),n.info(\"StyleManager åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰é£æ ¼:\",this.currentStyleId)}catch(t){n.error(\"StyleManager åˆå§‹åŒ–å¤±è´¥:\",t)}},async apply(e,r=!0){try{const i=this.getStyle(e);if(!i)return n.warn(\"é£æ ¼ä¸å­˜åœ¨:\",e),!1;i.colors&&this._applyColorVars(i.colors),i.dimensions&&this._applyVars(i.dimensions),i.typography&&this._applyVars(i.typography),i.animations&&this._applyVars(i.animations),i.morphology&&this._applyMorphology(i.morphology),i.interactiveStates&&this._applyInteractiveStates(i.interactiveStates),i.overrides?this._applyOverrides(i.overrides):this._clearOverrides(),Hr.apply(i);const{window:d}=a();if(d&&d.DND_Dashboard_UI&&d.DND_Dashboard_UI.updateDynamicBackground){const n=i.background||{type:\"particles\",colors:[\"rgba(255, 219, 133, 0.8)\",\"rgba(157, 139, 108, 0.6)\",\"rgba(255, 255, 255, 0.5)\"]};d.DND_Dashboard_UI.updateDynamicBackground(n)}return this.currentStyleId=e,r&&await t.setSetting(o.STORAGE_KEYS.CURRENT_STYLE,e),n.info(\"å·²åº”ç”¨é£æ ¼:\",i.meta?.name||e),!0}catch(t){return n.error(\"åº”ç”¨é£æ ¼å¤±è´¥:\",t),!1}},getStyle(n){return Gr(n)?(n=>Br[n]||null)(n):this.customStyles[n]?this.customStyles[n]:null},getAvailableStyles(){return[...Object.values(Br).map(n=>({id:n.meta.id,name:n.meta.name,icon:n.meta.icon,description:n.meta.description,author:n.meta.author})),...Object.values(this.customStyles).map(n=>({id:n.meta.id,name:n.meta.name,icon:n.meta.icon||\"ğŸ¨\",description:n.meta.description||\"\",author:n.meta.author||\"ç”¨æˆ·\",isCustom:!0}))]},async importStyle(t){try{let n=t;if(\"string\"==typeof t)try{n=JSON.parse(t)}catch(n){return{success:!1,message:\"JSONæ ¼å¼æ— æ•ˆ\"}}const e=Yr.validate(n);if(!e.valid)return{success:!1,message:\"éªŒè¯å¤±è´¥: \"+e.errors.join(\"; \")};const a=e.sanitized,r=a.meta.id;Gr(r)&&(a.meta.id=r+\"-custom\",a.meta.name=a.meta.name+\" (è‡ªå®šä¹‰)\");const o=a.meta.id;this.customStyles[o]=a,await this._saveCustomStyles();const i=e.warnings.length>0?`\\næ³¨æ„: ${e.warnings.length}ä¸ªé¡¹ç›®è¢«è‡ªåŠ¨ä¿®æ­£`:\"\";return{success:!0,message:`é£æ ¼ \"${a.meta.name}\" å¯¼å…¥æˆåŠŸ${i}`,styleId:o,warnings:e.warnings}}catch(t){return n.error(\"å¯¼å…¥é£æ ¼å¤±è´¥:\",t),{success:!1,message:\"å¯¼å…¥å¤±è´¥: \"+t.message}}},exportStyle(t){const e=t||this.currentStyleId,a=this.getStyle(e);return a?JSON.stringify(a,null,2):(n.warn(\"å¯¼å‡ºå¤±è´¥ï¼šé£æ ¼ä¸å­˜åœ¨\",e),null)},async deleteCustomStyle(n){return Gr(n)?{success:!1,message:\"ä¸èƒ½åˆ é™¤å†…ç½®é£æ ¼\"}:this.customStyles[n]?(this.currentStyleId===n&&await this.apply(\"classic-dnd\"),delete this.customStyles[n],await this._saveCustomStyles(),{success:!0,message:\"å·²åˆ é™¤é£æ ¼\"}):{success:!1,message:\"é£æ ¼ä¸å­˜åœ¨\"}},async resetToDefault(){return await this.apply(\"classic-dnd\",!0),{success:!0,message:\"å·²é‡ç½®ä¸ºé»˜è®¤é£æ ¼\"}},_applyColorVars(n){const{window:t}=a();let e;try{e=t?.document?.documentElement||document.documentElement}catch(n){e=document.documentElement}if(!e)return;Object.entries(n).forEach(([n,t])=>{e.style.setProperty(n,t)});const r=n[\"--dnd-bg-panel-start\"]||\"#2b1b17\",o=n[\"--dnd-bg-panel-end\"]||\"#1a100e\",i=n[\"--dnd-bg-card-start\"]||\"#242424\",d=n[\"--dnd-bg-card-end\"]||\"#1a1a1c\";e.style.setProperty(\"--dnd-bg-panel\",`linear-gradient(to bottom, ${r}, ${o})`),e.style.setProperty(\"--dnd-bg-hud\",`linear-gradient(to bottom, ${r}, ${o})`),e.style.setProperty(\"--dnd-bg-card\",`linear-gradient(135deg, ${i} 0%, ${d} 100%)`),e.style.setProperty(\"--dnd-bg-popup\",`linear-gradient(to bottom, ${i}fc, ${d}fc)`)},_applyVars(n){const{window:t}=a();let e;try{e=t?.document?.documentElement||document.documentElement}catch(n){e=document.documentElement}e&&Object.entries(n).forEach(([n,t])=>{e.style.setProperty(n,t)})},_applyMorphology(t){if(!t||\"object\"!=typeof t)return;const{window:e}=a();let r;try{r=e?.document?.documentElement||document.documentElement}catch(n){r=document.documentElement}if(r){if(t.border){const{style:n,width:e,outerStyle:a}=t.border;n&&r.style.setProperty(\"--dnd-border-style\",n),e&&r.style.setProperty(\"--dnd-border-width\",e),a&&r.style.setProperty(\"--dnd-border-outer-style\",a)}if(t.corners){const{style:n,clipPath:e}=t.corners;e&&\"none\"!==e?r.style.setProperty(\"--dnd-card-clip-path\",e):r.style.setProperty(\"--dnd-card-clip-path\",\"none\"),n&&r.style.setProperty(\"--dnd-corner-style\",n)}if(t.card){const{shape:n,aspectRatio:e,transform:a,decoration:o}=t.card;n&&r.style.setProperty(\"--dnd-card-shape\",n),e&&r.style.setProperty(\"--dnd-card-aspect-ratio\",e),a&&\"none\"!==a&&r.style.setProperty(\"--dnd-card-transform\",a),o&&r.style.setProperty(\"--dnd-card-decoration\",o)}if(t.decorations){const{corners:n,dividers:e,headers:a,icons:o}=t.decorations;n&&r.style.setProperty(\"--dnd-corner-ornament\",n),e&&r.style.setProperty(\"--dnd-divider-style\",e),a&&r.style.setProperty(\"--dnd-header-decoration\",a),o&&r.style.setProperty(\"--dnd-icon-shape\",o)}if(t.effects){const{overlay:n,innerGlow:e,borderGlow:a,texture:o}=t.effects;n&&r.style.setProperty(\"--dnd-effect-overlay\",this._getOverlayValue(n)),e&&r.style.setProperty(\"--dnd-effect-inner-glow\",this._getGlowValue(e)),a&&r.style.setProperty(\"--dnd-effect-border-glow\",this._getGlowValue(a)),o&&r.style.setProperty(\"--dnd-effect-texture\",this._getTextureValue(o))}if(t.layout){const{density:n,cardMinWidth:e,gridGap:a}=t.layout;if(n){r.style.setProperty(\"--dnd-layout-density\",n);const t=\"compact\"===n?.75:\"spacious\"===n?1.25:1;r.style.setProperty(\"--dnd-density-multiplier\",String(t))}e&&r.style.setProperty(\"--dnd-card-min-width\",e),a&&r.style.setProperty(\"--dnd-grid-gap\",a)}n.debug(\"å·²åº”ç”¨å½¢æ€é…ç½®:\",t)}},_applyInteractiveStates(t){if(!t||\"object\"!=typeof t)return;const{window:e}=a();let r;try{r=e?.document?.documentElement||document.documentElement}catch(n){r=document.documentElement}if(r){if(t.hover){const{brightness:n,scale:e,lift:a,shadow:o,borderColor:i,glow:d,transition:s}=t.hover;n&&r.style.setProperty(\"--dnd-hover-brightness\",String(n)),e&&r.style.setProperty(\"--dnd-hover-scale\",String(e)),a&&r.style.setProperty(\"--dnd-hover-lift\",a),o&&r.style.setProperty(\"--dnd-hover-shadow\",o),i&&r.style.setProperty(\"--dnd-hover-border-color\",i),d&&r.style.setProperty(\"--dnd-hover-glow\",d),s&&r.style.setProperty(\"--dnd-hover-transition\",s)}if(t.cardHover){const{transform:n,shadow:e,borderColor:a}=t.cardHover;n&&r.style.setProperty(\"--dnd-card-hover-transform\",n),e&&r.style.setProperty(\"--dnd-card-hover-shadow\",e),a&&r.style.setProperty(\"--dnd-card-hover-border-color\",a)}if(t.buttonHover){const{brightness:n,transform:e,shadow:a}=t.buttonHover;n&&r.style.setProperty(\"--dnd-btn-hover-brightness\",String(n)),e&&r.style.setProperty(\"--dnd-btn-hover-transform\",e),a&&r.style.setProperty(\"--dnd-btn-hover-shadow\",a)}if(t.active){const{scale:n,brightness:e,transform:a,shadow:o}=t.active;n&&r.style.setProperty(\"--dnd-active-scale\",String(n)),e&&r.style.setProperty(\"--dnd-active-brightness\",String(e)),a&&r.style.setProperty(\"--dnd-active-transform\",a),o&&r.style.setProperty(\"--dnd-active-shadow\",o)}if(t.buttonActive){const{transform:n,shadow:e}=t.buttonActive;n&&r.style.setProperty(\"--dnd-btn-active-transform\",n),e&&r.style.setProperty(\"--dnd-btn-active-shadow\",e)}if(t.selected){const{background:n,borderColor:e,borderWidth:a,glow:o,textColor:i}=t.selected;n&&r.style.setProperty(\"--dnd-selected-bg\",n),e&&r.style.setProperty(\"--dnd-selected-border-color\",e),a&&r.style.setProperty(\"--dnd-selected-border-width\",a),o&&r.style.setProperty(\"--dnd-selected-glow\",o),i&&r.style.setProperty(\"--dnd-selected-text-color\",i)}if(t.navActive){const{background:n,border:e,indicator:a}=t.navActive;n&&r.style.setProperty(\"--dnd-nav-active-bg\",n),e&&r.style.setProperty(\"--dnd-nav-active-border\",e),a&&r.style.setProperty(\"--dnd-nav-active-indicator\",a)}if(t.focus){const{borderColor:n,shadow:e,outline:a}=t.focus;n&&r.style.setProperty(\"--dnd-focus-border-color\",n),e&&r.style.setProperty(\"--dnd-focus-shadow\",e),a&&r.style.setProperty(\"--dnd-focus-outline\",a)}if(t.disabled){const{opacity:n,cursor:e,filter:a}=t.disabled;n&&r.style.setProperty(\"--dnd-disabled-opacity\",String(n)),e&&r.style.setProperty(\"--dnd-disabled-cursor\",e),a&&r.style.setProperty(\"--dnd-disabled-filter\",a)}if(t.iconHover){const{glow:n,scale:e}=t.iconHover;n&&r.style.setProperty(\"--dnd-icon-hover-glow\",n),e&&r.style.setProperty(\"--dnd-icon-hover-scale\",String(e))}if(t.inputFocus){const{border:n,shadow:e}=t.inputFocus;n&&r.style.setProperty(\"--dnd-input-focus-border\",n),e&&r.style.setProperty(\"--dnd-input-focus-shadow\",e)}n.debug(\"å·²åº”ç”¨äº¤äº’çŠ¶æ€é…ç½®:\",t)}},_getOverlayValue:n=>({none:\"none\",noise:\"url(\\\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E\\\")\",scanlines:\"repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px)\",grid:\"linear-gradient(transparent 95%, rgba(0,255,255,0.1) 95%), linear-gradient(90deg, transparent 95%, rgba(0,255,255,0.1) 95%)\",hex:\"url(\\\"data:image/svg+xml,%3Csvg width='24' height='40' viewBox='0 0 24 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 40c5.523 0 10-4.477 10-10V10c0-5.523 4.477-10 10-10H0v40z' fill='rgba(255,255,255,0.03)' fill-rule='evenodd'/%3E%3C/svg%3E\\\")\",vignette:\"radial-gradient(ellipse at center, transparent 0%, transparent 60%, rgba(0,0,0,0.4) 100%)\",\"blood-vignette\":\"radial-gradient(ellipse at center, transparent 0%, transparent 50%, rgba(80,0,0,0.2) 100%)\",gradient:\"linear-gradient(135deg, rgba(255,255,255,0.05) 0%, transparent 50%, rgba(0,0,0,0.05) 100%)\"}[n]||\"none\"),_getGlowValue:n=>({none:\"none\",subtle:\"inset 0 0 10px rgba(255,255,255,0.05)\",medium:\"inset 0 0 20px rgba(255,255,255,0.1)\",strong:\"inset 0 0 30px rgba(255,255,255,0.15)\",neon:\"0 0 5px rgba(0,243,255,0.5), inset 0 0 10px rgba(0,243,255,0.2)\",gold:\"inset 0 0 15px rgba(255,215,0,0.1), 0 0 5px rgba(255,215,0,0.2)\",evil:\"inset 0 0 20px rgba(138,0,0,0.2), 0 0 10px rgba(138,0,0,0.3)\",pulse:\"inset 0 0 20px rgba(255,255,255,0.1)\"}[n]||\"none\"),_getTextureValue:n=>({none:\"none\",paper:\"url(\\\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='paper'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23paper)' opacity='0.03'/%3E%3C/svg%3E\\\")\",metal:\"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(0,0,0,0.1) 100%)\",wood:\"url(\\\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='wood'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.02 0.15' numOctaves='2'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23wood)' opacity='0.05'/%3E%3C/svg%3E\\\")\",stone:\"url(\\\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='stone'%3E%3CfeTurbulence type='turbulence' baseFrequency='0.05' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23stone)' opacity='0.04'/%3E%3C/svg%3E\\\")\",fabric:\"url(\\\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10'%3E%3Crect width='5' height='5' fill='rgba(0,0,0,0.02)'/%3E%3Crect x='5' y='5' width='5' height='5' fill='rgba(0,0,0,0.02)'/%3E%3C/svg%3E\\\")\",circuit:\"url(\\\"data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 10h80v80h-80z' fill='none' stroke='rgba(0,255,255,0.05)' stroke-width='1'/%3E%3Cpath d='M20 20l20 20h20l20-20' fill='none' stroke='rgba(0,255,255,0.05)' stroke-width='1'/%3E%3Ccircle cx='50' cy='50' r='5' fill='rgba(0,255,255,0.05)'/%3E%3C/svg%3E\\\")\",scales:\"url(\\\"data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 0c5.523 0 10 4.477 10 10s-4.477 10-10 10S0 15.523 0 10 4.477 0 10 0z' fill='none' stroke='rgba(0,0,0,0.2)' stroke-width='1'/%3E%3C/svg%3E\\\")\",stars:\"radial-gradient(1px 1px at 20px 30px, #eee, rgba(0,0,0,0)), radial-gradient(1px 1px at 40px 70px, #fff, rgba(0,0,0,0)), radial-gradient(1px 1px at 50px 160px, #ddd, rgba(0,0,0,0))\"}[n]||\"none\"),_applyOverrides(t){const{$:e,window:r}=a(),o=r?.document||document;if(this._clearOverrides(),!t||0===Object.keys(t).length)return;let i=\"\";if(Object.entries(t).forEach(([n,t])=>{if(!t||\"object\"!=typeof t)return;const e=Object.entries(t).map(([n,t])=>`${n}: ${t} !important`).join(\"; \");e&&(i+=`${n} { ${e}; }\\n`)}),i){const t=o.createElement(\"style\");t.id=this.STYLE_ELEMENT_ID,t.textContent=i,o.head.appendChild(t),n.debug(\"å·²æ³¨å…¥è¦†ç›–æ ·å¼:\",i.length,\"bytes\")}},_clearOverrides(){const{$:n,window:t}=a(),e=(t?.document||document).getElementById(this.STYLE_ELEMENT_ID);e&&e.remove()},async _saveCustomStyles(){try{await t.setSetting(o.STORAGE_KEYS.CUSTOM_STYLES,JSON.stringify(this.customStyles))}catch(t){n.error(\"ä¿å­˜è‡ªå®šä¹‰é£æ ¼å¤±è´¥:\",t)}},getCurrentStyle(){return{id:this.currentStyleId,...this.getStyle(this.currentStyleId)?.meta||{}}},isCurrentStyle(n){return this.currentStyleId===n},previewStyle(n){const t=this.currentStyleId;return this.apply(n,!1),()=>{this.apply(t,!1)}},downloadStyle(n){const t=this.exportStyle(n);if(!t)return!1;const e=this.getStyle(n),a=`dnd-style-${e?.meta?.id||\"export\"}.json`,r=new Blob([t],{type:\"application/json\"}),o=URL.createObjectURL(r),i=document.createElement(\"a\");return i.href=o,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o),!0},async importFromFile(n){return new Promise((t,e)=>{const a=new FileReader;a.onload=async n=>{try{const e=await this.importStyle(n.target.result);t(e)}catch(n){e(n)}},a.onerror=()=>e(new Error(\"æ–‡ä»¶è¯»å–å¤±è´¥\")),a.readAsText(n)})}},Wr={_lastCombatState:null,getAPI:function(){try{if(window.AutoCardUpdaterAPI)return window.AutoCardUpdaterAPI;if(window.parent&&window.parent.AutoCardUpdaterAPI)return window.parent.AutoCardUpdaterAPI;if(window.top&&window.top.AutoCardUpdaterAPI)return window.top.AutoCardUpdaterAPI}catch(t){n.error(\"[PresetSwitcher] è·å– API å¤±è´¥:\",t)}return null},switchPreset:function(t){const e=this.getAPI();if(!e)return n.warn(\"[PresetSwitcher] AutoCardUpdaterAPI ä¸å¯ç”¨ï¼Œæ— æ³•åˆ‡æ¢é¢„è®¾\"),!1;if(!e.switchPlotPreset)return n.warn(\"[PresetSwitcher] switchPlotPreset æ–¹æ³•ä¸å¯ç”¨\"),!1;try{const a=e.switchPlotPreset(t);return a?n.info(`[PresetSwitcher] é¢„è®¾å·²åˆ‡æ¢è‡³: ${t}`):n.warn(`[PresetSwitcher] é¢„è®¾åˆ‡æ¢å¤±è´¥: ${t} (å¯èƒ½ä¸å­˜åœ¨)`),a}catch(t){return n.error(\"[PresetSwitcher] åˆ‡æ¢é¢„è®¾æ—¶å‘ç”Ÿé”™è¯¯:\",t),!1}},checkCombatStateChange:function(t){if(t&&!this._lastCombatState&&mo&&mo.initResourceTracker&&mo.initResourceTracker(),!o.PRESET_SWITCHING.ENABLED)return;if(null===this._lastCombatState)return this._lastCombatState=t,void n.info(\"[PresetSwitcher] åˆå§‹åŒ–æˆ˜æ–—çŠ¶æ€: \"+(t?\"æˆ˜æ–—ä¸­\":\"æ¢ç´¢ä¸­\"));if(this._lastCombatState===t)return;this._lastCombatState=t;const e=t?o.PRESET_SWITCHING.COMBAT_PRESET:o.PRESET_SWITCHING.EXPLORE_PRESET;n.info(\"[PresetSwitcher] æ£€æµ‹åˆ°æˆ˜æ–—çŠ¶æ€å˜åŒ–: \"+(t?\"è¿›å…¥æˆ˜æ–—\":\"é€€å‡ºæˆ˜æ–—\")),n.info(`[PresetSwitcher] æ­£åœ¨åˆ‡æ¢é¢„è®¾è‡³: ${e}`);this.switchPreset(e)&&this.showNotification(t,`é¢„è®¾å·²åˆ‡æ¢: ${e}`)},showNotification:function(n,t){void 0===t&&\"string\"==typeof n&&(t=n,n=!1);const{$:e}=a(),r=e(\"#dnd-hud-status-text\");if(!r.length)return;const o=n?\"âš”ï¸\":\"ğŸ§­\",i=n?\"var(--dnd-accent-red)\":\"var(--dnd-accent-green)\",d=r.html(),s=t&&(t.includes(\"é¢„è®¾\")||t.includes(\"åˆ‡æ¢\"))?t:`é€šçŸ¥: ${t}`;r.html(`<span style=\"color:${i};animation:dnd-pulse 1s infinite;\">${o} ${s}</span>`),setTimeout(()=>{r.text().includes(s.replace(/<[^>]+>/g,\"\"))&&r.html(d)},3e3)},getCurrentPreset:function(){const n=this.getAPI();return n&&n.getCurrentPlotPreset?n.getCurrentPlotPreset():null},getAvailablePresets:function(){const n=this.getAPI();return n&&n.getPlotPresetNames?n.getPlotPresetNames():[]}},Vr={_activeEffects:new Map,_canvasContexts:new Map,_animationFrames:new Map,_effectConfigs:{},PRESETS:{gears:{name:\"æœºæ¢°é½¿è½®\",icon:\"âš™ï¸\",description:\"ç¼“æ…¢è½¬åŠ¨çš„é½¿è½®ï¼Œè’¸æ±½æœ‹å…‹é£æ ¼\",gearCount:5,colors:[\"rgba(157, 139, 108, 0.3)\",\"rgba(92, 75, 53, 0.25)\",\"rgba(139, 119, 89, 0.2)\"],speedMultiplier:.3,minSize:40,maxSize:120,teethCount:[8,12,16,20,24]},ripples:{name:\"æ°´æ³¢çº¹\",icon:\"ğŸ’§\",description:\"æŸ”å’Œçš„æ³¢çº¹æ‰©æ•£æ•ˆæœ\",rippleCount:3,colors:[\"rgba(157, 139, 108, 0.2)\",\"rgba(255, 219, 133, 0.15)\"],maxRadius:200,speed:.5,interval:3e3},particles:{name:\"é­”æ³•ç²’å­\",icon:\"âœ¨\",description:\"æ¼‚æµ®çš„é­”æ³•å…‰ç‚¹\",particleCount:30,colors:[\"rgba(255, 219, 133, 0.8)\",\"rgba(157, 139, 108, 0.6)\",\"rgba(255, 255, 255, 0.5)\"],minSize:2,maxSize:5,speed:.3,connectionDistance:100,showConnections:!0},runes:{name:\"é­”æ³•ç¬¦æ–‡\",icon:\"ğŸ”¯\",description:\"è‹¥éšè‹¥ç°çš„ç¥ç§˜ç¬¦æ–‡\",runeCount:8,symbols:[\"âš”\",\"ğŸ›¡\",\"âœ§\",\"â—ˆ\",\"â—‡\",\"â¬¡\",\"â¬¢\",\"â–³\",\"â–½\",\"â˜†\",\"â˜…\",\"âš\",\"âœ¦\",\"â–\"],colors:[\"rgba(255, 219, 133, 0.3)\",\"rgba(157, 139, 108, 0.25)\"],rotateSpeed:.2,pulseSpeed:.02,fontSize:28},starfield:{name:\"æ˜Ÿç©º\",icon:\"ğŸŒŒ\",description:\"é—ªçƒçš„æ˜Ÿç©ºèƒŒæ™¯\",starCount:50,colors:[\"rgba(255, 255, 255, 0.9)\",\"rgba(255, 219, 133, 0.8)\",\"rgba(200, 200, 255, 0.7)\"],twinkleSpeed:.03,shootingStarChance:.001},gradient:{name:\"æµå…‰æº¢å½©\",icon:\"ğŸŒˆ\",description:\"æŸ”å’Œçš„æ¸å˜è‰²å—æµåŠ¨\",blobCount:4,colors:[\"rgba(157, 139, 108, 0.2)\",\"rgba(92, 75, 53, 0.18)\",\"rgba(139, 69, 19, 0.15)\",\"rgba(255, 219, 133, 0.12)\"],speed:.2,blur:60},grid:{name:\"ç§‘æŠ€ç½‘æ ¼\",icon:\"ğŸ•¸ï¸\",description:\"å¸¦æœ‰è„‰å†²æ•ˆæœçš„ç§‘æŠ€ç½‘æ ¼\",gridSize:30,lineColor:\"rgba(157, 139, 108, 0.2)\",pulseColor:\"rgba(255, 219, 133, 0.5)\",pulseSpeed:.5,pulseFrequency:2e3},dna:{name:\"DNAèºæ—‹\",icon:\"ğŸ§¬\",description:\"æ—‹è½¬çš„åŒèºæ—‹ç»“æ„\",helixCount:2,pointsPerHelix:20,colors:[\"rgba(255, 219, 133, 0.6)\",\"rgba(157, 139, 108, 0.5)\"],rotationSpeed:.01,amplitude:50,frequency:.1},stripes:{name:\"åŠ¨æ„Ÿæ¡çº¹\",icon:\"ğŸ’ˆ\",description:\"å€¾æ–œæ»šåŠ¨çš„æ¡çº¹èƒŒæ™¯\",color:\"rgba(157, 139, 108, 0.15)\",lineWidth:20,gapWidth:20,angle:-45,speed:.5},dots:{name:\"ç‚¹é˜µçŸ©é˜µ\",icon:\"â ¸\",description:\"è§„å¾‹æ’åˆ—çš„ç‚¹é˜µèƒŒæ™¯\",color:\"rgba(157, 139, 108, 0.3)\",radius:2,spacing:20,speedX:.1,speedY:.05},hex:{name:\"å…­è¾¹å½¢èœ‚å·¢\",icon:\"ğŸ’ \",description:\"ç§‘æŠ€æ„Ÿå…­è¾¹å½¢èœ‚å·¢ç½‘æ ¼\",color:\"rgba(157, 139, 108, 0.15)\",size:15,strokeWidth:1.5,speedY:.2},topo:{name:\"åœ°ç†ç­‰é«˜çº¿\",icon:\"ğŸ—ºï¸\",description:\"åŠ¨æ€æµåŠ¨çš„åœ°ç†ç­‰é«˜çº¿\",color:\"rgba(157, 139, 108, 0.5)\",lineCount:10,speed:.2,amplitude:20,frequency:.01},iso:{name:\"ç­‰è½´ç½‘æ ¼\",icon:\"ğŸ§Š\",description:\"æˆ˜æœ¯ç­–ç•¥æ¸¸æˆçš„ç­‰è½´è§†è§’ç½‘æ ¼\",color:\"rgba(44, 76, 138, 0.25)\",gridSize:30,speed:.5},radar:{name:\"é›·è¾¾æ‰«æ\",icon:\"ğŸ“¡\",description:\"æ—‹è½¬æ‰«æçš„é›·è¾¾ç•Œé¢\",gridColor:\"rgba(58, 107, 74, 0.2)\",sweepColor:\"rgba(58, 107, 74, 0.5)\",speed:.02,gridSize:40},blueprint:{name:\"å·¥ç¨‹è“å›¾\",icon:\"ğŸ“\",description:\"ç²¾ç»†çš„å·¥ç¨‹è®¾è®¡è“å›¾ç½‘æ ¼\",majorColor:\"rgba(44, 76, 138, 0.25)\",minorColor:\"rgba(44, 76, 138, 0.15)\",majorSize:100,minorSize:20,speed:.3},geo:{name:\"å‡ ä½•æµ®åŠ¨\",icon:\"ğŸ”·\",description:\"ç¥ç§˜æ¼‚æµ®çš„å‡ ä½•å›¾å½¢\",count:8,colors:[\"rgba(157, 139, 108, 0.4)\",\"rgba(255, 255, 255, 0.3)\"],minSize:30,maxSize:80,speed:.1},crt:{name:\"CRT ä¿¡å·\",icon:\"ğŸ“º\",description:\"å¤å¤æ˜¾ç¤ºå™¨çš„æ‰«æçº¿ä¸å™ªç‚¹\",scanlineColor:\"rgba(0, 0, 0, 0.3)\",scanlineHeight:4,noiseColor:\"rgba(255, 255, 255, 0.1)\",flickerSpeed:.1}},init(t,e=\"particles\",r={}){const{$:o}=a(),i=o(t);if(!i.length)return n.warn(\"[DynamicBackground] Container not found:\",t),null;const d=`dnd-bg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={...this.PRESETS[e]||this.PRESETS.particles,...r,type:e},l=document.createElement(\"canvas\");l.id=d,l.className=\"dnd-dynamic-bg-canvas\",l.style.cssText=\"\\n            position: absolute;\\n            top: 0;\\n            left: 0;\\n            width: 100%;\\n            height: 100%;\\n            pointer-events: none;\\n            z-index: 0;\\n            opacity: 0;\\n            transition: opacity 0.5s ease-in-out;\\n        \";\"static\"===i.css(\"position\")&&i.css(\"position\",\"relative\"),i.prepend(l);const c=l.getContext(\"2d\");this._resizeCanvas(l,i[0]),this._effectConfigs[d]=s,this._canvasContexts.set(d,{canvas:l,ctx:c,container:i[0]}),this._initEffectData(d,s),this._startAnimation(d),setTimeout(()=>{l.style.opacity=\"1\"},50);const p=()=>this._resizeCanvas(l,i[0]);return window.addEventListener(\"resize\",p),this._activeEffects.set(d,{resizeHandler:p,config:s}),n.debug(\"[DynamicBackground] Initialized effect:\",e,\"with ID:\",d),d},_initEffectData(n,t){const{canvas:e}=this._canvasContexts.get(n),a=e.width,r=e.height;switch(void 0!==t.count&&(\"particles\"===t.type&&(t.particleCount=t.count),\"gears\"===t.type&&(t.gearCount=t.count),\"ripples\"===t.type&&(t.rippleCount=t.count),\"runes\"===t.type&&(t.runeCount=t.count),\"starfield\"===t.type&&(t.starCount=t.count),\"gradient\"===t.type&&(t.blobCount=t.count)),t.type){case\"gears\":this._initGears(n,t,a,r);break;case\"ripples\":this._initRipples(n,t,a,r);break;case\"particles\":this._initParticles(n,t,a,r);break;case\"runes\":this._initRunes(n,t,a,r);break;case\"starfield\":this._initStarfield(n,t,a,r);break;case\"gradient\":this._initGradient(n,t,a,r);break;case\"grid\":this._initGrid(n,t,a,r);break;case\"dna\":this._initDNA(n,t,a,r);break;case\"stripes\":case\"topo\":this._effectConfigs[n].data={offset:0};break;case\"dots\":case\"blueprint\":this._effectConfigs[n].data={offsetX:0,offsetY:0};break;case\"hex\":this._effectConfigs[n].data={scrollY:0};break;case\"iso\":this._effectConfigs[n].data={scrollX:0};break;case\"radar\":this._effectConfigs[n].data={angle:0};break;case\"geo\":this._initGeo(n,t,a,r);break;case\"crt\":this._effectConfigs[n].data={time:0}}},_initGears(n,t,e,a){const r=[];for(let n=0;n<t.gearCount;n++)r.push({x:Math.random()*e,y:Math.random()*a,radius:t.minSize+Math.random()*(t.maxSize-t.minSize),teeth:t.teethCount[Math.floor(Math.random()*t.teethCount.length)],rotation:Math.random()*Math.PI*2,speed:.02*(Math.random()-.5)*t.speedMultiplier,color:t.colors[Math.floor(Math.random()*t.colors.length)],direction:Math.random()>.5?1:-1});this._effectConfigs[n].data={gears:r}},_initRipples(n,t,e,a){const r=[],o=()=>({x:Math.random()*e,y:Math.random()*a,radius:0,maxRadius:t.maxRadius*(.5+.5*Math.random()),opacity:.5,color:t.colors[Math.floor(Math.random()*t.colors.length)],speed:t.speed*(.8+.4*Math.random())});for(let n=0;n<t.rippleCount;n++){const n=o();n.radius=Math.random()*t.maxRadius,r.push(n)}this._effectConfigs[n].data={ripples:r,createRipple:o};const i=setInterval(()=>{r.length<2*t.rippleCount&&r.push(o())},t.interval);this._effectConfigs[n].intervalId=i},_initParticles(n,t,e,a){const r=[];for(let n=0;n<t.particleCount;n++)r.push({x:Math.random()*e,y:Math.random()*a,vx:(Math.random()-.5)*t.speed,vy:(Math.random()-.5)*t.speed,size:t.minSize+Math.random()*(t.maxSize-t.minSize),color:t.colors[Math.floor(Math.random()*t.colors.length)],alpha:.3+.7*Math.random()});this._effectConfigs[n].data={particles:r}},_initRunes(n,t,e,a){const r=[];for(let n=0;n<t.runeCount;n++)r.push({x:Math.random()*e,y:Math.random()*a,symbol:t.symbols[Math.floor(Math.random()*t.symbols.length)],rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*t.rotateSpeed,scale:.5+1*Math.random(),alpha:0,alphaDirection:1,color:t.colors[Math.floor(Math.random()*t.colors.length)],fontSize:t.fontSize*(.5+Math.random())});this._effectConfigs[n].data={runes:r}},_initStarfield(n,t,e,a){const r=[];for(let n=0;n<t.starCount;n++)r.push({x:Math.random()*e,y:Math.random()*a,size:.5+2*Math.random(),color:t.colors[Math.floor(Math.random()*t.colors.length)],alpha:Math.random(),alphaSpeed:(Math.random()-.5)*t.twinkleSpeed,twinklePhase:Math.random()*Math.PI*2});this._effectConfigs[n].data={stars:r,shootingStars:[]}},_initGradient(n,t,e,a){const r=[];for(let n=0;n<t.blobCount;n++)r.push({x:Math.random()*e,y:Math.random()*a,radius:50+100*Math.random(),vx:(Math.random()-.5)*t.speed,vy:(Math.random()-.5)*t.speed,color:t.colors[n%t.colors.length]});this._effectConfigs[n].data={blobs:r}},_initGrid(n,t,e,a){this._effectConfigs[n].data={pulses:[],lastPulseTime:0}},_initDNA(n,t,e,a){this._effectConfigs[n].data={rotation:0,time:0}},_initGeo(n,t,e,a){const r=[];for(let n=0;n<t.count;n++)r.push({x:Math.random()*e,y:Math.random()*a,size:t.minSize+Math.random()*(t.maxSize-t.minSize),vx:(Math.random()-.5)*t.speed,vy:(Math.random()-.5)*t.speed,color:t.colors[Math.floor(Math.random()*t.colors.length)],rotation:360*Math.random(),rotateSpeed:.5*(Math.random()-.5),type:Math.random()>.5?\"square\":\"circle\"});this._effectConfigs[n].data={shapes:r}},_startAnimation(n){const t=this._effectConfigs[n],e=this._canvasContexts.get(n);if(!t||!e)return;const a=()=>{this._renderFrame(n),this._animationFrames.set(n,requestAnimationFrame(a))};a()},_renderFrame(n){const t=this._effectConfigs[n],e=this._canvasContexts.get(n);if(!t||!e)return;const{canvas:a,ctx:r}=e,o=a.width,i=a.height;try{switch(r.clearRect(0,0,o,i),t.type){case\"gears\":this._renderGears(r,t,o,i);break;case\"ripples\":this._renderRipples(r,t,o,i);break;case\"particles\":this._renderParticles(r,t,o,i);break;case\"runes\":this._renderRunes(r,t,o,i);break;case\"starfield\":this._renderStarfield(r,t,o,i);break;case\"gradient\":this._renderGradient(r,t,o,i);break;case\"grid\":this._renderGrid(r,t,o,i);break;case\"dna\":this._renderDNA(r,t,o,i);break;case\"stripes\":this._renderStripes(r,t,o,i);break;case\"dots\":this._renderDots(r,t,o,i);break;case\"hex\":this._renderHex(r,t,o,i);break;case\"topo\":this._renderTopo(r,t,o,i);break;case\"iso\":this._renderIso(r,t,o,i);break;case\"radar\":this._renderRadar(r,t,o,i);break;case\"blueprint\":this._renderBlueprint(r,t,o,i);break;case\"geo\":this._renderGeo(r,t,o,i);break;case\"crt\":this._renderCRT(r,t,o,i)}}catch(n){console.error(\"[DynamicBackground] Render error:\",n)}},_setAlpha(n,t){if(!n)return`rgba(255, 255, 255, ${t})`;if(n.startsWith(\"#\")){let e=0,a=0,r=0;return 4===n.length?(e=parseInt(n[1]+n[1],16),a=parseInt(n[2]+n[2],16),r=parseInt(n[3]+n[3],16)):7===n.length&&(e=parseInt(n.slice(1,3),16),a=parseInt(n.slice(3,5),16),r=parseInt(n.slice(5,7),16)),`rgba(${e}, ${a}, ${r}, ${t})`}return n.startsWith(\"rgba\")?n.replace(/[\\d.]+\\)$/,`${t})`):n.startsWith(\"rgb\")?n.replace(\"rgb\",\"rgba\").replace(\")\",`, ${t})`):n},_renderGears(n,t,e,a){const{gears:r}=t.data;r.forEach(t=>{t.rotation+=t.speed*t.direction,n.save(),n.translate(t.x,t.y),n.rotate(t.rotation),n.beginPath(),n.strokeStyle=t.color,n.lineWidth=2;const e=.6*t.radius,a=t.radius,r=.15*t.radius;for(let o=0;o<t.teeth;o++){const i=o/t.teeth*Math.PI*2,d=(o+.5)/t.teeth*Math.PI*2,s=Math.cos(i)*e,l=Math.sin(i)*e,c=Math.cos(i)*(a+r),p=Math.sin(i)*(a+r),g=Math.cos(d)*(a+r),f=Math.sin(d)*(a+r),b=Math.cos(d)*e,m=Math.sin(d)*e;0===o&&n.moveTo(s,l),n.lineTo(c,p),n.lineTo(g,f),n.lineTo(b,m)}n.closePath(),n.stroke(),n.beginPath(),n.arc(0,0,.3*e,0,2*Math.PI),n.stroke();for(let t=0;t<4;t++){const a=t/4*Math.PI*2;n.beginPath(),n.moveTo(Math.cos(a)*e*.3,Math.sin(a)*e*.3),n.lineTo(Math.cos(a)*e*.9,Math.sin(a)*e*.9),n.stroke()}n.restore()})},_renderRipples(n,t,e,a){const{ripples:r}=t.data;if(r)for(let t=r.length-1;t>=0;t--){const e=r[t];e.radius+=e.speed,e.opacity=1-e.radius/e.maxRadius,e.radius>=e.maxRadius?r.splice(t,1):(n.beginPath(),n.arc(e.x,e.y,e.radius,0,2*Math.PI),n.strokeStyle=this._setAlpha(e.color,.8*e.opacity),n.lineWidth=2,n.stroke(),e.radius>20&&(n.beginPath(),n.arc(e.x,e.y,.7*e.radius,0,2*Math.PI),n.strokeStyle=this._setAlpha(e.color,.5*e.opacity),n.stroke()))}},_renderParticles(n,t,e,a){const{particles:r}=t.data;if(r&&(r.forEach(t=>{t.x+=t.vx,t.y+=t.vy,(t.x<0||t.x>e)&&(t.vx*=-1),(t.y<0||t.y>a)&&(t.vy*=-1),n.beginPath(),n.arc(t.x,t.y,t.size,0,2*Math.PI),n.fillStyle=t.color,n.fill();const r=n.createRadialGradient(t.x,t.y,0,t.x,t.y,3*t.size);r.addColorStop(0,this._setAlpha(t.color,.6)),r.addColorStop(1,\"transparent\"),n.beginPath(),n.arc(t.x,t.y,3*t.size,0,2*Math.PI),n.fillStyle=r,n.fill()}),t.showConnections)){const e=t.colors&&t.colors.length>0?t.colors[0]:\"rgba(157, 139, 108, 1)\";n.lineWidth=.5;for(let a=0;a<r.length;a++)for(let o=a+1;o<r.length;o++){const i=r[a].x-r[o].x,d=r[a].y-r[o].y,s=Math.sqrt(i*i+d*d);if(s<t.connectionDistance){const i=1-s/t.connectionDistance;n.strokeStyle=this._setAlpha(e,.3*i),n.beginPath(),n.moveTo(r[a].x,r[a].y),n.lineTo(r[o].x,r[o].y),n.stroke()}}}},_renderRunes(n,t,e,a){const{runes:r}=t.data;r&&r.forEach(r=>{r.alpha+=r.alphaDirection*t.pulseSpeed,r.alpha>=1?(r.alpha=1,r.alphaDirection=-1):r.alpha<=0&&(r.alpha=0,r.alphaDirection=1,r.x=Math.random()*e,r.y=Math.random()*a,r.symbol=t.symbols[Math.floor(Math.random()*t.symbols.length)]),r.rotation+=r.rotationSpeed,n.save(),n.translate(r.x,r.y),n.rotate(r.rotation),n.scale(r.scale,r.scale),n.font=`${r.fontSize}px serif`,n.textAlign=\"center\",n.textBaseline=\"middle\",n.fillStyle=this._setAlpha(r.color,.8*r.alpha),n.fillText(r.symbol,0,0),n.shadowColor=\"rgba(255, 219, 133, 0.7)\",n.shadowBlur=10*r.alpha,n.fillText(r.symbol,0,0),n.restore()})},_renderStarfield(n,t,e,a){const{stars:r,shootingStars:o}=t.data;if(r){r.forEach(e=>{e.twinklePhase+=t.twinkleSpeed,e.alpha=.5+.3*Math.sin(e.twinklePhase)+.2,n.beginPath(),n.arc(e.x,e.y,e.size,0,2*Math.PI),n.fillStyle=this._setAlpha(e.color,e.alpha),n.fill()}),Math.random()<t.shootingStarChance&&o.push({x:Math.random()*e,y:0,length:50+100*Math.random(),speed:5+10*Math.random(),angle:Math.PI/4+Math.random()*Math.PI/4,alpha:1});for(let t=o.length-1;t>=0;t--){const r=o[t];if(r.x+=Math.cos(r.angle)*r.speed,r.y+=Math.sin(r.angle)*r.speed,r.alpha-=.02,r.alpha<=0||r.x>e||r.y>a){o.splice(t,1);continue}const i=n.createLinearGradient(r.x,r.y,r.x-Math.cos(r.angle)*r.length,r.y-Math.sin(r.angle)*r.length);i.addColorStop(0,`rgba(255, 255, 255, ${r.alpha})`),i.addColorStop(1,\"transparent\"),n.beginPath(),n.strokeStyle=i,n.lineWidth=2,n.moveTo(r.x,r.y),n.lineTo(r.x-Math.cos(r.angle)*r.length,r.y-Math.sin(r.angle)*r.length),n.stroke()}}},_renderGradient(n,t,e,a){const{blobs:r}=t.data;n.filter=`blur(${t.blur}px)`,r.forEach(t=>{t.x+=t.vx,t.y+=t.vy,(t.x<-t.radius||t.x>e+t.radius)&&(t.vx*=-1),(t.y<-t.radius||t.y>a+t.radius)&&(t.vy*=-1);const r=n.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius);r.addColorStop(0,t.color),r.addColorStop(1,\"transparent\"),n.beginPath(),n.arc(t.x,t.y,t.radius,0,2*Math.PI),n.fillStyle=r,n.fill()}),n.filter=\"none\"},_renderGrid(n,t,e,a){const{pulses:r}=t.data;if(!r)return;const o=Date.now();n.strokeStyle=t.lineColor,n.lineWidth=.5;for(let r=0;r<=e;r+=t.gridSize)n.beginPath(),n.moveTo(r,0),n.lineTo(r,a),n.stroke();for(let r=0;r<=a;r+=t.gridSize)n.beginPath(),n.moveTo(0,r),n.lineTo(e,r),n.stroke();o-(t.data.lastPulseTime||0)>t.pulseFrequency&&(r.push({x:Math.floor(Math.random()*(e/t.gridSize))*t.gridSize,y:Math.floor(Math.random()*(a/t.gridSize))*t.gridSize,radius:0,maxRadius:.3*Math.min(e,a),alpha:1}),t.data.lastPulseTime=o);for(let e=r.length-1;e>=0;e--){const a=r[e];if(a.radius+=2*t.pulseSpeed,a.alpha=1-a.radius/a.maxRadius,a.radius>=a.maxRadius){r.splice(e,1);continue}const o=a.radius;n.strokeStyle=this._setAlpha(t.pulseColor,.8*a.alpha),n.lineWidth=2,n.beginPath(),n.arc(a.x,a.y,o,0,2*Math.PI),n.stroke()}},_renderDNA(n,t,e,a){const{data:r}=t;r.time+=t.rotationSpeed;const o=e/2;n.strokeStyle=t.colors[0],n.lineWidth=2;for(let e=0;e<t.helixCount;e++){const i=e*Math.PI;n.beginPath();for(let e=0;e<=t.pointsPerHelix;e++){const d=e/t.pointsPerHelix,s=.1*a+d*a*.8,l=o+Math.sin(d*t.frequency*Math.PI*2+r.time+i)*t.amplitude;0===e?n.moveTo(l,s):n.lineTo(l,s)}n.strokeStyle=t.colors[e%t.colors.length],n.stroke()}n.strokeStyle=\"rgba(157, 139, 108, 0.2)\",n.lineWidth=1;for(let e=0;e<t.pointsPerHelix;e+=2){const i=e/t.pointsPerHelix,d=.1*a+i*a*.8,s=o+Math.sin(i*t.frequency*Math.PI*2+r.time)*t.amplitude,l=o+Math.sin(i*t.frequency*Math.PI*2+r.time+Math.PI)*t.amplitude;n.beginPath(),n.moveTo(s,d),n.lineTo(l,d),n.stroke()}},_renderStripes(n,t,e,a){const{data:r}=t;r.offset=(r.offset+t.speed)%(t.lineWidth+t.gapWidth),n.save();const o=Math.sqrt(e*e+a*a);n.translate(e/2,a/2),n.rotate(t.angle*Math.PI/180),n.translate(-o,-o),n.fillStyle=t.color;const i=t.lineWidth+t.gapWidth,d=Math.ceil(2*o/i);for(let e=0;e<d;e++){const a=e*i+r.offset;n.fillRect(a,0,t.lineWidth,2*o)}n.restore()},_renderDots(n,t,e,a){const{data:r}=t;r.offsetX=(r.offsetX+t.speedX)%t.spacing,r.offsetY=(r.offsetY+t.speedY)%t.spacing,n.fillStyle=t.color;for(let o=-t.spacing;o<e+t.spacing;o+=t.spacing)for(let e=-t.spacing;e<a+t.spacing;e+=t.spacing)n.beginPath(),n.arc(o+r.offsetX,e+r.offsetY,t.radius,0,2*Math.PI),n.fill()},_renderHex(n,t,e,a){const{data:r}=t;r.scrollY=(r.scrollY+t.speedY)%(t.size*Math.sqrt(3));const o=t.size,i=o*Math.sqrt(3),d=.75*(2*o);n.strokeStyle=t.color,n.lineWidth=t.strokeWidth;const s=Math.ceil(e/d)+1,l=Math.ceil(a/i)+2,c=(t,e)=>{n.beginPath();for(let a=0;a<6;a++){const r=Math.PI/3*a,i=t+o*Math.cos(r),d=e+o*Math.sin(r);0===a?n.moveTo(i,d):n.lineTo(i,d)}n.closePath(),n.stroke()};for(let n=-1;n<s;n++)for(let t=-1;t<l;t++){let e=n*d,a=t*i+r.scrollY;n%2!=0&&(a+=i/2),c(e,a)}},_renderTopo(n,t,e,a){const{data:r}=t;r.offset+=t.frequency,n.strokeStyle=t.color,n.lineWidth=1;for(let o=0;o<t.lineCount;o++){n.beginPath();const i=a/2+30*(o-t.lineCount/2);for(let a=0;a<=e;a+=10){const e=i+Math.sin(.01*(a+1e3*r.offset)+o)*t.amplitude+Math.cos(.02*(a-500*r.offset))*(t.amplitude/2);0===a?n.moveTo(a,e):n.lineTo(a,e)}n.stroke()}},_renderIso(n,t,e,a){const{data:r}=t;r.scrollX=(r.scrollX+t.speed)%(2*t.gridSize),n.strokeStyle=t.color,n.lineWidth=1;const o=t.gridSize,i=Math.sqrt(e*e+a*a);n.save(),n.beginPath();const d=2*Math.ceil(i/o);for(let t=-d;t<d;t++){const a=t*o+r.scrollX;n.moveTo(0,a),n.lineTo(e,e*Math.tan(30*Math.PI/180)+a)}for(let t=-d;t<d;t++){const a=t*o;n.moveTo(0,a),n.lineTo(e,-e*Math.tan(30*Math.PI/180)+a)}n.stroke(),n.restore()},_renderRadar(n,t,e,a){const{data:r}=t;r.angle=(r.angle+t.speed)%(2*Math.PI);const o=e/2,i=a/2,d=.8*Math.max(e,a);n.strokeStyle=t.gridColor,n.lineWidth=1;for(let e=t.gridSize;e<d;e+=t.gridSize)n.beginPath(),n.arc(o,i,e,0,2*Math.PI),n.stroke();n.beginPath(),n.moveTo(o,0),n.lineTo(o,a),n.moveTo(0,i),n.lineTo(e,i),n.stroke(),n.save(),n.translate(o,i),n.rotate(r.angle);try{const e=n.createConicGradient(0,0,0);e.addColorStop(0,\"transparent\"),e.addColorStop(.8,\"transparent\"),e.addColorStop(1,t.sweepColor),n.fillStyle=e,n.beginPath(),n.arc(0,0,d,0,2*Math.PI),n.fill()}catch(e){n.beginPath(),n.moveTo(0,0),n.arc(0,0,d,-.5,0),n.fillStyle=t.sweepColor,n.globalAlpha=.3,n.fill()}n.restore()},_renderBlueprint(n,t,e,a){const{data:r}=t;r.offsetX=(r.offsetX+t.speed)%t.majorSize,r.offsetY=(r.offsetY+t.speed)%t.majorSize;const o=(t,o,i)=>{n.strokeStyle=o,n.lineWidth=i;const d=r.offsetX%t,s=r.offsetY%t;n.beginPath();for(let r=-t;r<=e+t;r+=t)n.moveTo(r+d,0),n.lineTo(r+d,a);for(let r=-t;r<=a+t;r+=t)n.moveTo(0,r+s),n.lineTo(e,r+s);n.stroke()};o(t.minorSize,t.minorColor,.5),o(t.majorSize,t.majorColor,1)},_renderGeo(n,t,e,a){const{shapes:r}=t.data;r.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.rotation+=t.rotateSpeed,t.x<-t.size&&(t.x=e+t.size),t.x>e+t.size&&(t.x=-t.size),t.y<-t.size&&(t.y=a+t.size),t.y>a+t.size&&(t.y=-t.size),n.save(),n.translate(t.x,t.y),n.rotate(t.rotation*Math.PI/180),n.strokeStyle=t.color,n.lineWidth=2,n.beginPath(),\"square\"===t.type?n.rect(-t.size/2,-t.size/2,t.size,t.size):n.arc(0,0,t.size/2,0,2*Math.PI),n.stroke(),n.restore()})},_renderCRT(n,t,e,a){const{data:r}=t;r.time+=t.flickerSpeed,n.fillStyle=t.scanlineColor;for(let r=0;r<a;r+=2*t.scanlineHeight)n.fillRect(0,r,e,t.scanlineHeight);n.fillStyle=t.noiseColor;for(let t=0;t<20;t++){const t=Math.random()*e,r=Math.random()*a,o=100*Math.random(),i=2;n.fillRect(t,r,o,i)}const o=.05+.02*Math.sin(10*r.time);n.fillStyle=`rgba(255, 255, 255, ${o})`,n.fillRect(0,0,e,a)},_resizeCanvas(n,t){const e=t.getBoundingClientRect(),a=window.devicePixelRatio||1;n.width=e.width*a,n.height=e.height*a,n.style.width=e.width+\"px\",n.style.height=e.height+\"px\";n.getContext(\"2d\").scale(a,a)},destroy(t){const e=this._activeEffects.get(t),a=this._canvasContexts.get(t),r=this._effectConfigs[t];e&&(window.removeEventListener(\"resize\",e.resizeHandler),this._activeEffects.delete(t)),r&&r.intervalId&&clearInterval(r.intervalId);const o=this._animationFrames.get(t);o&&(cancelAnimationFrame(o),this._animationFrames.delete(t)),a&&(a.canvas.style.opacity=\"0\",setTimeout(()=>{a.canvas.remove()},500),this._canvasContexts.delete(t)),delete this._effectConfigs[t],n.debug(\"[DynamicBackground] Destroyed effect:\",t)},destroyAll(){[...this._activeEffects.keys()].forEach(n=>this.destroy(n))},switchEffect(t,e,a={}){if(!this._canvasContexts.get(t))return;const r=this._effectConfigs[t];r&&r.intervalId&&clearInterval(r.intervalId);const o={...this.PRESETS[e]||this.PRESETS.particles,...a,type:e};this._effectConfigs[t]=o,this._initEffectData(t,o),n.debug(\"[DynamicBackground] Switched effect to:\",e,\"with config:\",a)},getAvailableEffects(){return Object.entries(this.PRESETS).map(([n,t])=>({id:n,name:t.name,icon:t.icon,description:t.description}))}},qr=Vr,Kr={state:{currentTableKey:null,isExpanded:!1,btnCols:\"auto\",isConfigLoaded:!1,stylesInjected:!1,searchKeyword:\"\",filteredRowIndices:null,searchDebounceTimer:null,fieldLayout:\"single\"},injectStyles(){const{$:n}=a();this.state.stylesInjected||(0===n(\"#dnd-table-manager-styles\").length&&n(\"head\").append(\"\\n<style id=\\\"dnd-table-manager-styles\\\">\\n    /* è¡¨æ ¼æŒ‰é’®æ ·å¼ */\\n    .dnd-tm-table-btn {\\n        padding: 6px 12px;\\n        border: 1px solid #444;\\n        border-radius: 6px;\\n        cursor: pointer;\\n        font-size: 12px;\\n        font-weight: 500;\\n        white-space: nowrap;\\n        overflow: hidden;\\n        text-overflow: ellipsis;\\n        background: linear-gradient(135deg, #2a2a2c 0%, #1f1f21 100%);\\n        color: #ccc;\\n        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);\\n        box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.05);\\n        position: relative;\\n        overflow: hidden;\\n    }\\n    \\n    .dnd-tm-table-btn::before {\\n        content: '';\\n        position: absolute;\\n        top: 0;\\n        left: -100%;\\n        width: 100%;\\n        height: 100%;\\n        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);\\n        transition: left 0.4s ease;\\n    }\\n    \\n    .dnd-tm-table-btn:hover {\\n        background: linear-gradient(135deg, #3a3a3c 0%, #2a2a2c 100%);\\n        border-color: var(--dnd-border-gold);\\n        color: #fff;\\n        transform: translateY(-2px);\\n        box-shadow: 0 4px 12px rgba(0,0,0,0.4), 0 0 20px rgba(var(--dnd-gold-rgb, 212,175,55), 0.15);\\n    }\\n    \\n    .dnd-tm-table-btn:hover::before {\\n        left: 100%;\\n    }\\n    \\n    .dnd-tm-table-btn:active {\\n        transform: translateY(0) scale(0.98);\\n        transition-duration: 0.1s;\\n    }\\n    \\n    .dnd-tm-table-btn.active {\\n        background: linear-gradient(135deg, var(--dnd-border-gold) 0%, #a08030 100%);\\n        color: #000;\\n        border-color: var(--dnd-border-gold);\\n        box-shadow: 0 0 15px rgba(var(--dnd-gold-rgb, 212,175,55), 0.4), inset 0 1px 0 rgba(255,255,255,0.2);\\n        font-weight: 600;\\n    }\\n    \\n    .dnd-tm-table-btn.active:hover {\\n        background: linear-gradient(135deg, #e0c060 0%, var(--dnd-border-gold) 100%);\\n    }\\n    \\n    /* å¡ç‰‡å®¹å™¨åŠ¨ç”» */\\n    .dnd-tm-cards-container {\\n        flex: 1;\\n        overflow-y: auto;\\n        overflow-x: hidden;\\n        display: flex;\\n        flex-wrap: wrap;\\n        gap: 12px;\\n        align-content: flex-start;\\n        justify-content: center;\\n        min-height: 100px;\\n        padding: 5px;\\n    }\\n    \\n    /* å¡ç‰‡æ ·å¼ */\\n    .dnd-tm-card {\\n        width: 100%;\\n        max-width: 320px;\\n        flex: 1 1 280px;\\n        background: linear-gradient(145deg, #2a2a2c 0%, #1a1a1c 50%, #151517 100%);\\n        border: 1px solid rgba(100,100,100,0.3);\\n        border-radius: 10px;\\n        padding: 12px;\\n        display: flex;\\n        flex-direction: column;\\n        gap: 10px;\\n        box-shadow: 0 4px 20px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.03);\\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\\n        margin: 2px;\\n        position: relative;\\n        overflow: hidden;\\n        animation: cardSlideIn 0.3s ease-out forwards;\\n        opacity: 0;\\n        transform: translateY(10px);\\n    }\\n    \\n    @keyframes cardSlideIn {\\n        to {\\n            opacity: 1;\\n            transform: translateY(0);\\n        }\\n    }\\n    \\n    .dnd-tm-card::before {\\n        content: '';\\n        position: absolute;\\n        top: 0;\\n        left: 0;\\n        right: 0;\\n        height: 2px;\\n        background: linear-gradient(90deg, transparent, var(--dnd-border-gold), transparent);\\n        opacity: 0;\\n        transition: opacity 0.3s;\\n    }\\n    \\n    .dnd-tm-card:hover {\\n        border-color: var(--dnd-border-gold);\\n        transform: translateY(-4px) scale(1.01);\\n        box-shadow: 0 8px 30px rgba(0,0,0,0.6), 0 0 25px rgba(var(--dnd-gold-rgb, 212,175,55), 0.1);\\n    }\\n    \\n    .dnd-tm-card:hover::before {\\n        opacity: 1;\\n    }\\n    \\n    /* å¡ç‰‡æ ‡é¢˜ */\\n    .dnd-tm-card-header {\\n        font-weight: bold;\\n        color: var(--dnd-text-highlight);\\n        border-bottom: 1px solid rgba(100,100,100,0.3);\\n        padding-bottom: 8px;\\n        margin-bottom: 4px;\\n        display: flex;\\n        justify-content: space-between;\\n        align-items: center;\\n    }\\n    \\n    .dnd-tm-card-title {\\n        overflow: hidden;\\n        text-overflow: ellipsis;\\n        white-space: nowrap;\\n        max-width: 70%;\\n        font-size: 14px;\\n        text-shadow: 0 1px 2px rgba(0,0,0,0.5);\\n    }\\n    \\n    /* ä¿å­˜æŒ‰é’® */\\n    .dnd-tm-save-btn {\\n        background: linear-gradient(135deg, var(--dnd-accent-green, #4CAF50) 0%, #388E3C 100%);\\n        color: #fff;\\n        border: none;\\n        border-radius: 5px;\\n        padding: 4px 10px;\\n        font-size: 11px;\\n        cursor: pointer;\\n        transition: all 0.2s;\\n        box-shadow: 0 2px 5px rgba(0,0,0,0.3);\\n        display: flex;\\n        align-items: center;\\n        gap: 4px;\\n    }\\n    \\n    .dnd-tm-save-btn:hover {\\n        background: linear-gradient(135deg, #5CBF60 0%, #4CAF50 100%);\\n        transform: scale(1.05);\\n        box-shadow: 0 4px 10px rgba(0,0,0,0.4);\\n    }\\n    \\n    .dnd-tm-save-btn:active {\\n        transform: scale(0.95);\\n    }\\n    \\n    .dnd-tm-save-btn:disabled {\\n        opacity: 0.7;\\n        cursor: not-allowed;\\n        transform: none;\\n    }\\n    \\n    /* å­—æ®µå®¹å™¨ */\\n    .dnd-tm-fields {\\n        max-height: 220px;\\n        overflow-y: auto;\\n        padding-right: 5px;\\n    }\\n    \\n    .dnd-tm-fields::-webkit-scrollbar {\\n        width: 4px;\\n    }\\n    \\n    .dnd-tm-fields::-webkit-scrollbar-track {\\n        background: rgba(0,0,0,0.2);\\n        border-radius: 2px;\\n    }\\n    \\n    .dnd-tm-fields::-webkit-scrollbar-thumb {\\n        background: rgba(var(--dnd-gold-rgb, 212,175,55), 0.3);\\n        border-radius: 2px;\\n    }\\n    \\n    /* å­—æ®µé¡¹ */\\n    .dnd-tm-field-item {\\n        margin-bottom: 10px;\\n        animation: fieldFadeIn 0.2s ease-out forwards;\\n        opacity: 0;\\n    }\\n    \\n    @keyframes fieldFadeIn {\\n        to { opacity: 1; }\\n    }\\n    \\n    .dnd-tm-field-label {\\n        font-size: 11px;\\n        color: #888;\\n        margin-bottom: 3px;\\n        display: flex;\\n        align-items: center;\\n        gap: 5px;\\n    }\\n    \\n    .dnd-tm-field-label::before {\\n        content: '';\\n        width: 3px;\\n        height: 10px;\\n        background: var(--dnd-border-gold);\\n        border-radius: 1px;\\n        opacity: 0.6;\\n    }\\n    \\n    /* è¾“å…¥æ¡† */\\n    .dnd-tm-input {\\n        width: 100%;\\n        background: rgba(0,0,0,0.3);\\n        border: 1px solid #444;\\n        border-bottom: 2px solid #555;\\n        color: var(--dnd-text-main);\\n        font-size: 13px;\\n        padding: 6px 8px;\\n        border-radius: 5px;\\n        transition: all 0.25s;\\n        box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);\\n    }\\n    \\n    .dnd-tm-input:hover {\\n        border-color: #666;\\n        background: rgba(0,0,0,0.35);\\n    }\\n    \\n    .dnd-tm-input:focus {\\n        outline: none;\\n        border-color: var(--dnd-text-highlight);\\n        border-bottom-color: var(--dnd-text-highlight);\\n        background: rgba(0,0,0,0.4);\\n        box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 0 10px rgba(var(--dnd-gold-rgb, 212,175,55), 0.1);\\n    }\\n    \\n    /* ç©ºçŠ¶æ€æç¤º */\\n    .dnd-tm-empty-state {\\n        color: #666;\\n        width: 100%;\\n        text-align: center;\\n        margin-top: 30px;\\n        font-size: 14px;\\n    }\\n    \\n    .dnd-tm-empty-state i {\\n        display: block;\\n        font-size: 32px;\\n        margin-bottom: 10px;\\n        opacity: 0.5;\\n    }\\n    \\n    /* ========== æœç´¢æ æ ·å¼ ========== */\\n    .dnd-tm-toolbar {\\n        display: flex;\\n        align-items: center;\\n        gap: 10px;\\n        padding: 10px;\\n        background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.25) 100%);\\n        border-radius: 8px;\\n        margin-bottom: 12px;\\n        border: 1px solid rgba(100,100,100,0.2);\\n    }\\n    \\n    .dnd-tm-search-wrapper {\\n        flex: 1;\\n        min-width: 150px;\\n        max-width: 280px;\\n        display: flex;\\n        align-items: center;\\n        background: rgba(0,0,0,0.4);\\n        border: 1px solid #3a3a3c;\\n        border-radius: 6px;\\n        padding: 7px 12px;\\n        transition: all 0.25s;\\n    }\\n    \\n    .dnd-tm-search-wrapper:focus-within {\\n        border-color: var(--dnd-border-gold);\\n        background: rgba(0,0,0,0.5);\\n        box-shadow: 0 0 10px rgba(var(--dnd-gold-rgb, 212,175,55), 0.2);\\n    }\\n    \\n    .dnd-tm-search-wrapper i {\\n        color: #777;\\n        margin-right: 8px;\\n        font-size: 13px;\\n    }\\n    \\n    .dnd-tm-search-input {\\n        flex: 1;\\n        background: transparent !important;\\n        border: none !important;\\n        color: var(--dnd-text-main, #ccc) !important;\\n        outline: none !important;\\n        font-size: 13px;\\n        box-shadow: none !important;\\n    }\\n    \\n    .dnd-tm-search-input::placeholder {\\n        color: #666;\\n    }\\n    \\n    .dnd-tm-search-clear {\\n        background: transparent;\\n        border: none;\\n        color: #666;\\n        cursor: pointer;\\n        font-size: 16px;\\n        padding: 2px 6px;\\n        transition: all 0.2s;\\n        display: none;\\n        border-radius: 3px;\\n    }\\n    \\n    .dnd-tm-search-clear:hover {\\n        color: #e74c3c;\\n        background: rgba(231, 76, 60, 0.15);\\n    }\\n    \\n    .dnd-tm-search-clear.visible {\\n        display: block;\\n    }\\n    \\n    .dnd-tm-search-count {\\n        color: #888;\\n        font-size: 11px;\\n        white-space: nowrap;\\n        padding: 4px 8px;\\n        background: rgba(0,0,0,0.2);\\n        border-radius: 4px;\\n    }\\n    \\n    .dnd-tm-toolbar-actions {\\n        display: flex;\\n        align-items: center;\\n        gap: 8px;\\n        margin-left: auto;\\n    }\\n    \\n    /* ========== å¸ƒå±€åˆ‡æ¢æŒ‰é’® ========== */\\n    .dnd-tm-layout-btn {\\n        background: linear-gradient(135deg, #2a2a2c 0%, #1f1f21 100%);\\n        border: 1px solid #3a3a3c;\\n        color: #999;\\n        padding: 7px 12px;\\n        border-radius: 6px;\\n        cursor: pointer;\\n        transition: all 0.25s;\\n        font-size: 13px;\\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\\n    }\\n    \\n    .dnd-tm-layout-btn:hover {\\n        border-color: var(--dnd-border-gold);\\n        color: var(--dnd-text-highlight);\\n        transform: translateY(-1px);\\n        box-shadow: 0 3px 8px rgba(0,0,0,0.3);\\n    }\\n    \\n    .dnd-tm-layout-btn.active {\\n        background: linear-gradient(135deg, rgba(var(--dnd-gold-rgb, 212,175,55), 0.25) 0%, rgba(var(--dnd-gold-rgb, 212,175,55), 0.15) 100%);\\n        border-color: var(--dnd-border-gold);\\n        color: var(--dnd-text-highlight);\\n    }\\n    \\n    /* ========== æ–°å¢æŒ‰é’® ========== */\\n    .dnd-tm-add-btn {\\n        background: linear-gradient(135deg, var(--dnd-accent-green, #4CAF50) 0%, #388E3C 100%);\\n        color: #fff;\\n        border: none;\\n        border-radius: 6px;\\n        padding: 7px 14px;\\n        font-size: 12px;\\n        font-weight: 500;\\n        cursor: pointer;\\n        display: flex;\\n        align-items: center;\\n        gap: 6px;\\n        transition: all 0.25s;\\n        box-shadow: 0 2px 6px rgba(0,0,0,0.3);\\n        white-space: nowrap;\\n    }\\n    \\n    .dnd-tm-add-btn:hover {\\n        background: linear-gradient(135deg, #5CBF60 0%, var(--dnd-accent-green, #4CAF50) 100%);\\n        transform: translateY(-2px);\\n        box-shadow: 0 4px 12px rgba(0,0,0,0.4);\\n    }\\n    \\n    .dnd-tm-add-btn:active {\\n        transform: translateY(0) scale(0.98);\\n    }\\n    \\n    .dnd-tm-add-btn:disabled {\\n        opacity: 0.5;\\n        cursor: not-allowed;\\n        transform: none;\\n        background: #444;\\n    }\\n    \\n    /* ========== åˆ é™¤æŒ‰é’® ========== */\\n    .dnd-tm-delete-btn {\\n        background: transparent;\\n        color: #888;\\n        border: none;\\n        padding: 4px 8px;\\n        cursor: pointer;\\n        font-size: 12px;\\n        transition: all 0.2s;\\n        border-radius: 4px;\\n    }\\n    \\n    .dnd-tm-delete-btn:hover {\\n        background: rgba(231, 76, 60, 0.2);\\n        color: #e74c3c;\\n    }\\n    \\n    .dnd-tm-card-actions {\\n        display: flex;\\n        align-items: center;\\n        gap: 4px;\\n    }\\n    \\n    /* ========== ç¡®è®¤å¯¹è¯æ¡† ========== */\\n    .dnd-tm-dialog-overlay {\\n        position: fixed !important;\\n        top: 0 !important;\\n        left: 0 !important;\\n        width: 100vw !important;\\n        height: 100vh !important;\\n        background: rgba(0,0,0,0.7) !important;\\n        z-index: 2147483650 !important;\\n        animation: dialogFadeIn 0.2s ease-out;\\n    }\\n    \\n    @keyframes dialogFadeIn {\\n        from { opacity: 0; }\\n        to { opacity: 1; }\\n    }\\n    \\n    .dnd-tm-dialog {\\n        position: fixed !important;\\n        top: 50% !important;\\n        left: 50% !important;\\n        transform: translate(-50%, -50%) !important;\\n        background: linear-gradient(145deg, #2a2a2c 0%, #1a1a1c 100%);\\n        border: 1px solid #444;\\n        border-radius: 10px;\\n        padding: 20px;\\n        min-width: 280px;\\n        max-width: 90vw;\\n        box-shadow: 0 10px 40px rgba(0,0,0,0.5);\\n        z-index: 2147483651 !important;\\n        animation: dialogSlideIn 0.2s ease-out;\\n    }\\n    \\n    @keyframes dialogSlideIn {\\n        from { transform: translate(-50%, -50%) translateY(-20px); opacity: 0; }\\n        to { transform: translate(-50%, -50%) translateY(0); opacity: 1; }\\n    }\\n    \\n    .dnd-tm-dialog-title {\\n        font-size: 16px;\\n        font-weight: bold;\\n        color: var(--dnd-text-highlight);\\n        margin-bottom: 10px;\\n        display: flex;\\n        align-items: center;\\n        gap: 8px;\\n    }\\n    \\n    .dnd-tm-dialog-message {\\n        color: #ccc;\\n        font-size: 14px;\\n        margin-bottom: 20px;\\n        line-height: 1.5;\\n    }\\n    \\n    .dnd-tm-dialog-actions {\\n        display: flex;\\n        justify-content: flex-end;\\n        gap: 10px;\\n    }\\n    \\n    .dnd-tm-dialog-btn {\\n        padding: 8px 16px;\\n        border-radius: 4px;\\n        cursor: pointer;\\n        font-size: 13px;\\n        transition: all 0.2s;\\n    }\\n    \\n    .dnd-tm-dialog-btn.cancel {\\n        background: #333;\\n        border: 1px solid #555;\\n        color: #ccc;\\n    }\\n    \\n    .dnd-tm-dialog-btn.cancel:hover {\\n        background: #444;\\n        border-color: #666;\\n    }\\n    \\n    .dnd-tm-dialog-btn.confirm {\\n        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\\n        border: none;\\n        color: #fff;\\n    }\\n    \\n    .dnd-tm-dialog-btn.confirm:hover {\\n        background: linear-gradient(135deg, #ec7063 0%, #e74c3c 100%);\\n    }\\n    \\n    /* ========== å­—æ®µå¸ƒå±€æ¨¡å¼ ========== */\\n    .dnd-tm-fields.layout-single .dnd-tm-field-item {\\n        width: 100%;\\n    }\\n    \\n    .dnd-tm-fields.layout-double {\\n        display: flex;\\n        flex-wrap: wrap;\\n        gap: 8px;\\n    }\\n    \\n    .dnd-tm-fields.layout-double .dnd-tm-field-item {\\n        flex: 1 1 calc(50% - 4px);\\n        min-width: 100px;\\n        margin-bottom: 0;\\n    }\\n    \\n    /* ========== æœç´¢é«˜äº® ========== */\\n    .dnd-tm-highlight {\\n        background: rgba(var(--dnd-gold-rgb, 212,175,55), 0.3);\\n        border-radius: 2px;\\n        padding: 0 2px;\\n    }\\n</style>\\n\"),this.state.stylesInjected=!0)},init(){const{$:n}=a();this._initialized||(this._initialized=!0,this.injectStyles(),n(document).on(\"dnd:settings-changed\",async()=>{this.state.isConfigLoaded=!1,this.state.isExpanded&&n(\"#dnd-tm-table-buttons\").length&&await this.render(n(\"#dnd-table-manager-container\"))}))},async loadConfig(){if(this.state.isConfigLoaded)return;const n=await t.getSetting(\"dnd_tm_cols\"),e=await t.getSetting(\"dnd_tm_hidden_tables\"),a=await t.getSetting(\"dnd_tm_field_layout\");if(n&&(this.state.btnCols=\"auto\"===n?\"auto\":parseInt(n)),e)try{this.state.hiddenTables=JSON.parse(e)}catch(n){this.state.hiddenTables=[]}else this.state.hiddenTables=[];!a||\"single\"!==a&&\"double\"!==a||(this.state.fieldLayout=a),this.state.isConfigLoaded=!0,this.updateButtonLayout()},updateButtonLayout(){const{$:n}=a(),t=n(\"#dnd-tm-table-buttons\");if(!t.length)return;const e=this.state.btnCols;if(\"auto\"===e)t.css({display:\"flex\",flexWrap:\"wrap\",gridTemplateColumns:\"none\"}),t.find(\".dnd-tm-table-btn\").css({flex:\"1 1 auto\",width:\"auto\",maxWidth:\"150px\"});else{const n=parseInt(e)||3;t.css({display:\"grid\",gridTemplateColumns:`repeat(${n}, 1fr)`,flexWrap:\"nowrap\"}),t.find(\".dnd-tm-table-btn\").css({flex:\"none\",width:\"auto\",maxWidth:\"none\"})}},async render(n){const{$:t}=a();n.empty(),this.init(),await this.loadConfig();const e=Rr.getAllData();if(!e)return void n.html('<div style=\"color:#aaa;padding:10px;\">æ— æ³•åŠ è½½æ•°æ®</div>');const r=Object.keys(e).filter(n=>(!this.state.hiddenTables||!this.state.hiddenTables.includes(n))&&(n.startsWith(\"sheet_\")||e[n].name&&e[n].mate));if(0===r.length)return void n.html('<div style=\"color:#aaa;padding:10px;\">æ²¡æœ‰å¯è§çš„è¡¨æ ¼ (è¯·åœ¨è®¾ç½®ä¸­æ£€æŸ¥éšè—åˆ—è¡¨)</div>');const o=\"double\"===this.state.fieldLayout?\"fa-table-list\":\"fa-table-columns\",i=\"double\"===this.state.fieldLayout?\"active\":\"\",d=t(`\\n            <div class=\"dnd-table-manager\" style=\"padding:12px;background:linear-gradient(180deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.4) 100%);max-height:450px;display:flex;flex-direction:column;border-radius:8px;\">\\n                \\x3c!-- é¡¶éƒ¨é€‰æ‹©æ  (æŒ‰é’®ç»„) --\\x3e\\n                <div style=\"margin-bottom:12px;display:flex;gap:6px;align-items:flex-start;\">\\n                    <div id=\"dnd-tm-table-buttons\" style=\"flex:1;display:flex;flex-wrap:wrap;gap:6px;max-height:100px;overflow-y:auto;padding:2px;\">\\n                        ${r.map(n=>{const t=e[n].name||n;return`<button class=\"dnd-tm-table-btn ${this.state.currentTableKey===n?\"active\":\"\"}\" data-key=\"${n}\" title=\"${t}\">${t}</button>`}).join(\"\")}\\n                    </div>\\n                </div>\\n                \\n                \\x3c!-- å·¥å…·æ ï¼šæœç´¢ + æ“ä½œæŒ‰é’® --\\x3e\\n                <div class=\"dnd-tm-toolbar\" id=\"dnd-tm-toolbar\">\\n                    <div class=\"dnd-tm-search-wrapper\">\\n                        <i class=\"fa-solid fa-magnifying-glass\"></i>\\n                        <input type=\"text\" class=\"dnd-tm-search-input\" id=\"dnd-tm-search\" placeholder=\"æœç´¢è®°å½•...\">\\n                        <button class=\"dnd-tm-search-clear\" id=\"dnd-tm-search-clear\">Ã—</button>\\n                    </div>\\n                    <span class=\"dnd-tm-search-count\" id=\"dnd-tm-search-count\"></span>\\n                    <div class=\"dnd-tm-toolbar-actions\">\\n                        <button class=\"dnd-tm-layout-btn ${i}\" id=\"dnd-tm-layout-toggle\" title=\"åˆ‡æ¢å­—æ®µå¸ƒå±€ (å•åˆ—/åŒåˆ—)\">\\n                            <i class=\"fa-solid ${o}\"></i>\\n                        </button>\\n                        <button class=\"dnd-tm-add-btn\" id=\"dnd-tm-add-record\" title=\"æ–°å¢è®°å½•\" disabled>\\n                            <i class=\"fa-solid fa-plus\"></i> æ–°å¢\\n                        </button>\\n                    </div>\\n                </div>\\n                \\n                \\x3c!-- å¡ç‰‡å®¹å™¨ --\\x3e\\n                <div id=\"dnd-tm-cards-container\" class=\"dnd-tm-cards-container\">\\n                    <div class=\"dnd-tm-empty-state\">\\n                        <i class=\"fa-solid fa-table\"></i>\\n                        è¯·é€‰æ‹©ä¸€ä¸ªè¡¨æ ¼æŸ¥çœ‹è®°å½•\\n                    </div>\\n                </div>\\n            </div>\\n        `);n.append(d);const s=this;d.find(\".dnd-tm-table-btn\").on(\"click\",function(){const n=t(this).data(\"key\"),e=t(this);if(e.addClass(\"clicking\"),setTimeout(()=>e.removeClass(\"clicking\"),200),s.state.currentTableKey===n)return s.state.currentTableKey=null,e.removeClass(\"active\"),s.clearSearch(),t(\"#dnd-tm-add-record\").prop(\"disabled\",!0),void t(\"#dnd-tm-cards-container\").empty().html('\\n                    <div class=\"dnd-tm-empty-state\">\\n                        <i class=\"fa-solid fa-table\"></i>\\n                        è¯·é€‰æ‹©ä¸€ä¸ªè¡¨æ ¼æŸ¥çœ‹è®°å½•\\n                    </div>\\n                ');s.state.currentTableKey=n,s.clearSearch(),d.find(\".dnd-tm-table-btn\").removeClass(\"active\"),e.addClass(\"active\"),t(\"#dnd-tm-add-record\").prop(\"disabled\",!1),s.renderCards(t(\"#dnd-tm-cards-container\"),n)}),d.find(\"#dnd-tm-search\").on(\"input\",function(){const n=t(this).val();s.state.searchKeyword=n,t(\"#dnd-tm-search-clear\").toggleClass(\"visible\",n.length>0),s.state.searchDebounceTimer&&clearTimeout(s.state.searchDebounceTimer),s.state.searchDebounceTimer=setTimeout(()=>{s.performSearch(n)},200)}),d.find(\"#dnd-tm-search-clear\").on(\"click\",function(){s.clearSearch(),s.state.currentTableKey&&s.renderCards(t(\"#dnd-tm-cards-container\"),s.state.currentTableKey)}),d.find(\"#dnd-tm-layout-toggle\").on(\"click\",function(){s.toggleFieldLayout()}),d.find(\"#dnd-tm-add-record\").on(\"click\",function(){s.state.currentTableKey&&s.addRecord(s.state.currentTableKey)}),this.updateButtonLayout(),this.state.currentTableKey&&(t(\"#dnd-tm-add-record\").prop(\"disabled\",!1),this.renderCards(t(\"#dnd-tm-cards-container\"),this.state.currentTableKey))},renderCards(n,t){const{$:e}=a();if(n.empty(),!t)return;const r=Rr.getAllData()[t];if(!r||!r.content||r.content.length<2)return n.html('\\n                <div class=\"dnd-tm-empty-state\">\\n                    <i class=\"fa-solid fa-file-excel\"></i>\\n                    è¡¨æ ¼ä¸ºç©ºæˆ–æ ¼å¼æ— æ•ˆ\\n                </div>\\n            '),void this.updateSearchCount(0,0);const o=r.content[0],i=r.content.slice(1);if(0===i.length)return n.html('\\n                <div class=\"dnd-tm-empty-state\">\\n                    <i class=\"fa-solid fa-inbox\"></i>\\n                    æ²¡æœ‰è®°å½•\\n                </div>\\n            '),void this.updateSearchCount(0,0);const d=this.state.filteredRowIndices,s=\"double\"===this.state.fieldLayout?\"layout-double\":\"layout-single\";let l=0;const c=i.length;i.forEach((t,e)=>{if(null!==d&&!d.includes(e))return;l++;let a=\"æœªå‘½åè®°å½•\";const r=[\"å§“å\",\"åç§°\",\"name\",\"title\",\"CHAR_ID\",\"ID\",\"PC_ID\",\"ç‰©å“åç§°\",\"æŠ€èƒ½åç§°\",\"ä»»åŠ¡åç§°\"];for(const n of r){const e=o.findIndex(t=>t&&t.includes&&t.includes(n));if(-1!==e&&t[e]){a=t[e];break}}if(\"æœªå‘½åè®°å½•\"===a)for(let n=0;n<o.length;n++)if(o[n]&&\"null\"!==o[n]&&t[n]){a=t[n];break}const i=.05*l;let c=`\\n                <div class=\"dnd-tm-card\" data-row-index=\"${e+1}\" style=\"animation-delay: ${i}s;\">\\n            `;c+=`\\n                <div class=\"dnd-tm-card-header\">\\n                    <span class=\"dnd-tm-card-title\" title=\"${a}\">${a}</span>\\n                    <div class=\"dnd-tm-card-actions\">\\n                        <button class=\"dnd-tm-delete-btn\" data-row=\"${e+1}\" title=\"åˆ é™¤è®°å½•\">\\n                            <i class=\"fa-solid fa-trash\"></i>\\n                        </button>\\n                        <button class=\"dnd-tm-save-btn\" data-row=\"${e+1}\">\\n                            <i class=\"fa-solid fa-save\"></i> ä¿å­˜\\n                        </button>\\n                    </div>\\n                </div>\\n            `,c+=`<div class=\"dnd-tm-fields ${s}\">`;let p=0;o.forEach((n,e)=>{if(!n||\"null\"===n||\"\"===n.trim())return;const a=void 0!==t[e]&&null!==t[e]?t[e]:\"\",r=.03*p;p++,c+=`\\n                    <div class=\"dnd-tm-field-item\" style=\"animation-delay: ${i+r}s;\">\\n                        <div class=\"dnd-tm-field-label\">${n}</div>\\n                        <input type=\"text\" class=\"dnd-tm-input\" data-col=\"${e}\" value=\"${String(a).replace(/\"/g,\"&quot;\")}\" />\\n                    </div>\\n                `}),c+=\"</div></div>\",n.append(c)}),this.updateSearchCount(l,c),0===l&&null!==d&&n.html('\\n                <div class=\"dnd-tm-empty-state\">\\n                    <i class=\"fa-solid fa-search\"></i>\\n                    æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•\\n                </div>\\n            ');const p=this;n.find(\".dnd-tm-save-btn\").on(\"click\",function(){const n=e(this),a=parseInt(n.data(\"row\")),r=n.closest(\".dnd-tm-card\");r.css(\"transform\",\"scale(0.98)\"),setTimeout(()=>r.css(\"transform\",\"\"),150);const o={};r.find(\".dnd-tm-input\").each(function(){const n=parseInt(e(this).data(\"col\")),t=e(this).val();o[n]=t}),p.saveRecord(t,a,o,n)}),n.find(\".dnd-tm-delete-btn\").on(\"click\",function(){const n=e(this),a=parseInt(n.data(\"row\")),r=n.closest(\".dnd-tm-card\");p.deleteRecord(t,a,r)})},async saveRecord(t,e,a,r){r&&r.prop(\"disabled\",!0).html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');try{const o=Rr.getAllData(),i=o[t];if(!i||!i.content)throw new Error(\"è¡¨æ ¼æ•°æ®ä¸¢å¤±\");if(!i.content[e])throw new Error(\"è®°å½•ä¸å­˜åœ¨\");Object.keys(a).forEach(n=>{i.content[e][n]=a[n]}),await Lr.saveData(o),r&&(r.html('<i class=\"fa-solid fa-check\"></i> å·²ä¿å­˜'),setTimeout(()=>r.html('<i class=\"fa-solid fa-save\"></i> ä¿å­˜').prop(\"disabled\",!1),1500)),n.info(`[TableManager] Updated record in ${t} at row ${e}`)}catch(n){console.error(\"[TableManager] Save failed:\",n),r&&(r.html('<i class=\"fa-solid fa-triangle-exclamation\"></i> å¤±è´¥'),setTimeout(()=>r.html('<i class=\"fa-solid fa-save\"></i> ä¿å­˜').prop(\"disabled\",!1),2e3))}},performSearch(n){const{$:t}=a();if(!this.state.currentTableKey)return;const e=Rr.getAllData()[this.state.currentTableKey];if(!e||!e.content||e.content.length<2)return;const r=e.content.slice(1);if(n&&\"\"!==n.trim()){const t=n.toLowerCase();this.state.filteredRowIndices=[],r.forEach((n,e)=>{n.some(n=>n&&String(n).toLowerCase().includes(t))&&this.state.filteredRowIndices.push(e)})}else this.state.filteredRowIndices=null;this.renderCards(t(\"#dnd-tm-cards-container\"),this.state.currentTableKey)},clearSearch(){const{$:n}=a();this.state.searchKeyword=\"\",this.state.filteredRowIndices=null,n(\"#dnd-tm-search\").val(\"\"),n(\"#dnd-tm-search-clear\").removeClass(\"visible\")},updateSearchCount(n,t){const{$:e}=a(),r=e(\"#dnd-tm-search-count\");0===t?r.text(\"\"):null!==this.state.filteredRowIndices?r.text(`æ˜¾ç¤º ${n}/${t} æ¡`):r.text(`å…± ${t} æ¡`)},async addRecord(t){const{$:e}=a(),r=e(\"#dnd-tm-add-record\");r.prop(\"disabled\",!0).html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');try{const a=Rr.getAllData(),o=a[t];if(!o||!o.content)throw new Error(\"è¡¨æ ¼æ•°æ®ä¸¢å¤±\");const i=o.content[0].map(()=>\"\");o.content.push(i),await Lr.saveData(a),n.info(`[TableManager] Added new record to ${t}`),this.clearSearch(),this.renderCards(e(\"#dnd-tm-cards-container\"),t),setTimeout(()=>{const n=e(\"#dnd-tm-cards-container\");n.scrollTop(n[0].scrollHeight)},100),r.html('<i class=\"fa-solid fa-check\"></i> å·²æ·»åŠ '),setTimeout(()=>r.html('<i class=\"fa-solid fa-plus\"></i> æ–°å¢').prop(\"disabled\",!1),1500)}catch(n){console.error(\"[TableManager] Add record failed:\",n),r.html('<i class=\"fa-solid fa-triangle-exclamation\"></i> å¤±è´¥'),setTimeout(()=>r.html('<i class=\"fa-solid fa-plus\"></i> æ–°å¢').prop(\"disabled\",!1),2e3)}},async deleteRecord(t,e,r){const{$:o}=a();if(await this.showConfirmDialog(\"ç¡®è®¤åˆ é™¤\",\"ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚\"))try{const a=Rr.getAllData(),i=a[t];if(!i||!i.content||!i.content[e])throw new Error(\"è®°å½•ä¸å­˜åœ¨\");i.content.splice(e,1),await Lr.saveData(a),n.info(`[TableManager] Deleted record from ${t} at row ${e}`),r.css({transform:\"scale(0.9)\",opacity:\"0\",transition:\"all 0.3s\"}),setTimeout(()=>{r.remove();const n=o(\"#dnd-tm-cards-container .dnd-tm-card\").length,e=Rr.getAllData()[t],a=e&&e.content?e.content.length-1:0;this.updateSearchCount(n,a),0===n&&o(\"#dnd-tm-cards-container\").html('\\n                        <div class=\"dnd-tm-empty-state\">\\n                            <i class=\"fa-solid fa-inbox\"></i>\\n                            æ²¡æœ‰è®°å½•\\n                        </div>\\n                    ')},300)}catch(n){console.error(\"[TableManager] Delete failed:\",n)}},showConfirmDialog(n,t){const{$:e}=a();return new Promise(a=>{const r=window.parent||window;let o=r.innerWidth||r.document?.documentElement?.clientWidth||document.documentElement.clientWidth||screen.width,i=r.innerHeight||r.document?.documentElement?.clientHeight||document.documentElement.clientHeight||screen.height;if(!o||!i)try{const n=window.top;o=n.innerWidth||800,i=n.innerHeight||600}catch(n){o=800,i=600}const d=`\\n                <div id=\"dnd-tm-confirm-dialog\" style=\"position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:2147483650;\"></div>\\n                <div id=\"dnd-tm-confirm-dialog-box\" style=\"position:fixed;top:${Math.round(i/2)}px;left:${Math.round(o/2)}px;transform:translate(-50%,-50%);background:linear-gradient(145deg,#2a2a2c 0%,#1a1a1c 100%);border:1px solid #444;border-radius:10px;padding:20px;min-width:280px;max-width:90vw;box-shadow:0 10px 40px rgba(0,0,0,0.5);z-index:2147483651;\">\\n                    <div class=\"dnd-tm-dialog-title\">\\n                        <i class=\"fa-solid fa-triangle-exclamation\" style=\"color:#e74c3c;\"></i>\\n                        ${n}\\n                    </div>\\n                    <div class=\"dnd-tm-dialog-message\">${t}</div>\\n                    <div class=\"dnd-tm-dialog-actions\">\\n                        <button class=\"dnd-tm-dialog-btn cancel\">å–æ¶ˆ</button>\\n                        <button class=\"dnd-tm-dialog-btn confirm\">ç¡®è®¤åˆ é™¤</button>\\n                    </div>\\n                </div>\\n            `;e(\"body\").append(d);const s=()=>{e(\"#dnd-tm-confirm-dialog\").remove(),e(\"#dnd-tm-confirm-dialog-box\").remove()};e(\"#dnd-tm-confirm-dialog-box .cancel\").on(\"click\",()=>{s(),a(!1)}),e(\"#dnd-tm-confirm-dialog-box .confirm\").on(\"click\",()=>{s(),a(!0)}),e(\"#dnd-tm-confirm-dialog\").on(\"click\",function(){s(),a(!1)})})},toggleFieldLayout(){const{$:n}=a();this.state.fieldLayout=\"single\"===this.state.fieldLayout?\"double\":\"single\";const e=\"double\"===this.state.fieldLayout?\"layout-double\":\"layout-single\";n(\".dnd-tm-fields\").removeClass(\"layout-single layout-double\").addClass(e);const r=n(\"#dnd-tm-layout-toggle\"),o=\"double\"===this.state.fieldLayout?\"fa-table-list\":\"fa-table-columns\";r.find(\"i\").removeClass().addClass(`fa-solid ${o}`),r.toggleClass(\"active\",\"double\"===this.state.fieldLayout),t.setSetting(\"dnd_tm_field_layout\",this.state.fieldLayout)}},Jr={state:\"collapsed\",_lastToggleTime:0,_controlledCharId:null,_dynamicBgIds:{},setControlledCharacter(n){this._controlledCharId=n,this.initResourceTracker&&this.initResourceTracker(),this.renderHUD(),Wr.showNotification(!0,`å·²åˆ‡æ¢æ“æ§: ${n||\"é»˜è®¤\"}`)},getControlledCharacter(){if(this._controlledCharId){return Rr.getPartyData().find(n=>n.CHAR_ID===this._controlledCharId||n.PC_ID===this._controlledCharId||n[\"å§“å\"]===this._controlledCharId)}return this.getCurrentActiveCharacter()},getCurrentActiveCharacter(){const n=Rr.getPartyData(),t=Rr.getTable(\"COMBAT_Encounter\");if(t){const e=t.find(n=>\"æ˜¯\"===n[\"æ˜¯å¦ä¸ºå½“å‰è¡ŒåŠ¨è€…\"]);if(e){const t=n.find(n=>n[\"å§“å\"]===e[\"å•ä½åç§°\"]);if(t)return t}}return n.find(n=>\"PC\"===n.type||n.isPC)||n[0]},applyUIScale(t){const{$:e}=a(),r=parseFloat(t)||1;document.documentElement.style.setProperty(\"--dnd-ui-scale\",r),0===e(\"#dnd-scale-style\").length&&e(\"head\").append('<style id=\"dnd-scale-style\"></style>');const o=(100/r).toFixed(4);e(\"#dnd-scale-style\").html(`\\n            ${[\"#dnd-mini-hud\",\"#dnd-toggle-btn\",\"#dnd-tooltip\",\"#dnd-position-dialog\",\".dnd-generic-popup\"].join(\", \")} {\\n                zoom: ${r};\\n            }\\n            ${[\"#dnd-dashboard-root\"].join(\", \")} {\\n                zoom: ${r};\\n                width: ${o}vw !important;\\n                height: ${o}vh !important;\\n                top: 0 !important;\\n                left: 0 !important;\\n            }\\n        `),this.currentScale=r,n.info(\"[UICore] Applied UI scale:\",r,\"Compensated size:\",o+\"%\"),window.DND_Dashboard_UI&&window.DND_Dashboard_UI.updateHUDPosition&&setTimeout(()=>window.DND_Dashboard_UI.updateHUDPosition(),100)},toggleDashboard(){n.info(\"toggleDashboard è¢«è°ƒç”¨ï¼Œå½“å‰çŠ¶æ€:\",this.state),this._lastToggleTime=Date.now(),\"collapsed\"===this.state?this.setState(\"mini\"):this.setState(\"collapsed\")},setState(n){const{$:t}=a();this.state=n;const e=t(\"#dnd-dashboard-root\"),r=t(\"#dnd-mini-hud\"),o=t(\"#dnd-toggle-btn\");switch(e.removeClass(\"visible\"),r.removeClass(\"visible\"),o.show(),n){case\"collapsed\":o.removeClass(\"dnd-hidden\"),this._destroyDynamicBackgrounds(),this._hideTableManager();break;case\"mini\":o.removeClass(\"dnd-hidden\"),requestAnimationFrame(()=>r.addClass(\"visible\")),this.renderHUD(),this._initDynamicBackground(\"mini\");break;case\"full\":o.addClass(\"dnd-hidden\"),e.addClass(\"visible\");const n=t(\".dnd-nav-item.active\");n.length?this.renderPanel(n.data(\"target\")):this.renderPanel(\"party\"),this._initDynamicBackground(\"full\")}},_initDynamicBackground(t){const{$:e}=a(),r=o.DYNAMIC_BG?.type||\"particles\";if(!1!==o.DYNAMIC_BG?.enabled)try{if(\"mini\"===t){const t=e(\"#dnd-mini-hud\");t.length&&!this._dynamicBgIds.mini&&(this._dynamicBgIds.mini=Vr.init(t[0],r,{particleCount:20,gearCount:3}),n.debug(\"[DynamicBackground] Initialized for Mini HUD\"))}else if(\"full\"===t){const t=e(\"#dnd-dashboard-root\");t.length&&!this._dynamicBgIds.full&&(this._dynamicBgIds.full=Vr.init(t[0],r,{particleCount:40,gearCount:6}),n.debug(\"[DynamicBackground] Initialized for Full Dashboard\"))}}catch(t){n.warn(\"[DynamicBackground] Init error:\",t)}else n.debug(\"[DynamicBackground] Disabled by config\")},_destroyDynamicBackgrounds(){try{this._dynamicBgIds.mini&&(Vr.destroy(this._dynamicBgIds.mini),this._dynamicBgIds.mini=null),this._dynamicBgIds.full&&(Vr.destroy(this._dynamicBgIds.full),this._dynamicBgIds.full=null)}catch(t){n.warn(\"[DynamicBackground] Destroy error:\",t)}},_hideTableManager(){const{$:t}=a(),e=t(\"#dnd-table-manager-container\");if(e.length&&e.is(\":visible\")){e.hide();const a=t(\"#dnd-hud-toggle-bar\");a.length&&a.text(\"â–¼\").attr(\"title\",\"å±•å¼€è¡¨æ ¼ç®¡ç†\"),Kr&&Kr.state&&(Kr.state.isExpanded=!1),n.debug(\"[UICore] è¡¨æ ¼ç®¡ç†å™¨å·²éšè—\")}},switchDynamicBgEffect(n){this.updateDynamicBackground({type:n})},updateDynamicBackground(t){if(t&&t.type)try{o.DYNAMIC_BG||(o.DYNAMIC_BG={});const e=!1!==o.DYNAMIC_BG.enabled;if(o.DYNAMIC_BG={...o.DYNAMIC_BG,...t,enabled:e},!e)return;const{type:a,...r}=t;this._dynamicBgIds.mini&&Vr.switchEffect(this._dynamicBgIds.mini,a,r),this._dynamicBgIds.full&&Vr.switchEffect(this._dynamicBgIds.full,a,r),n.info(\"[DynamicBackground] Updated configuration:\",t.type)}catch(t){n.warn(\"[DynamicBackground] Update error:\",t)}},getAvailableBgEffects:()=>Vr.getAvailableEffects(),init(){n.info(\"[UIRenderer] init() called\");const{$:e}=a();n.info(\"[UIRenderer] Performing cleanup...\"),window.DND_HUD_Interval&&(clearInterval(window.DND_HUD_Interval),window.DND_HUD_Interval=null);try{e(window).off(\"resize.dnd\"),e(document).off(\"keydown.dndHotkeys\"),e(document).off(\"dblclick.dndAvatar\"),e(document).off(\"click.dndPos\")}catch(n){console.warn(\"Event cleanup error:\",n)}[\"#dnd-dashboard-root\",\"#dnd-mini-hud\",\"#dnd-tooltip\",\"#dnd-toggle-btn\",\"#dnd-notification-container\",\"#dnd-dialog-container\",\".dnd-generic-popup\",\"#dnd-position-dialog\",\"#dnd-scale-style\",\"#dnd-shake-style\",\"#dnd-quick-bar\",\"#dnd-quick-trigger\"].forEach(n=>{const t=e(n);t.length&&(\"#dnd-toggle-btn\"===n&&t[0]&&(t[0].onclick=null),t.remove())}),e(\"#dnd-toggle-btn\").length>0&&(console.warn(\"[UIRenderer] Duplicate toggle button detected, removing all...\"),e('[id=\"dnd-toggle-btn\"]').remove());e(\"body\").append('\\n            <div id=\"dnd-dashboard-root\">\\n                <div class=\"dnd-top-bar\">\\n                    <div class=\"dnd-title\">DND Adventure Log</div>\\n                    <button class=\"dnd-close-btn\" id=\"dnd-close\">âœ• å…³é—­é¢æ¿</button>\\n                </div>\\n                <div class=\"dnd-main-container\">\\n                    <div class=\"dnd-nav-sidebar\">\\n                        <div class=\"dnd-nav-item\" data-target=\"create\" style=\"color:#ffdb85;border-left-color:#ffdb85\"><i class=\"fa-solid fa-plus-circle\"></i> åˆ›å»ºè§’è‰²</div>\\n                        <div class=\"dnd-nav-item active\" data-target=\"party\"><i class=\"fa-solid fa-users\"></i> å†’é™©é˜Ÿä¼</div>\\n                        <div class=\"dnd-nav-item\" data-target=\"npcs\"><i class=\"fa-solid fa-address-book\"></i> äººç‰©å›¾é‰´</div>\\n                        <div class=\"dnd-nav-item\" data-target=\"quests\"><i class=\"fa-solid fa-scroll\"></i> ä»»åŠ¡æ—¥å¿—</div>\\n                        <div class=\"dnd-nav-item\" data-target=\"inventory\"><i class=\"fa-solid fa-suitcase\"></i> èƒŒåŒ…ç‰©å“</div>\\n                        \\x3c!-- <div class=\"dnd-nav-item\" data-target=\"combat\"><i class=\"fa-solid fa-swords\"></i> æˆ˜æœ¯åœ°å›¾</div> --\\x3e\\n                        <div class=\"dnd-nav-item\" data-target=\"world\"><i class=\"fa-solid fa-globe\"></i> ä¸–ç•Œä¿¡æ¯</div>\\n                        <div class=\"dnd-nav-item\" data-target=\"logs\"><i class=\"fa-solid fa-book\"></i> å†å²è®°å½•</div>\\n                        <div class=\"dnd-nav-item\" data-target=\"archives\"><i class=\"fa-solid fa-database\"></i> æ•°æ®å½’æ¡£</div>\\n                        <div class=\"dnd-nav-item\" data-target=\"settings\"><i class=\"fa-solid fa-cog\"></i> è®¾ç½®</div>\\n                    </div>\\n                    <div class=\"dnd-content-area\" id=\"dnd-content\">\\n                        \\x3c!-- å†…å®¹åŠ¨æ€åŠ è½½ --\\x3e\\n                    </div>\\n                </div>\\n                <div class=\"dnd-modal-overlay\" id=\"dnd-modal-overlay\">\\n                    <div class=\"dnd-modal\" id=\"dnd-modal-content\"></div>\\n                </div>\\n            </div>\\n            \\n            \\x3c!-- ç®€ç•¥ç‰ˆ HUD --\\x3e\\n            <div id=\"dnd-mini-hud\">\\n                <div class=\"dnd-hud-header\">\\n                    \\x3c!-- Logo (ç‚¹å‡»åˆ‡æ¢/å±•å¼€) --\\x3e\\n                    <div id=\"dnd-logo-container\" title=\"DND ä»ªè¡¨ç›˜\">\\n                        <span class=\"dnd-logo-text\">D20</span>\\n                    </div>\\n                    \\n                    <div class=\"dnd-hud-status\" id=\"dnd-hud-status-text\">\\n                        \\x3c!-- åŠ¨æ€åŠ è½½ --\\x3e\\n                    </div>\\n                    \\n                    <div style=\"display:flex;gap:5px;align-items:center;margin-left:10px;\">\\n                        <button class=\"dnd-hud-expand-btn\" id=\"dnd-hud-theme\" title=\"åˆ‡æ¢ä¸»é¢˜\">\\n                            ğŸ¨\\n                        </button>\\n                    </div>\\n                </div>\\n                <div class=\"dnd-hud-body\" id=\"dnd-hud-body\">\\n                    \\x3c!-- åŠ¨æ€åŠ è½½ --\\x3e\\n                </div>\\n            </div>\\n\\n            \\x3c!-- æµ®çª— Tooltip --\\x3e\\n            <div id=\"dnd-tooltip\"></div>\\n            \\n            <div id=\"dnd-toggle-btn\" title=\"æ˜¾ç¤º DND é¢æ¿\">\\n                <svg viewBox=\"0 0 542.969 626.967\" width=\"24\" height=\"24\" style=\"fill:currentColor;\">\\n                    <path d=\"M271.485,0L0,156.742v313.483l271.485,156.742l271.484-156.742V156.742L271.485,0z M278.328,22.626  l221.618,127.952l-221.618-25.032V22.626z M524.976,167.178l-95.739,224.031L284.191,139.981L524.976,167.178z M418.301,399.638  H124.669l146.816-254.293L418.301,399.638z M264.642,22.626v102.92L43.023,150.578L264.642,22.626z M258.779,139.981L113.732,391.21  L17.993,167.178L258.779,139.981z M16.174,197.747l87.942,205.785l-87.942,49.606V197.747z M23.151,464.915l87.801-49.526  l133.02,177.018L23.151,464.915z M126.518,413.323h289.934L271.485,606.238L126.518,413.323z M298.997,592.407l133.021-177.019  l87.8,49.526L298.997,592.407z M526.795,453.138l-87.941-49.605l87.941-205.784V453.138z M200.249,297.943l0.166-1.121  c1.207-8.13,4.862-15.182,10.867-20.963c6.041-5.818,14.042-8.767,23.779-8.767c10.078,0,18.262,2.926,24.325,8.697  c6.08,5.788,9.164,13.233,9.164,22.127c0,7.859-2.729,14.97-8.108,21.134c-4.985,5.711-16.421,13.673-34.899,24.288h42.746v16.342  h-67.887v-17.453l27.728-18.44c8.271-5.514,13.883-10.438,16.682-14.636c2.751-4.126,4.145-7.929,4.145-11.3  c0-4.076-1.309-7.406-4.003-10.18c-2.682-2.763-6.089-4.106-10.413-4.106c-9.492,0-14.805,5.701-16.246,17.429l-0.172,1.4  L200.249,297.943z M312.995,361.044c8.107,0,14.958-2.273,20.362-6.755c5.35-4.437,9.305-10.174,11.755-17.053  c2.42-6.801,3.647-15.591,3.647-26.126c0-6.352-1.303-13.24-3.875-20.471c-2.604-7.323-6.636-13.135-11.983-17.275  c-5.378-4.162-12.033-6.273-19.776-6.273c-10.774,0-19.481,4.482-25.876,13.322c-6.303,8.716-9.499,20.356-9.499,34.596  c0,13.201,3.051,24.257,9.066,32.858C292.929,356.611,301.737,361.044,312.995,361.044z M313.255,281.484  c6.416,0,10.635,2.945,12.903,9.004c2.384,6.373,3.593,13.202,3.593,20.298c0,8.672-0.495,15.544-1.47,20.426  c-0.944,4.714-2.731,8.414-5.313,10.996c-2.553,2.553-5.836,3.794-10.037,3.794c-6.221,0-10.393-2.767-12.757-8.46  c-2.482-5.969-3.741-14.01-3.741-23.896C296.433,292.305,302.093,281.484,313.255,281.484z\"/>\\n                </svg>\\n            </div>\\n        ');const i=e(\"#dnd-toggle-btn\");n.debug(\"ğŸ”§ [DEBUG] æ‚¬æµ®çƒåˆå§‹åŒ–æ£€æŸ¥:\"),n.debug(\"  - $btn å…ƒç´ :\",i.length>0?\"å­˜åœ¨\":\"ä¸å­˜åœ¨\"),n.debug(\"  - $btn[0]:\",i[0]),n.debug(\"  - $btn ä½ç½®:\",i.css(\"position\"),\"top:\",i.css(\"top\"),\"left:\",i.css(\"left\")),n.debug(\"  - $btn z-index:\",i.css(\"z-index\")),n.debug(\"  - $btn display:\",i.css(\"display\")),n.debug(\"  - $btn pointer-events:\",i.css(\"pointer-events\")),t.getSetting(o.STORAGE_KEYS.TOGGLE_POS).then(t=>{if(t)try{let e=t;if(\"string\"==typeof e)try{e=JSON.parse(e)}catch(n){}if(\"string\"==typeof e)try{e=JSON.parse(e)}catch(n){}if(e&&e.left){const t=i[0];t&&(t.style.setProperty(\"left\",e.left,\"important\"),t.style.setProperty(\"top\",e.top,\"important\"),t.style.setProperty(\"right\",\"auto\",\"important\"),t.style.setProperty(\"bottom\",\"auto\",\"important\"),setTimeout(()=>this.updateHUDPosition(),100)),n.debug(\"ğŸ”§ [DEBUG] æ¢å¤ä¿å­˜çš„ä½ç½®:\",e)}else n.warn(\"ğŸ”§ [DEBUG] ä½ç½®æ•°æ®æ— æ•ˆ:\",t)}catch(t){n.warn(\"ğŸ”§ [DEBUG] ä½ç½®æ¢å¤å¤±è´¥:\",t)}});let d=!1,s=0,l=0,c=0,p=0;const g=t=>{t.cancelable&&t.preventDefault(),t.stopPropagation();const e=t.screenX-s,a=t.screenY-l;if(Math.random()<.05&&n.debug(`ğŸ–±ï¸ [Move] dx:${e} dy:${a} screen:${t.screenX},${t.screenY}`),!d&&(Math.abs(e)>5||Math.abs(a)>5)&&(d=!0,i.addClass(\"is-dragging\"),n.debug(\"ğŸš€ [Drag Start] Threshold passed\")),d){let n=c+e,t=p+a;const r=i[0],d=r.ownerDocument.defaultView||window,s=d.innerWidth,l=d.innerHeight,g=o.SIZE.TOGGLE_BTN;n=Math.max(5,Math.min(n,s-g-5)),t=Math.max(5,Math.min(t,l-g-5)),r.style.setProperty(\"left\",n+\"px\",\"important\"),r.style.setProperty(\"top\",t+\"px\",\"important\"),r.style.setProperty(\"right\",\"auto\",\"important\"),r.style.setProperty(\"bottom\",\"auto\",\"important\"),r.style.setProperty(\"transition\",\"none\",\"important\"),this.updateHUDPosition()}},f=n=>{console.log(\"[DND Debug] ğŸ–±ï¸ PointerUp/Cancel/Blur\",n.type);const t=i[0],e=t.ownerDocument.defaultView||window;if(t.style.borderColor=\"\",t.style.boxShadow=\"\",e.removeEventListener(\"pointermove\",g),e.removeEventListener(\"pointerup\",f),e.removeEventListener(\"pointercancel\",f),e.removeEventListener(\"blur\",f),t.releasePointerCapture)try{t.releasePointerCapture(n.pointerId)}catch(n){}if(i.css(\"transition\",\"\"),d){const n=t.getBoundingClientRect();r(o.STORAGE_KEYS.TOGGLE_POS,JSON.stringify({left:n.left+\"px\",top:n.top+\"px\"})),this.updateHUDPosition(),setTimeout(()=>i.removeClass(\"is-dragging\"),50)}else\"pointerup\"===n.type&&(\"collapsed\"===this.state?this.setState(\"mini\"):this.setState(\"collapsed\"));d=!1},b=i[0];b.style.touchAction=\"none\",b.style.userSelect=\"none\",b.style.webkitUserSelect=\"none\",b.addEventListener(\"pointerdown\",t=>{const e=i[0];if(n.debug(\"ğŸ–±ï¸ [PointerDown] Triggered\",{type:t.type,x:t.screenX,y:t.screenY}),e.style.borderColor=\"#ff0000\",e.style.boxShadow=\"0 0 15px rgba(255, 0, 0, 0.8)\",0!==t.button&&\"mouse\"===t.pointerType)return;t.cancelable&&t.preventDefault(),t.stopPropagation(),d=!1,s=t.screenX,l=t.screenY;const a=e.getBoundingClientRect();if(c=a.left,p=a.top,e.setPointerCapture)try{e.setPointerCapture(t.pointerId),n.debug(\"ğŸ–±ï¸ [PointerDown] Capture set\")}catch(t){n.warn(\"setPointerCapture failed:\",t)}const r=e.ownerDocument.defaultView||window;r.addEventListener(\"pointermove\",g),r.addEventListener(\"pointerup\",f),r.addEventListener(\"pointercancel\",f),r.addEventListener(\"blur\",f)}),b.addEventListener(\"touchstart\",n=>{n.preventDefault()},{passive:!1}),b.onclick=null,e(window).off(\"resize.dnd\").on(\"resize.dnd\",()=>this.updateHUDPosition()),window.DND_HUD_Interval&&clearInterval(window.DND_HUD_Interval),window.DND_HUD_Interval=setInterval(()=>this.updateHUDPosition(),1e3),setTimeout(()=>{const t=i[0].getBoundingClientRect(),a=t.left+t.width/2,r=t.top+t.height/2,o=document.elementFromPoint(a,r);n.debug(\"ğŸ”§ [DEBUG] é®æŒ¡æ£€æµ‹:\"),n.debug(\"  - æ‚¬æµ®çƒä¸­å¿ƒ:\",a,r),n.debug(\"  - è¯¥ä½ç½®é¡¶å±‚å…ƒç´ :\",o),n.debug(\"  - æ˜¯å¦æ˜¯æ‚¬æµ®çƒæœ¬èº«:\",o===i[0]||e.contains(i[0],o)),o&&o!==i[0]&&!e.contains(i[0],o)&&(n.error(\"ğŸ”§ [DEBUG] âŒ æ‚¬æµ®çƒè¢«å…¶ä»–å…ƒç´ é®æŒ¡:\",o),n.error(\"  - é®æŒ¡å…ƒç´  ID:\",o.id),n.error(\"  - é®æŒ¡å…ƒç´  class:\",o.className),n.error(\"  - é®æŒ¡å…ƒç´  z-index:\",window.getComputedStyle(o).zIndex))},1e3),e(\"#dnd-close\").on(\"click\",()=>this.setState(\"mini\")),e(\"#dnd-logo-container\").on(\"click\",n=>{n.stopPropagation();const t=e(\"#dnd-logo-container\");t.css(\"transform\",\"scale(0.9)\"),setTimeout(()=>t.css(\"transform\",\"\"),150),this.setState(\"full\")}),e(\"#dnd-hud-theme\").on(\"click\",async function(t){t.stopPropagation();try{const t=Xr.getAvailableStyles(),a=Xr.getCurrentStyle();let r=t.findIndex(n=>n.id===a.id);-1===r&&(r=0);const o=t[(r+1)%t.length];n.debug(\"Switching style from\",a.id,\"to\",o.id),await Xr.apply(o.id),e(this).attr(\"title\",o.name);const i=e(\"#dnd-hud-status-text\"),d=i.html();i.html(`<span style=\"color:var(--dnd-text-highlight);\">${o.icon} çš®è‚¤: ${o.name}</span>`);const s=e(this);s.css(\"transform\",\"rotate(360deg)\"),setTimeout(()=>{s.css(\"transition\",\"none\"),s.css(\"transform\",\"rotate(0deg)\"),setTimeout(()=>s.css(\"transition\",\"\"),50)},500),setTimeout(()=>{i.text().includes(o.name)&&i.html(d)},2e3)}catch(t){n.error(\"Style switch failed:\",t)}});const m=this;e(\".dnd-nav-item\").on(\"click\",function(){e(\".dnd-nav-item\").removeClass(\"active\"),e(this).addClass(\"active\");const n=e(this).data(\"target\");m.renderPanel(n)}),e(\"#dnd-modal-overlay\").on(\"click\",function(n){\"dnd-modal-overlay\"===n.target.id&&e(this).removeClass(\"active\")}),this.setState(\"collapsed\"),t.getSetting(o.STORAGE_KEYS.UI_SCALE).then(n=>{const t=n||o.UI_SCALE.DEFAULT;this.applyUIScale(t)}),e(document).on(\"keydown.dndHotkeys\",n=>{if(e(n.target).is('input, textarea, [contenteditable=\"true\"]'))return;const t=n.key,r=n.keyCode;if(\"Escape\"===t||27===r){if(e(\"#dnd-detail-popup-el\").hasClass(\"visible\"))return this.hideDetailPopup(),void n.preventDefault();if(e(\"#dnd-char-detail-card-el\").hasClass(\"visible\"))return this.hideCharacterCard(),void n.preventDefault();if(\"collapsed\"!==this.state)return this.setState(\"collapsed\"),void n.preventDefault()}if(\"mini\"===this.state&&t>=\"1\"&&t<=\"9\"){const e=parseInt(t)-1,r=Rr.getPartyData();if(r&&r[e]){const{window:t}=a();return this.showCharacterCard(r[e],{clientX:t.innerWidth/2,clientY:100}),void n.preventDefault()}}if(n.altKey&&(\"Tab\"===t||9===r))return this.toggleDashboard(),void n.preventDefault();if(n.altKey&&(\"d\"===t||\"D\"===t)){const t=Math.floor(20*Math.random())+1;return jr.info(`ğŸ² D20: ${t}`,\"å¿«é€ŸæŠ•éª°\"),void n.preventDefault()}}),e(document).off(\"dblclick.dndAvatar\").on(\"dblclick.dndAvatar\",\".dnd-avatar-container\",n=>{n.stopPropagation();const t=e(n.currentTarget),a=t.data(\"char-id\"),r=t.attr(\"title\")||t.find(\"span\").text()||t.find(\".dnd-avatar-initial\").text()||\"è§’è‰²\";if(a){const n=Rr.getPartyData(),o=n&&n.some(n=>n.PC_ID==a||n.CHAR_ID==a||n[\"å§“å\"]==a||n[\"å§“å\"]==r);if(o)this.showAvatarUploadDialog(a,r);else{console.log(\"[DND Dashboard] ä»…é™ä¿®æ”¹ä¸»è§’æˆ–é˜Ÿå‹å¤´åƒ\");const n=t;n.css(\"animation\",\"none\"),setTimeout(()=>n.css(\"animation\",\"dnd-shake 0.3s\"),10),e(\"#dnd-shake-style\").length||e(\"head\").append('<style id=\"dnd-shake-style\">@keyframes dnd-shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }</style>')}}})}},Qr={renderHUD(){const{$:n}=a(),t=n(\"#dnd-mini-hud\"),e=n(\"#dnd-hud-body\"),r=n(\"#dnd-hud-status-text\");if(!t.length)return;if(\"mini\"!==this.state)return;const o=Rr.getTable(\"SYS_GlobalState\"),i=o&&o[0]?o[0]:{\"å½“å‰åœºæ™¯\":\"æœªçŸ¥\",\"æ¸¸æˆæ—¶é—´\":\"\",\"å¤©æ°”çŠ¶å†µ\":\"\",\"æˆ˜æ–—æ¨¡å¼\":\"\"},d=i[\"å¤©æ°”çŠ¶å†µ\"]||\"\",s=\"æˆ˜æ–—ä¸­\"===i[\"æˆ˜æ–—æ¨¡å¼\"];Wr.checkCombatStateChange(s);const l=i[\"æ¸¸æˆæ—¶é—´\"]&&i[\"æ¸¸æˆæ—¶é—´\"].includes(\" \")?i[\"æ¸¸æˆæ—¶é—´\"].split(\" \")[1]:i[\"æ¸¸æˆæ—¶é—´\"],c=d?d.match(/[ğŸŒ¤ï¸â˜€ï¸â˜ï¸ğŸŒ§ï¸â›ˆï¸ğŸŒ©ï¸ğŸŒ¨ï¸â„ï¸ğŸŒ«ï¸ğŸŒªï¸]/)?.[0]||\"ğŸŒ¤ï¸\":\"\",p=s?'<i class=\"fa-solid fa-skull\"></i>':'<i class=\"fa-solid fa-compass\"></i>',g=s?\"æˆ˜æ–—ä¸­\":\"æ¢ç´¢ä¸­\",f=s?\"var(--dnd-accent-red)\":\"var(--dnd-accent-green)\",b=[];if(l&&b.push(`<span title=\"æ¸¸æˆæ—¶é—´\"><i class=\"fa-solid fa-clock\"></i> ${l}</span>`),(d||c)&&b.push(`<span title=\"${d}\"><i class=\"fa-solid fa-cloud-moon\"></i> ${d}</span>`),b.push(`<span style=\"color:${f}\">${p} ${g}</span>`),r.html(`\\n            <div id=\"dnd-hud-location\" class=\"dnd-location-text dnd-hud-entry\" title=\"${i[\"å½“å‰åœºæ™¯\"]}\">\\n                ${i[\"å½“å‰åœºæ™¯\"]}\\n            </div>\\n            <div class=\"dnd-hud-info-row dnd-hud-entry\" style=\"animation-delay: 0.1s;\">\\n                ${b.join('<span style=\"color:#444;margin:0 6px;\">|</span>')}\\n            </div>\\n        `),0===n(\"#dnd-hud-toggle-bar\").length){const t=n('<div id=\"dnd-hud-toggle-bar\" style=\"height:12px;background:linear-gradient(to bottom, #1a1a1a, #0a0a0a);border-bottom:1px solid var(--dnd-border-inner);display:flex;align-items:center;justify-content:center;cursor:pointer;color:#666;font-size:8px;transition:all 0.2s;\" title=\"å±•å¼€/æ”¶èµ·è¡¨æ ¼ç®¡ç†\">â–¼</div>');t.hover(function(){n(this).css({color:\"var(--dnd-text-highlight)\",background:\"rgba(255,255,255,0.05)\"})},function(){n(this).css({color:\"#666\",background:\"linear-gradient(to bottom, #1a1a1a, #0a0a0a)\"})});t.on(\"click\",async function(){const t=n(\"#dnd-hud-body\");0===n(\"#dnd-table-manager-container\").length&&n('<div id=\"dnd-table-manager-container\" style=\"display:none;border-bottom:1px solid var(--dnd-border-gold);\"></div>').insertBefore(t);const e=n(\"#dnd-table-manager-container\");e.is(\":visible\")?(e.slideUp(200),n(this).text(\"â–¼\").attr(\"title\",\"å±•å¼€è¡¨æ ¼ç®¡ç†\"),Kr.state.isExpanded=!1):(e.slideDown(200),n(this).text(\"â–²\").attr(\"title\",\"æ”¶èµ·è¡¨æ ¼ç®¡ç†\"),Kr.state.isExpanded=!0,await Kr.render(e))}),n(\"#dnd-mini-hud .dnd-hud-header\").after(t)}if(e.empty(),s?(t.addClass(\"dnd-combat-mode\"),this.renderCombatHUD(e)):(t.removeClass(\"dnd-combat-mode\"),this.renderExploreHUD(e)),e.addClass(\"dnd-stagger-enter\"),this.renderPartyBar(e),this.renderMiniSpellSlots(e),this.renderQuickInventory(e),this.renderFooter(e),this._actionQueue&&this._actionQueue.length>0){const t=n(`\\n                <div style=\"margin-top:10px;background:rgba(0,0,0,0.3);border:1px solid var(--dnd-border-gold);border-radius:4px;overflow:hidden;\">\\n                    <div style=\"background:rgba(197, 160, 89, 0.1);padding:5px 10px;font-weight:bold;color:var(--dnd-text-highlight);display:flex;justify-content:space-between;align-items:center;\">\\n                        <span><i class=\"fa-solid fa-hourglass-half\"></i> å¾…æ‰§è¡Œè¡ŒåŠ¨ (${this._actionQueue.length})</span>\\n                        <div style=\"display:flex;gap:5px;\">\\n                            <button class=\"dnd-clickable\" onclick=\"window.DND_Dashboard_UI.commitActions()\" style=\"background:var(--dnd-accent-green);border:none;color:#fff;padding:2px 8px;border-radius:3px;cursor:pointer;\"><i class=\"fa-solid fa-check\"></i> æ‰§è¡Œ</button>\\n                            <button class=\"dnd-clickable\" onclick=\"window.DND_Dashboard_UI.clearActions()\" style=\"background:var(--dnd-accent-red);border:none;color:#fff;padding:2px 8px;border-radius:3px;cursor:pointer;\"><i class=\"fa-solid fa-times\"></i> æ¸…ç©º</button>\\n                        </div>\\n                    </div>\\n                    <div style=\"padding:5px 10px;font-size:12px;color:#ccc;\">\\n                        ${this._actionQueue.map((n,t)=>`<div style=\"margin-bottom:2px;\">${t+1}. ${n.desc}</div>`).join(\"\")}\\n                    </div>\\n                </div>\\n            `);e.append(t)}if(0===n(\"#dnd-quick-bar\").length){const t=n('<div id=\"dnd-quick-bar\" class=\"dnd-quick-bar\"></div>'),e=n('<div id=\"dnd-quick-trigger\" class=\"dnd-quick-trigger\" onclick=\"window.DND_Dashboard_UI.toggleQuickBar()\"><i class=\"fa-solid fa-chevron-right\"></i></div>');n(\"#dnd-mini-hud\").append(t).append(e)}this.renderQuickBar(),this.updateHUDPosition()},updateHUDPosition(){const{$:t,window:e}=a(),r=e.innerWidth||t(e).width();if(r<=768){const n=t(\"#dnd-mini-hud\");return void(n.length&&(n[0].style.removeProperty(\"top\"),n[0].style.removeProperty(\"left\")))}const o=t(\"#dnd-toggle-btn\"),i=t(\"#dnd-mini-hud\");if(!o.length||!i.length)return;const d=o[0].getBoundingClientRect(),s=i[0].getBoundingClientRect(),l=e.innerHeight||t(e).height(),c=10;n.debug(\"[HUD Pos] Btn:\",d.left,d.top,\"HUD:\",s.width,s.height,\"Win:\",r,l);const p=s.width||360,g=s.height||400;let f,b;f=d.bottom+c+g<=l-c?d.bottom+c:d.top-c-g>=c?d.top-c-g:l-d.bottom>d.top?d.bottom+c:d.top-c-g,b=d.left,f=Math.max(c,Math.min(f,l-g-c)),b+p>r-c&&(b=d.right-p),b=Math.max(c,Math.min(b,r-p-c)),n.debug(\"[HUD Pos] Calculated:\",b,f),i[0].style.setProperty(\"top\",f+\"px\",\"important\"),i[0].style.setProperty(\"left\",b+\"px\",\"important\")},showPositionDialog(){const{$:n,window:t}=a();n(\"#dnd-position-dialog\").remove();n(\"#dnd-toggle-btn\");const e=t.innerWidth||n(t).width(),i=t.innerHeight||n(t).height(),d=40,s=10;let l=[{pos:\"tl\",label:\"â†– å·¦ä¸Š\",left:s,top:s},{pos:\"tc\",label:\"â†‘ é¡¶éƒ¨\",left:(e-d)/2,top:s},{pos:\"tr\",label:\"â†— å³ä¸Š\",left:e-d-s,top:s},{pos:\"ml\",label:\"â† å·¦ä¾§\",left:s,top:(i-d)/2},{pos:\"mc\",label:\"â— ä¸­å¤®\",left:(e-d)/2,top:(i-d)/2},{pos:\"mr\",label:\"â†’ å³ä¾§\",left:e-d-s,top:(i-d)/2},{pos:\"bl\",label:\"â†™ å·¦ä¸‹\",left:s,top:i-d-s},{pos:\"bc\",label:\"â†“ åº•éƒ¨\",left:(e-d)/2,top:i-d-s},{pos:\"br\",label:\"â†˜ å³ä¸‹\",left:e-d-s,top:i-d-s}].map(n=>`<button class=\"dnd-pos-btn\" data-left=\"${n.left}\" data-top=\"${n.top}\" style=\"padding:8px;background:#2a2a2c;border:1px solid #444;color:#ccc;border-radius:4px;cursor:pointer;\">${n.label}</button>`).join(\"\");const c=`\\n            <div id=\"dnd-position-dialog\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#161618;border:1px solid #9d8b6c;border-radius:8px;padding:15px;z-index:2147483650;box-shadow:0 10px 40px rgba(0,0,0,0.8);min-width:280px;\">\\n                <div style=\"display:flex;justify-content:space-between;margin-bottom:15px;border-bottom:1px solid #444;padding-bottom:8px;\">\\n                    <span style=\"color:#ffdb85;font-weight:bold;\">ğŸ“ æ‚¬æµ®çƒä½ç½®</span>\\n                    <span id=\"dnd-pos-close\" style=\"cursor:pointer;color:#888;\">âœ•</span>\\n                </div>\\n                <div style=\"display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;margin-bottom:10px;\">${l}</div>\\n                <div style=\"font-size:11px;color:#666;text-align:center;\">å•å‡»=åˆ‡æ¢HUD | åŒå‡»/é•¿æŒ‰=æ­¤è®¾ç½®</div>\\n            </div>\\n            <div id=\"dnd-pos-backdrop\" style=\"position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:2147483646;\"></div>\\n        `;n(\"body\").append(c),n(\"#dnd-pos-close, #dnd-pos-backdrop\").on(\"click\",()=>n(\"#dnd-position-dialog, #dnd-pos-backdrop\").remove()),n(document).off(\"click.dndPos\").on(\"click.dndPos\",\".dnd-pos-btn\",function(t){t&&(t.preventDefault(),t.stopPropagation());const e=n(\"#dnd-toggle-btn\"),a=n(this).attr(\"data-left\"),i=n(this).attr(\"data-top\");console.log(\"[DND Dashboard] Setting position to:\",a,i),e.length&&a&&i?(e.css({left:a+\"px\",top:i+\"px\",right:\"auto\",bottom:\"auto\",transform:\"none\"}),r(o.STORAGE_KEYS.TOGGLE_POS,JSON.stringify({left:a+\"px\",top:i+\"px\"}))):console.error(\"[DND Dashboard] Position update failed:\",{btnLen:e.length,left:a,top:i}),n(\"#dnd-position-dialog, #dnd-pos-backdrop\").remove()}),n(document).on(\"mouseover\",\".dnd-pos-btn\",function(){n(this).css({\"border-color\":\"#9d8b6c\",color:\"#ffdb85\"})}).on(\"mouseout\",\".dnd-pos-btn\",function(){n(this).css({\"border-color\":\"#444\",color:\"#ccc\"})})},renderCombatHUD(n){const{$:t}=a(),e=Rr.getTable(\"COMBAT_Encounter\"),r=Rr.getTable(\"SYS_GlobalState\");r&&r[0]&&r[0][\"å½“å‰å›åˆ\"];let o='<div class=\"dnd-hud-combat-layout\">';const i=this._turnResources||{action:1,bonus:1,reaction:1,movement:30};if(o+=`\\n            <div style=\"display:flex;flex-direction:column;gap:5px;\">\\n                <div class=\"dnd-hud-minimap\" id=\"dnd-hud-minimap-content\" style=\"width:180px;height:180px;\"></div>\\n                \\n                \\x3c!-- åŠ¨ä½œç»æµå±•ç¤º --\\x3e\\n                <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px;font-size:10px;background:rgba(0,0,0,0.3);padding:4px;border-radius:4px;\">\\n                    <div class=\"dnd-clickable\" onclick=\"window.DND_Dashboard_UI.adjustTurnResource('action')\" title=\"ç‚¹å‡»å¢åŠ åŠ¨ä½œ\" style=\"cursor:pointer;color:${i.action>0?\"#2ecc71\":\"#555\"}\"><i class=\"fa-solid fa-bolt\"></i> åŠ¨ä½œ: ${i.action}</div>\\n                    <div class=\"dnd-clickable\" onclick=\"window.DND_Dashboard_UI.adjustTurnResource('bonus')\" title=\"ç‚¹å‡»å¢åŠ é™„èµ åŠ¨ä½œ\" style=\"cursor:pointer;color:${i.bonus>0?\"#e67e22\":\"#555\"}\"><i class=\"fa-solid fa-plus-circle\"></i> é™„èµ : ${i.bonus}</div>\\n                    <div class=\"dnd-clickable\" onclick=\"window.DND_Dashboard_UI.adjustTurnResource('reaction')\" title=\"ç‚¹å‡»å¢åŠ ååº”\" style=\"cursor:pointer;color:${i.reaction>0?\"#f1c40f\":\"#555\"}\"><i class=\"fa-solid fa-rotate\"></i> ååº”: ${i.reaction}</div>\\n                    <div class=\"dnd-clickable\" onclick=\"window.DND_Dashboard_UI.adjustTurnResource('movement')\" title=\"ç‚¹å‡»å¢åŠ 30å°ºç§»åŠ¨åŠ›\" style=\"cursor:pointer;color:${i.movement>0?\"#3498db\":\"#555\"}\"><i class=\"fa-solid fa-shoe-prints\"></i> ç§»åŠ¨: ${i.movement}</div>\\n                </div>\\n\\n                <div style=\"display:flex;gap:5px;\">\\n                    <button class=\"dnd-clickable\" style=\"\\n                        flex: 1;\\n                        background: linear-gradient(135deg, #2c3e50, #2980b9);\\n                        border: 1px solid #3498db;\\n                        color: #fff;\\n                        padding: 5px;\\n                        border-radius: 4px;\\n                        cursor: pointer;\\n                        font-weight: bold;\\n                        font-size: 12px;\\n                    \" onclick=\"window.DND_Dashboard_UI.startTargeting({\\n                        type: 'move',\\n                        rangeText: '30å°º',\\n                        skillName: 'ç§»åŠ¨',\\n                        callback: (res) => window.DND_Dashboard_UI.executeAction('move', res)\\n                    })\"><i class=\"fa-solid fa-person-walking\"></i> ç§»åŠ¨</button>\\n                    <button class=\"dnd-clickable\" style=\"\\n                        flex: 1;\\n                        background: linear-gradient(135deg, #8e44ad, #9b59b6);\\n                        border: 1px solid #9b59b6;\\n                        color: #fff;\\n                        padding: 5px;\\n                        border-radius: 4px;\\n                        cursor: pointer;\\n                        font-weight: bold;\\n                        font-size: 12px;\\n                    \" onclick=\"window.DND_Dashboard_UI.showCombatSkillList(event)\"><i class=\"fa-solid fa-gavel\"></i> æŠ€èƒ½</button>\\n                </div>\\n            </div>\\n        `,o+='<div class=\"dnd-hud-party-stats\">',o+='<div id=\"dnd-combat-resource-panel\"></div>',e&&e.length>0){const n=[...e].sort((n,t)=>{const e=parseInt(n[\"å…ˆæ”»/ä½ç½®\"])||0;return(parseInt(t[\"å…ˆæ”»/ä½ç½®\"])||0)-e});n.forEach(n=>{const t=\"æ˜¯\"===n[\"æ˜¯å¦ä¸ºå½“å‰è¡ŒåŠ¨è€…\"],e=n[\"é™„ç€çŠ¶æ€\"]||\"\",a=\"æ•Œæ–¹\"===n[\"é˜µè¥\"];let r=0,i=1,d=100;const s=n[\"HPçŠ¶æ€\"]||\"0/0\",l=s.split(\"/\");l.length>=2&&(r=parseInt(l[0])||0,i=parseInt(l[1])||1,d=Math.min(100,Math.max(0,r/i*100)));const c=n[\"é˜²å¾¡/æŠ—æ€§\"]||\"-\",p=c.match(/AC(\\d+)/),g=p?p[1]:c.length<5?c:\"??\",f=n[\"å•ä½åç§°\"],b=this.getNameInitial(n[\"å•ä½åç§°\"]),m=`combat-avatar-${f.replace(/[^a-zA-Z0-9]/g,\"_\")}-${Math.random().toString(36).substr(2,5)}`;setTimeout(()=>this.loadAvatarAsync(f,m),0);let u=\"var(--dnd-text-main)\";a&&(u=\"var(--dnd-accent-red)\"),t&&(u=\"var(--dnd-text-highlight)\"),o+=`\\n                    <div class=\"dnd-mini-char dnd-hud-entry ${t?\"active\":\"\"}\" style=\"${a?\"border-left-color:var(--dnd-accent-red) !important;\":\"\"}\">\\n                        <div id=\"${m}\" class=\"dnd-mini-char-avatar dnd-avatar-container ${t?\"dnd-active-turn\":\"\"}\" data-char-id=\"${f}\" style=\"overflow:hidden;background:linear-gradient(135deg, #2a2a2e 0%, #1a1a1c 100%);position:relative;cursor:pointer;border-color:${a?\"var(--dnd-accent-red)\":\"var(--dnd-border-gold)\"};\" title=\"${n[\"å•ä½åç§°\"]}\">\\n                            <div class=\"dnd-avatar-initial\" style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:${a?\"#ff6b6b\":\"var(--dnd-text-highlight)\"};font-weight:bold;font-size:16px;\">${b}</div>\\n                        </div>\\n                        <div class=\"dnd-mini-char-info\">\\n                            <div style=\"display:flex;justify-content:space-between\">\\n                                <div class=\"dnd-mini-name\" style=\"color:${u}\">${n[\"å•ä½åç§°\"]} ${t?'<i class=\"fa-solid fa-bolt\"></i>':\"\"}</div>\\n                                <div style=\"font-size:11px;color:#888\">AC: ${g}</div>\\n                            </div>\\n                            <div class=\"dnd-mini-bars\">\\n                                <div class=\"dnd-micro-bar hp dnd-bar-shimmer\" title=\"${s}\"><div class=\"dnd-micro-bar-fill\" style=\"width:${d}%;background:${a?\"#c0392b\":\"var(--dnd-accent-green)\"} !important;\"></div></div>\\n                            </div>\\n                            ${e?`<div style=\"font-size:10px;color:#aaa;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">${e}</div>`:\"\"}\\n                        </div>\\n                    </div>\\n                `})}else o+='<div style=\"color:#666;text-align:center;padding:10px;\">ç­‰å¾…æˆ˜æ–—æ•°æ®...</div>';o+=\"</div></div>\",n.append(o);const d=this;n.find(\".dnd-mini-char-avatar\").on(\"click\",function(n){n.stopPropagation();const a=t(this).attr(\"title\"),r=e.find(n=>n[\"å•ä½åç§°\"]===a);r&&d.showCombatUnitDetail(r,n)}),this.renderResourceConsumption&&this.renderResourceConsumption(t(\"#dnd-combat-resource-panel\")),this.renderMiniMap(t(\"#dnd-hud-minimap-content\"))},renderExploreHUD(n){const{$:t}=a(),e=t('<div class=\"dnd-hud-minimap\" id=\"dnd-hud-minimap-content\" style=\"width:100% !important; height:240px !important; margin-bottom:10px; border:1px solid var(--dnd-border-gold);\"></div>');n.append(e),this.renderMiniMap(e),this.renderActionOptions(n);const r=Rr.getTable(\"QUEST_Active\");if(r&&r.length>0){const e=r.find(n=>\"è¿›è¡Œä¸­\"===n[\"çŠ¶æ€\"])||r[0],a=e[\"ç±»å‹\"]||\"\",o=e[\"æ—¶é™\"]||\"\",i=t(`\\n                <div class=\"dnd-hud-quests dnd-hud-entry\" style=\"animation-delay:0.2s; margin-top:5px;background:rgba(0,0,0,0.2);padding:6px;border-radius:4px;border-left:2px solid var(--dnd-border-gold);cursor:pointer;\">\\n                    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:2px;\">\\n                        <div style=\"font-weight:bold;color:var(--dnd-text-header);font-size:12px;display:flex;align-items:center;gap:5px;\">\\n                            <span><i class=\"fa-solid fa-thumbtack dnd-icon-notify\"></i> ${e[\"ä»»åŠ¡åç§°\"]}</span>\\n                            ${a?`<span style=\"font-size:10px;background:rgba(255,255,255,0.1);padding:0 4px;border-radius:2px;color:var(--dnd-text-dim);\">${a}</span>`:\"\"}\\n                        </div>\\n                        ${o&&\"æ— é™åˆ¶\"!==o?`<div style=\"font-size:10px;color:#e67e22;\"><i class=\"fa-solid fa-clock\"></i> ${o}</div>`:\"\"}\\n                    </div>\\n                    <div style=\"font-size:11px;color:#aaa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">\\n                        ${e[\"å½“å‰è¿›åº¦\"]||e[\"ç›®æ ‡æè¿°\"]||\"...\"}\\n                    </div>\\n                </div>\\n            `);i.on(\"click\",n=>this.showQuestTooltip(e,n.clientX,n.clientY)),n.append(i)}},renderActionOptions(n){const{$:t}=a(),e=Rr.getTable(\"UI_ActionOptions\");if(!e||0===e.length)return;const r=e[0],o=[];if([\"é€‰é¡¹A\",\"é€‰é¡¹B\",\"é€‰é¡¹C\",\"é€‰é¡¹D\"].forEach(n=>{r[n]&&r[n].trim()&&o.push({key:n.replace(\"é€‰é¡¹\",\"\"),text:r[n]})}),0===o.length)return;let i='<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px;\">';o.forEach((n,t)=>{i+=`\\n                <button class=\"dnd-action-btn dnd-clickable dnd-hud-entry dnd-hover-lift\" data-text=\"${n.text}\" style=\"animation-delay:${.05*t}s;\\n                    background: linear-gradient(to bottom, #2a2a2c, #1a1a1c);\\n                    border: 1px solid var(--dnd-border-inner);\\n                    color: var(--dnd-text-main);\\n                    padding: 8px 5px;\\n                    border-radius: 4px;\\n                    cursor: pointer;\\n                    font-size: 12px;\\n                    text-align: left;\\n                    overflow: hidden;\\n                    text-overflow: ellipsis;\\n                    white-space: nowrap;\\n                    transition: all 0.2s;\\n                \" onmouseover=\"this.style.borderColor='var(--dnd-text-highlight)';this.style.color='var(--dnd-text-highlight)'\" \\n                onmouseout=\"this.style.borderColor='var(--dnd-border-inner)';this.style.color='var(--dnd-text-main)'\">\\n                    <span style=\"color:var(--dnd-border-gold);font-weight:bold;margin-right:4px;\">${n.key}.</span> ${n.text}\\n                </button>\\n            `}),i+=\"</div>\";const d=t(i),s=this;d.find(\".dnd-action-btn\").on(\"click\",function(){const n=t(this).data(\"text\");s.fillChatInput(n)}),n.append(d)},renderPartyBar(t){const{$:e}=a(),r=Rr.getPartyData();if(!r||0===r.length)return;let o='<div class=\"dnd-hud-party-bar\">';r.forEach((n,t)=>{let e=0,a=0,r=0;if(n.HP){const t=n.HP.split(\"/\");2===t.length&&(e=parseInt(t[0])||0,a=parseInt(t[1])||1,r=Math.min(100,Math.max(0,e/a*100)))}let i=0,d=\"\";if(n[\"ç»éªŒå€¼\"]){const t=n[\"ç»éªŒå€¼\"].toString().split(\"/\");if(2===t.length){const n=parseInt(t[0])||0,e=parseInt(t[1])||1;i=Math.min(100,Math.max(0,n/e*100)),d=`${n}/${e}`}}const s=n[\"ç­‰çº§\"]||1,l=n.PC_ID||n.CHAR_ID||n[\"å§“å\"],c=this.getNameInitial(n[\"å§“å\"]),p=`party-avatar-${l}-${t}`;setTimeout(()=>this.loadAvatarAsync(l,p),0);const g=this._controlledCharId===l;let f=!1;if(n[\"ç»éªŒå€¼\"]){const t=n[\"ç»éªŒå€¼\"].toString().split(\"/\");if(2===t.length){const n=parseInt(t[0])||0,e=parseInt(t[1])||1;n>=e&&e>0&&(f=!0)}}o+=`\\n                <div class=\"party-bar-item dnd-clickable dnd-hud-entry dnd-hover-lift\" data-idx=\"${t}\" style=\"animation-delay:${.05*t}s;\">\\n                    <div style=\"position:relative;\">\\n                        <div id=\"${p}\" class=\"dnd-avatar-container party-avatar-container\" data-char-id=\"${l}\" title=\"${n[\"å§“å\"]}\">\\n                            <span style=\"color:var(--dnd-text-highlight);font-weight:bold;font-size:16px;\">${c}</span>\\n                        </div>\\n                        <div class=\"party-lvl-badge\">Lv.${s}</div>\\n                        \\x3c!-- [æ–°å¢] æ“æ§åˆ‡æ¢æŒ‰é’® --\\x3e\\n                        <div class=\"party-control-btn ${g?\"active\":\"\"}\"\\n                                onclick=\"event.stopPropagation(); window.DND_Dashboard_UI.setControlledCharacter('${l}')\"\\n                                title=\"åˆ‡æ¢æ“æ§æ­¤è§’è‰²\">\\n                            <i class=\"fa-solid fa-gamepad\"></i>\\n                        </div>\\n                        \\x3c!-- [æ–°å¢] å‡çº§æŒ‰é’® --\\x3e\\n                        ${f?`\\n                        <div class=\"party-levelup-btn\"\\n                                onclick=\"event.stopPropagation(); window.DND_Dashboard_UI.startLevelUp('${l}')\"\\n                                title=\"ç»éªŒå€¼å·²æ»¡ï¼Œç‚¹å‡»å‡çº§ï¼\">\\n                            <i class=\"fa-solid fa-arrow-up dnd-icon-bounce\"></i>\\n                        </div>`:\"\"}\\n                    </div>\\n                    \\n                    \\x3c!-- HPæ¡ --\\x3e\\n                    <div class=\"dnd-bar-shimmer\" style=\"width:100%;height:4px;background:#333;border-radius:2px;overflow:hidden;margin-top:2px;\">\\n                        <div class=\"dnd-bar-fill\" style=\"width:${r}%;height:100%;background:${r<30?\"#c0392b\":\"var(--dnd-accent-green)\"};transition:width 0.3s;\"></div>\\n                    </div>\\n                    \\n                    \\x3c!-- XPæ¡ --\\x3e\\n                    ${d?`\\n                    <div class=\"dnd-bar-shimmer\" style=\"width:100%;height:2px;background:#222;border-radius:1px;overflow:hidden;margin-top:1px;\" title=\"XP: ${d}\">\\n                        <div class=\"dnd-bar-fill\" style=\"width:${i}%;height:100%;background:#8e44ad;transition:width 0.3s;\"></div>\\n                    </div>`:\"\"}\\n                </div>\\n            `}),o+=\"</div>\";const i=e(o),d=this;i.find(\".party-bar-item\").on(\"click\",function(t){n.debug(\"[PartyBar] Clicked item\",e(this).data(\"idx\")),t.stopPropagation();const a=e(this).data(\"idx\"),o=r[a];o?d.showCharacterCard(o,t):n.error(\"[PartyBar] Character data not found for index\",a)}),t.append(i)},renderFooter(t){const{$:e}=a(),r=this.getControlledCharacter(),o=r||{},i=Rr.getTable(\"FACTION_Standing\")||[],d=r?r.CHAR_ID||r.PC_ID||r[\"å§“å\"]:null,s=Rr.getKnownSpells(d),l=s&&s.length>0;let c='<div class=\"dnd-hud-footer\">';if(r&&(c+=`<div class=\"dnd-res-item\" title=\"é‡‘å¸\"><span class=\"dnd-res-icon\"><i class=\"fa-solid fa-coins\"></i></span> ${o[\"é‡‘å¸\"]||0} gp</div>`,o[\"ç”Ÿå‘½éª°\"]&&(c+=`<div class=\"dnd-res-item\" title=\"ç”Ÿå‘½éª°\"><span class=\"dnd-res-icon\"><i class=\"fa-solid fa-heart\"></i></span> ${o[\"ç”Ÿå‘½éª°\"]}</div>`),o[\"èŒä¸šèµ„æº\"]))try{const n=Rr.parseValue(o[\"èŒä¸šèµ„æº\"],\"resources\");if(n){const t=Object.keys(n)[0];t&&(c+=`<div class=\"dnd-res-item\" title=\"${t}\"><span class=\"dnd-res-icon\"><i class=\"fa-solid fa-bolt\"></i></span> ${n[t]}</div>`)}}catch(n){}if(i.length>0){let n=\"\",t=0;i.forEach(e=>{if(t>=2)return;const a=parseInt(e[\"å…³ç³»ç­‰çº§\"])||0;if(0!==a){const r=a>0?'<i class=\"fa-solid fa-landmark\"></i>':'<i class=\"fa-solid fa-skull\"></i>';n+=`<span style=\"color:${a>0?\"var(--dnd-accent-green)\":\"var(--dnd-accent-red)\"};margin-left:5px;cursor:help;\" title=\"${e[\"åŠ¿åŠ›åç§°\"]}: ${e[\"å…³ç³»ç­‰çº§\"]} (å£°æœ›:${e[\"å£°æœ›å€¼\"]||0})\">${r}</span>`,t++}}),n&&(c+=`<div class=\"dnd-res-item\" style=\"border-left:1px solid rgba(255,255,255,0.1);padding-left:8px;margin-left:5px;\">${n}</div>`)}c+='<div style=\"margin-left:auto;display:flex;gap:10px;\">',c+='\\n            <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"inventory\" style=\"cursor:pointer;\" title=\"èƒŒåŒ…ç‰©å“\">\\n                <span class=\"dnd-res-icon\" style=\"font-size:16px;color:var(--dnd-text-main)\"><i class=\"fa-solid fa-suitcase\"></i></span>\\n            </div>\\n        ',c+='\\n            <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"equipment\" style=\"cursor:pointer;\" title=\"å·²è£…å¤‡ç‰©å“\">\\n                <span class=\"dnd-res-icon\" style=\"font-size:16px;color:var(--dnd-text-highlight)\"><i class=\"fa-solid fa-shield-halved\"></i></span>\\n            </div>\\n        ',i.length>0&&(c+='\\n                <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"faction\" style=\"cursor:pointer;\" title=\"åŠ¿åŠ›ä¸å£°æœ›\">\\n                    <span class=\"dnd-res-icon\" style=\"font-size:16px;color:var(--dnd-text-highlight)\"><i class=\"fa-solid fa-landmark\"></i></span>\\n                </div>\\n            '),l&&(c+='\\n                <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"spellbook\" style=\"cursor:pointer;\" title=\"æ³•æœ¯ä¹¦\">\\n                    <span class=\"dnd-res-icon\" style=\"font-size:16px;color:#aab\"><i class=\"fa-solid fa-book\"></i></span>\\n                </div>\\n            '),c+='\\n            <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"npclist\" style=\"cursor:pointer;\" title=\"NPCåˆ—è¡¨\">\\n                <span class=\"dnd-res-icon\" style=\"font-size:16px;color:var(--dnd-text-main)\"><i class=\"fa-solid fa-users\"></i></span>\\n            </div>\\n        ',c+='\\n            <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"dice\" style=\"cursor:pointer;\" title=\"å¿«é€ŸæŠ•æ·\">\\n                <span class=\"dnd-res-icon\" style=\"font-size:16px;color:var(--dnd-text-highlight)\"><i class=\"fa-solid fa-dice-d20\"></i></span>\\n            </div>\\n        ',c+='\\n            <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"manual-update\" style=\"cursor:pointer;\" title=\"æ‰‹åŠ¨åˆ·æ–°æ•°æ®\">\\n                <span class=\"dnd-res-icon dnd-refresh-icon\" style=\"font-size:16px;color:var(--dnd-text-main)\"><i class=\"fa-solid fa-sync\"></i></span>\\n            </div>\\n        ',c+='\\n            <div class=\"dnd-res-item dnd-footer-btn dnd-clickable\" data-action=\"settings\" style=\"cursor:pointer;\" title=\"æ‰“å¼€è®¾ç½®\">\\n                <span class=\"dnd-res-icon\" style=\"font-size:16px;color:var(--dnd-text-dim)\"><i class=\"fa-solid fa-cog\"></i></span>\\n            </div>\\n        ',c+=\"</div></div>\";const p=e(c),g=this;p.find(\".dnd-footer-btn\").on(\"click\",function(t){t.stopPropagation();const a=e(this).data(\"action\");switch(n.debug(\"Footer button clicked:\",a),a){case\"inventory\":g.showInventoryPanel(t);break;case\"equipment\":g.showEquipmentPanel(t);break;case\"faction\":g.showFactionPanel(t);break;case\"spellbook\":g.showSpellBook(t);break;case\"npclist\":g.showNPCListPanel(t);break;case\"dice\":g.showQuickDice(t);break;case\"manual-update\":g.triggerManualUpdate(t);break;case\"settings\":e(\".dnd-nav-item\").removeClass(\"active\"),e('.dnd-nav-item[data-target=\"settings\"]').addClass(\"active\"),Jr.setState(\"full\")}}),t.append(p)},showNPCListPanel(n){const t=Rr.getTable(\"NPC_Registry\");if(!t||0===t.length)return void this.showItemDetailPopup('<div style=\"text-align:center;color:#888;\">ğŸ‘¥ æš‚æ— NPCæ•°æ®</div>',n.clientX,n.clientY);const e=[...new Set(t.map(n=>n[\"å½“å‰çŠ¶æ€\"]||\"æœªçŸ¥\"))].sort();let a=`<div style=\"font-weight:bold;color:var(--dnd-text-main);border-bottom:1px solid var(--dnd-border-gold);padding-bottom:5px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;\">\\n            <span>ğŸ‘¥ NPCåˆ—è¡¨</span>\\n            <span style=\"font-size:11px;color:#888;\">${t.length} äºº</span>\\n        </div>`;a+=`\\n            <div style=\"display:flex;gap:5px;margin-bottom:10px;\">\\n                <input type=\"text\" id=\"dnd-npc-search\" placeholder=\"æœç´¢NPC...\" style=\"flex:1;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:4px 8px;border-radius:4px;font-size:12px;\" oninput=\"window.DND_Dashboard_UI.filterNPCList()\">\\n                <select id=\"dnd-npc-filter\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:4px;border-radius:4px;font-size:12px;\" onchange=\"window.DND_Dashboard_UI.filterNPCList()\">\\n                    <option value=\"\">å…¨éƒ¨çŠ¶æ€</option>\\n                    ${e.map(n=>`<option value=\"${n}\">${n}</option>`).join(\"\")}\\n                </select>\\n            </div>\\n        `,a+='<div style=\"max-height:400px;overflow-y:auto;display:flex;flex-direction:column;gap:6px;\" id=\"dnd-npc-list\">',t.forEach(n=>{const t=(n.NPC_ID||\"\").replace(/'/g,\"\\\\'\"),e=\"æ­»äº¡\"===n[\"å½“å‰çŠ¶æ€\"]?\"#8a2c2c\":\"åœ¨åœº\"===n[\"å½“å‰çŠ¶æ€\"]?\"#3a6b4a\":\"#888\",r=n.HP||\"\",o=r.match(/(\\d+)\\s*\\/\\s*(\\d+)/),i=o?parseInt(o[1]):0,d=o?parseInt(o[2]):1,s=Math.min(100,Math.max(0,i/d*100)),l=s>50?\"#4a7c59\":s>25?\"#b8860b\":\"#8a2c2c\";a+=`\\n                <div class=\"dnd-npc-list-item\" data-name=\"${n[\"å§“å\"]||\"\"}\" data-status=\"${n[\"å½“å‰çŠ¶æ€\"]||\"\"}\"\\n                    style=\"padding:8px 10px;background:rgba(255,255,255,0.03);border:1px solid var(--dnd-border-inner);border-radius:6px;cursor:pointer;\"\\n                    onmouseover=\"this.style.background='rgba(255,255,255,0.08)';this.style.borderColor='var(--dnd-border-gold)'\"\\n                    onmouseout=\"this.style.background='rgba(255,255,255,0.03)';this.style.borderColor='var(--dnd-border-inner)'\"\\n                    onclick=\"window.DND_Dashboard_UI.showNPCDetail('${t}', event)\">\\n                    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;\">\\n                        <span style=\"font-weight:bold;color:var(--dnd-text-main);\">${n[\"å§“å\"]||\"æœªçŸ¥\"}</span>\\n                        <span style=\"font-size:11px;\">\\n                            ${n[\"ç­‰çº§\"]?`<span style=\"color:#d4af37;margin-right:6px;\">Lv.${n[\"ç­‰çº§\"]}</span>`:\"\"}\\n                            <span style=\"color:${e}\">${n[\"å½“å‰çŠ¶æ€\"]||\"\"}</span>\\n                        </span>\\n                    </div>\\n                    <div style=\"font-size:11px;color:#888;margin-bottom:4px;\">${n[\"ç§æ—/æ€§åˆ«/å¹´é¾„\"]||\"-\"} | ${n[\"èŒä¸š/èº«ä»½\"]||\"-\"}</div>\\n                    ${r?`\\n                    <div style=\"display:flex;align-items:center;gap:8px;\">\\n                        <div style=\"flex:1;background:#1a1a1a;border-radius:3px;height:4px;overflow:hidden;\">\\n                            <div style=\"width:${s}%;height:100%;background:${l};\"></div>\\n                        </div>\\n                        <span style=\"font-size:10px;color:#888;\">${r}${n.AC?` | AC${n.AC}`:\"\"}</span>\\n                    </div>\\n                    `:n.AC?`<div style=\"font-size:10px;color:#888;\">AC ${n.AC}</div>`:\"\"}\\n                </div>\\n            `}),a+=\"</div>\",this.showItemDetailPopup(a,n.clientX,n.clientY)},filterNPCList(){const{$:n}=a(),t=(n(\"#dnd-npc-search\").val()||\"\").toLowerCase(),e=n(\"#dnd-npc-filter\").val();n(\"#dnd-npc-list .dnd-npc-list-item\").each(function(){const a=n(this),r=(a.data(\"name\")||\"\").toLowerCase(),o=a.data(\"status\")||\"\",i=!t||r.includes(t),d=!e||o===e;a.toggle(i&&d)})},showNPCDetail(n,t){const e=Rr.getTable(\"NPC_Registry\"),a=e?.find(t=>t.NPC_ID===n);if(!a)return void console.error(\"NPC not found:\",n);let r='<div style=\"min-width:220px;max-width:350px;\">';const o=\"æ­»äº¡\"===a[\"å½“å‰çŠ¶æ€\"]?\"#8a2c2c\":\"åœ¨åœº\"===a[\"å½“å‰çŠ¶æ€\"]?\"#3a6b4a\":\"#888\";if(r+=`\\n            <div style=\"border-bottom:1px solid var(--dnd-border-gold);padding-bottom:8px;margin-bottom:12px;\">\\n                <div style=\"display:flex;justify-content:space-between;align-items:center;\">\\n                    <span style=\"font-size:16px;font-weight:bold;color:var(--dnd-text-main);\">${a[\"å§“å\"]||\"æœªçŸ¥\"}</span>\\n                    <span style=\"font-size:12px;\">\\n                        ${a[\"ç­‰çº§\"]?`<span style=\"color:#d4af37;margin-right:6px;\">Lv.${a[\"ç­‰çº§\"]}</span>`:\"\"}\\n                        <span style=\"color:${o}\">${a[\"å½“å‰çŠ¶æ€\"]||\"\"}</span>\\n                    </span>\\n                </div>\\n                <div style=\"font-size:12px;color:#888;margin-top:4px;\">${a[\"ç§æ—/æ€§åˆ«/å¹´é¾„\"]||\"-\"} | ${a[\"èŒä¸š/èº«ä»½\"]||\"-\"}</div>\\n            </div>\\n        `,(a[\"ç­‰çº§\"]||a.HP||a.AC)&&(r+='<div style=\"background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;margin-bottom:12px;\">',r+='<div style=\"display:flex;gap:16px;flex-wrap:wrap;\">',a[\"ç­‰çº§\"]&&(r+=`<div><span style=\"color:#888;font-size:10px;\">ç­‰çº§</span><br><span style=\"color:#d4af37;font-size:14px;font-weight:bold;\">Lv.${a[\"ç­‰çº§\"]}</span></div>`),a.HP&&(r+=`<div><span style=\"color:#888;font-size:10px;\">ç”Ÿå‘½å€¼</span><br><span style=\"color:#c94c4c;font-size:14px;font-weight:bold;\">${a.HP}</span></div>`),a.AC&&(r+=`<div><span style=\"color:#888;font-size:10px;\">æŠ¤ç”²</span><br><span style=\"color:#6a9fb5;font-size:14px;font-weight:bold;\">AC ${a.AC}</span></div>`),r+=\"</div></div>\"),r+=`\\n            <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;font-size:12px;\">\\n                <div><span style=\"color:#888;\">ä½ç½®:</span> <span style=\"color:#ccc;\">${a[\"æ‰€åœ¨ä½ç½®\"]||\"-\"}</span></div>\\n                <div><span style=\"color:#888;\">å…³ç³»:</span> <span style=\"color:#ccc;\">${a[\"ä¸ä¸»è§’å…³ç³»\"]||\"-\"}</span></div>\\n            </div>\\n        `,a[\"ä¸»è¦æŠ€èƒ½\"]){r+='<div style=\"margin-bottom:10px;\"><span style=\"color:#d4af37;font-size:12px;font-weight:bold;\">ä¸»è¦æŠ€èƒ½</span>';const n=a[\"ä¸»è¦æŠ€èƒ½\"].split(/[,ï¼Œ]/).map(n=>n.trim()).filter(n=>n);r+='<div style=\"display:flex;flex-wrap:wrap;gap:4px;margin-top:4px;\">',n.forEach(n=>{r+=`<span style=\"background:rgba(212,175,55,0.15);color:#d4af37;padding:2px 6px;border-radius:4px;font-size:11px;\">${n}</span>`}),r+=\"</div></div>\"}if(a[\"éšèº«ç‰©å“\"]){r+='<div style=\"margin-bottom:10px;\"><span style=\"color:#8b7355;font-size:12px;font-weight:bold;\">éšèº«ç‰©å“</span>';const n=a[\"éšèº«ç‰©å“\"].split(/[,ï¼Œ]/).map(n=>n.trim()).filter(n=>n);r+='<div style=\"display:flex;flex-wrap:wrap;gap:4px;margin-top:4px;\">',n.forEach(n=>{r+=`<span style=\"background:rgba(139,115,85,0.15);color:#c9a86c;padding:2px 6px;border-radius:4px;font-size:11px;\">${n}</span>`}),r+=\"</div></div>\"}a[\"å¤–è²Œæè¿°\"]&&(r+=`<div style=\"margin-bottom:10px;\"><span style=\"color:#888;font-size:12px;font-weight:bold;\">å¤–è²Œ</span>\\n                <div style=\"color:#aaa;font-size:12px;line-height:1.4;margin-top:4px;max-height:150px;overflow-y:auto;\">${a[\"å¤–è²Œæè¿°\"]}</div>\\n            </div>`),a[\"å…³é”®ç»å†\"]&&(r+=`<div style=\"margin-bottom:10px;\"><span style=\"color:#888;font-size:12px;font-weight:bold;\">å…³é”®ç»å†</span>\\n                <div style=\"color:#aaa;font-size:12px;line-height:1.4;margin-top:4px;max-height:200px;overflow-y:auto;\">${a[\"å…³é”®ç»å†\"]}</div>\\n            </div>`),r+=`<div style=\"margin-top:12px;font-size:10px;color:#555;text-align:right;\">ID: ${a.NPC_ID}</div>`,r+=\"</div>\",t&&t.stopPropagation(),this.showItemDetailPopup(r,t.clientX,t.clientY)},renderMiniSpellSlots(n){const{$:t}=a(),e=this.getControlledCharacter();if(!e)return;const r=e;if(r&&r[\"æ³•æœ¯ä½\"]){const a=this.formatSpellSlots(r[\"æ³•æœ¯ä½\"],!0);if(a){const r=t(`\\n                    <div style=\"padding:0 10px 5px 10px; border-bottom:1px solid rgba(255,255,255,0.05);\">\\n                        <div style=\"font-size:10px;color:#888;margin-bottom:2px;\">æ³•æœ¯ä½ (${e[\"å§“å\"]})</div>\\n                        ${a}\\n                    </div>\\n                `);n.append(r)}}}},Zr={update:async(n,t,e=null)=>{Rr.getAPI();const a=Rr.getTable(\"ITEM_Inventory\");if(!a)return;let r=-1;a.find((t,e)=>(t[\"ç‰©å“ID\"]===n||t[\"ç‰©å“åç§°\"]===n)&&(r=e,!0));if(-1===r)return void console.error(\"[DND ItemManager] Item not found:\",n);const o=Rr.getAllData();let i=Object.keys(o).find(n=>n.includes(\"ITEM_Inventory\")||o[n].name&&o[n].name.includes(\"èƒŒåŒ…\"));if(!i)return;const d=o[i],s=d.content[0],l=r+1;Object.keys(t).forEach(n=>{const e=s.indexOf(n);-1!==e&&(d.content[l][e]=t[n])}),void 0!==t[\"æ•°é‡\"]&&t[\"æ•°é‡\"]<=0&&d.content.splice(l,1),e&&Rr.applySystemNotification(o,e),await Lr.saveData(o)}},no={getCore:function(){let n=null,t=null;try{window.SillyTavern?n=window.SillyTavern:window.parent&&window.parent.SillyTavern?n=window.parent.SillyTavern:window.top&&window.top.SillyTavern&&(n=window.top.SillyTavern),window.TavernHelper?t=window.TavernHelper:window.parent&&window.parent.TavernHelper?t=window.parent.TavernHelper:window.top&&window.top.TavernHelper&&(t=window.top.TavernHelper)}catch(n){console.error(\"[TavernAPI] è·å–æ ¸å¿ƒå¯¹è±¡å¤±è´¥:\",n)}return{SillyTavern:n,TavernHelper:t}},_normalizeUrl:function(n){if(!n)return\"\";let t=n.trim();for(;t.endsWith(\"/\");)t=t.slice(0,-1);return t.endsWith(\"/chat/completions\")&&(t=t.replace(/\\/chat\\/completions$/,\"\")),t},getPresets:function(){const{SillyTavern:n}=this.getCore();return console.log(\"[TavernAPI] æ­£åœ¨å°è¯•è·å– API é¢„è®¾...\"),n?n.extensionSettings?.connectionManager?.profiles?n.extensionSettings.connectionManager.profiles:n.extensionSettings?.connection?.profiles?n.extensionSettings.connection.profiles:n.contexts?.connection?.profiles?n.contexts.connection.profiles:(console.warn(\"[TavernAPI] æœªèƒ½æ‰¾åˆ° connectionManager.profilesï¼Œè¯·æ£€æŸ¥é…’é¦†ç‰ˆæœ¬\"),[]):(console.error(\"[TavernAPI] æœªæ‰¾åˆ° SillyTavern å¯¹è±¡\"),[])},fetchModels:async function(n,t){if(!n)throw new Error(\"API URL ä¸èƒ½ä¸ºç©º\");const e=this._normalizeUrl(n),{SillyTavern:a}=this.getCore(),r={reverse_proxy:e,proxy_password:\"\",chat_completion_source:\"custom\",custom_url:e,custom_include_headers:t?`Authorization: Bearer ${t}`:\"\"},o=await fetch(\"/api/backends/chat-completions/status\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",...a?.getRequestHeaders?a.getRequestHeaders():{}},body:JSON.stringify(r)});if(!o.ok){const n=await o.text();throw new Error(`è¿æ¥å¤±è´¥: ${o.status} - ${n}`)}const i=await o.json();let d=[];return i.models&&Array.isArray(i.models)?d=i.models:Array.isArray(i)?d=i:i.data&&Array.isArray(i.data)&&(d=i.data),d.map(n=>\"string\"==typeof n?n:n.id)},generate:async function(n,t={}){const{SillyTavern:e,TavernHelper:a}=this.getCore(),{presetId:r,customConfig:o,maxTokens:i=4096}=t;if(!e&&!a)throw new Error(\"SillyTavern æ ¸å¿ƒ API æœªå°±ç»ª\");if(o&&o.url&&o.model){console.log(`[TavernAPI] ä½¿ç”¨è‡ªå®šä¹‰é…ç½®å‘é€è¯·æ±‚: ${o.url}`);const{url:t,key:a,model:r}=o,d=this._normalizeUrl(t);try{const t={messages:n,model:r,max_tokens:i,temperature:.7,top_p:.9,stream:!1,chat_completion_source:\"custom\",reverse_proxy:d,proxy_password:\"\",custom_url:d,custom_include_headers:a?`Authorization: Bearer ${a}`:\"\",enable_web_search:!1,request_images:!1},o=await fetch(\"/api/backends/chat-completions/generate\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",...e?.getRequestHeaders?e.getRequestHeaders():{}},body:JSON.stringify(t)});if(!o.ok){const n=await o.text();throw new Error(`API è¯·æ±‚å¤±è´¥: ${o.status} - ${n}`)}const s=await o.json();if(s&&s.choices&&s.choices[0]&&s.choices[0].message)return s.choices[0].message.content.trim();if(s&&s.content)return s.content.trim();throw new Error(\"API è¿”å›äº†æ„å¤–çš„æ•°æ®ç»“æ„\")}catch(n){throw console.error(\"[TavernAPI] Proxy Fetch Error:\",n),n}}else{if(!r){console.log(\"[TavernAPI] ä½¿ç”¨ä¸» API å‘é€è¯·æ±‚\");return(await a.generateRaw({ordered_prompts:n,should_stream:!1})).trim()}{console.log(`[TavernAPI] ä½¿ç”¨é¢„è®¾ ID: ${r} å‘é€è¯·æ±‚`);const t=this.getPresets().find(n=>n.id===r);if(!t)throw new Error(`æ‰¾ä¸åˆ° ID ä¸º \"${r}\" çš„ API é¢„è®¾`);let a=t.api_key||t.key||\"\",o=t.api_url||t.url||\"\",d=t.openai_model||t.model||\"gpt-3.5-turbo\";if(t.settings&&(a=a||t.settings.api_key||t.settings.key,o=o||t.settings.api_url||t.settings.url,d=d||t.settings.openai_model||t.settings.model),!o)throw new Error(`æ— æ³•ä»é¢„è®¾ \"${r}\" ä¸­è§£æå‡º API URLã€‚`);o=this._normalizeUrl(o),console.log(`[TavernAPI] Proxy via Backend: ${o}, Model: ${d}`);try{const t={messages:n,model:d,max_tokens:i,temperature:.7,top_p:.9,stream:!1,chat_completion_source:\"custom\",reverse_proxy:o,proxy_password:\"\",custom_url:o,custom_include_headers:a?`Authorization: Bearer ${a}`:\"\",enable_web_search:!1,request_images:!1},r=await fetch(\"/api/backends/chat-completions/generate\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",...e?.getRequestHeaders?e.getRequestHeaders():{}},body:JSON.stringify(t)});if(!r.ok){const n=await r.text();throw new Error(`API è¯·æ±‚å¤±è´¥: ${r.status} - ${n}`)}const s=await r.json();if(s&&s.choices&&s.choices[0]&&s.choices[0].message)return s.choices[0].message.content.trim();if(s&&s.content)return s.content.trim();throw new Error(\"API è¿”å›äº†æ„å¤–çš„æ•°æ®ç»“æ„\")}catch(n){throw console.error(\"[TavernAPI] Proxy Fetch Error:\",n),n}}}},getEnabledWorldInfo:async function(){const{TavernHelper:n}=this.getCore();if(!n)return\"\";try{const t=new Set;if(n.getGlobalWorldbookNames){const e=n.getGlobalWorldbookNames();Array.isArray(e)&&e.forEach(n=>t.add(n))}if(n.getChatWorldbookName){const e=n.getChatWorldbookName(\"current\");e&&t.add(e)}if(n.getCharWorldbookNames){const e=n.getCharWorldbookNames(\"current\");e&&(e.primary&&t.add(e.primary),Array.isArray(e.additional)&&e.additional.forEach(n=>t.add(n)))}if(0===t.size)return\"\";let e=\"ã€å½“å‰ä¸–ç•Œè§‚/è§„åˆ™å‚è€ƒ (World Info)ã€‘\\n\";for(const a of t)if(n.getWorldbook){const t=await n.getWorldbook(a);if(t&&t.length>0){e+=`\\n--- ä¸–ç•Œä¹¦: ${a} ---\\n`;const n=t.filter(n=>n.enabled),r=n.filter(n=>{const t=(Array.isArray(n.keys)?n.keys:[]).join(\",\").toLowerCase(),e=(n.content||\"\").toLowerCase();return t.includes(\"class\")||t.includes(\"race\")||t.includes(\"level\")||t.includes(\"magic\")||t.includes(\"rule\")||e.includes(\"èŒä¸š\")||e.includes(\"ç§æ—\")||e.includes(\"ç­‰çº§\")||e.includes(\"è§„åˆ™\")});(r.length>0?r:n.slice(0,20)).forEach(n=>{const t=Array.isArray(n.keys)?n.keys.join(\", \"):\"æ— å…³é”®å­—\";e+=`[${t}]: ${n.content}\\n`})}}return e}catch(n){return console.error(\"[TavernAPI] è·å–ä¸–ç•Œä¹¦å¤±è´¥:\",n),\"\"}}},to=async()=>{let t=await e.getSetting(\"dnd_global_api_config\",null);if(!t)try{const n=localStorage.getItem(\"dnd_creator_api_config\");n&&(t=n)}catch(n){}let a=t;if(\"string\"==typeof t)try{a=JSON.parse(t)}catch(t){n.warn(\"[SettingsManager] JSON parse failed, using raw value\")}if(\"string\"==typeof a)try{const n=JSON.parse(a);n&&\"object\"==typeof n&&(a=n)}catch(n){}return a&&\"object\"==typeof a||(a={}),{url:a.url||\"\",key:a.key||\"\",model:a.model||\"\"}},eo=async t=>{n.info(\"[SettingsManager] Saving API Config:\",t),await e.setSetting(\"dnd_global_api_config\",t)},ao=async()=>await e.getStatus(),ro=async()=>await e.forceSync(),oo={avatarStorage:{get:async n=>{const a=e.getFromChat(`avatar_${n}`);if(a)return a;let r=await t.get(n);if(!r){const e=localStorage.getItem(`dnd_avatar_${n}`);e&&(await t.put(n,e),localStorage.removeItem(`dnd_avatar_${n}`),r=e)}return r},set:async(n,a)=>(await e.saveToChat(`avatar_${n}`,a),await t.put(n,a)),remove:async n=>(await e.deleteFromChat(`avatar_${n}`),await t.delete(n))},async loadAvatarAsync(n,t){const{$:e}=a(),r=await this.avatarStorage.get(n);if(r){const n=e(`#${t}`);if(n.length){n.html(`<img src=\"${r}\" style=\"width:100%;height:100%;object-fit:cover;\">`);const t=this;n.find(\"img\").on(\"error\",function(){e(this).hide();const a=t.getNameInitial(n.attr(\"title\")),r=Math.floor(.5*n.width());n.html(`<div class=\"dnd-avatar-initial\" style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:var(--dnd-text-highlight);font-weight:bold;font-size:${r}px;\">${a}</div>`)})}}},renderAvatar(n,t,e=40){const a=this.getNameInitial(n),r=Math.floor(.5*e),o=`avatar-${t}-${Math.random().toString(36).substr(2,9)}`;return setTimeout(()=>this.loadAvatarAsync(t,o),0),`\\n            <div id=\"${o}\" class=\"dnd-avatar-container\" data-char-id=\"${t}\" style=\"width:${e}px;height:${e}px;border-radius:50%;overflow:hidden;border:1px solid var(--dnd-border-gold);flex-shrink:0;background:linear-gradient(135deg, #2a2a2e 0%, #1a1a1c 100%);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;\" title=\"${n}\">\\n                <span style=\"color:var(--dnd-text-highlight);font-weight:bold;font-size:${r}px;\">${a}</span>\\n            </div>\\n        `},showAvatarUploadDialog(n,t){const{$:e,window:r}=a();e(\"#dnd-avatar-upload-dialog\").remove(),this.avatarStorage.get(n).then(a=>{const o=this.getNameInitial(t),i=`\\n                <div id=\"dnd-avatar-upload-dialog\" style=\"\\n                    position: fixed;\\n                    ${(r.innerWidth||e(r).width())<768?\"\\n                        top: 20px;\\n                        left: 10px;\\n                        right: 10px;\\n                        transform: none;\\n                        width: auto;\\n                    \":\"\\n                        top: 50%;\\n                        left: 50%;\\n                        transform: translate(-50%, -50%);\\n                        min-width: 300px;\\n                        max-width: 90vw;\\n                    \"}\\n                    background: var(--dnd-bg-panel, #161618);\\n                    border: 1px solid var(--dnd-border-gold, #9d8b6c);\\n                    border-radius: 8px;\\n                    padding: 20px;\\n                    z-index: 2147483650;\\n                    box-shadow: 0 10px 40px rgba(0,0,0,0.8);\\n                \">\\n                    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;border-bottom:1px solid var(--dnd-border-inner);padding-bottom:10px;\">\\n                        <span style=\"color:var(--dnd-text-highlight);font-weight:bold;font-size:16px;\">è®¾ç½®å¤´åƒ - ${t}</span>\\n                        <span id=\"dnd-avatar-dialog-close\" style=\"cursor:pointer;color:#888;font-size:18px;\" title=\"å…³é—­\">âœ•</span>\\n                    </div>\\n                    \\n                    <div style=\"display:flex;flex-direction:column;align-items:center;gap:15px;\">\\n                        <div id=\"dnd-avatar-preview\" style=\"width:80px;height:80px;border-radius:50%;overflow:hidden;border:2px solid var(--dnd-border-gold);background:linear-gradient(135deg, #2a2a2e 0%, #1a1a1c 100%);display:flex;align-items:center;justify-content:center;\">\\n                            ${a?`<img src=\"${a}\" style=\"width:100%;height:100%;object-fit:cover;\">`:`<span style=\"color:var(--dnd-text-highlight);font-weight:bold;font-size:36px;\">${o}</span>`}\\n                        </div>\\n                        \\n                        <div style=\"display:flex;gap:10px;flex-wrap:wrap;justify-content:center;\">\\n                            <label style=\"\\n                                background: rgba(157, 139, 108, 0.2);\\n                                border: 1px solid var(--dnd-border-gold);\\n                                color: var(--dnd-text-highlight);\\n                                padding: 8px 16px;\\n                                border-radius: 4px;\\n                                cursor: pointer;\\n                                font-size: 13px;\\n                                transition: all 0.2s;\\n                            \" onmouseover=\"this.style.background='rgba(157, 139, 108, 0.4)'\" onmouseout=\"this.style.background='rgba(157, 139, 108, 0.2)'\">\\n                                <i class=\"fa-solid fa-camera\"></i> é€‰æ‹©å›¾ç‰‡\\n                                <input type=\"file\" id=\"dnd-avatar-file-input\" accept=\"image/*\" style=\"display:none;\">\\n                            </label>\\n                            \\n                            ${a?'\\n                                <button id=\"dnd-avatar-remove-btn\" style=\"\\n                                    background: rgba(138, 44, 44, 0.3);\\n                                    border: 1px solid #8a2c2c;\\n                                    color: #ff6b6b;\\n                                    padding: 8px 16px;\\n                                    border-radius: 4px;\\n                                    cursor: pointer;\\n                                    font-size: 13px;\\n                                    transition: all 0.2s;\\n                                \" onmouseover=\"this.style.background=\\'rgba(138, 44, 44, 0.5)\\'\" onmouseout=\"this.style.background=\\'rgba(138, 44, 44, 0.3)\\'\">\\n                                    <i class=\"fa-solid fa-trash\"></i> ç§»é™¤å¤´åƒ\\n                                </button>\\n                            ':\"\"}\\n                        </div>\\n                        \\n                        <div style=\"font-size:11px;color:#888;text-align:center;\">\\n                            æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼<br>\\n                            å›¾ç‰‡å°†å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°\\n                        </div>\\n                    </div>\\n                </div>\\n                <div id=\"dnd-avatar-dialog-backdrop\" style=\"\\n                    position: fixed;\\n                    top: 0;\\n                    left: 0;\\n                    width: 100vw;\\n                    height: 100vh;\\n                    background: rgba(0,0,0,0.6);\\n                    z-index: 2147483646;\\n                \"></div>\\n            `;e(\"body\").append(i),e(\"#dnd-avatar-dialog-close, #dnd-avatar-dialog-backdrop\").on(\"click\",()=>{e(\"#dnd-avatar-upload-dialog, #dnd-avatar-dialog-backdrop\").remove()});const d=this;e(\"#dnd-avatar-file-input\").on(\"change\",function(t){const a=t.target.files[0];if(!a)return;if(a.size>5242880)return void jr.warning(\"å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº 5MB çš„å›¾ç‰‡\");const r=new FileReader;r.onload=function(t){const a=t.target.result;d.compressImage(a,150,t=>{d.avatarStorage.set(n,t).then(a=>{a?(e(\"#dnd-avatar-preview\").html(`<img src=\"${t}\" style=\"width:100%;height:100%;object-fit:cover;\">`),d.refreshAvatars(n),setTimeout(()=>{e(\"#dnd-avatar-upload-dialog, #dnd-avatar-dialog-backdrop\").remove()},500)):jr.error(\"ä¿å­˜å¤±è´¥ï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨å­˜å‚¨ç©ºé—´ä¸è¶³\")})})},r.readAsDataURL(a)}),e(\"#dnd-avatar-remove-btn\").on(\"click\",async()=>{await jr.confirm(\"ç¡®å®šè¦ç§»é™¤å¤´åƒå—ï¼Ÿ\",{title:\"ç§»é™¤å¤´åƒ\",confirmText:\"ç§»é™¤\",type:\"danger\"})&&(this.avatarStorage.remove(n),this.refreshAvatars(n),e(\"#dnd-avatar-upload-dialog, #dnd-avatar-dialog-backdrop\").remove())})})},refreshAvatars(n){const{$:t}=a();this.avatarStorage.get(n).then(e=>{t(`.dnd-avatar-container[data-char-id=\"${n}\"]`).each(function(){const n=t(this),a=n.width(),r=Math.floor(.5*a),o=n.find(\".dnd-avatar-initial\").text()||n.find(\"span\").text()||\"?\";e?n.html(`\\n                        <img src=\"${e}\" style=\"width:100%;height:100%;object-fit:cover;\" onerror=\"this.style.display='none';this.nextElementSibling.style.display='flex'\">\\n                        <div class=\"dnd-avatar-initial\" style=\"display:none;width:100%;height:100%;align-items:center;justify-content:center;color:var(--dnd-text-highlight);font-weight:bold;font-size:${r}px;background:linear-gradient(135deg, #2a2a2e 0%, #1a1a1c 100%);\">${o}</div>\\n                    `):(n.html(`<span style=\"color:var(--dnd-text-highlight);font-weight:bold;font-size:${r}px;\">${o}</span>`),n.css({display:\"flex\",\"align-items\":\"center\",\"justify-content\":\"center\",background:\"linear-gradient(135deg, #2a2a2e 0%, #1a1a1c 100%)\"}))}),\"mini\"===this.state&&this.renderHUD()})},_lastClickPos:{x:0,y:0},showCharacterCard(t,e){n.info(\"[UIRenderer] showCharacterCard called for:\",t?t[\"å§“å\"]:\"Unknown\");const{$:r}=a();let o=r(\"#dnd-char-detail-card-el\");e&&void 0!==e.clientX&&(this._lastClickPos={x:e.clientX,y:e.clientY}),o.length||(o=r('<div id=\"dnd-char-detail-card-el\" class=\"dnd-char-detail-card\"></div>'),r(\"body\").append(o)),r(document).off(\"click.dndCharCard\");const i=this;if(setTimeout(()=>{r(document).on(\"click.dndCharCard\",n=>{const t=r(n.target);t.closest(\"#dnd-char-detail-card-el\").length||t.closest(\"#dnd-detail-popup-el\").length||t.closest(\".dnd-skill-trigger, .dnd-feat-trigger\").length||t.closest(\".dnd-mini-char-avatar, .dnd-mini-char, .party-list-avatar, .party-quick-avatar, .dnd-char-card, .party-bar-item, #dnd-logo-container\").length||o.hasClass(\"visible\")&&(i.hideCharacterCard(),i.hideDetailPopup(),r(document).off(\"click.dndCharCard\"))})},150),o.hasClass(\"visible\")&&o.data(\"charId\")===(t.PC_ID||t.CHAR_ID))return this.hideCharacterCard(),void this.hideDetailPopup();const d=t.PC_ID||t.CHAR_ID;o.data(\"charId\",d);const s=Rr.parseValue(t[\"å±æ€§å€¼\"],\"stats\")||{};let l=0,c=0,p=0;if(t.HP){const n=t.HP.split(\"/\");2===n.length&&(l=parseInt(n[0])||0,c=parseInt(n[1])||1,p=Math.min(100,Math.max(0,l/c*100)))}const g=d?Rr.getCharacterSkills(d):[],f=d?Rr.getCharacterFeats(d):[],b=Rr.getTable(\"PC_Resources\"),m=Rr.getTable(\"PARTY_Resources\");let u={};\"PC\"===t.type&&b?u=b[0]||{}:m&&(u=m.find(n=>n.CHAR_ID===d)||{});const h=this.renderAvatar(t[\"å§“å\"],d,48),x=Rr.getPartyData(),v=x&&x.some(n=>n.PC_ID==d||n.CHAR_ID==d||n[\"å§“å\"]==d||n[\"å§“å\"]==t[\"å§“å\"]);let y=`\\n            <div class=\"dnd-detail-header\">\\n                <div style=\"display:flex;align-items:center;gap:15px;flex:1;overflow:hidden;\">\\n                    <div style=\"position:relative;cursor:pointer;\" class=\"dnd-avatar-wrapper\" onclick=\"${v?`window.DND_Dashboard_UI.showAvatarUploadDialog('${d}', '${t[\"å§“å\"]}')`:\"\"}\" title=\"${v?\"ç‚¹å‡»ä¿®æ”¹å¤´åƒ\":\"\"}\">\\n                        ${h}\\n                        ${v?'<div style=\"position:absolute;bottom:-2px;right:-2px;background:#333;border:1px solid var(--dnd-border-gold);border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--dnd-text-highlight);\">ğŸ“·</div>':\"\"}\\n                    </div>\\n                    <div class=\"dnd-detail-info\">\\n                        <div class=\"dnd-detail-name\">${t[\"å§“å\"]}</div>\\n                        <div class=\"dnd-detail-sub\">${t[\"ç§æ—/æ€§åˆ«/å¹´é¾„\"]||\"æœªçŸ¥\"} | ${t[\"èŒä¸š\"]||\"æ— èŒä¸š\"}</div>\\n                    </div>\\n                </div>\\n                <div class=\"dnd-detail-close\" id=\"dnd-card-close\">âœ•</div>\\n            </div>\\n            \\n            <div class=\"dnd-detail-body\">\\n                <div style=\"margin-bottom:15px;\">\\n                    <div style=\"display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;color:#ccc;\">\\n                        <span>HP (ç”Ÿå‘½å€¼)</span>\\n                        <span style=\"color:${p<30?\"#e74c3c\":\"inherit\"}\">${l} / ${c}</span>\\n                    </div>\\n                    <div class=\"dnd-bar-container dnd-bar-hp\">\\n                        <div class=\"dnd-bar-fill\" style=\"width: ${p}%\"></div>\\n                    </div>\\n                </div>\\n                \\n                <div class=\"dnd-detail-stats-row\">\\n                    <div class=\"dnd-detail-stat-item\"><span style=\"color:#888\">AC</span> <strong style=\"color:var(--dnd-text-highlight);font-size:15px;\">${t.AC||\"-\"}</strong></div>\\n                    <div class=\"dnd-detail-stat-item\"><span style=\"color:#888\">å…ˆæ”»</span> <strong>${t[\"å…ˆæ”»åŠ å€¼\"]||\"+0\"}</strong></div>\\n                    <div class=\"dnd-detail-stat-item\"><span style=\"color:#888\">æ„ŸçŸ¥</span> <strong>${t[\"è¢«åŠ¨æ„ŸçŸ¥\"]||\"10\"}</strong></div>\\n                    <div class=\"dnd-detail-stat-item\"><span style=\"color:#888\">é€Ÿåº¦</span> <strong>${t[\"é€Ÿåº¦\"]||\"-\"}</strong></div>\\n                </div>\\n\\n                <div class=\"dnd-attr-grid\">\\n                    ${[\"STR\",\"DEX\",\"CON\",\"INT\",\"WIS\",\"CHA\"].map(n=>`\\n                        <div class=\"dnd-attr-box\">\\n                            <div class=\"dnd-attr-val\">${s[n]||10}</div>\\n                            <div class=\"dnd-attr-mod\">${(n=>{const t=Math.floor((n-10)/2);return t>=0?`+${t}`:t})(s[n]||10)}</div>\\n                            <div class=\"dnd-attr-lbl\">${n}</div>\\n                        </div>\\n                    `).join(\"\")}\\n                </div>\\n\\n                ${u[\"æ³•æœ¯ä½\"]||u[\"èŒä¸šèµ„æº\"]?`\\n                <div class=\"dnd-detail-section\">\\n                    <div class=\"dnd-detail-title\">èµ„æº</div>\\n                    <div style=\"font-size:12px;color:var(--dnd-text-main)\">\\n                        ${u[\"æ³•æœ¯ä½\"]?`<div style=\"margin-bottom:4px;\">${this.formatSpellSlots(u[\"æ³•æœ¯ä½\"])}</div>`:\"\"}\\n                        ${u[\"èŒä¸šèµ„æº\"]?`<div>${this.formatClassRes(u[\"èŒä¸šèµ„æº\"])}</div>`:\"\"}\\n                        <div style=\"margin-top:4px;color:#aaa\">\\n                            ${u[\"ç”Ÿå‘½éª°\"]?`HD: ${u[\"ç”Ÿå‘½éª°\"]} `:\"\"}\\n                            ${u[\"é‡‘å¸\"]?`GP: ${u[\"é‡‘å¸\"]}`:\"\"}\\n                        </div>\\n                    </div>\\n                </div>`:\"\"}\\n\\n                ${g.length>0?`\\n                <div class=\"dnd-detail-section\">\\n                    <div class=\"dnd-detail-title\">æŠ€èƒ½ & æ³•æœ¯ (${g.length})</div>\\n                    <div class=\"dnd-tag-list\">\\n                        ${g.map((n,t)=>`<div class=\"dnd-tag dnd-skill-trigger\" onclick=\"window.DND_Dashboard_UI.handleSkillClick(${t}, event)\">${n[\"æŠ€èƒ½åç§°\"]}</div>`).join(\"\")}\\n                    </div>\\n                </div>`:\"\"}\\n\\n                ${f.length>0?`\\n                <div class=\"dnd-detail-section\">\\n                    <div class=\"dnd-detail-title\">ä¸“é•¿ (${f.length})</div>\\n                    <div class=\"dnd-tag-list\">\\n                        ${f.map((n,t)=>`<div class=\"dnd-tag dnd-feat-trigger\" onclick=\"window.DND_Dashboard_UI.handleFeatClick(${t}, event)\">${n[\"ä¸“é•¿åç§°\"]}</div>`).join(\"\")}\\n                    </div>\\n                </div>`:\"\"}\\n\\n                <div class=\"dnd-detail-section\">\\n                    <div class=\"dnd-detail-title\" id=\"dnd-bio-toggle\">èƒŒæ™¯æ•…äº‹ <span style=\"float:right\">â–¼</span></div>\\n                    <div id=\"dnd-bio-content\" style=\"display:none;font-size:12px;color:#ccc;line-height:1.5;margin-top:5px;\">\\n                        ${t[\"èƒŒæ™¯æ•…äº‹\"]||\"æš‚æ— èƒŒæ™¯æ•…äº‹\"}\\n                    </div>\\n                </div>\\n            </div>\\n        `;o.html(y),o.find(\"#dnd-card-close\").on(\"click\",()=>{this.hideCharacterCard(),this.hideDetailPopup()}),o.find(\"#dnd-bio-toggle\").on(\"click\",function(){const n=r(\"#dnd-bio-content\");n.is(\":visible\")?(n.hide(),r(this).find(\"span\").text(\"â–¼\")):(n.show(),r(this).find(\"span\").text(\"â–²\"))});const{window:w}=a(),k=r(w),S=k.width(),C=k.height();S<768?o.css({top:\"10px\",left:\"50%\",right:\"auto\",bottom:\"auto\"}).addClass(\"visible\"):(o.removeClass(\"visible\").css({display:\"flex\",visibility:\"hidden\",top:\"-9999px\",left:\"-9999px\"}),requestAnimationFrame(()=>{const n=o.outerWidth()||380,t=o.outerHeight()||500,e=15,a=this._lastClickPos.x||S/2,r=this._lastClickPos.y||100;let i,d;i=a+n+e<S?a+e:a-n-e>0?a-n-e:Math.max(e,(S-n)/2),d=r-50,d<e&&(d=e),d+t>C-e&&(d=Math.max(e,C-t-e)),i=Math.max(e,Math.min(i,S-n-e)),d=Math.max(e,Math.min(d,C-t-e)),o.css({top:d+\"px\",left:i+\"px\",right:\"auto\",bottom:\"auto\",display:\"\",visibility:\"\"}).addClass(\"visible\")}))},hideCharacterCard(){$(\"#dnd-char-detail-card-el\").removeClass(\"visible\")},handleSkillClick(n,t){console.log(\"[DND Dashboard] handleSkillClick\",n),t&&(t.stopPropagation(),t.preventDefault());const{$:e}=a(),r=e(\"#dnd-char-detail-card-el\").data(\"charId\");if(!r)return void console.error(\"No charId found\");const o=Rr.getCharacterSkills(r)[n];if(!o)return void console.error(\"Skill not found\",n);const i=(o[\"æŠ€èƒ½åç§°\"]||\"\").replace(/'/g,\"\\\\'\"),d=(o[\"å°„ç¨‹\"]||\"æ¥è§¦\").replace(/'/g,\"\\\\'\"),s=`\\n            <div style=\"color:var(--dnd-text-highlight);font-weight:bold;border-bottom:1px solid #444;margin-bottom:5px;padding-bottom:3px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span>${o[\"æŠ€èƒ½åç§°\"]} <span style=\"font-size:10px;color:#888;font-weight:normal\">(${o[\"ç¯é˜¶\"]||\"-\"} Â· ${o[\"å­¦æ´¾\"]||\"-\"})</span></span>\\n                <button class=\"dnd-clickable\" style=\"background:var(--dnd-accent-green);border:none;color:#fff;padding:2px 8px;border-radius:3px;font-size:11px;cursor:pointer;\"\\n                    onclick=\"window.DND_Dashboard_UI.handleCastClick('${i}', '${d}', '${o[\"ç¯é˜¶\"]||\"\"}', 'skill')\">\\n                    âœ¨ æ–½æ”¾\\n                </button>\\n            </div>\\n            <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:5px;font-size:11px;color:#aaa;margin-bottom:8px;\">\\n                <div>æ—¶é—´: ${o[\"æ–½æ³•æ—¶é—´\"]||\"-\"}</div>\\n                <div>å°„ç¨‹: ${o[\"å°„ç¨‹\"]||\"-\"}</div>\\n                <div>æˆåˆ†: ${o[\"æˆåˆ†\"]||\"-\"}</div>\\n                <div>æŒç»­: ${o[\"æŒç»­æ—¶é—´\"]||\"-\"}</div>\\n            </div>\\n            <div style=\"line-height:1.4;color:#ccc;\">${o[\"æ•ˆæœæè¿°\"]||\"æ— æè¿°\"}</div>\\n        `;this.showItemDetailPopup(s,t.clientX,t.clientY)},handleFeatClick(n,t){console.log(\"[DND Dashboard] handleFeatClick\",n),t&&(t.stopPropagation(),t.preventDefault());const{$:e}=a(),r=e(\"#dnd-char-detail-card-el\").data(\"charId\");if(!r)return void console.error(\"No charId found\");const o=Rr.getCharacterFeats(r)[n];if(!o)return void console.error(\"Feat not found\",n);const i=`\\n            <div style=\"color:var(--dnd-text-highlight);font-weight:bold;border-bottom:1px solid #444;margin-bottom:5px;padding-bottom:3px;\">\\n                ${o[\"ä¸“é•¿åç§°\"]} <span style=\"font-size:10px;color:#888;font-weight:normal\">(${o[\"ç±»åˆ«\"]||\"-\"})</span>\\n            </div>\\n            <div style=\"font-size:11px;color:#aaa;margin-bottom:5px;\">å‰ç½®: ${o[\"å‰ç½®æ¡ä»¶\"]||\"æ— \"}</div>\\n            <div style=\"line-height:1.4;color:#ccc;\">${o[\"æ•ˆæœæè¿°\"]||\"æ— æè¿°\"}</div>\\n        `;this.showItemDetailPopup(i,t.clientX,t.clientY)},_charCreatorState:null,_charCreatorLoading:!1,async startLevelUp(n){const{$:t}=a(),e=Rr.getPartyData().find(t=>t.PC_ID===n||t.CHAR_ID===n||t.å§“å===n);if(!e)return void jr.error(\"æœªæ‰¾åˆ°è§’è‰²æ•°æ®\");const r=Rr.getCharacterSkills(n),o=Rr.getCharacterFeats(n),i=Rr.parseValue(e[\"å±æ€§å€¼\"],\"stats\")||{},d={name:e[\"å§“å\"],race_gender_age:e[\"ç§æ—/æ€§åˆ«/å¹´é¾„\"],class:e[\"èŒä¸š\"],level:parseInt(e[\"ç­‰çº§\"])||1,stats:i,hp:e.HP,xp:e[\"ç»éªŒå€¼\"],spells:r.filter(n=>\"æ³•æœ¯\"===n[\"æŠ€èƒ½ç±»å‹\"]).map(n=>({name:n[\"æŠ€èƒ½åç§°\"],level:n[\"ç¯é˜¶\"]||0,desc:n[\"æ•ˆæœæè¿°\"]})),features:o.map(n=>({name:n[\"ä¸“é•¿åç§°\"],desc:n[\"æ•ˆæœæè¿°\"]})),background:e[\"èƒŒæ™¯æ•…äº‹\"]},s=await no.getEnabledWorldInfo();this._charCreatorState={mode:\"levelup\",targetCharId:n,apiConfig:await to(),modelList:[],conversationHistory:[],characterData:d,isGenerating:!1,currentStep:\"chatting\",characterType:\"pc\",worldInfo:s,useWorldInfo:!0};const l=\"function\"==typeof this.renderPanel?this:window.DND_Dashboard_UI;if(l){const{$:n}=a();n(\".dnd-nav-item\").removeClass(\"active\"),n('.dnd-nav-item[data-target=\"create\"]').addClass(\"active\"),\"function\"==typeof l.setState&&l.setState(\"full\"),\"function\"==typeof l.renderPanel&&l.renderPanel(\"create\")}this.sendCreatorMessage(null,!0)},saveCreatorState(){this._charCreatorState&&r(\"dnd_creator_state\",JSON.stringify(this._charCreatorState))},formatChatMessage(n){if(!n)return\"\";let t=n.replace(/```CHARACTER_OPTIONS\\s*[\\s\\S]*?```/g,\"\").replace(/```CHARACTER_DATA\\s*[\\s\\S]*?```/g,\"\").trim();return t=t.replace(/&/g,\"&\").replace(/</g,\"<\").replace(/>/g,\">\"),t=t.replace(/```([\\s\\S]*?)```/g,'<pre class=\"dnd-md-pre\"><code>$1</code></pre>'),t=t.replace(/`([^`]+)`/g,'<code class=\"dnd-md-code\">$1</code>'),t=t.replace(/^### (.*$)/gm,'<h3 class=\"dnd-md-h3\">$1</h3>'),t=t.replace(/^## (.*$)/gm,'<h2 class=\"dnd-md-h2\">$1</h2>'),t=t.replace(/^# (.*$)/gm,'<h1 class=\"dnd-md-h1\">$1</h1>'),t=t.replace(/\\*\\*(.*?)\\*\\*/g,\"<strong>$1</strong>\"),t=t.replace(/\\*(.*?)\\*/g,\"<em>$1</em>\"),t=t.replace(/^\\s*-\\s+(.*$)/gm,'<li class=\"dnd-md-li\">$1</li>'),t},renderCharacterCreationPanel(n){const{$:e}=a();no.getPresets();if(!this._charCreatorState)return this._charCreatorLoading?void n.html('<div style=\"padding:50px;text-align:center;color:#888;\">â³ æ­£åœ¨æ¢å¤ä¼šè¯...</div>'):(this._charCreatorLoading=!0,n.html('<div style=\"padding:50px;text-align:center;color:#888;\">â³ æ­£åœ¨åˆå§‹åŒ–...</div>'),void t.getSetting(\"dnd_creator_state\").then(async t=>{if(this._charCreatorLoading=!1,t)try{this._charCreatorState=\"string\"==typeof t?JSON.parse(t):t,console.log(\"[DND Creator] å·²æ¢å¤ä¸Šæ¬¡æœªå®Œæˆçš„åˆ›å»ºä¼šè¯\")}catch(n){console.error(\"[DND Creator] çŠ¶æ€è§£æå¤±è´¥\",n)}if(!this._charCreatorState){let t={url:\"\",key:\"\",model:\"\"};const e=await no.getEnabledWorldInfo();return this._charCreatorState={selectedPresetId:null,apiConfig:t,modelList:[],conversationHistory:[],characterData:{},isGenerating:!1,currentStep:\"init\",characterType:\"pc\",worldInfo:e,useWorldInfo:!0},void to().then(t=>{t&&t.url&&this._charCreatorState&&(this._charCreatorState.apiConfig=t),this.renderCharacterCreationPanel(n)})}this.renderCharacterCreationPanel(n)}));const r=this._charCreatorState;let o='<option value=\"\">-- è¯·å…ˆè·å–æ¨¡å‹ --</option>';r.modelList&&r.modelList.length>0?(o='<option value=\"\">-- é€‰æ‹©æ¨¡å‹ --</option>',r.modelList.forEach(n=>{const t=r.apiConfig.model===n?\"selected\":\"\";o+=`<option value=\"${n}\" ${t}>${n}</option>`})):r.apiConfig.model&&(o=`<option value=\"${r.apiConfig.model}\" selected>${r.apiConfig.model}</option>`);let i=\"\";r.conversationHistory.length>0&&r.conversationHistory.forEach((n,t)=>{const e=\"user\"===n.role;i+=`\\n                    <div class=\"dnd-chat-msg dnd-anim-entry\" style=\"animation-delay:${.05*t}s; background:${e?\"rgba(52, 152, 219, 0.1)\":\"rgba(155, 89, 182, 0.1)\"}; border-left:3px solid ${e?\"#3498db\":\"#9b59b6\"}; padding:10px 12px; margin-bottom:8px; border-radius:4px;\">\\n                        <div style=\"font-size:11px;color:#888;margin-bottom:4px;\">${e?'<i class=\"fa-solid fa-user\"></i>':'<i class=\"fa-solid fa-robot\"></i>'} ${e?\"ä½ \":\"AI å‘å¯¼\"}</div>\\n                        <div style=\"color:var(--dnd-text-main);line-height:1.5;white-space:pre-wrap;\">${this.formatChatMessage(n.content)}</div>\\n                    </div>\\n                `});let d=\"\";switch(r.currentStep){case\"init\":d='é€‰æ‹© API é¢„è®¾åï¼Œç‚¹å‡»\"å¼€å§‹åˆ›å»º\"ä¸ AI å‘å¯¼å¯¹è¯ï¼Œé€æ­¥æ„å»ºä½ çš„è§’è‰²ã€‚';break;case\"chatting\":d=\"ä¸ AI å‘å¯¼å¯¹è¯ä¸­...å›ç­”é—®é¢˜æˆ–æå‡ºä½ çš„æƒ³æ³•ï¼ŒAI ä¼šå¸®åŠ©ä½ å®Œå–„è§’è‰²è®¾å®šã€‚\";break;case\"reviewing\":d='è§’è‰²ä¿¡æ¯å·²ç”Ÿæˆï¼è¯·æ£€æŸ¥ä¸‹æ–¹é¢„è§ˆï¼Œç¡®è®¤æ— è¯¯åç‚¹å‡»\"ç¡®è®¤åˆ›å»º\"ã€‚';break;case\"complete\":d=\"ğŸ‰ è§’è‰²åˆ›å»ºå®Œæˆï¼æ•°æ®å·²ä¿å­˜åˆ°è§’è‰²å¡ã€‚\"}const s=\"levelup\"===r.mode,l=`\\n            <div class=\"dnd-char-creator-panel\" style=\"max-width:800px;margin:0 auto;\">\\n                \\x3c!-- æ ‡é¢˜åŒº --\\x3e\\n                <div style=\"text-align:center;margin-bottom:20px;\">\\n                    <h2 style=\"color:var(--dnd-text-highlight);font-family:var(--dnd-font-serif);margin:0 0 10px 0;\">\\n                        ${s?\"ğŸ†™ è§’è‰²å‡çº§å‘å¯¼\":\"âš”ï¸ AI è§’è‰²åˆ›å»ºå‘å¯¼\"}\\n                    </h2>\\n                    <p style=\"color:#888;font-size:13px;margin:0;\">${d}</p>\\n                </div>\\n                \\n                \\x3c!-- è®¾ç½®åŒºåŸŸ --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:15px;border-radius:6px;margin-bottom:15px;border:1px solid var(--dnd-border-inner);\">\\n                    <div style=\"display:flex;align-items:center;gap:15px;flex-wrap:wrap;\">\\n                        \\x3c!-- è§’è‰²ç±»å‹é€‰æ‹© (å‡çº§æ¨¡å¼ä¸‹éšè—) --\\x3e\\n                        <div style=\"min-width:150px; ${s?\"display:none;\":\"\"}\">\\n                            <label style=\"font-size:12px;color:#888;display:block;margin-bottom:5px;\">è§’è‰²ç±»å‹</label>\\n                            <div style=\"display:flex;gap:5px;\">\\n                                <button id=\"dnd-creator-type-pc\" class=\"dnd-clickable\" style=\"\\n                                    flex:1;\\n                                    padding:8px 12px;\\n                                    background:${\"pc\"===r.characterType?\"var(--dnd-border-gold)\":\"#1a1a1c\"};\\n                                    border:1px solid ${\"pc\"===r.characterType?\"var(--dnd-border-gold)\":\"var(--dnd-border-inner)\"};\\n                                    color:${\"pc\"===r.characterType?\"#000\":\"var(--dnd-text-main)\"};\\n                                    border-radius:4px;\\n                                    font-size:12px;\\n                                    cursor:pointer;\\n                                \" ${\"init\"!==r.currentStep?\"disabled\":\"\"}><i class=\"fa-solid fa-user\"></i> ä¸»è§’</button>\\n                                <button id=\"dnd-creator-type-party\" class=\"dnd-clickable\" style=\"\\n                                    flex:1;\\n                                    padding:8px 12px;\\n                                    background:${\"party\"===r.characterType?\"var(--dnd-border-gold)\":\"#1a1a1c\"};\\n                                    border:1px solid ${\"party\"===r.characterType?\"var(--dnd-border-gold)\":\"var(--dnd-border-inner)\"};\\n                                    color:${\"party\"===r.characterType?\"#000\":\"var(--dnd-text-main)\"};\\n                                    border-radius:4px;\\n                                    font-size:12px;\\n                                    cursor:pointer;\\n                                \" ${\"init\"!==r.currentStep?\"disabled\":\"\"}><i class=\"fa-solid fa-users\"></i> é˜Ÿå‹</button>\\n                            </div>\\n                        </div>\\n                        \\n                        \\x3c!-- API çŠ¶æ€æ˜¾ç¤º --\\x3e\\n                        <div style=\"flex:1;min-width:300px;background:rgba(0,0,0,0.2);padding:10px;border-radius:4px;border:1px solid var(--dnd-border-inner);\">\\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\">\\n                                <label style=\"font-size:12px;color:#888;\">API çŠ¶æ€</label>\\n                                <div style=\"font-size:11px;color:${r.apiConfig.key?\"#2ecc71\":\"#e74c3c\"}\">\\n                                    ${r.apiConfig.key?'<i class=\"fa-solid fa-check-circle\"></i> å·²é…ç½®':'<i class=\"fa-solid fa-times-circle\"></i> æœªé…ç½®'}\\n                                </div>\\n                            </div>\\n                            <div style=\"font-size:11px;color:#aaa;margin-bottom:8px;\">\\n                                URL: ${r.apiConfig.url||\"æœªè®¾ç½®\"}<br>\\n                                Model: ${r.apiConfig.model||\"æœªè®¾ç½®\"}\\n                            </div>\\n                            \\n                            \\x3c!-- ä¸–ç•Œä¹¦å¼€å…³ --\\x3e\\n                            <div style=\"margin-bottom:8px; display:flex; align-items:center; gap:5px;\">\\n                                <input type=\"checkbox\" id=\"dnd-creator-use-worldinfo\" ${!1!==r.useWorldInfo?\"checked\":\"\"} style=\"cursor:pointer;\">\\n                                <label for=\"dnd-creator-use-worldinfo\" style=\"font-size:12px; color:#ccc; cursor:pointer;\" title=\"å¼€å¯åï¼Œå‡çº§/åˆ›å»ºæ—¶å°†å‚è€ƒå½“å‰å¯ç”¨çš„ä¸–ç•Œä¹¦å†…å®¹\">ğŸ“š å‚è€ƒå¯ç”¨ä¸–ç•Œä¹¦</label>\\n                            </div>\\n\\n                            <button type=\"button\" onclick=\"window.DND_Dashboard_UI.renderPanel('settings')\" class=\"dnd-clickable\" style=\"width:100%;padding:6px;background:#2a2a2c;border:1px solid #555;color:#ccc;border-radius:4px;cursor:pointer;font-size:12px;\">\\n                                <i class=\"fa-solid fa-cog\"></i> å‰å¾€è®¾ç½®é…ç½® API\\n                            </button>\\n                        </div>\\n                        <div style=\"display:flex;gap:10px;\">\\n                            ${\"init\"===r.currentStep?'\\n                                <button id=\"dnd-creator-start-btn\" class=\"dnd-clickable\" style=\"\\n                                    background:linear-gradient(135deg, var(--dnd-accent-green), #27ae60);\\n                                    border:none;\\n                                    color:#fff;\\n                                    padding:10px 20px;\\n                                    border-radius:4px;\\n                                    cursor:pointer;\\n                                    font-weight:bold;\\n                                    font-size:13px;\\n                                \"><i class=\"fa-solid fa-bolt\"></i> å¼€å§‹åˆ›å»º</button>\\n                            ':\"\"}\\n                            ${\"init\"!==r.currentStep?'\\n                                <button id=\"dnd-creator-reset-btn\" class=\"dnd-clickable\" style=\"\\n                                    background:rgba(192, 57, 43, 0.2);\\n                                    border:1px solid #c0392b;\\n                                    color:#e74c3c;\\n                                    padding:8px 15px;\\n                                    border-radius:4px;\\n                                    cursor:pointer;\\n                                    font-size:12px;\\n                                \"><i class=\"fa-solid fa-sync\"></i> é‡æ–°å¼€å§‹</button>\\n                            ':\"\"}\\n                        </div>\\n                    </div>\\n                </div>\\n                \\n                \\x3c!-- å¯¹è¯åŒºåŸŸ --\\x3e\\n                <div style=\"display:flex;gap:15px;flex-wrap:wrap;\">\\n                    \\x3c!-- å·¦ä¾§ï¼šå¯¹è¯å†å² --\\x3e\\n                    <div style=\"flex:2;min-width:300px;\">\\n                        <div style=\"background:rgba(0,0,0,0.2);border:1px solid var(--dnd-border-inner);border-radius:6px;overflow:hidden;\">\\n                            <div style=\"background:rgba(255,255,255,0.05);padding:10px 15px;border-bottom:1px solid var(--dnd-border-inner);\">\\n                                <span style=\"color:var(--dnd-text-header);font-weight:bold;\"><i class=\"fa-solid fa-comments\"></i> å¯¹è¯è®°å½•</span>\\n                                <span style=\"float:right;font-size:11px;color:#666;\">${r.conversationHistory.length} æ¡æ¶ˆæ¯</span>\\n                            </div>\\n                            <div id=\"dnd-creator-chat-history\" style=\"height:350px;overflow-y:auto;padding:15px;\">\\n                                ${i||'<div style=\"color:#666;text-align:center;padding:50px 20px;\">å¯¹è¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...<br><br>ç‚¹å‡»\"å¼€å§‹åˆ›å»º\"ä¸ AI å‘å¯¼å¯¹è¯</div>'}\\n                            </div>\\n                        </div>\\n                        \\n                        \\x3c!-- è¾“å…¥åŒº --\\x3e\\n                        <div style=\"margin-top:10px;display:flex;gap:10px;\">\\n                            <button id=\"dnd-creator-stats-btn\" class=\"dnd-clickable\" style=\"\\n                                background:rgba(255,255,255,0.1);\\n                                border:1px solid #555;\\n                                color:#ccc;\\n                                padding:0 12px;\\n                                border-radius:4px;\\n                                cursor:pointer;\\n                                font-size:16px;\\n                            \" title=\"å±æ€§ç”Ÿæˆå™¨\"><i class=\"fa-solid fa-sort-numeric-down\"></i></button>\\n                            <input type=\"text\" id=\"dnd-creator-user-input\" placeholder=\"è¾“å…¥ä½ çš„å›ç­”æˆ–æƒ³æ³•...\" style=\"\\n                                flex:1;\\n                                padding:10px 15px;\\n                                background:#1a1a1c;\\n                                border:1px solid var(--dnd-border-inner);\\n                                color:var(--dnd-text-main);\\n                                border-radius:4px;\\n                                font-size:13px;\\n                            \" ${\"init\"===r.currentStep||r.isGenerating?\"disabled\":\"\"}>\\n                            <button id=\"dnd-creator-send-btn\" class=\"dnd-clickable\" style=\"\\n                                background:var(--dnd-border-gold);\\n                                border:none;\\n                                color:#000;\\n                                padding:10px 20px;\\n                                border-radius:4px;\\n                                cursor:pointer;\\n                                font-weight:bold;\\n                            \" ${\"init\"===r.currentStep||r.isGenerating?\"disabled\":\"\"}>\\n                                ${r.isGenerating?'<i class=\"fa-solid fa-hourglass-half\"></i> ç”Ÿæˆä¸­...':'<i class=\"fa-solid fa-paper-plane\"></i> å‘é€'}\\n                            </button>\\n                        </div>\\n                        \\n                        \\x3c!-- å¿«æ·å›å¤æŒ‰é’® --\\x3e\\n                        <div id=\"dnd-creator-quick-replies\" style=\"margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;\">\\n                            \\x3c!-- åŠ¨æ€ç”Ÿæˆ --\\x3e\\n                        </div>\\n                    </div>\\n                    \\n                    \\x3c!-- å³ä¾§ï¼šè§’è‰²é¢„è§ˆ --\\x3e\\n                    <div style=\"flex:1;min-width:250px;\">\\n                        <div style=\"background:rgba(0,0,0,0.2);border:1px solid var(--dnd-border-gold);border-radius:6px;overflow:hidden;\">\\n                            <div style=\"background:linear-gradient(135deg, rgba(157, 139, 108, 0.2), rgba(157, 139, 108, 0.1));padding:10px 15px;border-bottom:1px solid var(--dnd-border-gold);\">\\n                                <span style=\"color:var(--dnd-text-highlight);font-weight:bold;\"><i class=\"fa-solid fa-clipboard-list\"></i> è§’è‰²é¢„è§ˆ</span>\\n                            </div>\\n                            <div id=\"dnd-creator-preview\" style=\"padding:15px;min-height:300px;\">\\n                                ${this.renderCharacterPreview(r.characterData)}\\n                            </div>\\n                        </div>\\n                        \\n                        ${\"reviewing\"===r.currentStep?'\\n                            <div style=\"margin-top:15px;display:flex;gap:10px;\">\\n                                <button id=\"dnd-creator-confirm-btn\" class=\"dnd-clickable\" style=\"\\n                                    flex:1;\\n                                    background:linear-gradient(135deg, var(--dnd-accent-green), #27ae60);\\n                                    border:none;\\n                                    color:#fff;\\n                                    padding:12px;\\n                                    border-radius:4px;\\n                                    cursor:pointer;\\n                                    font-weight:bold;\\n                                \"><i class=\"fa-solid fa-check-circle\"></i> ç¡®è®¤åˆ›å»º</button>\\n                                <button id=\"dnd-creator-modify-btn\" class=\"dnd-clickable\" style=\"\\n                                    background:rgba(241, 196, 15, 0.2);\\n                                    border:1px solid #f1c40f;\\n                                    color:#f1c40f;\\n                                    padding:12px 20px;\\n                                    border-radius:4px;\\n                                    cursor:pointer;\\n                                \"><i class=\"fa-solid fa-pen\"></i> ç»§ç»­ä¿®æ”¹</button>\\n                            </div>\\n                        ':\"\"}\\n                    </div>\\n                </div>\\n            </div>\\n        `;n.html(l),this.bindCharacterCreatorEvents(n)},showStatsGenerator(n){this.showItemDetailPopup('\\n            <div style=\"padding-bottom:10px; border-bottom:1px solid #444; margin-bottom:10px; font-weight:bold; color:var(--dnd-text-highlight);\">\\n                ğŸ² å±æ€§åˆ†é…ç”Ÿæˆå™¨\\n            </div>\\n            <div style=\"display:flex; flex-direction:column; gap:10px;\">\\n                \\x3c!-- æ ‡å‡†æ•°åˆ— --\\x3e\\n                <div style=\"background:rgba(255,255,255,0.05); padding:8px; border-radius:4px;\">\\n                    <div style=\"font-size:13px; font-weight:bold; margin-bottom:5px;\">1. æ ‡å‡†æ•°åˆ— (Standard Array)</div>\\n                    <div style=\"font-family:monospace; color:#ccc; margin-bottom:5px;\">[15, 14, 13, 12, 10, 8]</div>\\n                    <button onclick=\"window.DND_Dashboard_UI.applyStatsOption(\\'standard\\')\" style=\"width:100%; padding:5px; background:#333; border:1px solid #555; color:#fff; border-radius:3px; cursor:pointer;\">ä½¿ç”¨æ­¤æ•°åˆ—</button>\\n                </div>\\n\\n                \\x3c!-- è´­ç‚¹æ³• --\\x3e\\n                <div style=\"background:rgba(255,255,255,0.05); padding:8px; border-radius:4px;\">\\n                    <div style=\"font-size:13px; font-weight:bold; margin-bottom:5px;\">2. è´­ç‚¹æ³• (Point Buy)</div>\\n                    <div style=\"display:flex; gap:5px;\">\\n                        <button onclick=\"window.DND_Dashboard_UI.applyStatsOption(\\'pointbuy_27\\')\" style=\"flex:1; padding:5px; background:#333; border:1px solid #555; color:#fff; border-radius:3px; cursor:pointer;\">æ ‡å‡† (27ç‚¹)</button>\\n                        <button onclick=\"window.DND_Dashboard_UI.applyStatsOption(\\'pointbuy_32\\')\" style=\"flex:1; padding:5px; background:#333; border:1px solid #555; color:#fff; border-radius:3px; cursor:pointer;\">å®½è£• (32ç‚¹)</button>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- éª°å­å†³å®š --\\x3e\\n                <div style=\"background:rgba(255,255,255,0.05); padding:8px; border-radius:4px;\">\\n                    <div style=\"font-size:13px; font-weight:bold; margin-bottom:5px;\">3. éª°å­å†³å®š (4d6 drop lowest)</div>\\n                    <div id=\"dnd-stats-roll-result\" style=\"font-family:monospace; color:var(--dnd-text-highlight); margin-bottom:5px; min-height:20px; font-size:14px; text-align:center;\">???</div>\\n                    <div style=\"display:flex; gap:5px;\">\\n                        <button onclick=\"window.DND_Dashboard_UI.performStatsRoll()\" style=\"flex:1; padding:5px; background:var(--dnd-border-gold); color:#000; border:none; border-radius:3px; cursor:pointer; font-weight:bold;\">ğŸ² æŠ•æ· (x6)</button>\\n                        <button id=\"dnd-btn-use-roll\" onclick=\"window.DND_Dashboard_UI.confirmStatsRoll()\" style=\"flex:1; padding:5px; background:#333; border:1px solid #555; color:#fff; border-radius:3px; cursor:pointer;\" disabled>ä½¿ç”¨ç»“æœ</button>\\n                    </div>\\n                </div>\\n            </div>\\n        ',n.clientX,n.clientY)},applyStatsOption(n){let t=\"\";\"standard\"===n&&(t=\"æˆ‘é€‰æ‹©ä½¿ç”¨ã€æ ‡å‡†æ•°åˆ—ã€‘è¿›è¡Œå±æ€§åˆ†é…ï¼š15, 14, 13, 12, 10, 8ã€‚è¯·å¸®æˆ‘åˆ†é…åˆ°åˆé€‚çš„å±æ€§ä¸Šã€‚\"),\"pointbuy_27\"===n&&(t=\"æˆ‘é€‰æ‹©ä½¿ç”¨ã€æ ‡å‡†è´­ç‚¹æ³• (27ç‚¹)ã€‘ã€‚è¯·å¸®æˆ‘è§„åˆ’å±æ€§åˆ†é…ã€‚\"),\"pointbuy_32\"===n&&(t=\"æˆ‘é€‰æ‹©ä½¿ç”¨ã€å®½è£•è´­ç‚¹æ³• (32ç‚¹)ã€‘ã€‚è¯·å¸®æˆ‘è§„åˆ’å±æ€§åˆ†é…ã€‚\"),t&&(this.fillCreatorInput(t),this.hideDetailPopup())},performStatsRoll(){const n=()=>{const n=[Math.floor(6*Math.random())+1,Math.floor(6*Math.random())+1,Math.floor(6*Math.random())+1,Math.floor(6*Math.random())+1];return n.sort((n,t)=>t-n),n[0]+n[1]+n[2]},t=[];for(let e=0;e<6;e++)t.push(n());const e=t.join(\", \"),{$:r}=a();r(\"#dnd-stats-roll-result\").text(`[${e}]`),r(\"#dnd-btn-use-roll\").prop(\"disabled\",!1).attr(\"data-results\",e)},confirmStatsRoll(){const{$:n}=a(),t=n(\"#dnd-btn-use-roll\").attr(\"data-results\");t&&(this.fillCreatorInput(`æˆ‘é€‰æ‹©ä½¿ç”¨ã€éª°å­æŠ•æ·ç»“æœã€‘ï¼š[${t}]ã€‚è¯·å¸®æˆ‘åˆ†é…åˆ°åˆé€‚çš„å±æ€§ä¸Šã€‚`),this.hideDetailPopup())},fillCreatorInput(n){const{$:t}=a(),e=t(\"#dnd-creator-user-input\"),r=e.val();e.val(r?r+\" \"+n:n).focus()},renderCharacterPreview(n){if(!n||0===Object.keys(n).length)return'\\n                <div style=\"color:#666;text-align:center;padding:30px 15px;\">\\n                    <div style=\"font-size:48px;margin-bottom:15px;opacity:0.3;\"><i class=\"fa-solid fa-hat-wizard\"></i></div>\\n                    <div>è§’è‰²ä¿¡æ¯å°†éšå¯¹è¯é€æ­¥ç”Ÿæˆ...</div>\\n                </div>\\n            ';const t=n.stats||{},e=(n,t,e)=>t&&0!==t.length?`\\n                <div style=\"margin-top:10px;\">\\n                    <div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid rgba(255,255,255,0.1);margin-bottom:5px;font-size:12px;\">${n}</div>\\n                    <div>${t.map(e).join(\"\")}</div>\\n                </div>\\n            `:\"\";let a=\"\";if(n.resources){const t=n.resources;let e=[];t.spell_slots&&Object.keys(t.spell_slots).forEach(n=>e.push(`${n}: ${t.spell_slots[n]}`)),t.class_resources&&Object.keys(t.class_resources).forEach(n=>e.push(`${n}: ${t.class_resources[n]}`)),t.hit_dice&&e.push(`ç”Ÿå‘½éª°: ${t.hit_dice}`),e.length>0&&(a=`\\n                    <div style=\"margin-bottom:10px;font-size:11px;background:rgba(255,255,255,0.05);padding:6px;border-radius:4px;\">\\n                        <div style=\"color:#888;margin-bottom:2px;\">èµ„æº</div>\\n                        <div style=\"display:flex;flex-wrap:wrap;gap:8px;color:#ccc;\">\\n                            ${e.map(n=>`<span>${n}</span>`).join('<span style=\"color:#444\">|</span>')}\\n                        </div>\\n                    </div>\\n                `)}let r=\"\";const o=n.skill_proficiencies||[],i=n.saving_throws||[];return(o.length>0||i.length>0)&&(r=`\\n                <div style=\"font-size:11px;margin-bottom:10px;color:#aaa;\">\\n                    ${i.length?`<div><span style=\"color:#888\">è±å…:</span> ${i.join(\", \")}</div>`:\"\"}\\n                    ${o.length?`<div><span style=\"color:#888\">æŠ€èƒ½:</span> ${o.join(\", \")}</div>`:\"\"}\\n                </div>\\n            `),`\\n            <div class=\"dnd-preview-content\">\\n                \\x3c!-- åŸºæœ¬ä¿¡æ¯ --\\x3e\\n                <div style=\"text-align:center;margin-bottom:15px;\">\\n                    <div style=\"font-size:20px;font-weight:bold;color:var(--dnd-text-highlight);\">${n.name||\"æœªå‘½å\"}</div>\\n                    <div style=\"font-size:12px;color:#888;margin-top:3px;\">${n.race_gender_age||n.race||\"?\"} Â· ${n.class||\"?\"} Â· Lv.${n.level||1}</div>\\n                </div>\\n                \\n                \\x3c!-- å±æ€§å€¼ --\\x3e\\n                ${Object.keys(t).length>0?`\\n                <div style=\"display:grid;grid-template-columns:repeat(3, 1fr);gap:5px;margin-bottom:15px;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;\">\\n                    ${[\"STR\",\"DEX\",\"CON\",\"INT\",\"WIS\",\"CHA\"].map(n=>`\\n                        <div style=\"text-align:center;\">\\n                            <div style=\"font-size:12px;font-weight:bold;color:var(--dnd-text-header);\">${t[n]||10}</div>\\n                            <div style=\"font-size:9px;color:#666;\">${(n=>{const t=parseInt(n)||10,e=Math.floor((t-10)/2);return e>=0?`+${e}`:e})(t[n])} ${n}</div>\\n                        </div>\\n                    `).join(\"\")}\\n                </div>\\n                `:\"\"}\\n                \\n                ${a}\\n                ${r}\\n\\n                \\x3c!-- ç‰¹æ€§ & ä¸“é•¿ --\\x3e\\n                ${e('<i class=\"fa-solid fa-bolt\"></i> ç‰¹æ€§ & ä¸“é•¿',n.features,n=>`\\n                    <div style=\"margin-bottom:4px;font-size:12px;\">\\n                        <span style=\"color:#ccc;font-weight:bold;\">${n.name}</span>\\n                        <div style=\"color:#888;font-size:10px;line-height:1.3;\">${n.desc||\"\"}</div>\\n                    </div>\\n                `)}\\n\\n                \\x3c!-- æ³•æœ¯ --\\x3e\\n                ${e('<i class=\"fa-solid fa-bolt\"></i> æ³•æœ¯',n.spells,n=>`\\n                    <div style=\"margin-bottom:4px;font-size:12px;\">\\n                        <span style=\"color:#b585ff;font-weight:bold;\">${n.name}</span>\\n                        <span style=\"color:#666;font-size:10px;\">(${0===n.level?\"æˆæ³•\":n.level+\"ç¯\"})</span>\\n                        <div style=\"color:#888;font-size:10px;line-height:1.3;\">${n.desc||\"\"}</div>\\n                    </div>\\n                `)}\\n                \\n                \\x3c!-- å…¶ä»–ä¿¡æ¯ --\\x3e\\n                ${n.background?`<div style=\"font-size:12px;margin-top:10px;\"><span style=\"color:#888;\">èƒŒæ™¯:</span> ${n.background}</div>`:\"\"}\\n                ${n.alignment?`<div style=\"font-size:12px;\"><span style=\"color:#888;\">é˜µè¥:</span> ${n.alignment}</div>`:\"\"}\\n                ${n.personality?`<div style=\"font-size:12px;\"><span style=\"color:#888;\">æ€§æ ¼:</span> ${n.personality}</div>`:\"\"}\\n                ${n.backstory?`<div style=\"font-size:11px;color:#aaa;margin-top:10px;padding-top:10px;border-top:1px dashed #444;line-height:1.5;\">${n.backstory.substring(0,200)}${n.backstory.length>200?\"...\":\"\"}</div>`:\"\"}\\n            </div>\\n        `},bindCharacterCreatorEvents(n){const{$:t}=a(),e=this._charCreatorState;n.find(\"#dnd-creator-use-worldinfo\").on(\"change\",async function(){if(e.useWorldInfo=t(this).is(\":checked\"),e.useWorldInfo&&!e.worldInfo){const n=await no.getEnabledWorldInfo();e.worldInfo=n}\"function\"==typeof window.DND_Dashboard_UI.saveCreatorState&&window.DND_Dashboard_UI.saveCreatorState()}),n.find(\"#dnd-creator-type-pc\").on(\"click\",()=>{\"init\"===e.currentStep&&(e.characterType=\"pc\",this.saveCreatorState(),this.renderCharacterCreationPanel(n))}),n.find(\"#dnd-creator-type-party\").on(\"click\",()=>{\"init\"===e.currentStep&&(e.characterType=\"party\",this.saveCreatorState(),this.renderCharacterCreationPanel(n))}),n.find(\"#dnd-creator-stats-btn\").on(\"click\",n=>{t(n.target).prop(\"disabled\")||this.showStatsGenerator(n)}),n.find(\"#dnd-creator-start-btn\").on(\"click\",async()=>{const n=await to();if(e.apiConfig=n,!e.apiConfig.url||!e.apiConfig.model)return jr.warning(\"è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API åœ°å€å’Œæ¨¡å‹\",\"é…ç½®ç¼ºå¤±\"),void this.renderPanel(\"settings\");e.currentStep=\"chatting\",e.conversationHistory=[],e.characterData={},this.saveCreatorState(),await this.sendCreatorMessage(null,!0)}),n.find(\"#dnd-creator-reset-btn\").on(\"click\",async()=>{if(await jr.confirm(\"ç¡®å®šè¦é‡æ–°å¼€å§‹å—ï¼Ÿå½“å‰å¯¹è¯å’Œè§’è‰²æ•°æ®å°†è¢«æ¸…é™¤ã€‚\",{title:\"é‡æ–°å¼€å§‹\",confirmText:\"ç¡®å®š\",type:\"warning\"})){const t=await no.getEnabledWorldInfo();this._charCreatorState={selectedPresetId:e.selectedPresetId,apiConfig:e.apiConfig,modelList:e.modelList,characterType:e.characterType,conversationHistory:[],characterData:{},isGenerating:!1,currentStep:\"init\",worldInfo:t,useWorldInfo:!0},this.saveCreatorState(),this.renderCharacterCreationPanel(n)}}),n.find(\"#dnd-creator-send-btn\").on(\"click\",()=>{const t=n.find(\"#dnd-creator-user-input\"),e=t.val().trim();e&&(this.sendCreatorMessage(e),t.val(\"\"))}),n.find(\"#dnd-creator-user-input\").on(\"keypress\",t=>{13!==t.which||t.shiftKey||(t.preventDefault(),n.find(\"#dnd-creator-send-btn\").click())}),n.find(\"#dnd-creator-confirm-btn\").html(\"levelup\"===e.mode?'<i class=\"fa-solid fa-check-circle\"></i> ç¡®è®¤å‡çº§':'<i class=\"fa-solid fa-check-circle\"></i> ç¡®è®¤åˆ›å»º'),n.find(\"#dnd-creator-confirm-btn\").on(\"click\",async()=>{await this.finalizeCharacterCreation()}),n.find(\"#dnd-creator-modify-btn\").on(\"click\",()=>{e.currentStep=\"chatting\",this.saveCreatorState(),this.renderCharacterCreationPanel(n)});const r=n.find(\"#dnd-creator-chat-history\");r.length&&r.scrollTop(r[0].scrollHeight)},renderChatOptions(n){const{$:t}=a(),e=t(\"#dnd-creator-chat-history\"),{question:r,options:o,type:i}=n,d=\"multiple\"===i,s=`\\n            <div class=\"dnd-chat-msg dnd-anim-entry\" style=\"background:rgba(157, 139, 108, 0.1); border-left:3px solid var(--dnd-border-gold); padding:10px 12px; margin-bottom:8px; border-radius:4px;\">\\n                ${r?`<div style=\"font-size:12px;color:var(--dnd-text-highlight);margin-bottom:8px;font-weight:bold;\"><i class=\"fa-solid fa-question-circle\"></i> ${r}</div>`:\"\"}\\n                <div style=\"display:flex;flex-direction:column;gap:5px;\">\\n                    ${o.map(n=>{const t=\"string\"==typeof n,e=t?n:n.text||n.label||n.name||\"é€‰é¡¹\",a=t?\"\":n.desc||n.description||\"\";let r=t?n:n.id||n.value||n.name||e;return\"object\"==typeof r&&(r=JSON.stringify(r)),`\\n            <button class=\"dnd-creator-option-btn\" style=\"\\n                background:rgba(255,255,255,0.05);\\n                border:1px solid var(--dnd-border-gold);\\n                color:var(--dnd-text-main);\\n                padding:8px 12px;\\n                border-radius:4px;\\n                cursor:pointer;\\n                text-align:left;\\n                transition:all 0.2s;\\n                font-size:13px;\\n            \" onclick=\"window.DND_Dashboard_UI.handleCreatorOption('${String(r).replace(/'/g,\"\\\\'\")}', '${d}')\">\\n                <div style=\"font-weight:bold;\">${e}</div>\\n                ${a?`<div style=\"font-size:11px;color:#aaa;margin-top:2px;\">${a}</div>`:\"\"}\\n            </button>\\n        `}).join(\"\")}\\n                </div>\\n            </div>\\n        `;e.append(s),e.scrollTop(e[0].scrollHeight)},handleCreatorOption(n,t){this.sendCreatorMessage(n)},async sendCreatorMessage(n,t=!1){const{$:e}=a(),r=this._charCreatorState,o=e(\"#dnd-creator-chat-history\"),i=e(\"#dnd-creator-user-input\"),d=e(\"#dnd-creator-send-btn\");if(!r.isGenerating){r.isGenerating=!0,i.prop(\"disabled\",!0),d.text(\"â³ ç”Ÿæˆä¸­...\").prop(\"disabled\",!0);try{if(n){r.conversationHistory.length;const t=`\\n                    <div class=\"dnd-chat-msg dnd-anim-entry\" style=\"background:rgba(52, 152, 219, 0.1); border-left:3px solid #3498db; padding:10px 12px; margin-bottom:8px; border-radius:4px;\">\\n                        <div style=\"font-size:11px;color:#888;margin-bottom:4px;\"><i class=\"fa-solid fa-user\"></i> ä½ </div>\\n                        <div style=\"color:var(--dnd-text-main);line-height:1.5;white-space:pre-wrap;\">${this.formatChatMessage(n)}</div>\\n                    </div>`;o.append(t),o.scrollTop(o[0].scrollHeight),r.conversationHistory.push({role:\"user\",content:n}),this.saveCreatorState()}else if(t){const n=\"levelup\"===r.mode,t=(r.characterData.level||1)+1,e=n?`ä½ å¥½ï¼Œæˆ‘æ˜¯ ${r.characterData.name}ï¼Œæˆ‘æƒ³ä» Lv.${r.characterData.level} å‡çº§åˆ° Lv.${t}ã€‚è¯·å¼•å¯¼æˆ‘å®Œæˆå‡çº§ã€‚`:\"ä½ å¥½ï¼Œæˆ‘æƒ³åˆ›å»ºä¸€ä¸ª DND 5E è§’è‰²ã€‚è¯·å¼•å¯¼æˆ‘å¼€å§‹ã€‚\";r.conversationHistory.push({role:\"user\",content:e}),this.saveCreatorState()}const a=[],i=\"levelup\"===r.mode;let d=\"\";if(i){const n=!1!==r.useWorldInfo&&r.worldInfo?`\\n\\n${r.worldInfo}\\n\\næ³¨æ„ï¼šä¸Šè¿°ã€å½“å‰ä¸–ç•Œè§‚/è§„åˆ™å‚è€ƒã€‘ä¸ä»…æ˜¯èƒŒæ™¯æ•…äº‹ï¼Œæ›´æ˜¯**æ‰©å±•çš„æ¸¸æˆè§„åˆ™**ã€‚å¦‚æœä¸–ç•Œä¹¦ä¸­æè¿°äº†ç‰¹æ®Šçš„é­”æ³•ä½“ç³»ã€æ­¦æœ¯æµæ´¾æˆ–ç”Ÿç†ç‰¹å¾ï¼Œè¯·å°†å…¶è½¬åŒ–ä¸ºå…·ä½“çš„**è‡ªå®šä¹‰èŒä¸šã€ä¸“é•¿ã€æŠ€èƒ½æˆ–ç‰¹æ€§**ã€‚ä¸è¦å±€é™äº DND 5E çš„æ ‡å‡†é€‰é¡¹ã€‚å¦‚æœä¸–ç•Œä¹¦å†…å®¹ä¸ DND è§„åˆ™å†²çªï¼Œæˆ–æä¾›äº†å…¨æ–°çš„æœºåˆ¶ï¼Œ**è¯·ä¼˜å…ˆä½¿ç”¨ä¸–ç•Œä¹¦å†…å®¹åˆ›é€ æ–°çš„æ¸¸æˆè§„åˆ™**ã€‚ä½ å¯ä»¥è®¾è®¡å…¨æ–°çš„èŒä¸šç‰¹æ€§æ¥åæ˜ ä¸–ç•Œä¹¦çš„è®¾å®šï¼Œè€Œä¸ä»…ä»…æ˜¯é‡å‘½åç°æœ‰çš„ DND ç‰¹æ€§ã€‚`:\"\";d=`ä½ æ˜¯ä¸€ä¸ª DND 5E (åŠè‡ªå®šä¹‰ä¸–ç•Œè§‚) è§’è‰²å‡çº§å‘å¯¼ã€‚å½“å‰ç”¨æˆ·æ­£åœ¨å°†è§’è‰² \"${r.characterData.name}\" ä»ç­‰çº§ ${r.characterData.level} æå‡åˆ° ${(r.characterData.level||1)+1}ã€‚${n}\\n\\n**å½“å‰è§’è‰²æ•°æ®:**\\n\\`\\`\\`json\\n${JSON.stringify(r.characterData,null,2)}\\n\\`\\`\\`\\n\\nè¯·éµå¾ªä»¥ä¸‹æµç¨‹å¼•å¯¼ç”¨æˆ·å‡çº§ï¼š\\n1. **ç”Ÿå‘½å€¼æå‡**: æ ¹æ®èŒä¸šç”Ÿå‘½éª°ï¼ˆå–å¹³å‡æˆ–æŠ•æ·ï¼‰ï¼Œè®¡ç®—æ–°çš„æœ€å¤§HPã€‚\\n2. **èŒä¸šç‰¹æ€§**: å‘ŠçŸ¥ç”¨æˆ·æ–°ç­‰çº§è·å¾—çš„èŒä¸šç‰¹æ€§ã€‚å¦‚æœè§’è‰²æ˜¯è‡ªå®šä¹‰èŒä¸šæˆ–å¤„äºè‡ªå®šä¹‰ä¸–ç•Œè§‚ä¸‹ï¼Œè¯·**æ ¹æ®ä¸–ç•Œä¹¦æ¨æ–­ã€è®¾è®¡æˆ–è¯¢é—®ç”¨æˆ·å…¶ç‰¹æ€§**ã€‚ä¸è¦å®³æ€•åˆ›é€  DND è§„åˆ™ä¹¦ä¸­æ²¡æœ‰çš„èƒ½åŠ›ã€‚\\n3. **æ³•æœ¯/å·²çŸ¥æ³•æœ¯**: å¦‚æœæ˜¯æ–½æ³•è€…ï¼Œå¼•å¯¼é€‰æ‹©æ–°æ³•æœ¯æˆ–æ›¿æ¢æ—§æ³•æœ¯ã€‚\\n4. **å±æ€§æå‡/ä¸“é•¿**: å¦‚æœæ˜¯ 4/8/12/16/19 çº§ï¼Œå¼•å¯¼ç”¨æˆ·é€‰æ‹©å±æ€§å€¼æå‡ (ASI) æˆ–ä¸“é•¿ã€‚\\n5. **ç†Ÿç»ƒé¡¹åŠ å€¼**: æ£€æŸ¥ç†Ÿç»ƒåŠ å€¼æ˜¯å¦å› ç­‰çº§æå‡è€Œå¢åŠ ï¼ˆå¦‚ 1-4çº§+2, 5-8çº§+3ï¼‰ã€‚\\n\\nåœ¨å¯¹è¯ä¸­ï¼š\\n- æ¯æ¬¡ä¸“æ³¨äºä¸€ä¸ªå‡çº§æ­¥éª¤ã€‚\\n- å½“æœ‰å¤šä¸ªé€‰æ‹©æ—¶ï¼ˆå¦‚é€‰æ‹©æ–°æ³•æœ¯ã€ä¸“é•¿ï¼‰ï¼Œ**å¿…é¡»**ä½¿ç”¨ \\`CHARACTER_OPTIONS\\` å—è¾“å‡ºé€‰é¡¹ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\\n\\`\\`\\`CHARACTER_OPTIONS\\n{\\n\"question\": \"è¯·é€‰æ‹©...\",\\n\"type\": \"single\",\\n\"options\": [\"é€‰é¡¹A\", \"é€‰é¡¹B\"]\\n}\\n\\`\\`\\`\\n- è§£é‡Šè§„åˆ™ä¾æ® (DND 5E è§„åˆ™æˆ–ä¸–ç•Œä¹¦è‡ªå®šä¹‰è§„åˆ™)ã€‚å¦‚æœä½¿ç”¨äº†è‡ªå®šä¹‰è§„åˆ™ï¼Œè¯·æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯æ ¹æ®ä¸–ç•Œä¹¦è®¾å®šçš„ã€‚\\n\\næœ€åï¼Œå½“å‡çº§çš„æ‰€æœ‰é€‰æ‹©éƒ½ç¡®å®šåï¼Œè¾“å‡ºæ›´æ–°åçš„ \\`CHARACTER_DATA\\` å—ã€‚**å¿…é¡»åŒ…å«è§’è‰²çš„æ‰€æœ‰æ•°æ®ï¼ˆæ—§æ•°æ®+æ–°å˜åŒ–ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯å˜åŒ–éƒ¨åˆ†ã€‚** æ ¼å¼ä¸åˆ›å»ºè§’è‰²æ—¶ç›¸åŒã€‚\\n\\n\\`\\`\\`CHARACTER_DATA\\n{\\n  ... (å®Œæ•´çš„è§’è‰²JSONæ•°æ®ï¼Œæ›´æ–°äº†ç­‰çº§ã€HPã€ç‰¹æ€§ã€æ³•æœ¯ç­‰)\\n}\\n\\`\\`\\`\\n`}else{const n=\"pc\"===r.characterType?\"ä¸»è§’\":\"é˜Ÿå‹\",t=!1!==r.useWorldInfo;d=`ä½ æ˜¯ä¸€ä¸ª DND 5E (åŠè‡ªå®šä¹‰ä¸–ç•Œè§‚) è§’è‰²åˆ›å»ºå‘å¯¼ã€‚ä½ çš„ä»»åŠ¡æ˜¯é€šè¿‡å¯¹è¯å¼•å¯¼ç”¨æˆ·åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„${n}è§’è‰²ã€‚${t&&r.worldInfo?`\\n\\n${r.worldInfo}\\n\\næ³¨æ„ï¼šä¸Šè¿°ã€å½“å‰ä¸–ç•Œè§‚/è§„åˆ™å‚è€ƒã€‘ä¸ä»…æ˜¯èƒŒæ™¯æ•…äº‹ï¼Œæ›´æ˜¯**æ‰©å±•çš„æ¸¸æˆè§„åˆ™**ã€‚è¯·ç§¯æä»ä¸–ç•Œä¹¦ä¸­æå–å¹¶**åˆ›é€ **æ–°çš„ç§æ—ã€èŒä¸šã€èƒŒæ™¯å’Œä¸“é•¿ã€‚ä¸è¦å±€é™äº DND 5E çš„æ ‡å‡†é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸–ç•Œä¹¦æåˆ°äº†ä¸€ç§ç‰¹æ®Šçš„â€œæ˜Ÿèƒ½ä½¿ç”¨è€…â€ï¼Œä½ å¯ä»¥ä¸ºæ­¤åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„èŒä¸šï¼Œå¹¶è®¾è®¡å…¶ç‰¹æœ‰çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œè€Œä¸æ˜¯å¼ºè¡Œè®©ç”¨æˆ·ä½¿ç”¨â€œæœ¯å£«â€å¡ã€‚å¦‚æœä¸–ç•Œä¹¦å†…å®¹æä¾›äº†å…¨æ–°çš„æœºåˆ¶ï¼Œ**è¯·ä¼˜å…ˆä½¿ç”¨ä¸–ç•Œä¹¦å†…å®¹åˆ›é€ æ–°çš„æ¸¸æˆè§„åˆ™**ã€‚`:\"\"}\\n\\nè¯·éµå¾ªä»¥ä¸‹æµç¨‹ï¼š\\n1. é¦–å…ˆè¯¢é—®ç”¨æˆ·æƒ³è¦åˆ›å»ºä»€ä¹ˆç±»å‹çš„è§’è‰²ï¼ˆæˆ˜å£«ã€æ³•å¸ˆã€ç›—è´¼ç­‰ï¼‰ï¼Œæˆ–è€…è®©ä»–ä»¬æè¿°ä¸€ä¸ªè§’è‰²æ¦‚å¿µ\\n2. æ ¹æ®ç”¨æˆ·çš„å›ç­”ï¼Œå»ºè®®åˆé€‚çš„ç§æ—å’ŒèŒä¸šç»„åˆ (ä¼˜å…ˆå‚è€ƒä¸–ç•Œä¹¦è®¾å®šï¼Œå…¶æ¬¡å‚è€ƒ DND è§„åˆ™)\\n3. å¸®åŠ©ç”¨æˆ·ç¡®å®šå±æ€§å€¼åˆ†é…ï¼ˆä½¿ç”¨æ ‡å‡†ç‚¹æ•°è´­ä¹°æˆ–è®©ç”¨æˆ·è‡ªé€‰ï¼‰\\n4. è¯¢é—®è§’è‰²çš„èƒŒæ™¯ã€æ€§æ ¼ç‰¹ç‚¹ï¼ˆç†æƒ³ã€ç‰µç»Šã€ç¼ºé™·ï¼‰\\n5. è¯¢é—®è§’è‰²çš„å¤–è²Œç‰¹å¾ï¼ˆå‘è‰²ã€çœ¼ç›ã€èº«é«˜ã€ç‰¹å¾ï¼‰\\n6. å¸®åŠ©ç”¨æˆ·æ„æ€ä¸€ä¸ªç®€çŸ­çš„èƒŒæ™¯æ•…äº‹ï¼ˆä¸è¶…è¿‡300å­—ï¼‰\\n\\nåœ¨å¯¹è¯è¿‡ç¨‹ä¸­ï¼Œè¯·ï¼š\\n- æ¯æ¬¡åªé—®1-2ä¸ªé—®é¢˜ï¼Œä¸è¦ä¸€æ¬¡é—®å¤ªå¤š\\n- æä¾›å…·ä½“çš„é€‰é¡¹ä¾›ç”¨æˆ·é€‰æ‹©ï¼ˆ**å¿…é¡»**é€šè¿‡ CHARACTER_OPTIONS è¾“å‡ºï¼‰\\n- è§£é‡Šä½ çš„å»ºè®®ç†ç”±\\n- ä¿æŒå‹å¥½å’Œé¼“åŠ±çš„è¯­æ°”\\n\\nå½“éœ€è¦ç”¨æˆ·åšé€‰æ‹©æ—¶ï¼ˆå¦‚é€‰æ‹©ç§æ—ã€èŒä¸šã€å±æ€§åˆ†é…æ–¹å¼ï¼‰ï¼Œè¯·åŠ¡å¿…è¾“å‡ºä¸€ä¸ªé€‰é¡¹å—ï¼š\\n\\`\\`\\`CHARACTER_OPTIONS\\n{\\n\"question\": \"è¯·é€‰æ‹©ä½ çš„ç§æ—...\",\\n\"type\": \"single\",\\n\"options\": [\"äººç±»\", \"ç²¾çµ\", \"çŸ®äºº\", \"å…¶ä»–\"]\\n}\\n\\`\\`\\`\\n\\nå½“æ”¶é›†åˆ°è¶³å¤Ÿä¿¡æ¯åï¼Œè¾“å‡ºä¸€ä¸ªç‰¹æ®Šæ ¼å¼çš„è§’è‰²æ•°æ®å—ï¼ˆä¸¥æ ¼éµå®ˆæ­¤JSONæ ¼å¼ï¼‰ï¼š\\n\\`\\`\\`CHARACTER_DATA\\n{\\n\"name\": \"è§’è‰²å…¨å\",\\n\"race_gender_age\": \"ç§æ—/æ€§åˆ«/å¹´é¾„ï¼ˆå¦‚ï¼šåŠç²¾çµ/ç”·/32å²ï¼‰\",\\n\"class\": \"èŒä¸šåŠå­èŒï¼ˆå¦‚ï¼šåœ£æ­¦å£«(å¤ä»‡èª“è¨€) Lv1ï¼‰\",\\n\"level\": 1,\\n\"appearance\": \"å¤–è²Œæè¿°ï¼ˆè¯¦ç»†çš„å¤–è²Œç‰¹å¾ï¼‰\",\\n\"personality\": \"æ€§æ ¼ç‰¹ç‚¹ï¼ˆæ ¸å¿ƒæ€§æ ¼ã€ç†æƒ³ã€ç‰µç»Šã€ç¼ºé™·ï¼‰\",\\n\"backstory\": \"èƒŒæ™¯æ•…äº‹ï¼ˆä¸è¶…è¿‡300å­—ï¼‰\",\\n\"stats\": {\"STR\": 10, \"DEX\": 10, \"CON\": 10, \"INT\": 10, \"WIS\": 10, \"CHA\": 10},\\n\"hp\": \"å½“å‰HP/æœ€å¤§HPï¼ˆå¦‚ï¼š12/12ï¼‰\",\\n\"ac\": 10,\\n\"initiative\": 0,\\n\"speed\": \"30å°º(6æ ¼)\",\\n\"saving_throws\": [\"åŠ›é‡\", \"ä½“è´¨\"],\\n\"skill_proficiencies\": [\"è¿åŠ¨\", \"å¨å“\"],\\n\"passive_perception\": 10,\\n\"resources\": {\\n    \"spell_slots\": {\"1çº§\": \"3/4\"},\\n    \"class_resources\": {\"åŠ¨ä½œå¦‚æ½®\": \"1/1\"},\\n    \"hit_dice\": \"3/3\"\\n},\\n\"features\": [\\n    {\"name\": \"æˆ˜æ–—é£æ ¼(é˜²å¾¡)\", \"type\": \"èŒä¸šç‰¹æ€§\", \"desc\": \"ç€è£…æŠ¤ç”²æ—¶AC+1\"},\\n    {\"name\": \"å¤è‹ä¹‹é£\", \"type\": \"èŒä¸šç‰¹æ€§\", \"desc\": \"ç”¨é™„èµ åŠ¨ä½œæ¢å¤1d10+ç­‰çº§ç‚¹HP\"}\\n],\\n\"spells\": [\\n    {\"name\": \"é­”èƒ½çˆ†\", \"level\": 0, \"school\": \"å¡‘èƒ½\", \"time\": \"1åŠ¨ä½œ\", \"range\": \"120å°º\", \"comp\": \"V,S\", \"duration\": \"ç«‹å³\", \"desc\": \"1d10åŠ›åœºä¼¤å®³...\"},\\n    {\"name\": \"æŠ¤ç›¾æœ¯\", \"level\": 1, \"school\": \"é˜²æŠ¤\", \"time\": \"1ååº”\", \"range\": \"è‡ªèº«\", \"comp\": \"V,S\", \"duration\": \"1è½®\", \"desc\": \"AC+5ç›´åˆ°å›åˆç»“æŸ...\"}\\n]${\"party\"===r.characterType?',\\n\"member_type\": \"åŒä¼´\",\\n\"control_method\": \"AIæ§åˆ¶\"':\"\"}\\n}\\n\\`\\`\\`\\n\\nç°åœ¨å¼€å§‹ä¸ç”¨æˆ·å¯¹è¯ã€‚`}a.push({role:\"system\",content:d}),r.conversationHistory.forEach(n=>{a.push({role:n.role,content:n.content})});const s=await no.generate(a,{customConfig:r.apiConfig,maxTokens:4096});if(s){r.conversationHistory.push({role:\"assistant\",content:s});const n=`\\n                    <div class=\"dnd-chat-msg dnd-anim-entry\" style=\"background:rgba(155, 89, 182, 0.1); border-left:3px solid #9b59b6; padding:10px 12px; margin-bottom:8px; border-radius:4px;\">\\n                        <div style=\"font-size:11px;color:#888;margin-bottom:4px;\"><i class=\"fa-solid fa-robot\"></i> AI å‘å¯¼</div>\\n                        <div style=\"color:var(--dnd-text-main);line-height:1.5;white-space:pre-wrap;\">${this.formatChatMessage(s)}</div>\\n                    </div>`;o.append(n);const t=s.match(/```CHARACTER_OPTIONS\\s*([\\s\\S]*?)```/);if(t)try{const n=JSON.parse(t[1]);this.renderChatOptions(n)}catch(n){console.error(\"Options parse error\",n)}o.scrollTop(o[0].scrollHeight);const a=s.match(/```CHARACTER_DATA\\s*([\\s\\S]*?)```/);if(a)try{const n=JSON.parse(a[1]);r.characterData=n,r.currentStep=\"reviewing\",e(\"#dnd-creator-preview\").html(this.renderCharacterPreview(r.characterData)),console.log(\"[CharCreator] è§’è‰²æ•°æ®å·²è§£æ:\",n)}catch(n){console.error(\"[CharCreator] è§£æè§’è‰²æ•°æ®å¤±è´¥:\",n)}this.saveCreatorState()}}catch(n){console.error(\"[CharCreator] API è°ƒç”¨å¤±è´¥:\",n);const t=`\\n                <div class=\"dnd-chat-msg dnd-anim-entry\" style=\"background:rgba(192, 57, 43, 0.1); border-left:3px solid #e74c3c; padding:10px 12px; margin-bottom:8px; border-radius:4px;\">\\n                    <div style=\"font-size:11px;color:#888;margin-bottom:4px;\"><i class=\"fa-solid fa-robot\"></i> ç³»ç»Ÿæ¶ˆæ¯</div>\\n                    <div style=\"color:var(--dnd-text-main);line-height:1.5;\"><i class=\"fa-solid fa-times-circle\"></i> æŠ±æ­‰ï¼Œç”Ÿæˆå¤±è´¥ï¼š${n.message}</div>\\n                </div>`;o.append(t),o.scrollTop(o[0].scrollHeight),r.conversationHistory.push({role:\"assistant\",content:`âŒ æŠ±æ­‰ï¼Œç”Ÿæˆå¤±è´¥ï¼š${n.message}\\n\\nè¯·æ£€æŸ¥ API è¿æ¥æˆ–é‡è¯•ã€‚`})}finally{r.isGenerating=!1,i.prop(\"disabled\",!1).val(\"\").focus(),d.text(\"ğŸ“¤ å‘é€\").prop(\"disabled\",!1),\"reviewing\"===r.currentStep&&0===e(\"#dnd-creator-confirm-btn\").length&&this.renderCharacterCreationPanel(e(\"#dnd-creator-chat-history\").closest(\"#dnd-content\"))}}},async finalizeCharacterCreation(){const{$:n}=a(),t=this._charCreatorState,e=t.characterData;if(e&&e.name)try{const a=Rr.getAllData();if(!a)throw new Error(\"æ— æ³•è·å–æ•°æ®åº“\");const r=\"pc\"===t.characterType,o=\"levelup\"===t.mode?t.targetCharId:null,i=n=>Object.values(a).find(t=>t.uid===n||t.uid===`sheet_${n}`||t.uid===`sheet_CHARACTER_${n}`||t.name&&t.name.includes(n)),d=i(\"CHARACTER_Registry\")||i(\"Registry\"),s=i(\"CHARACTER_Attributes\")||i(\"Attributes\"),l=i(\"CHARACTER_Resources\")||i(\"Resources\"),c=i(\"SKILL_Library\"),p=i(\"CHARACTER_Skills\"),g=i(\"FEAT_Library\"),f=i(\"CHARACTER_Feats\");if(!d)throw new Error(\"æ‰¾ä¸åˆ°è§’è‰²æ³¨å†Œè¡¨ (CHARACTER_Registry)\");let b;b=o||(r?\"PC_MAIN\":\"ALLY_\"+Date.now());const m=(n,a)=>{if(n.content||(n.content=[]),0===n.content.length)return;const o=n.content[0],i=o.indexOf(\"CHAR_ID\");if(-1===i)return;let d=-1;for(let t=1;t<n.content.length;t++)if(n.content[t][i]===a){d=t;break}const s=o.map((o,i)=>{if(\"CHAR_ID\"===o)return a;const s=-1!==d&&n.content[d]&&void 0!==n.content[d][i]?n.content[d][i]:void 0,l=n=>null!=n&&\"\"!==n?n:s;if(\"æˆå‘˜ç±»å‹\"===o)return r?\"ä¸»è§’\":e.member_type||s||\"åŒä¼´\";if(\"å§“å\"===o)return l(e.name);if(\"ç§æ—/æ€§åˆ«/å¹´é¾„\"===o)return l(e.race_gender_age)||`${e.race}/-/1`;if(\"èŒä¸š\"===o)return l(e.class);if(\"å¤–è²Œæè¿°\"===o)return l(e.appearance);if(\"æ€§æ ¼ç‰¹ç‚¹\"===o)return l(e.personality);if(\"èƒŒæ™¯æ•…äº‹\"===o)return l(e.backstory);if(\"åŠ å…¥æ—¶é—´\"===o)return r?s||null:\"ç¬¬1å¤©\";if(\"ç­‰çº§\"===o)return l(e.level)||1;if(\"HP\"===o)return l(e.hp)||\"10/10\";if(\"AC\"===o)return l(e.ac)||10;if(\"å…ˆæ”»åŠ å€¼\"===o)return(void 0!==e.initiative?e.initiative:s)||0;if(\"é€Ÿåº¦\"===o)return l(e.speed)||\"30å°º\";if(\"å±æ€§å€¼\"===o)return e.stats?JSON.stringify(e.stats):s||\"{}\";if(\"è±å…ç†Ÿç»ƒ\"===o)return e.saving_throws?JSON.stringify(e.saving_throws):s||\"[]\";if(\"æŠ€èƒ½ç†Ÿç»ƒ\"===o)return e.skill_proficiencies?JSON.stringify(e.skill_proficiencies):s||\"[]\";if(\"è¢«åŠ¨æ„ŸçŸ¥\"===o)return(void 0!==e.passive_perception?e.passive_perception:s)||10;if(\"ç»éªŒå€¼\"===o&&r){if(\"levelup\"===t.mode&&-1!==d){const t=n.content[d][i]||\"0/300\";return`${parseInt(t.split(\"/\")[0])||0}/${[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3][parseInt(e.level)||1]||355e3}`}return\"0/300\"}return\"æ³•æœ¯ä½\"===o?e.resources?.spell_slots?JSON.stringify(e.resources.spell_slots):null:\"èŒä¸šèµ„æº\"===o?e.resources?.class_resources?JSON.stringify(e.resources.class_resources):null:\"ç”Ÿå‘½éª°\"===o?e.resources?.hit_dice||null:\"é‡‘å¸\"===o&&r?0:-1!==d&&void 0!==n.content[d][i]?n.content[d][i]:null});-1!==d?n.content[d]=s:n.content.push(s)};m(d,b),s&&m(s,b),l&&m(l,b);const u=e.spells||[];if(u.length>0&&c&&p){const n=p.content[0],t=n.indexOf(\"CHAR_ID\"),e=n.indexOf(\"SKILL_ID\");if(-1!==t&&-1!==e){const n=p.content.filter(n=>n[t]===b),a=new Map,r=new Set;n.forEach(n=>{const t=n[e],r=c.content.find(n=>n[0]===t);if(r){const t=(r[1]||\"\").trim();t&&(a.has(t)||a.set(t,[]),a.get(t).push(n))}}),a.forEach((n,t)=>{if(n.length>1){console.log(`[CharCreator] æ¸…ç†é‡å¤æŠ€èƒ½: ${t} (åˆ é™¤ ${n.length-1} ä¸ª)`);for(let t=1;t<n.length;t++)r.add(n[t])}}),r.size>0&&(p.content=p.content.filter(n=>!r.has(n)))}u.forEach(a=>{const r=(a.name||\"\").trim();if(!r)return;const o=c.content.filter(n=>(n[1]||\"\").trim()===r).map(n=>n[0]);if(-1!==t&&-1!==e&&o.length>0){if(p.content.some(n=>n[t]===b&&o.includes(n[e])))return}let i=\"SKILL_\"+Math.random().toString(36).substr(2,8);const d=c.content.find(n=>(n[1]||\"\").trim()===r);if(d){if(i=d[0],a.desc){const n=c.content[0].indexOf(\"æ•ˆæœæè¿°\");-1!==n&&(d[n]=a.desc)}}else{const n=c.content[0].map(n=>\"SKILL_ID\"===n?i:\"æŠ€èƒ½åç§°\"===n?r:\"æŠ€èƒ½ç±»å‹\"===n?\"æ³•æœ¯\":\"ç¯é˜¶\"===n?void 0!==a.level?a.level:\"0\":\"å­¦æ´¾\"===n?a.school||\"-\":\"æ–½æ³•æ—¶é—´\"===n?a.time||\"-\":\"å°„ç¨‹\"===n?a.range||\"-\":\"æˆåˆ†\"===n?a.comp||\"-\":\"æŒç»­æ—¶é—´\"===n?a.duration||\"-\":\"æ•ˆæœæè¿°\"===n?a.desc:null);c.content.push(n)}if(-1!==t&&-1!==e){if(p.content.some(n=>n[t]===b&&n[e]===i))return}const s=n.map(n=>\"LINK_ID\"===n?\"LNK_\"+Math.random().toString(36).substr(2,8):\"CHAR_ID\"===n?b:\"SKILL_ID\"===n?i:\"å·²å‡†å¤‡\"===n?\"æ˜¯\":null);p.content.push(s)})}const h=e.features||[];if(h.length>0&&g&&f){const n=f.content[0],t=n.indexOf(\"CHAR_ID\"),e=n.indexOf(\"FEAT_ID\");if(-1!==t&&-1!==e){const n=f.content.filter(n=>n[t]===b),a=new Map,r=new Set;n.forEach(n=>{const t=n[e],r=g.content.find(n=>n[0]===t);if(r){const t=(r[1]||\"\").trim();t&&(a.has(t)||a.set(t,[]),a.get(t).push(n))}}),a.forEach((n,t)=>{if(n.length>1){console.log(`[CharCreator] æ¸…ç†é‡å¤ç‰¹æ€§: ${t} (åˆ é™¤ ${n.length-1} ä¸ª)`);for(let t=1;t<n.length;t++)r.add(n[t])}}),r.size>0&&(f.content=f.content.filter(n=>!r.has(n)))}h.forEach(a=>{const r=(a.name||\"\").trim();if(!r)return;const o=g.content.filter(n=>(n[1]||\"\").trim()===r).map(n=>n[0]);if(-1!==t&&-1!==e&&o.length>0){if(f.content.some(n=>n[t]===b&&o.includes(n[e])))return void console.log(`[CharCreator] è·³è¿‡é‡å¤ä¸“é•¿/ç‰¹æ€§: ${r}`)}let i=\"FEAT_\"+Math.random().toString(36).substr(2,8);const d=g.content.find(n=>(n[1]||\"\").trim()===r);if(d){if(i=d[0],a.desc){const n=g.content[0].indexOf(\"æ•ˆæœæè¿°\");-1!==n&&(d[n]=a.desc)}}else{const n=g.content[0].map(n=>\"FEAT_ID\"===n?i:\"ä¸“é•¿åç§°\"===n?r:\"ç±»åˆ«\"===n?a.type||\"èŒä¸šç‰¹æ€§\":\"æ•ˆæœæè¿°\"===n?a.desc:null);g.content.push(n)}if(-1!==t&&-1!==e){if(f.content.some(n=>n[t]===b&&n[e]===i))return}const s=n.map(n=>\"LINK_ID\"===n?\"LNK_\"+Math.random().toString(36).substr(2,8):\"CHAR_ID\"===n?b:\"FEAT_ID\"===n?i:null);f.content.push(s)})}await Lr.saveData(a),t.currentStep=\"complete\",this.saveCreatorState(),this.renderCharacterCreationPanel(n(\"#dnd-creator-chat-history\").closest(\"#dnd-content\"));const x=\"levelup\"===t.mode?`ğŸ‰ è§’è‰² \"${e.name}\" å‡çº§æˆåŠŸ (Lv.${e.level})ï¼`:`ğŸ‰ ${r?\"ä¸»è§’\":\"é˜Ÿå‹\"} \"${e.name}\" åˆ›å»ºæˆåŠŸï¼`;jr.success(x,\"levelup\"===t.mode?\"è§’è‰²å‡çº§\":\"è§’è‰²åˆ›å»º\")}catch(n){console.error(\"[CharCreator] ä¿å­˜å¤±è´¥:\",n),jr.error(\"ä¿å­˜å¤±è´¥ï¼š\"+n.message)}else jr.warning(\"è§’è‰²æ•°æ®ä¸å®Œæ•´ï¼Œæ— æ³•ä¿å­˜\")}},io={renderPanel(n){const{$:t}=a(),e=t(\"#dnd-content\");if(e.length)switch(e.empty(),e.removeClass(\"dnd-panel-transition\"),e[0].offsetWidth,e.addClass(\"dnd-panel-transition\"),n){case\"create\":oo.renderCharacterCreationPanel.call(this,e);break;case\"party\":this.renderPartyPanel(e);break;case\"quests\":this.renderQuestsPanel(e);break;case\"inventory\":this.renderInventoryPanel(e);break;case\"combat\":this.renderCombatPanel(e);break;case\"world\":this.renderWorldPanel(e);break;case\"logs\":this.renderLogsPanel(e);break;case\"npcs\":this.renderNPCPanel(e);break;case\"archives\":this.renderArchivesPanel(e);break;case\"settings\":this.renderSettingsPanel(e);break;default:e.html('<div style=\"padding:20px\">å¼€å‘ä¸­...</div>')}},renderPartyPanel(t){const{$:e}=a(),r=Rr.getPartyData()||[],o=e(`\\n            <div class=\"dnd-party-toolbar\" style=\"display:flex;gap:10px;margin-bottom:15px;padding:10px;background:rgba(0,0,0,0.3);border-radius:6px;border:1px solid var(--dnd-border-inner);\">\\n                <div style=\"flex:1;display:flex;align-items:center;gap:10px;\">\\n                    <span style=\"font-weight:bold;color:var(--dnd-text-highlight);\"><i class=\"fa-solid fa-users\"></i> å†’é™©é˜Ÿä¼</span>\\n                    <span style=\"font-size:12px;color:#888;\">(${r.length} åæˆå‘˜)</span>\\n                </div>\\n                <button class=\"dnd-btn dnd-clickable dnd-export-party-btn\" style=\"background:#1a1a1c;border:1px solid var(--dnd-border-gold);color:var(--dnd-text-main);padding:6px 12px;border-radius:4px;cursor:pointer;display:flex;align-items:center;gap:5px;\">\\n                    <i class=\"fa-solid fa-download\"></i> å¯¼å‡ºé˜Ÿä¼\\n                </button>\\n                <button class=\"dnd-btn dnd-clickable dnd-import-party-btn\" style=\"background:#1a1a1c;border:1px solid var(--dnd-border-inner);color:var(--dnd-text-main);padding:6px 12px;border-radius:4px;cursor:pointer;display:flex;align-items:center;gap:5px;\">\\n                    <i class=\"fa-solid fa-upload\"></i> å¯¼å…¥é˜Ÿä¼\\n                </button>\\n                <button class=\"dnd-btn dnd-clickable dnd-import-fvtt-btn\" style=\"background:#1a1a1c;border:1px solid var(--dnd-border-inner);color:#e67e22;padding:6px 12px;border-radius:4px;cursor:pointer;display:flex;align-items:center;gap:5px;\">\\n                    <i class=\"fa-solid fa-file-import\"></i> å¯¼å…¥ FVTT\\n                </button>\\n            </div>\\n        `),i=this;if(o.find(\".dnd-export-party-btn\").on(\"click\",function(){i.exportPartyToFile()}),o.find(\".dnd-import-party-btn\").on(\"click\",function(){i.importPartyFromFile()}),o.find(\".dnd-import-fvtt-btn\").on(\"click\",function(){i.importFVTTFromFile()}),t.empty(),t.append(o),0===r.length)return void t.append('<div style=\"padding:20px; text-align:center;\">æš‚æ— é˜Ÿä¼æ•°æ®ï¼Œè¯·ç¡®ä¿å·²è¿æ¥æ•°æ®åº“å¹¶åŠ è½½ DND æ¨¡æ¿ã€‚</div>');const d=e('<div class=\"dnd-grid\"></div>');r.forEach((t,a)=>{let r=0,o=0,s=0;if(t.HP){const n=t.HP.toString().split(\"/\");2===n.length&&(r=parseInt(n[0])||0,o=parseInt(n[1])||1,s=Math.min(100,Math.max(0,r/o*100)))}let l=\"\";const c=Rr.parseValue(t[\"å±æ€§å€¼\"],\"stats\")||{};Object.keys(c).length>0&&(l='<div style=\"display:flex; justify-content:space-between; margin-bottom:10px; background:rgba(0,0,0,0.2); padding:5px; border-radius:4px;\">',Object.keys(c).forEach(n=>{l+=`<div style=\"text-align:center;\"><div style=\"font-size:10px;color:#888\">${n}</div><div style=\"font-weight:bold\">${c[n]}</div></div>`}),l+=\"</div>\");const p=t.PC_ID||t.CHAR_ID||t[\"å§“å\"],g=this.renderAvatar(t[\"å§“å\"],p,40);let f=\"ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…\";try{if(t[\"æŠ€èƒ½ç†Ÿç»ƒ\"]){let n=[];\"string\"==typeof t[\"æŠ€èƒ½ç†Ÿç»ƒ\"]?n=t[\"æŠ€èƒ½ç†Ÿç»ƒ\"].startsWith(\"[\")?JSON.parse(t[\"æŠ€èƒ½ç†Ÿç»ƒ\"]):t[\"æŠ€èƒ½ç†Ÿç»ƒ\"].split(/[,;ï¼Œï¼›]/):Array.isArray(t[\"æŠ€èƒ½ç†Ÿç»ƒ\"])&&(n=t[\"æŠ€èƒ½ç†Ÿç»ƒ\"]),n&&n.length>0&&(f=\"ç†Ÿç»ƒæŠ€èƒ½: \"+n.map(n=>n.trim()).join(\", \"))}}catch(n){}const b=`\\n                <div class=\"dnd-char-card dnd-anim-entry dnd-clickable\" style=\"cursor:pointer; animation-delay: ${.05*a}s\" title=\"${f}\">\\n                    <div class=\"dnd-card-header\" style=\"justify-content:flex-start;gap:10px;\">\\n                        ${g}\\n                        <div style=\"flex:1;overflow:hidden;\">\\n                            <div class=\"dnd-char-name\" style=\"white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">${t[\"å§“å\"]||\"æœªçŸ¥\"}</div>\\n                            <div class=\"dnd-char-lvl\" style=\"white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">${t[\"ç§æ—/æ€§åˆ«/å¹´é¾„\"]||\"\"} | ${t[\"èŒä¸š\"]||\"\"}</div>\\n                        </div>\\n                    </div>\\n                    <div class=\"dnd-card-body\">\\n                        ${l}\\n                        <div class=\"dnd-stat-row\">\\n                            <span class=\"dnd-stat-label\">AC (æŠ¤ç”²)</span>\\n                            <span class=\"dnd-stat-val\">${t.AC||\"-\"}</span>\\n                        </div>\\n                        <div class=\"dnd-stat-row\">\\n                            <span class=\"dnd-stat-label\">å…ˆæ”»åŠ å€¼</span>\\n                            <span class=\"dnd-stat-val\">${t[\"å…ˆæ”»åŠ å€¼\"]||\"+0\"}</span>\\n                        </div>\\n                        <div class=\"dnd-stat-row\">\\n                            <span class=\"dnd-stat-label\">è¢«åŠ¨æ„ŸçŸ¥</span>\\n                            <span class=\"dnd-stat-val\">${t[\"è¢«åŠ¨æ„ŸçŸ¥\"]||\"10\"}</span>\\n                        </div>\\n                        \\n                        <div>\\n                            <div style=\"display:flex;justify-content:space-between;font-size:12px;margin-bottom:2px;\">\\n                                <span>HP</span>\\n                                <span>${r} / ${o}</span>\\n                            </div>\\n                            <div class=\"dnd-bar-container dnd-bar-hp\">\\n                                <div class=\"dnd-bar-fill\" style=\"width: ${s}%\"></div>\\n                            </div>\\n                        </div>\\n\\n                        ${t[\"ç»éªŒå€¼\"]?`\\n                        <div>\\n                            <div style=\"display:flex;justify-content:space-between;font-size:12px;margin-bottom:2px;\">\\n                                <span>XP</span>\\n                                <span>${t[\"ç»éªŒå€¼\"]}</span>\\n                            </div>\\n                            <div class=\"dnd-bar-container dnd-bar-exp\">\\n                                <div class=\"dnd-bar-fill\" style=\"width: 50%\"></div>\\n                            </div>\\n                        </div>`:\"\"}\\n                        \\n                        <div style=\"margin-top:5px;font-size:12px;color:#888;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\">\\n                            ${t[\"å¤–è²Œæè¿°\"]||\"æ— æè¿°\"}\\n                        </div>\\n                    </div>\\n                </div>\\n            `,m=e(b);m.on(\"click\",e=>{n.debug(\"[PartyPanel] Clicked card for\",t[\"å§“å\"]),i.showCharacterCard(t,e)}),d.append(m)}),t.append(d)},renderQuestsPanel(n){const{$:t}=a(),e=Rr.getTable(\"QUEST_Active\");if(!e)return void n.html(\"æš‚æ— ä»»åŠ¡æ•°æ®ã€‚\");const r=t('<div style=\"display:flex;flex-direction:column;gap:15px;\"></div>');e.forEach((n,t)=>{const e=\"å·²å®Œæˆ\"===n[\"çŠ¶æ€\"]?\"#3a6b4a\":\"å·²å¤±è´¥\"===n[\"çŠ¶æ€\"]?\"#8a2c2c\":\"#c5a059\",a=`\\n                <div class=\"dnd-anim-entry\" style=\"animation-delay:${.05*t}s; background:var(--dnd-bg-panel);border:1px solid var(--dnd-border-inner);padding:15px;border-radius:4px;\">\\n                    <div style=\"display:flex;justify-content:space-between;margin-bottom:10px;\">\\n                        <span style=\"font-weight:bold;color:var(--dnd-text-header);font-size:18px;\">${n[\"ä»»åŠ¡åç§°\"]}</span>\\n                        <span style=\"background:${e};color:#fff;padding:2px 8px;border-radius:4px;font-size:12px;\">${n[\"çŠ¶æ€\"]}</span>\\n                    </div>\\n                    <div style=\"font-size:14px;color:var(--dnd-text-main);margin-bottom:8px;\">${n[\"ç›®æ ‡æè¿°\"]||\"\"}</div>\\n                    <div style=\"font-size:12px;color:var(--dnd-text-dim);\">\\n                        å‘å¸ƒè€…: ${n[\"å‘å¸ƒè€…\"]||\"-\"} | å¥–åŠ±: ${n[\"å¥–åŠ±\"]||\"-\"}\\n                    </div>\\n                </div>\\n            `;r.append(a)}),n.append(r)},renderCombatPanel(n){const{$:t}=a(),e=Rr.getTable(\"COMBAT_Encounter\"),r=Rr.getTable(\"COMBAT_BattleMap\"),o=t('<div style=\"display:flex;gap:20px;height:100%;\"></div>'),i=t('<div style=\"width:250px;background:rgba(0,0,0,0.3);padding:10px;overflow-y:auto;\"></div>'),d=t('<div class=\"dnd-map-container\"></div>');if(i.html('<h3 style=\"color:var(--dnd-text-header);border-bottom:1px solid var(--dnd-border-gold);padding-bottom:5px;\">å…ˆæ”»åˆ—è¡¨</h3>'),e){const n=[...e].sort((n,t)=>{const e=parseInt(n[\"å…ˆæ”»/ä½ç½®\"])||0;return(parseInt(t[\"å…ˆæ”»/ä½ç½®\"])||0)-e});n.forEach(n=>{const t=\"æ˜¯\"===n[\"æ˜¯å¦ä¸ºå½“å‰è¡ŒåŠ¨è€…\"],e=n[\"HPçŠ¶æ€\"]||\"??/??\",a=`\\n                    <div style=\"padding:8px;border-bottom:1px solid #333;display:flex;justify-content:space-between;${t?\"background:rgba(197, 160, 89, 0.2);border-left:3px solid var(--dnd-border-gold);\":\"\"}\">\\n                        <div>\\n                            <div style=\"font-weight:bold;color:${\"æ•Œæ–¹\"===n[\"é˜µè¥\"]?\"var(--dnd-accent-red)\":\"var(--dnd-text-main)\"}\">${n[\"å•ä½åç§°\"]}</div>\\n                            <div style=\"font-size:12px;color:#888;\">HP: ${e}</div>\\n                        </div>\\n                        <div style=\"font-size:16px;font-weight:bold;color:var(--dnd-text-header)\">${parseInt(n[\"å…ˆæ”»/ä½ç½®\"])||0}</div>\\n                    </div>\\n                `;i.append(a)})}else i.append('<div style=\"color:#666\">éæˆ˜æ–—çŠ¶æ€</div>');if(r&&r.length>0){const n=r.find(n=>\"Config\"===n[\"ç±»å‹\"]);let t=20,e=20;if(n&&n[\"åæ ‡\"]){const a=Rr.parseValue(n[\"åæ ‡\"],\"size\");a&&(a.w&&(t=a.w),a.h&&(e=a.h))}d.html('<div style=\"color:#888;padding:20px;text-align:center;\">ï¼ˆæˆ˜æ–—åœ°å›¾å·²éšè—ï¼Œè¯·ä½¿ç”¨ HUD æŸ¥çœ‹ï¼‰</div>')}else d.html('<div style=\"color:#666\">æ— åœ°å›¾æ•°æ®</div>');o.append(i).append(d),n.append(o)},renderInventoryPanel(n){const t=Rr.getTable(\"ITEM_Inventory\");if(!t||0===t.length)return void n.html('<div style=\"padding:20px;text-align:center;color:#888\"><i class=\"fa-solid fa-suitcase\"></i> èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿ</div>');const e={},r=[],o=new Set;t.forEach(n=>{(\"æ˜¯\"===n[\"å·²è£…å¤‡\"]||!0===n[\"å·²è£…å¤‡\"]||\"true\"===String(n[\"å·²è£…å¤‡\"]).toLowerCase())&&r.push(n);const t=n[\"ç±»åˆ«\"]||\"æ‚ç‰©\";o.add(t),e[t]||(e[t]=[]),e[t].push(n)});const i=[...o].sort(),{$:d}=a(),s=d('<div style=\"display:flex;flex-direction:column;gap:20px;\"></div>'),l=new Set;t.forEach(n=>{n[\"æ‰€å±äºº\"]&&l.add(n[\"æ‰€å±äºº\"])});const c=[...l].sort(),p=`\\n            <div style=\"background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;border:1px solid var(--dnd-border-inner);display:flex;gap:10px;align-items:center;\">\\n                <div style=\"font-weight:bold;color:var(--dnd-text-highlight);white-space:nowrap;\"><i class=\"fa-solid fa-search\"></i> æŸ¥æ‰¾ç‰©å“</div>\\n                <input type=\"text\" id=\"dnd-panel-inv-search\" placeholder=\"ç‰©å“åç§°...\" style=\"flex:1;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:6px 10px;border-radius:4px;\" oninput=\"window.DND_Dashboard_UI.filterPanelInventory()\">\\n                <select id=\"dnd-panel-inv-filter\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:6px;border-radius:4px;\" onchange=\"window.DND_Dashboard_UI.filterPanelInventory()\">\\n                    <option value=\"\">å…¨éƒ¨åˆ†ç±»</option>\\n                    ${i.map(n=>`<option value=\"${n}\">${n}</option>`).join(\"\")}\\n                </select>\\n                <select id=\"dnd-panel-inv-owner\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:6px;border-radius:4px;\" onchange=\"window.DND_Dashboard_UI.filterPanelInventory()\">\\n                    <option value=\"\">å…¨éƒ¨æŒæœ‰è€…</option>\\n                    ${c.map(n=>`<option value=\"${n}\">${n}</option>`).join(\"\")}\\n                    <option value=\"æ— \">æ— æŒæœ‰è€…</option>\\n                </select>\\n            </div>\\n        `;if(s.append(p),r.length>0){const n=d(`\\n                <div class=\"dnd-inv-section-equipped\" style=\"background:rgba(0,0,0,0.3);padding:15px;border-radius:6px;border:1px solid var(--dnd-border-gold);\">\\n                    <div style=\"font-size:16px;font-weight:bold;color:var(--dnd-text-header);margin-bottom:10px;display:flex;align-items:center;gap:10px;\">\\n                        <span><i class=\"fa-solid fa-shield-halved\"></i> å·²è£…å¤‡</span>\\n                        <span style=\"font-size:12px;background:var(--dnd-accent-green);color:#fff;padding:2px 6px;border-radius:4px;\">${r.length}</span>\\n                    </div>\\n                    <div class=\"dnd-grid\" style=\"grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important;\"></div>\\n                </div>\\n            `),t=n.find(\".dnd-grid\");r.forEach((n,e)=>{const a=this.renderItemCard(n,!0,.05*e),r=d(a);r.attr(\"data-name\",n[\"ç‰©å“åç§°\"]),r.attr(\"data-category\",n[\"ç±»åˆ«\"]||\"æ‚ç‰©\"),r.attr(\"data-owner\",n[\"æ‰€å±äºº\"]||\"\"),t.append(r)}),s.append(n)}Object.keys(e).forEach(n=>{const t=e[n],a=d(`\\n                <div class=\"dnd-inv-category\" data-category=\"${n}\" style=\"background:var(--dnd-bg-panel);border:1px solid var(--dnd-border-inner);border-radius:4px;overflow:hidden;\">\\n                    <div class=\"dnd-inv-header\" style=\"padding:10px 15px;background:rgba(255,255,255,0.05);cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\\n                        <span style=\"font-weight:bold;color:var(--dnd-text-main);\">${n} (${t.length})</span>\\n                        <span class=\"dnd-collapse-icon\" style=\"color:var(--dnd-text-dim)\">â–¼</span>\\n                    </div>\\n                    <div class=\"dnd-inv-body\" style=\"padding:15px;display:none;\">\\n                        <div class=\"dnd-grid\" style=\"grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important;\"></div>\\n                    </div>\\n                </div>\\n            `),r=a.find(\".dnd-grid\");t.forEach((t,e)=>{const a=this.renderItemCard(t,!1,.05*e),o=d(a);o.attr(\"data-name\",t[\"ç‰©å“åç§°\"]),o.attr(\"data-category\",n),o.attr(\"data-owner\",t[\"æ‰€å±äºº\"]||\"\"),r.append(o)}),a.find(\".dnd-inv-header\").on(\"click\",function(){const n=d(this).next(),t=d(this).find(\".dnd-collapse-icon\");n.is(\":visible\")?(n.slideUp(200),t.text(\"â–¼\")):(n.slideDown(200),t.text(\"â–²\"))}),s.append(a)}),n.html(s)},filterPanelInventory(){const{$:n}=a(),t=n(\"#dnd-panel-inv-search\").val().toLowerCase(),e=n(\"#dnd-panel-inv-filter\").val(),r=n(\"#dnd-panel-inv-owner\").val();n(\".dnd-item-card\").each(function(){const a=n(this),o=(a.attr(\"data-name\")||\"\").toLowerCase(),i=a.attr(\"data-category\")||\"\",d=a.attr(\"data-owner\")||\"\";(!t||o.includes(t))&&(!e||i===e)&&(!r||(\"æ— \"===r?!d:d===r))?a.show():a.hide()}),n(\".dnd-inv-category\").each(function(){const a=n(this),r=a.data(\"category\");if(e&&r!==e)return void a.hide();a.find(\".dnd-item-card:visible\").length>0?(a.show(),t&&(a.find(\".dnd-inv-body\").slideDown(200),a.find(\".dnd-collapse-icon\").text(\"â–²\"))):a.hide()})},renderWorldPanel(n){const t=Rr.getTable(\"SYS_GlobalState\");if(!t||!t[0])return void n.html(\"æ— ä¸–ç•Œæ•°æ®\");const e=t[0];n.html(`\\n            <div style=\"background:var(--dnd-bg-panel);padding:20px;border:1px solid var(--dnd-border-gold);\">\\n                <h2 style=\"color:var(--dnd-text-header);margin-top:0;\">${e[\"å½“å‰åœºæ™¯\"]}</h2>\\n                <p style=\"color:var(--dnd-text-main);\">${e[\"åœºæ™¯æè¿°\"]}</p>\\n                <hr style=\"border:0;border-bottom:1px solid #333;margin:15px 0;\">\\n                <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:10px;\">\\n                    <div><span style=\"color:#888\">æ—¶é—´:</span> ${e[\"æ¸¸æˆæ—¶é—´\"]}</div>\\n                    <div><span style=\"color:#888\">å¤©æ°”:</span> ${e[\"å¤©æ°”çŠ¶å†µ\"]}</div>\\n                    <div><span style=\"color:#888\">æˆ˜æ–—æ¨¡å¼:</span> ${e[\"æˆ˜æ–—æ¨¡å¼\"]}</div>\\n                </div>\\n            </div>\\n        `)},renderLogsPanel(n){const t=Rr.getTable(\"LOG_Summary\");if(!t)return void n.html(\"æ— æ—¥å¿—æ•°æ®\");let e='<div style=\"display:flex;flex-direction:column;gap:15px;\">';[...t].reverse().forEach(n=>{e+=`\\n            <div style=\"background:rgba(255,255,255,0.05);padding:15px;border-left:3px solid var(--dnd-border-gold);\">\\n                <div style=\"display:flex;justify-content:space-between;color:var(--dnd-text-dim);font-size:12px;margin-bottom:5px;\">\\n                    <span>${n[\"æ—¶é—´è·¨åº¦\"]} @ ${n[\"åœ°ç‚¹\"]}</span>\\n                    <span>${n[\"ç¼–ç ç´¢å¼•\"]}</span>\\n                </div>\\n                <div style=\"color:var(--dnd-text-main);line-height:1.5;\">${n[\"çºªè¦\"]}</div>\\n            </div>`}),e+=\"</div>\",n.html(e)},renderNPCPanel(n){const{$:t}=a(),e=Rr.getTable(\"NPC_Registry\");if(!e)return void n.html(\"æ—  NPC æ•°æ®\");const r=t('<div class=\"dnd-grid\"></div>');e.forEach((n,e)=>{const a=\"æ­»äº¡\"===n[\"å½“å‰çŠ¶æ€\"]?\"#8a2c2c\":\"åœ¨åœº\"===n[\"å½“å‰çŠ¶æ€\"]?\"#3a6b4a\":\"#888\",o=n.HP||\"\",i=o.match(/(\\d+)\\s*\\/\\s*(\\d+)/),d=i?parseInt(i[1]):0,s=i?parseInt(i[2]):1,l=Math.min(100,Math.max(0,d/s*100)),c=l>50?\"#4a7c59\":l>25?\"#b8860b\":\"#8a2c2c\",p=`\\n                <div class=\"dnd-char-card dnd-anim-entry dnd-clickable\" style=\"cursor:pointer; animation-delay:${.05*e}s\">\\n                    <div class=\"dnd-card-header\">\\n                        <span class=\"dnd-char-name\">${n[\"å§“å\"]||\"æœªçŸ¥\"}</span>\\n                        <span style=\"font-size:11px;\">\\n                            ${n[\"ç­‰çº§\"]?`<span style=\"color:#d4af37;margin-right:6px;\">Lv.${n[\"ç­‰çº§\"]}</span>`:\"\"}\\n                            <span style=\"color:${a}\">${n[\"å½“å‰çŠ¶æ€\"]||\"\"}</span>\\n                        </span>\\n                    </div>\\n                    <div class=\"dnd-card-body\">\\n                        <div style=\"font-size:12px;color:#aaa;margin-bottom:8px;\">${n[\"ç§æ—/æ€§åˆ«/å¹´é¾„\"]||\"-\"} | ${n[\"èŒä¸š/èº«ä»½\"]||\"-\"}</div>\\n                        \\n                        ${o?`\\n                        <div style=\"margin-bottom:8px;\">\\n                            <div style=\"display:flex;justify-content:space-between;font-size:11px;margin-bottom:2px;\">\\n                                <span style=\"color:#888;\">HP</span>\\n                                <span style=\"color:#ccc;\">${o}${n.AC?` | AC ${n.AC}`:\"\"}</span>\\n                            </div>\\n                            <div style=\"background:#1a1a1a;border-radius:3px;height:6px;overflow:hidden;\">\\n                                <div style=\"width:${l}%;height:100%;background:${c};transition:width 0.3s;\"></div>\\n                            </div>\\n                        </div>\\n                        `:n.AC?`<div style=\"font-size:11px;color:#888;margin-bottom:8px;\">AC ${n.AC}</div>`:\"\"}\\n                        \\n                        <div class=\"dnd-stat-row\">\\n                            <span class=\"dnd-stat-label\">ä½ç½®</span>\\n                            <span class=\"dnd-stat-val\">${n[\"æ‰€åœ¨ä½ç½®\"]||\"-\"}</span>\\n                        </div>\\n                        <div class=\"dnd-stat-row\">\\n                            <span class=\"dnd-stat-label\">å…³ç³»</span>\\n                            <span class=\"dnd-stat-val\">${n[\"ä¸ä¸»è§’å…³ç³»\"]||\"-\"}</span>\\n                        </div>\\n                        <div style=\"margin-top:10px;font-size:13px;line-height:1.4;color:#ccc;max-height:60px;overflow:hidden;\">\\n                            ${n[\"å¤–è²Œæè¿°\"]||\"\"}\\n                        </div>\\n                    </div>\\n                </div>\\n            `,g=t(p);g.on(\"click\",()=>{let t=\"\";if((n[\"ç­‰çº§\"]||n.HP||n.AC)&&(t+='<div style=\"background:rgba(0,0,0,0.3);padding:12px;border-radius:6px;margin-bottom:15px;\">',t+='<div style=\"display:flex;gap:20px;flex-wrap:wrap;\">',n[\"ç­‰çº§\"]&&(t+=`<div><span style=\"color:#888;font-size:11px;\">ç­‰çº§</span><br><span style=\"color:#d4af37;font-size:16px;font-weight:bold;\">Lv.${n[\"ç­‰çº§\"]}</span></div>`),n.HP&&(t+=`<div><span style=\"color:#888;font-size:11px;\">ç”Ÿå‘½å€¼</span><br><span style=\"color:#c94c4c;font-size:16px;font-weight:bold;\">${n.HP}</span></div>`),n.AC&&(t+=`<div><span style=\"color:#888;font-size:11px;\">æŠ¤ç”²</span><br><span style=\"color:#6a9fb5;font-size:16px;font-weight:bold;\">AC ${n.AC}</span></div>`),t+=\"</div></div>\"),n[\"ä¸»è¦æŠ€èƒ½\"]){t+='<div style=\"margin-bottom:12px;\"><strong style=\"color:#d4af37;\">ä¸»è¦æŠ€èƒ½:</strong><br>';const e=n[\"ä¸»è¦æŠ€èƒ½\"].split(/[,ï¼Œ]/).map(n=>n.trim()).filter(n=>n);t+='<div style=\"display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;\">',e.forEach(n=>{t+=`<span style=\"background:rgba(212,175,55,0.15);color:#d4af37;padding:3px 8px;border-radius:4px;font-size:12px;\">${n}</span>`}),t+=\"</div></div>\"}if(n[\"éšèº«ç‰©å“\"]){t+='<div style=\"margin-bottom:12px;\"><strong style=\"color:#8b7355;\">éšèº«ç‰©å“:</strong><br>';const e=n[\"éšèº«ç‰©å“\"].split(/[,ï¼Œ]/).map(n=>n.trim()).filter(n=>n);t+='<div style=\"display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;\">',e.forEach(n=>{t+=`<span style=\"background:rgba(139,115,85,0.15);color:#c9a86c;padding:3px 8px;border-radius:4px;font-size:12px;\">${n}</span>`}),t+=\"</div></div>\"}t+=`<div style=\"margin-bottom:10px\"><strong>å…³é”®ç»å†:</strong><br><span style=\"color:#aaa;\">${n[\"å…³é”®ç»å†\"]||\"æ— \"}</span></div>`,t+=`<div style=\"margin-bottom:10px\"><strong>å¤–è²Œ:</strong><br><span style=\"color:#aaa;\">${n[\"å¤–è²Œæè¿°\"]||\"æ— \"}</span></div>`,t+=`<div style=\"margin-top:20px;font-size:10px;color:#666\">ID: ${n.NPC_ID}</div>`,this.showModal(n[\"å§“å\"],t)}),r.append(g)}),n.append(r)},showModal(n,t){const{$:e}=a(),r=e(\"#dnd-modal-overlay\"),o=e(\"#dnd-modal-content\");o.html(`\\n            <div class=\"dnd-modal-header\" style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;border-bottom:1px solid var(--dnd-border-gold);padding-bottom:12px;\">\\n                <h3 style=\"margin:0;color:var(--dnd-text-highlight);font-size:18px;\">${n}</h3>\\n                <span class=\"dnd-modal-close\" style=\"cursor:pointer;font-size:20px;color:#888;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all 0.2s;\">âœ•</span>\\n            </div>\\n            <div class=\"dnd-modal-body\" style=\"max-height:60vh;overflow-y:auto;padding-right:5px;text-align: left;\">${t}</div>\\n        `),o.find(\".dnd-modal-close\").on(\"click\",function(){r.removeClass(\"active\")}).on(\"mouseenter\",function(){e(this).css({background:\"rgba(255,255,255,0.1)\",color:\"var(--dnd-text-highlight)\"})}).on(\"mouseleave\",function(){e(this).css({background:\"transparent\",color:\"#888\"})}),r.addClass(\"active\")},renderArchivesPanel(n){const{$:t}=a(),e=Rr.getAllData();if(!e)return void n.html(\"æ— æ•°æ®\");const r=t('<div style=\"margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;\"></div>'),o=t('<div style=\"overflow-x:auto;\"></div>');Object.keys(e).forEach(n=>{if(\"mate\"===n)return;const a=e[n],i=t(`<button style=\"padding:5px 10px;background:#333;border:1px solid #555;color:#ccc;cursor:pointer;\">${a.name||n}</button>`);i.on(\"click\",()=>{let n=`<h3 style=\"color:var(--dnd-text-highlight)\">${a.name}</h3>`;n+='<table class=\"dnd-table\"><thead><tr>',a.content&&a.content.length>0?(a.content[0].forEach(t=>n+=`<th>${t||\"\"}</th>`),n+=\"</tr></thead><tbody>\",a.content.slice(1).forEach(t=>{n+=\"<tr>\",t.forEach(t=>n+=`<td>${t||\"\"}</td>`),n+=\"</tr>\"}),n+=\"</tbody></table>\"):n+=\"<p>ç©ºè¡¨</p>\",o.html(n),r.children().css(\"border-color\",\"#555\"),i.css(\"border-color\",\"var(--dnd-border-gold)\")}),r.append(i)}),n.append(r).append(o)},exportPartyToFile(){try{const n=Rr.exportPartyData();if(!n)return void jr.error(\"æ— æ•°æ®å¯å¯¼å‡º\");const t=new Blob([JSON.stringify(n,null,2)],{type:\"application/json\"}),e=URL.createObjectURL(t),a=document.createElement(\"a\");a.href=e,a.download=`DND_Party_${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(e),jr.success(\"å·²å¯¼å‡ºé˜Ÿä¼æ•°æ®\")}catch(t){n.error(\"Export failed:\",t),jr.error(\"å¯¼å‡ºå¤±è´¥: \"+t.message)}},importPartyFromFile(){const t=document.createElement(\"input\");t.type=\"file\",t.accept=\".json\",t.onchange=t=>{const e=t.target.files[0];if(!e)return;const a=new FileReader;a.onload=async t=>{try{const n=JSON.parse(t.target.result),e=await Rr.importPartyData(n);e.success?(jr.success(e.message),this.renderPanel(\"party\")):jr.error(e.message)}catch(t){n.error(\"Import parse error:\",t),jr.error(\"æ–‡ä»¶è§£æå¤±è´¥\")}},a.readAsText(e)},t.click()},importFVTTFromFile(){const t=document.createElement(\"input\");t.type=\"file\",t.accept=\".json\",t.onchange=t=>{const e=t.target.files[0];if(!e)return;const a=new FileReader;a.onload=async t=>{try{const n=JSON.parse(t.target.result),e=await Rr.importFVTTData(n);e.success?(jr.success(e.message),this.renderPanel(\"party\")):jr.error(e.message)}catch(t){n.error(\"FVTT Import error:\",t),jr.error(\"FVTT æ–‡ä»¶è§£æå¤±è´¥\")}},a.readAsText(e)},t.click()},renderQuickInventory(n){const{$:t}=a(),e=Rr.getTable(\"ITEM_Inventory\");if(!e)return;const r=[],o=[];if(e.forEach(n=>{const t=\"æ˜¯\"===n[\"å·²è£…å¤‡\"]||!0===n[\"å·²è£…å¤‡\"]||\"true\"===String(n[\"å·²è£…å¤‡\"]).toLowerCase(),e=n[\"ç±»åˆ«\"]||\"\";t?r.push(n):(e.includes(\"æ¶ˆè€—\")||e.includes(\"è¯æ°´\")||e.includes(\"å·è½´\")||e.includes(\"é£Ÿç‰©\"))&&o.push(n)}),0===r.length&&0===o.length)return;let i='<div style=\"padding:5px 10px;border-top:1px solid rgba(255,255,255,0.05);\">';o.length>0&&(i+='<div style=\"display:flex;gap:5px;overflow-x:auto;padding-bottom:2px;\">',o.forEach((n,t)=>{const e=n[\"ç‰©å“ID\"]||n[\"ç‰©å“åç§°\"];i+=`\\n                    <div class=\"dnd-quick-item dnd-clickable dnd-hud-entry dnd-hover-lift\" data-id=\"${e}\" title=\"[${n[\"æ•°é‡\"]}] ${n[\"ç‰©å“åç§°\"]}\" style=\"animation-delay:${.03*t}s; padding:2px 6px;background:rgba(255,255,255,0.05);border:1px solid #444;border-radius:10px;font-size:10px;white-space:nowrap;cursor:pointer;flex-shrink:0;\">\\n                        ${n[\"ç‰©å“åç§°\"]} x${n[\"æ•°é‡\"]}\\n                    </div>\\n                `}),i+=\"</div>\"),i+=\"</div>\";const d=t(i),s=this;d.find(\".dnd-quick-item\").on(\"click\",function(n){n.stopPropagation();const a=t(this).data(\"id\"),r=e.find(n=>n[\"ç‰©å“ID\"]===a||n[\"ç‰©å“åç§°\"]===a);r&&s.showMiniItemActions(r,n)}),n.append(d)}},so={async renderSettingsPanel(e){const{$:i}=a(),d=o.PRESET_SWITCHING,s=Wr.getAvailablePresets(),l=await to(),c=await ao(),p=await t.getSetting(o.STORAGE_KEYS.UI_SCALE)||o.UI_SCALE.DEFAULT,g=Rr.getAllData()||{},f=Object.keys(g).filter(n=>n.startsWith(\"sheet_\")||g[n].name&&g[n].mate),b=await t.getSetting(\"dnd_tm_cols\")||\"auto\",m=await t.getSetting(\"dnd_tm_hidden_tables\"),u=m?JSON.parse(m):[],h=await t.getSetting(o.STORAGE_KEYS.DYNAMIC_BG),x=h?JSON.parse(h):o.DYNAMIC_BG,v=Vr.getAvailableEffects(),y=n=>{let t='<option value=\"\">-- æ‰‹åŠ¨è¾“å…¥ --</option>';return s.forEach(e=>{t+=`<option value=\"${e}\" ${e===n?\"selected\":\"\"}>${e}</option>`}),t},w=`\\n            <div style=\"padding:20px; max-width: 600px;\">\\n                <h2 style=\"color:var(--dnd-text-highlight);border-bottom:1px solid var(--dnd-border-gold);padding-bottom:10px;margin-top:0;\">\\n                    âš™ï¸ ä»ªè¡¨ç›˜è®¾ç½®\\n                </h2>\\n\\n                \\x3c!-- åŒæ­¥çŠ¶æ€ --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:15px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;\">\\n                    <div>\\n                        <div style=\"color:var(--dnd-text-header);font-weight:bold;margin-bottom:5px;\">â˜ï¸ äº‘åŒæ­¥çŠ¶æ€</div>\\n                        <div style=\"color:#888;font-size:12px;\">é…ç½®å°†è‡ªåŠ¨åŒæ­¥åˆ°é…’é¦†æœåŠ¡å™¨</div>\\n                    </div>\\n                    <div style=\"display:flex;align-items:center;gap:10px;\">\\n                        <span id=\"dnd-sync-badge\" class=\"dnd-badge dnd-badge-${c.statusClass}\" style=\"padding:4px 8px;\">${c.statusText}</span>\\n                        <button type=\"button\" id=\"dnd-sync-force\" style=\"background:transparent;border:1px solid #555;color:#ccc;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px;\" title=\"å¼ºåˆ¶åŒæ­¥\">ğŸ”„</button>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- ç•Œé¢æ˜¾ç¤ºè®¾ç½® --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ’» ç•Œé¢æ˜¾ç¤º</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        è°ƒæ•´ä»ªè¡¨ç›˜å’Œæ‚¬æµ®çƒçš„å¤§å°æ¯”ä¾‹ï¼Œé€‚é…ä¸åŒåˆ†è¾¨ç‡çš„å±å¹•ã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:10px;\">\\n                        <label style=\"display:flex;justify-content:space-between;margin-bottom:5px;color:var(--dnd-text-main);\">\\n                            <span>ç¼©æ”¾æ¯”ä¾‹ (Scale)</span>\\n                            <span id=\"dnd-scale-value\" style=\"color:var(--dnd-text-highlight);\">${p}</span>\\n                        </label>\\n                        <div style=\"display:flex;gap:10px;align-items:center;\">\\n                            <input type=\"range\" id=\"dnd-set-ui-scale\"\\n                                min=\"${o.UI_SCALE.MIN}\" max=\"${o.UI_SCALE.MAX}\" step=\"${o.UI_SCALE.STEP}\" value=\"${p}\"\\n                                style=\"flex:1;cursor:pointer;\">\\n                            <button type=\"button\" id=\"dnd-reset-scale\" style=\"padding:4px 8px;background:#333;border:1px solid #555;color:#ccc;border-radius:4px;cursor:pointer;font-size:12px;\">é‡ç½®</button>\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- é…è‰²æ¨¡æ¿è®¾ç½® --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ¨ é…è‰²æ¨¡æ¿</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        é€‰æ‹©é¢„è®¾ä¸»é¢˜æˆ–è‡ªå®šä¹‰é…è‰²ï¼Œè®©ç•Œé¢é£æ ¼æ›´ç¬¦åˆä½ çš„å–œå¥½ã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:15px;\">\\n                        <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">é¢„è®¾ä¸»é¢˜</label>\\n                        <select id=\"dnd-theme-preset\" style=\"width:100%;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                            ${Ur.getList().map(n=>`<option value=\"${n.id}\" ${n.id===Ur.currentTheme?\"selected\":\"\"}>${n.icon||\"ğŸ¨\"} ${n.name}</option>`).join(\"\")}\\n                        </select>\\n                    </div>\\n                    \\n                    <div style=\"margin-bottom:15px;\">\\n                        <label style=\"display:flex;align-items:center;cursor:pointer;\">\\n                            <input type=\"checkbox\" id=\"dnd-custom-color-enabled\" ${\"custom\"===Ur.currentTheme?\"checked\":\"\"} style=\"margin-right:10px;transform:scale(1.2);\">\\n                            <span style=\"font-weight:bold;\">å¯ç”¨è‡ªå®šä¹‰é…è‰²</span>\\n                        </label>\\n                    </div>\\n                    \\n                    <div id=\"dnd-custom-color-panel\" style=\"opacity:${\"custom\"===Ur.currentTheme?1:.5};pointer-events:${\"custom\"===Ur.currentTheme?\"auto\":\"none\"};transition:all 0.3s;\">\\n                        <div style=\"display:grid;grid-template-columns:repeat(2, 1fr);gap:10px;margin-bottom:15px;\">\\n                            ${(()=>{const n=Ur.getEditableVars();return Object.entries(n).map(([n,t])=>`\\n                                    <div style=\"display:flex;align-items:center;gap:8px;\">\\n                                        <input type=\"color\" class=\"dnd-color-picker\" data-var=\"${n}\" value=\"${t.value.replace(/^#/,\"#\").substring(0,7)}\"\\n                                            style=\"width:32px;height:32px;border:1px solid #444;border-radius:4px;cursor:pointer;background:transparent;padding:0;\">\\n                                        <span style=\"color:#ccc;font-size:12px;flex:1;\">${t.label}</span>\\n                                    </div>\\n                                `).join(\"\")})()}\\n                        </div>\\n                        \\n                        <div style=\"display:flex;gap:10px;flex-wrap:wrap;\">\\n                            <button type=\"button\" id=\"dnd-color-reset\" style=\"\\n                                background:rgba(231, 76, 60, 0.2);\\n                                border:1px solid #e74c3c;\\n                                color:#e74c3c;\\n                                padding:6px 12px;\\n                                border-radius:4px;\\n                                cursor:pointer;\\n                                font-size:12px;\\n                            \">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</button>\\n                            <button type=\"button\" id=\"dnd-color-export\" style=\"\\n                                background:rgba(52, 152, 219, 0.2);\\n                                border:1px solid #3498db;\\n                                color:#3498db;\\n                                padding:6px 12px;\\n                                border-radius:4px;\\n                                cursor:pointer;\\n                                font-size:12px;\\n                            \">ğŸ“¤ å¯¼å‡ºé…è‰²</button>\\n                            <button type=\"button\" id=\"dnd-color-import\" style=\"\\n                                background:rgba(46, 204, 113, 0.2);\\n                                border:1px solid #2ecc71;\\n                                color:#2ecc71;\\n                                padding:6px 12px;\\n                                border-radius:4px;\\n                                cursor:pointer;\\n                                font-size:12px;\\n                            \">ğŸ“¥ å¯¼å…¥é…è‰²</button>\\n                        </div>\\n                        <input type=\"file\" id=\"dnd-color-import-input\" accept=\".json\" style=\"display:none;\">\\n                        \\n                        <div id=\"dnd-color-preview\" style=\"margin-top:15px;padding:15px;border-radius:6px;border:1px solid var(--dnd-border-inner);background:var(--dnd-bg-card);\">\\n                            <div style=\"font-weight:bold;margin-bottom:8px;color:var(--dnd-text-header);\">é…è‰²é¢„è§ˆ</div>\\n                            <div style=\"display:flex;gap:10px;flex-wrap:wrap;\">\\n                                <span class=\"dnd-badge dnd-badge-success\" style=\"padding:4px 8px;\">æˆåŠŸ</span>\\n                                <span class=\"dnd-badge dnd-badge-warning\" style=\"padding:4px 8px;\">è­¦å‘Š</span>\\n                                <span class=\"dnd-badge dnd-badge-error\" style=\"padding:4px 8px;\">é”™è¯¯</span>\\n                            </div>\\n                            <div style=\"margin-top:10px;padding:8px;background:rgba(0,0,0,0.3);border-radius:4px;\">\\n                                <span style=\"color:var(--dnd-text-main);\">ä¸»æ–‡æœ¬</span> Â·\\n                                <span style=\"color:var(--dnd-text-highlight);\">é«˜äº®æ–‡æœ¬</span> Â·\\n                                <span style=\"color:var(--dnd-text-dim);\">æ¬¡è¦æ–‡æœ¬</span>\\n                            </div>\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- é£æ ¼ç®¡ç† --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ­ é£æ ¼ç®¡ç†</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        é€‰æ‹©å®Œæ•´çš„è§†è§‰é£æ ¼ä¸»é¢˜ï¼ŒåŒ…å«é¢œè‰²ã€å°ºå¯¸ã€åœ†è§’ã€åŠ¨ç”»ç­‰å…¨å¥—é…ç½®ã€‚\\n                        é£æ ¼æ˜¯æ¯”é…è‰²æ›´å®Œæ•´çš„è§†è§‰æ–¹æ¡ˆï¼Œèƒ½è®©ç•Œé¢çœ‹èµ·æ¥ç„•ç„¶ä¸€æ–°ã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:15px;\">\\n                        <label style=\"display:block;margin-bottom:8px;color:var(--dnd-text-main);\">å½“å‰é£æ ¼</label>\\n                        <div style=\"display:flex;align-items:center;gap:10px;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;border:1px solid var(--dnd-border-inner);\">\\n                            <span style=\"font-size:24px;\">${Xr.getCurrentStyle().icon||\"ğŸ¨\"}</span>\\n                            <div style=\"flex:1;\">\\n                                <div style=\"font-weight:bold;color:var(--dnd-text-header);\">${Xr.getCurrentStyle().name||\"ç»å…¸DND\"}</div>\\n                                <div style=\"font-size:11px;color:#888;\">${Xr.getCurrentStyle().description||\"\"}</div>\\n                            </div>\\n                        </div>\\n                    </div>\\n                    \\n                    <div style=\"margin-bottom:15px;\">\\n                        <label style=\"display:block;margin-bottom:8px;color:var(--dnd-text-main);\">å¯ç”¨é£æ ¼</label>\\n                        <div id=\"dnd-style-grid\" style=\"display:grid;grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));gap:10px;\">\\n                            ${Xr.getAvailableStyles().map(n=>`\\n                                <div class=\"dnd-style-card ${n.id===Xr.currentStyleId?\"active\":\"\"}\"\\n                                     data-style-id=\"${n.id}\">\\n                                    <div style=\"font-size:28px;margin-bottom:6px;\">${n.icon||\"ğŸ¨\"}</div>\\n                                    <div style=\"font-size:12px;font-weight:bold;color:${n.id===Xr.currentStyleId?\"var(--dnd-text-highlight)\":\"var(--dnd-text-main)\"};\">${n.name}</div>\\n                                    ${n.isCustom?'<div style=\"font-size:9px;color:#888;margin-top:2px;\">è‡ªå®šä¹‰</div>':\"\"}\\n                                    ${n.id===Xr.currentStyleId?'<div style=\"font-size:9px;color:var(--dnd-text-highlight);margin-top:2px;\">âœ“ å½“å‰</div>':\"\"}\\n                                </div>\\n                            `).join(\"\")}\\n                        </div>\\n                    </div>\\n                    \\n                    <div style=\"display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;\">\\n                        <button type=\"button\" id=\"dnd-style-import\" style=\"\\n                            background:rgba(46, 204, 113, 0.2);\\n                            border:1px solid #2ecc71;\\n                            color:#2ecc71;\\n                            padding:8px 16px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:12px;\\n                        \">ğŸ“¥ å¯¼å…¥é£æ ¼åŒ…</button>\\n                        <button type=\"button\" id=\"dnd-style-export\" style=\"\\n                            background:rgba(52, 152, 219, 0.2);\\n                            border:1px solid #3498db;\\n                            color:#3498db;\\n                            padding:8px 16px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:12px;\\n                        \">ğŸ“¤ å¯¼å‡ºå½“å‰é£æ ¼</button>\\n                        <button type=\"button\" id=\"dnd-style-reset\" style=\"\\n                            background:rgba(231, 76, 60, 0.2);\\n                            border:1px solid #e74c3c;\\n                            color:#e74c3c;\\n                            padding:8px 16px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:12px;\\n                        \">ğŸ”„ æ¢å¤é»˜è®¤</button>\\n                    </div>\\n                    <input type=\"file\" id=\"dnd-style-import-input\" accept=\".json\" style=\"display:none;\">\\n                    \\n                    <div style=\"padding:10px;background:rgba(52, 152, 219, 0.1);border:1px solid rgba(52, 152, 219, 0.3);border-radius:4px;\">\\n                        <div style=\"font-size:11px;color:#888;\">\\n                            ğŸ’¡ <strong>æç¤º:</strong> é£æ ¼åŒ…æ˜¯å®Œæ•´çš„è§†è§‰ä¸»é¢˜é…ç½®ã€‚å¦‚æœæ‚¨åªæƒ³å¾®è°ƒé¢œè‰²ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šæ–¹çš„\"é…è‰²æ¨¡æ¿\"åŠŸèƒ½ã€‚\\n                            é£æ ¼å’Œé…è‰²å¯ä»¥å åŠ ä½¿ç”¨ â€”â€” å…ˆé€‰æ‹©å–œæ¬¢çš„é£æ ¼ï¼Œå†é€šè¿‡é…è‰²è¿›è¡Œä¸ªæ€§åŒ–è°ƒæ•´ã€‚\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- åŠ¨æ€èƒŒæ™¯è®¾ç½® --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">âœ¨ åŠ¨æ€èƒŒæ™¯</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        ä¸ºç•Œé¢æ·»åŠ åŠ¨æ€èƒŒæ™¯æ•ˆæœï¼Œç±»ä¼¼æ¸¸æˆUIè®¾è®¡ï¼Œè®©èƒŒæ™¯ä¸å†å•è°ƒã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:15px;\">\\n                        <label style=\"display:flex;align-items:center;cursor:pointer;\">\\n                            <input type=\"checkbox\" id=\"dnd-bg-enabled\" ${x.enabled?\"checked\":\"\"} style=\"margin-right:10px;transform:scale(1.2);\">\\n                            <span style=\"font-weight:bold;\">å¯ç”¨åŠ¨æ€èƒŒæ™¯</span>\\n                        </label>\\n                    </div>\\n                    \\n                    <div class=\"dnd-bg-group\" style=\"opacity:${x.enabled?1:.5};pointer-events:${x.enabled?\"auto\":\"none\"};transition:all 0.3s;\">\\n                        <div style=\"margin-bottom:15px;\">\\n                            <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">èƒŒæ™¯æ•ˆæœ</label>\\n                            <select id=\"dnd-bg-type\" style=\"width:100%;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                                ${v.map(n=>`<option value=\"${n.id}\" ${n.id===x.type?\"selected\":\"\"}>${n.icon||\"âœ¨\"} ${n.name}</option>`).join(\"\")}\\n                            </select>\\n                        </div>\\n                        \\n                        <div style=\"margin-bottom:10px;\">\\n                            <label style=\"display:flex;justify-content:space-between;margin-bottom:5px;color:var(--dnd-text-main);\">\\n                                <span>æ•ˆæœå¼ºåº¦</span>\\n                                <span id=\"dnd-bg-intensity-value\" style=\"color:var(--dnd-text-highlight);\">${x.intensity||1}</span>\\n                            </label>\\n                            <input type=\"range\" id=\"dnd-bg-intensity\" min=\"0.3\" max=\"2.0\" step=\"0.1\" value=\"${x.intensity||1}\" style=\"width:100%;cursor:pointer;\">\\n                        </div>\\n                        \\n                        <div id=\"dnd-bg-preview\" style=\"margin-top:15px;height:80px;border-radius:6px;border:1px solid var(--dnd-border-inner);overflow:hidden;position:relative;\">\\n                            <div style=\"position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#666;font-size:12px;\">æ•ˆæœé¢„è§ˆ</div>\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- API é…ç½® --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ”Œ API è¿æ¥é…ç½®</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        é…ç½® OpenAI å…¼å®¹ APIï¼Œç”¨äºè§’è‰²ç”Ÿæˆå’Œåœ°å›¾ç»˜åˆ¶ã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:10px;\">\\n                        <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">API åœ°å€ (URL)</label>\\n                        <input type=\"text\" id=\"dnd-set-api-url\" value=\"${l.url||\"\"}\" placeholder=\"https://api.openai.com/v1\" style=\"width:100%;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                    </div>\\n                    \\n                    <div style=\"margin-bottom:10px;\">\\n                        <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">API å¯†é’¥ (Key)</label>\\n                        <input type=\"password\" id=\"dnd-set-api-key\" value=\"${l.key||\"\"}\" placeholder=\"sk-...\" style=\"width:100%;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                    </div>\\n                    \\n                    <div style=\"margin-bottom:10px;\">\\n                        <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">æ¨¡å‹åç§° (Model)</label>\\n                        <div style=\"display:flex;gap:10px;\">\\n                            <input type=\"text\" id=\"dnd-set-api-model\" value=\"${l.model||\"\"}\" placeholder=\"gpt-3.5-turbo\" style=\"flex:1;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                            <button type=\"button\" id=\"dnd-set-fetch-models\" style=\"padding:0 15px;background:#333;border:1px solid #555;color:#ccc;border-radius:4px;cursor:pointer;\">è·å–åˆ—è¡¨</button>\\n                        </div>\\n                        \\x3c!-- æ¨¡å‹ä¸‹æ‹‰åˆ—è¡¨å®¹å™¨ --\\x3e\\n                        <div id=\"dnd-model-list-container\" style=\"display:none;margin-top:5px;\">\\n                            <select id=\"dnd-set-model-select\" style=\"width:100%;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                                <option value=\"\">-- é€‰æ‹©æ¨¡å‹ --</option>\\n                            </select>\\n                        </div>\\n                    </div>\\n                </div>\\n                \\n                \\x3c!-- è¡¨æ ¼ç®¡ç†è®¾ç½® --\\x3e\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);margin-bottom:20px;\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ“‹ è¡¨æ ¼ç®¡ç†</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        è‡ªå®šä¹‰è¡¨æ ¼ç®¡ç†æ¨¡å—çš„å¸ƒå±€å’Œæ˜¾ç¤ºå†…å®¹ã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:15px;\">\\n                        <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">æ¯è¡ŒæŒ‰é’®æ•°</label>\\n                        <select id=\"dnd-tm-cols-setting\" style=\"width:100%;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;\">\\n                            <option value=\"auto\" ${\"auto\"===b?\"selected\":\"\"}>è‡ªåŠ¨ (Auto)</option>\\n                            <option value=\"2\" ${2==b?\"selected\":\"\"}>2 åˆ—</option>\\n                            <option value=\"3\" ${3==b?\"selected\":\"\"}>3 åˆ—</option>\\n                            <option value=\"4\" ${4==b?\"selected\":\"\"}>4 åˆ—</option>\\n                            <option value=\"5\" ${5==b?\"selected\":\"\"}>5 åˆ—</option>\\n                        </select>\\n                    </div>\\n\\n                    <div style=\"margin-bottom:10px;\">\\n                        <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">å¯è§è¡¨æ ¼</label>\\n                        <div style=\"background:rgba(0,0,0,0.2);border:1px solid #444;border-radius:4px;padding:10px;max-height:150px;overflow-y:auto;\">\\n                            ${f.length>0?f.map(n=>{const t=g[n].name||n;return`\\n                                    <label style=\"display:flex;align-items:center;margin-bottom:5px;cursor:pointer;\">\\n                                        <input type=\"checkbox\" class=\"dnd-tm-visible-check\" value=\"${n}\" ${!u.includes(n)?\"checked\":\"\"} style=\"margin-right:8px;\">\\n                                        <span style=\"color:#ccc;font-size:12px;\">${t}</span>\\n                                    </label>\\n                                `}).join(\"\"):'<div style=\"color:#666;font-size:12px;\">æš‚æ— å¯ç”¨è¡¨æ ¼</div>'}\\n                        </div>\\n                    </div>\\n                </div>\\n\\n                <div style=\"background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ” è‡ªåŠ¨é¢„è®¾åˆ‡æ¢</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:20px;\">\\n                        æ ¹æ®æ¸¸æˆå†…çš„æˆ˜æ–—çŠ¶æ€ï¼ˆå…¨å±€çŠ¶æ€è¡¨ä¸­çš„\"æˆ˜æ–—æ¨¡å¼\"å­—æ®µï¼‰ï¼Œè‡ªåŠ¨åˆ‡æ¢é…’é¦†çš„ Plot/World Info é¢„è®¾ã€‚\\n                    </p>\\n                    \\n                    <div style=\"margin-bottom:20px;\">\\n                        <label style=\"display:flex;align-items:center;cursor:pointer;\">\\n                            <input type=\"checkbox\" id=\"dnd-cfg-enabled\" ${d.ENABLED?\"checked\":\"\"} style=\"margin-right:10px;transform:scale(1.2);\">\\n                            <span style=\"font-weight:bold;\">å¯ç”¨è‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½</span>\\n                        </label>\\n                    </div>\\n                    \\n                    <div class=\"dnd-cfg-group\" style=\"opacity:${d.ENABLED?1:.5};pointer-events:${d.ENABLED?\"auto\":\"none\"};transition:all 0.3s;\">\\n                        <div style=\"margin-bottom:15px;\">\\n                            <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">âš”ï¸ æˆ˜æ–—çŠ¶æ€é¢„è®¾</label>\\n                            <div style=\"display:flex;gap:10px;\">\\n                                <select id=\"dnd-cfg-combat-sel\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;flex:1;\">\\n                                    ${y(d.COMBAT_PRESET)}\\n                                </select>\\n                                <input type=\"text\" id=\"dnd-cfg-combat-input\" value=\"${d.COMBAT_PRESET}\" placeholder=\"é¢„è®¾åç§°\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;flex:1;\">\\n                            </div>\\n                        </div>\\n                        \\n                        <div style=\"margin-bottom:20px;\">\\n                            <label style=\"display:block;margin-bottom:5px;color:var(--dnd-text-main);\">ğŸ§­ æ¢ç´¢çŠ¶æ€é¢„è®¾</label>\\n                            <div style=\"display:flex;gap:10px;\">\\n                                <select id=\"dnd-cfg-explore-sel\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;flex:1;\">\\n                                    ${y(d.EXPLORE_PRESET)}\\n                                </select>\\n                                <input type=\"text\" id=\"dnd-cfg-explore-input\" value=\"${d.EXPLORE_PRESET}\" placeholder=\"é¢„è®¾åç§°\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:8px;border-radius:4px;flex:1;\">\\n                            </div>\\n                        </div>\\n                    </div>\\n                    \\n                    <div style=\"border-top:1px solid var(--dnd-border-inner);padding-top:20px;display:flex;justify-content:flex-end;gap:10px;\">\\n                        <button type=\"button\" id=\"dnd-cfg-refresh-presets\" style=\"\\n                            background:rgba(52, 152, 219, 0.2);\\n                            border:1px solid #3498db;\\n                            color:#3498db;\\n                            padding:10px 15px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:13px;\\n                        \">ğŸ”„ åˆ·æ–°é¢„è®¾åˆ—è¡¨</button>\\n                        <button type=\"button\" id=\"dnd-cfg-save\" style=\"\\n                            background:linear-gradient(135deg, var(--dnd-accent-green), #27ae60);\\n                            border:none;\\n                            color:#fff;\\n                            padding:10px 25px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-weight:bold;\\n                            font-size:14px;\\n                            display:flex;align-items:center;gap:5px;\\n                        \">ğŸ’¾ ä¿å­˜è®¾ç½®</button>\\n                    </div>\\n                </div>\\n\\n                \\x3c!-- å­˜å‚¨è¯Šæ–­å·¥å…· --\\x3e\\n                <div style=\"margin-top:20px;background:rgba(0,0,0,0.3);padding:20px;border-radius:6px;border:1px solid var(--dnd-border-inner);\">\\n                    <h3 style=\"color:var(--dnd-text-header);margin-top:0;\">ğŸ’¾ å­˜å‚¨ç©ºé—´ç®¡ç†</h3>\\n                    <p style=\"color:#888;font-size:13px;margin-bottom:15px;\">\\n                        æ£€æŸ¥ LocalStorage ä½¿ç”¨æƒ…å†µï¼Œæˆ–æ¸…ç† IndexedDB ä¸­çš„ç¼“å­˜æ•°æ®ï¼ˆå›¾ç‰‡å’Œåœ°å›¾ï¼‰ã€‚\\n                    </p>\\n                    <div id=\"dnd-storage-stats\" style=\"margin-bottom:15px;font-size:12px;color:#ccc;\"></div>\\n                    \\n                    <div style=\"display:flex;gap:10px;flex-wrap:wrap;\">\\n                        <button type=\"button\" id=\"dnd-check-storage\" class=\"dnd-clickable\" style=\"\\n                            background:rgba(52, 152, 219, 0.2);\\n                            border:1px solid #3498db;\\n                            color:#3498db;\\n                            padding:8px 15px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:13px;\\n                        \">ğŸ” æ£€æŸ¥å­˜å‚¨ä½¿ç”¨é‡</button>\\n                        \\n                        <button type=\"button\" id=\"dnd-clear-avatars\" class=\"dnd-clickable\" style=\"\\n                            background:rgba(231, 76, 60, 0.2);\\n                            border:1px solid #e74c3c;\\n                            color:#e74c3c;\\n                            padding:8px 15px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:13px;\\n                        \">ğŸ—‘ï¸ æ¸…ç†å¤´åƒç¼“å­˜</button>\\n                        \\n                        <button type=\"button\" id=\"dnd-clear-maps\" class=\"dnd-clickable\" style=\"\\n                            background:rgba(231, 76, 60, 0.2);\\n                            border:1px solid #e74c3c;\\n                            color:#e74c3c;\\n                            padding:8px 15px;\\n                            border-radius:4px;\\n                            cursor:pointer;\\n                            font-size:13px;\\n                        \">ğŸ—ºï¸ æ¸…ç†åœ°å›¾ç¼“å­˜</button>\\n                    </div>\\n                </div>\\n                \\n                <div style=\"margin-top:20px;padding:15px;background:rgba(197, 160, 89, 0.1);border-left:3px solid var(--dnd-border-gold);border-radius:4px;\">\\n                    <div style=\"font-weight:bold;color:var(--dnd-text-highlight);margin-bottom:5px;\">ğŸ’¡ æç¤º</div>\\n                    <div style=\"font-size:12px;color:#ccc;line-height:1.5;\">\\n                        é¢„è®¾åç§°å¿…é¡»ä¸é…’é¦† World Info ç•Œé¢ä¸­çš„ Plot é¢„è®¾åç§°å®Œå…¨ä¸€è‡´ã€‚<br>\\n                        å¦‚æœªæ‰¾åˆ°é¢„è®¾ï¼Œå°†ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šä¸”ä¸æ‰§è¡Œåˆ‡æ¢ã€‚\\n                    </div>\\n                </div>\\n            </div>\\n        `;e.html(w),e.find(\"#dnd-check-storage\").on(\"click\",function(){const n=t.analyzeStorage();let a='<ul style=\"padding-left:20px;margin:5px 0;\">';const r=Object.entries(n.breakdown).sort((n,t)=>t[1]-n[1]);r.forEach(([t,e])=>{const r=(e/1024/1024).toFixed(2),o=Math.round(e/n.totalBytes*100);a+=`<li><strong>${t}</strong>: ${r} MB (${o}%)</li>`}),a+=\"</ul>\";let o='<div style=\"margin-top:10px;\"><strong>å ç”¨æœ€å¤§çš„ Top 5:</strong><br>';n.topKeys.forEach(n=>{o+=`<div style=\"font-family:monospace;font-size:11px;color:#888;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">${(n.size/1024).toFixed(1)} KB - ${n.key}</div>`}),o+=\"</div>\";const i=n.totalBytes>4718592?\"#e74c3c\":n.totalBytes>3145728?\"#f1c40f\":\"#2ecc71\";e.find(\"#dnd-storage-stats\").html(`\\n                <div style=\"margin-bottom:10px;\">æ€»ä½¿ç”¨é‡: <span style=\"color:${i};font-weight:bold;font-size:14px;\">${n.totalMB} MB</span> / ~5.00 MB</div>\\n                ${a}\\n                ${o}\\n            `)}),e.find(\"#dnd-clear-avatars\").on(\"click\",async function(){if(confirm(\"ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ç¼“å­˜çš„è§’è‰²å¤´åƒå—ï¼Ÿè¿™å°†é‡Šæ”¾å­˜å‚¨ç©ºé—´ï¼Œä½†ä¸‹æ¬¡æŸ¥çœ‹è§’è‰²æ—¶éœ€è¦é‡æ–°ç”Ÿæˆå¤´åƒã€‚\"))try{await t.clearAvatars(),jr.success(\"å¤´åƒç¼“å­˜å·²æ¸…ç†\")}catch(n){jr.error(\"æ¸…ç†å¤±è´¥: \"+n.message)}}),e.find(\"#dnd-clear-maps\").on(\"click\",async function(){if(confirm(\"ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ç¼“å­˜çš„åœ°å›¾å—ï¼Ÿè¿™å°†é‡Šæ”¾å­˜å‚¨ç©ºé—´ï¼Œä½†ä¸‹æ¬¡æŸ¥çœ‹åœ°å›¾æ—¶éœ€è¦é‡æ–°ç”Ÿæˆã€‚\"))try{await t.clearMaps(),jr.success(\"åœ°å›¾ç¼“å­˜å·²æ¸…ç†\")}catch(n){jr.error(\"æ¸…ç†å¤±è´¥: \"+n.message)}}),e.find(\"#dnd-sync-force\").on(\"click\",async function(){const n=i(this);n.prop(\"disabled\",!0).css(\"opacity\",.5),e.find(\"#dnd-sync-badge\").text(\"ğŸ”„ åŒæ­¥ä¸­...\"),await ro();const t=await ao();e.find(\"#dnd-sync-badge\").removeClass(\"dnd-badge-success dnd-badge-warning dnd-badge-error\").addClass(`dnd-badge-${t.statusClass}`).text(t.statusText),n.prop(\"disabled\",!1).css(\"opacity\",1)}),e.find(\"#dnd-set-fetch-models\").on(\"click\",async function(n){n&&n.preventDefault();const t=e.find(\"#dnd-set-api-url\").val().trim(),a=e.find(\"#dnd-set-api-key\").val().trim(),r=i(this),o=e.find(\"#dnd-model-list-container\"),d=e.find(\"#dnd-set-model-select\");if(t){r.text(\"âŒ›\").prop(\"disabled\",!0);try{const n=await no.fetchModels(t,a);let r='<option value=\"\">-- é€‰æ‹©æ¨¡å‹ --</option>';n.forEach(n=>{r+=`<option value=\"${n}\">${n}</option>`}),d.html(r),o.show(),!e.find(\"#dnd-set-api-model\").val()&&n.length>0&&e.find(\"#dnd-set-api-model\").val(n[0]),jr.success(`è·å–æˆåŠŸï¼Œå…± ${n.length} ä¸ªæ¨¡å‹ã€‚è¯·ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©ã€‚`)}catch(n){jr.error(\"è·å–å¤±è´¥: \"+n.message)}finally{r.text(\"è·å–åˆ—è¡¨\").prop(\"disabled\",!1)}}else jr.warning(\"è¯·è¾“å…¥ API URL\")}),e.find(\"#dnd-set-model-select\").on(\"change\",function(){const n=i(this).val();n&&e.find(\"#dnd-set-api-model\").val(n)}),e.find(\"#dnd-cfg-refresh-presets\").on(\"click\",function(n){n&&n.preventDefault();const t=i(this);t.text(\"âŒ› åˆ·æ–°ä¸­...\").prop(\"disabled\",!0);const a=Wr.getAvailablePresets(),r=(n,t)=>{let e='<option value=\"\">-- æ‰‹åŠ¨è¾“å…¥ --</option>';a.forEach(n=>{e+=`<option value=\"${n}\" ${n===t?\"selected\":\"\"}>${n}</option>`}),n.html(e)};r(e.find(\"#dnd-cfg-combat-sel\"),e.find(\"#dnd-cfg-combat-input\").val()),r(e.find(\"#dnd-cfg-explore-sel\"),e.find(\"#dnd-cfg-explore-input\").val()),setTimeout(()=>{t.text(\"ğŸ”„ åˆ·æ–°é¢„è®¾åˆ—è¡¨\").prop(\"disabled\",!1)},500)});const k=e.find(\"#dnd-cfg-enabled\"),S=e.find(\".dnd-cfg-group\");k.on(\"change\",function(){const n=i(this).prop(\"checked\");S.css({opacity:n?1:.5,pointerEvents:n?\"auto\":\"none\"})}),e.find(\"#dnd-cfg-combat-sel\").on(\"change\",function(){this.value&&e.find(\"#dnd-cfg-combat-input\").val(this.value)}),e.find(\"#dnd-cfg-explore-sel\").on(\"change\",function(){this.value&&e.find(\"#dnd-cfg-explore-input\").val(this.value)}),e.find(\"#dnd-set-ui-scale\").on(\"input\",function(){const n=i(this).val();e.find(\"#dnd-scale-value\").text(n),Jr.applyUIScale(n)}),e.find(\"#dnd-reset-scale\").on(\"click\",function(){const n=o.UI_SCALE.DEFAULT;e.find(\"#dnd-set-ui-scale\").val(n).trigger(\"input\")});const C=e.find(\"#dnd-theme-preset\"),$=e.find(\"#dnd-custom-color-enabled\"),_=e.find(\"#dnd-custom-color-panel\");C.on(\"change\",function(){const n=i(this).val();if(n&&\"custom\"!==n){Ur.apply(n),$.prop(\"checked\",!1),_.css({opacity:.5,pointerEvents:\"none\"});const t=Ur.getEditableVars();Object.entries(t).forEach(([n,t])=>{e.find(`.dnd-color-picker[data-var=\"${n}\"]`).val(t.value.substring(0,7))})}}),$.on(\"change\",function(){const n=i(this).prop(\"checked\");if(_.css({opacity:n?1:.5,pointerEvents:n?\"auto\":\"none\"}),n){const n={};e.find(\".dnd-color-picker\").each(function(){const t=i(this).data(\"var\"),e=i(this).val();n[t]=e}),Ur.applyCustom(n),C.val(\"custom\")}else{const n=C.val();n&&\"custom\"!==n?Ur.apply(n):(Ur.apply(\"dark\"),C.val(\"dark\"))}}),e.find(\".dnd-color-picker\").on(\"input\",function(){if(!$.prop(\"checked\"))return;const n={};e.find(\".dnd-color-picker\").each(function(){const t=i(this).data(\"var\"),e=i(this).val();n[t]=e}),Ur.applyCustom(n)}),e.find(\"#dnd-color-reset\").on(\"click\",function(){const n=Ur.COLOR_VARS;if(Object.entries(n).forEach(([n,t])=>{e.find(`.dnd-color-picker[data-var=\"${n}\"]`).val(t.default)}),$.prop(\"checked\")){const n={};e.find(\".dnd-color-picker\").each(function(){n[i(this).data(\"var\")]=i(this).val()}),Ur.applyCustom(n)}}),e.find(\"#dnd-color-export\").on(\"click\",function(){const n={};e.find(\".dnd-color-picker\").each(function(){n[i(this).data(\"var\")]=i(this).val()});const t=JSON.stringify(n,null,2),a=new Blob([t],{type:\"application/json\"}),r=URL.createObjectURL(a),o=document.createElement(\"a\");o.href=r,o.download=\"dnd_custom_theme.json\",o.click(),URL.revokeObjectURL(r),jr.success(\"é…è‰²æ–¹æ¡ˆå·²å¯¼å‡º\")}),e.find(\"#dnd-color-import\").on(\"click\",function(){e.find(\"#dnd-color-import-input\").click()}),e.find(\"#dnd-color-import-input\").on(\"change\",function(t){const a=t.target.files[0];if(!a)return;const r=new FileReader;r.onload=function(t){try{const n=JSON.parse(t.target.result);Object.entries(n).forEach(([n,t])=>{const a=e.find(`.dnd-color-picker[data-var=\"${n}\"]`);a.length&&a.val(t)}),$.prop(\"checked\",!0),_.css({opacity:1,pointerEvents:\"auto\"}),C.val(\"custom\"),Ur.applyCustom(n),jr.success(\"é…è‰²æ–¹æ¡ˆå·²å¯¼å…¥\")}catch(t){jr.error(\"å¯¼å…¥å¤±è´¥: æ— æ•ˆçš„é…è‰²æ–‡ä»¶\"),n.error(\"Failed to import theme:\",t)}},r.readAsText(a),i(this).val(\"\")}),e.find(\".dnd-style-card\").on(\"click\",async function(){const n=i(this).data(\"style-id\");if(n===Xr.currentStyleId)return;if(await Xr.apply(n)){e.find(\".dnd-style-card\").each(function(){const t=i(this).data(\"style-id\")===n;i(this).toggleClass(\"active\",t).css({background:t?\"rgba(157, 139, 108, 0.2)\":\"rgba(0,0,0,0.3)\",borderColor:t?\"var(--dnd-border-gold)\":\"#444\"}).find(\"div:first\").nextAll(\"div:first\").css({color:t?\"var(--dnd-text-highlight)\":\"var(--dnd-text-main)\"})});const t=Xr.getCurrentStyle();e.find(\".dnd-style-card.active\").closest(\"div\").prev().find(\"span:first\").text(t.icon||\"ğŸ¨\"),jr.success(`å·²åˆ‡æ¢è‡³ \"${t.name}\" é£æ ¼`),setTimeout(()=>{Jr.renderPanel(\"settings\")},300)}}),e.find(\".dnd-style-card\").on(\"mouseenter\",function(){i(this).hasClass(\"active\")||i(this).css({borderColor:\"var(--dnd-border-gold)\",transform:\"translateY(-2px)\"})}).on(\"mouseleave\",function(){i(this).hasClass(\"active\")||i(this).css({borderColor:\"#444\",transform:\"translateY(0)\"})}),e.find(\"#dnd-style-import\").on(\"click\",function(){e.find(\"#dnd-style-import-input\").click()}),e.find(\"#dnd-style-import-input\").on(\"change\",async function(t){const e=t.target.files[0];if(e){try{const t=await Xr.importFromFile(e);t.success?(jr.success(t.message),t.warnings&&t.warnings.length>0&&n.info(\"é£æ ¼å¯¼å…¥è­¦å‘Š:\",t.warnings),setTimeout(()=>{Jr.renderPanel(\"settings\")},300)):jr.error(t.message)}catch(t){jr.error(\"å¯¼å…¥å¤±è´¥: \"+t.message),n.error(\"é£æ ¼å¯¼å…¥é”™è¯¯:\",t)}i(this).val(\"\")}}),e.find(\"#dnd-style-export\").on(\"click\",function(){Xr.downloadStyle()?jr.success(\"é£æ ¼åŒ…å·²å¯¼å‡º\"):jr.error(\"å¯¼å‡ºå¤±è´¥\")}),e.find(\"#dnd-style-reset\").on(\"click\",async function(){(await Xr.resetToDefault()).success&&(jr.success(\"å·²æ¢å¤é»˜è®¤é£æ ¼\"),setTimeout(()=>{Jr.renderPanel(\"settings\")},300))});const z=e.find(\"#dnd-bg-enabled\"),D=e.find(\".dnd-bg-group\"),I=e.find(\"#dnd-bg-preview\");let A=null;z.on(\"change\",function(){const n=i(this).prop(\"checked\");D.css({opacity:n?1:.5,pointerEvents:n?\"auto\":\"none\"}),o.DYNAMIC_BG.enabled=n,n?Jr._initDynamicBackground(\"full\"===Jr.state?\"full\":\"mini\"):Jr._destroyDynamicBackgrounds()}),e.find(\"#dnd-bg-type\").on(\"change\",function(){const n=i(this).val();o.DYNAMIC_BG.type=n,A&&Vr.destroy(A),A=Vr.init(I[0],n,{intensity:parseFloat(e.find(\"#dnd-bg-intensity\").val())}),z.prop(\"checked\")&&Jr.switchDynamicBgEffect(n)}),e.find(\"#dnd-bg-intensity\").on(\"input\",function(){const n=parseFloat(i(this).val());e.find(\"#dnd-bg-intensity-value\").text(n.toFixed(1)),o.DYNAMIC_BG.intensity=n;const t=e.find(\"#dnd-bg-type\").val();A&&Vr.destroy(A),A=Vr.init(I[0],t,{intensity:n})}),z.prop(\"checked\")&&(A=Vr.init(I[0],e.find(\"#dnd-bg-type\").val(),{intensity:parseFloat(e.find(\"#dnd-bg-intensity\").val())})),e.find(\"#dnd-cfg-save\").on(\"click\",async function(a){a&&a.preventDefault();const d=e.find(\"#dnd-set-ui-scale\").val();if(r(o.STORAGE_KEYS.UI_SCALE,d),$.prop(\"checked\")){const n={};e.find(\".dnd-color-picker\").each(function(){n[i(this).data(\"var\")]=i(this).val()}),await Ur.saveCustom(n)}else{const n=C.val();r(o.STORAGE_KEYS.THEME,n)}const s={enabled:z.prop(\"checked\"),type:e.find(\"#dnd-bg-type\").val(),intensity:parseFloat(e.find(\"#dnd-bg-intensity\").val())};Object.assign(o.DYNAMIC_BG,s),r(o.STORAGE_KEYS.DYNAMIC_BG,JSON.stringify(s));const l={ENABLED:k.prop(\"checked\"),COMBAT_PRESET:e.find(\"#dnd-cfg-combat-input\").val().trim(),EXPLORE_PRESET:e.find(\"#dnd-cfg-explore-input\").val().trim()};Object.assign(o.PRESET_SWITCHING,l),r(o.STORAGE_KEYS.PRESET_CONFIG,l);const c={url:e.find(\"#dnd-set-api-url\").val().trim(),key:e.find(\"#dnd-set-api-key\").val().trim(),model:e.find(\"#dnd-set-api-model\").val().trim()};await eo(c);const p=e.find(\"#dnd-tm-cols-setting\").val();await t.setSetting(\"dnd_tm_cols\",p);const g=[];e.find(\".dnd-tm-visible-check:not(:checked)\").each(function(){g.push(i(this).val())}),await t.setSetting(\"dnd_tm_hidden_tables\",JSON.stringify(g)),i(document).trigger(\"dnd:settings-changed\");const f=i(this),b=f.html();f.html(\"âœ… å·²ä¿å­˜\").prop(\"disabled\",!0),setTimeout(()=>{f.html(b).prop(\"disabled\",!1)},1500),n.info(\"è®¾ç½®å·²æ›´æ–°:\",l,c,s),Wr._lastCombatState=null;const m=Rr.getTable(\"SYS_GlobalState\");m&&m[0]&&Wr.checkCombatStateChange(\"æˆ˜æ–—ä¸­\"===m[0][\"æˆ˜æ–—æ¨¡å¼\"])})}},lo={renderItemCard(n,t,e=0){const a=\"æ˜¯\"===n[\"å·²è£…å¤‡\"]||!0===n[\"å·²è£…å¤‡\"]||\"true\"===String(n[\"å·²è£…å¤‡\"]).toLowerCase(),r=t?\"background:rgba(197, 160, 89, 0.1);border-color:var(--dnd-border-gold);\":\"\",o=(n[\"ç‰©å“ID\"]||n[\"ç‰©å“åç§°\"]||\"\").replace(/'/g,\"\\\\'\"),i=n[\"ä¼¤å®³\"]||n.damage||\"\",d=n[\"ç‰¹æ€§\"]||n.properties||\"\",s=n[\"ç¨€æœ‰åº¦\"]||n.rarity||\"æ™®é€š\",l=n[\"æ‰€å±äºº\"]||\"\";return`\\n            <div style=\"background:rgba(255,255,255,0.03);padding:10px;border:1px solid var(--dnd-border-inner);border-radius:4px;position:relative;cursor:pointer;animation-delay:${e}s;${r}\"\\n                class=\"dnd-item-card dnd-anim-entry dnd-clickable\"\\n                onclick=\"window.DND_Dashboard_UI.showItemDetail('${o}', event)\">\\n                <div style=\"font-weight:bold;color:${a?\"var(--dnd-text-highlight)\":\"var(--dnd-text-main)\"};margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;\">\\n                    ${n[\"ç‰©å“åç§°\"]}\\n                    ${a?'<i class=\"fa-solid fa-shield-halved\" style=\"float:right;font-size:12px;color:var(--dnd-text-highlight)\"></i>':\"\"}\\n                </div>\\n                \\n                ${i?`<div class=\"dnd-item-damage\"><i class=\"fa-solid fa-gavel\"></i> ${i}</div>`:\"\"}\\n\\n                <div style=\"font-size:12px;color:#888;display:flex;justify-content:space-between;margin-top:4px;\">\\n                    <span>x${n[\"æ•°é‡\"]}</span>\\n                    <span>${n[\"ä»·å€¼\"]||\"-\"}</span>\\n                </div>\\n                \\n                ${d?`<div class=\"dnd-item-props\">${d}</div>`:\"\"}\\n                \\n                <div style=\"display:flex;justify-content:space-between;align-items:flex-end;margin-top:4px;\">\\n                    <div class=\"dnd-item-rarity rarity-${s.toLowerCase()}\">${s}</div>\\n                    <div style=\"display:flex;flex-direction:column;align-items:flex-end;\">\\n                        ${l?`<div style=\"font-size:10px;color:var(--dnd-accent-blue);background:rgba(44, 76, 138, 0.2);padding:1px 4px;border-radius:2px;margin-bottom:2px;\"><i class=\"fa-solid fa-user\"></i> ${l}</div>`:\"\"}\\n                        ${n[\"é‡é‡\"]?`<div style=\"font-size:11px;color:#666;\">${n[\"é‡é‡\"]} lb</div>`:\"\"}\\n                    </div>\\n                </div>\\n            </div>\\n        `},showItemDetail(n,t){t&&t.stopPropagation();const e=Rr.getTable(\"ITEM_Inventory\");if(!e)return;const r=e.find(t=>t[\"ç‰©å“ID\"]===n||t[\"ç‰©å“åç§°\"]===n);if(!r)return;const o=\"æ˜¯\"===r[\"å·²è£…å¤‡\"]||!0===r[\"å·²è£…å¤‡\"]||\"true\"===String(r[\"å·²è£…å¤‡\"]).toLowerCase();let i=\"\";[{key:\"æ‰€å±äºº\",icon:'<i class=\"fa-solid fa-user\"></i>',label:\"æŒæœ‰è€…\"},{key:\"ä¼¤å®³\",icon:'<i class=\"fa-solid fa-gavel\"></i>',label:\"ä¼¤å®³\"},{key:\"æŠ¤ç”²ç­‰çº§\",icon:'<i class=\"fa-solid fa-shield-halved\"></i>',label:\"AC\"},{key:\"ç‰¹æ€§\",icon:'<i class=\"fa-solid fa-bolt\"></i>',label:\"ç‰¹æ€§\"},{key:\"ç¨€æœ‰åº¦\",icon:'<i class=\"fa-solid fa-gem\"></i>',label:\"ç¨€æœ‰åº¦\"},{key:\"é‡é‡\",icon:'<i class=\"fa-solid fa-weight-hanging\"></i>',label:\"é‡é‡\"},{key:\"ä»·å€¼\",icon:'<i class=\"fa-solid fa-coins\"></i>',label:\"ä»·å€¼\"},{key:\"éœ€æ±‚\",icon:'<i class=\"fa-solid fa-list\"></i>',label:\"éœ€æ±‚\"},{key:\"ç±»åˆ«\",icon:'<i class=\"fa-solid fa-tag\"></i>',label:\"ç±»åˆ«\"},{key:\"æ•°é‡\",icon:'<i class=\"fa-solid fa-sort-numeric-down\"></i>',label:\"æ•°é‡\"}].forEach(n=>{let t=r[n.key];t||\"æŠ¤ç”²ç­‰çº§\"!==n.key||(t=r.AC),t&&(i+=`\\n                    <div class=\"dnd-item-detail-row\">\\n                        <span class=\"dnd-item-detail-icon\">${n.icon}</span>\\n                        <span class=\"dnd-item-detail-label\">${n.label}:</span>\\n                        <span class=\"dnd-item-detail-value\">${t}</span>\\n                    </div>\\n                `)});const d=`\\n            <div style=\"color:var(--dnd-text-highlight);font-weight:bold;font-size:16px;border-bottom:1px solid var(--dnd-border-gold);padding-bottom:5px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span>${r[\"ç‰©å“åç§°\"]}</span>\\n                ${o?'<span style=\"font-size:12px;background:var(--dnd-accent-green);color:#fff;padding:2px 6px;border-radius:4px;\">å·²è£…å¤‡</span>':\"\"}\\n            </div>\\n            \\n            <div style=\"margin-bottom:15px;background:rgba(255,255,255,0.05);padding:10px;border-radius:4px;font-size:12px;\">\\n                ${i}\\n            </div>\\n            \\n            <div style=\"line-height:1.6;color:#ccc;font-size:13px;\">\\n                ${r[\"æè¿°\"]||\"æš‚æ— æè¿°\"}\\n            </div>\\n            <div style=\"margin-top:15px;font-size:10px;color:#666;text-align:right;\">ID: ${r[\"ç‰©å“ID\"]||\"-\"}</div>\\n        `,{window:s}=a();this.showItemDetailPopup(d,t?t.clientX:s.innerWidth/2,t?t.clientY:s.innerHeight/2)},showItemDetailPopup(n,t,e){console.log(`[DND Dashboard] showItemDetailPopup called at ${t},${e}`);const{$:r,window:o}=a();let i=r(\"#dnd-detail-popup-el\"),d=r(\"#dnd-popup-backdrop-el\");if(!d.length){d=r('<div id=\"dnd-popup-backdrop-el\" class=\"dnd-popup-backdrop\"></div>'),r(\"body\").append(d);const n=this;d.on(\"click\",()=>{n.hideDetailPopup()})}i.length||(i=r('<div id=\"dnd-detail-popup-el\" class=\"dnd-detail-popup\" style=\"max-height:80vh;overflow-y:auto;\"></div>'),r(\"body\").append(i));i.html('<div style=\"position:absolute;top:8px;right:8px;cursor:pointer;color:#888;font-size:16px;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all 0.2s;\" onmouseover=\"this.style.color=\\'var(--dnd-text-highlight)\\';this.style.background=\\'rgba(255,255,255,0.1)\\'\" onmouseout=\"this.style.color=\\'#888\\';this.style.background=\\'transparent\\'\" onclick=\"window.DND_Dashboard_UI.hideDetailPopup()\">âœ•</div><div style=\"padding-right:20px;\">'+n+\"</div>\");const s=o.innerWidth||r(o).width()||window.innerWidth||800,l=o.innerHeight||r(o).height()||window.innerHeight||600,c=10;if(s<768){i.css({display:\"block\",visibility:\"hidden\",opacity:0,top:\"-9999px\",left:\"\",right:\"\"}).addClass(\"visible\");const n=i.outerHeight()||200;let t=e+15;t+n>l-c&&(t=e-n-10),t<c&&(t=c),t+n>l-c&&(t=Math.max(c,l-n-c)),i.css({top:t+\"px\",left:\"\",right:\"\",bottom:\"auto\",visibility:\"visible\",opacity:1,display:\"block\"})}else{i.css({display:\"block\",visibility:\"hidden\",opacity:0,left:\"-9999px\",top:\"-9999px\"}).addClass(\"visible\");const n=i.outerWidth()||280,a=i.outerHeight()||200;console.log(`[DND Dashboard] Popup measuring: win=${s}x${l}, pop=${n}x${a}, mouse=${t},${e}`);let r=t+15,o=e+15;r+n>s-c&&(r=t-n-15),o+a>l-c&&(o=e-a-10),r<c&&(r=c),o<c&&(o=c),r+n>s-c&&(r=Math.max(c,s-n-c)),o+a>l-c&&(o=Math.max(c,l-a-c)),i.css({top:o+\"px\",left:r+\"px\",bottom:\"auto\",right:\"auto\",visibility:\"visible\",opacity:1,display:\"block\"})}d.addClass(\"visible\")},hideDetailPopup(){const{$:n}=a();n(\"#dnd-detail-popup-el\").removeClass(\"visible\").css(\"display\",\"none\"),n(\"#dnd-popup-backdrop-el\").removeClass(\"visible\")},showMiniItemActions(n,t){let e=n;const a=Rr.getTable(\"ITEM_Inventory\");if(\"string\"==typeof n&&(e=a?a.find(t=>t[\"ç‰©å“ID\"]===n||t[\"ç‰©å“åç§°\"]===n):null),!e)return;const r=e[\"ç‰©å“ID\"]||e[\"ç‰©å“åç§°\"],o=\"æ˜¯\"===e[\"å·²è£…å¤‡\"]||!0===e[\"å·²è£…å¤‡\"]||\"true\"===String(e[\"å·²è£…å¤‡\"]).toLowerCase(),i=a?a.find(n=>n[\"ç‰©å“ID\"]===r||n[\"ç‰©å“åç§°\"]===r):e,d=[{label:o?\"å¸ä¸‹\":\"è£…å¤‡\",icon:'<i class=\"fa-solid fa-shield-halved\"></i>',action:\"equip\"},{label:\"ä½¿ç”¨/æ¶ˆè€—\",icon:'<i class=\"fa-solid fa-flask\"></i>',action:\"use\"},{label:\"ä¸¢å¼ƒ\",icon:'<i class=\"fa-solid fa-trash\"></i>',action:\"drop\"}];let s='<div style=\"display:flex;flex-direction:column;gap:5px;\">';s+=`<div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:5px;\">\\n            ${i[\"ç‰©å“åç§°\"]}\\n            ${o?'<span style=\"font-size:10px;background:var(--dnd-accent-green);color:#fff;padding:1px 4px;border-radius:3px;margin-left:5px;\">å·²è£…å¤‡</span>':\"\"}\\n        </div>`,s+=`<div style=\"font-size:11px;color:#888;margin-bottom:5px;padding:4px 6px;background:rgba(0,0,0,0.2);border-radius:3px;\">\\n            <div>ç±»åˆ«: ${i[\"ç±»åˆ«\"]||\"-\"} | æ•°é‡: ${i[\"æ•°é‡\"]||1}</div>\\n            ${i[\"ä»·å€¼\"]?`<div>ä»·å€¼: ${i[\"ä»·å€¼\"]}</div>`:\"\"}\\n        </div>`;const l=i[\"æè¿°\"]||\"æš‚æ— æè¿°\";s+=`\\n            <div style=\"font-size:12px;color:#ccc;line-height:1.5;margin-bottom:8px;padding:5px;background:rgba(0,0,0,0.2);border-radius:4px;border-left:2px solid #555;cursor:pointer;max-height:60px;overflow:hidden;transition:max-height 0.3s ease-out;text-overflow:ellipsis;\"\\n                onclick=\"this.style.maxHeight = this.style.maxHeight==='60px' ? '500px' : '60px'\"\\n                title=\"ç‚¹å‡»å±•å¼€/æ”¶èµ·\">\\n                ${l}\\n            </div>\\n        `,d.forEach(n=>{s+=`\\n                <div style=\"cursor:pointer;padding:6px 10px;border-radius:4px;display:flex;align-items:center;gap:8px;font-size:13px;\" \\n                    onmouseover=\"this.style.background='rgba(255,255,255,0.1)'\" \\n                    onmouseout=\"this.style.background='transparent'\"\\n                    onclick=\"window.DND_Dashboard_UI.handleItemAction('${r}', '${n.action}', ${i[\"æ•°é‡\"]||1})\">\\n                    <span>${n.icon}</span> <span>${n.label}</span>\\n                </div>\\n            `}),s+=\"</div>\";const c=t.clientX,p=t.clientY;this.showItemDetailPopup(s,c,p)},async handleItemAction(n,t,e){if(this.hideDetailPopup(),\"equip\"===t){const t=Rr.getTable(\"ITEM_Inventory\").find(t=>t[\"ç‰©å“ID\"]===n||t[\"ç‰©å“åç§°\"]===n);if(t){const e=\"æ˜¯\"===t[\"å·²è£…å¤‡\"]||!0===t[\"å·²è£…å¤‡\"]||\"true\"===String(t[\"å·²è£…å¤‡\"]).toLowerCase();Zr.update(n,{\"å·²è£…å¤‡\":e?\"å¦\":\"æ˜¯\"})}}else if(\"use\"===t||\"drop\"===t){const a=\"use\"===t?\"ä½¿ç”¨\":\"ä¸¢å¼ƒ\";if(await jr.confirm(`ç¡®å®šè¦${a} 1 ä¸ª ${n} å—ï¼Ÿ`,{title:`${a}ç‰©å“`,confirmText:a,type:\"drop\"===t?\"danger\":\"info\"})){const t=`[ç³»ç»Ÿ] ç©å®¶${a}äº† 1x ${n}`;Zr.update(n,{\"æ•°é‡\":parseInt(e)-1},t)}}},showInventoryPanel(t){n.info(\"showInventoryPanel è¢«è°ƒç”¨\",t);const e=Rr.getTable(\"ITEM_Inventory\");if(!e||0===e.length)return void this.showItemDetailPopup('<div style=\"text-align:center;color:#888;\">ğŸ’ èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿ</div>',t.clientX,t.clientY);const a=e.filter(n=>!(\"æ˜¯\"===n[\"å·²è£…å¤‡\"]||!0===n[\"å·²è£…å¤‡\"]||\"true\"===String(n[\"å·²è£…å¤‡\"]).toLowerCase())),r=[...new Set(a.map(n=>n[\"ç±»åˆ«\"]||\"æ‚ç‰©\"))].sort();let o=`<div style=\"font-weight:bold;color:var(--dnd-text-main);border-bottom:1px solid var(--dnd-border-gold);padding-bottom:5px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;\">\\n            <span>ğŸ’ èƒŒåŒ…ç‰©å“</span>\\n            <span style=\"font-size:11px;color:#888;\">${a.length} ä»¶</span>\\n        </div>`;o+=`\\n            <div style=\"display:flex;gap:5px;margin-bottom:10px;\">\\n                <input type=\"text\" id=\"dnd-inv-search\" placeholder=\"æœç´¢ç‰©å“...\" style=\"flex:1;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:4px 8px;border-radius:4px;font-size:12px;\" oninput=\"window.DND_Dashboard_UI.filterInventory()\">\\n                <select id=\"dnd-inv-filter\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:4px;border-radius:4px;font-size:12px;\" onchange=\"window.DND_Dashboard_UI.filterInventory()\">\\n                    <option value=\"\">å…¨éƒ¨åˆ†ç±»</option>\\n                    ${r.map(n=>`<option value=\"${n}\">${n}</option>`).join(\"\")}\\n                </select>\\n            </div>\\n        `,o+='<div style=\"max-height:350px;overflow-y:auto;display:flex;flex-direction:column;gap:4px;\" id=\"dnd-inv-list\">',0===a.length?o+='<div style=\"color:#666;text-align:center;padding:10px;\">èƒŒåŒ…ä¸­æ²¡æœ‰æœªè£…å¤‡çš„ç‰©å“</div>':a.forEach(n=>{const t=(n[\"ç‰©å“ID\"]||n[\"ç‰©å“åç§°\"]||\"\").replace(/'/g,\"\\\\'\"),e=n[\"ç±»åˆ«\"]||\"æ‚ç‰©\";o+=`\\n                    <div class=\"dnd-inv-list-item\" data-name=\"${n[\"ç‰©å“åç§°\"]}\" data-category=\"${e}\" style=\"display:flex;justify-content:space-between;align-items:center;padding:6px 8px;background:rgba(255,255,255,0.03);border:1px solid var(--dnd-border-inner);border-radius:4px;cursor:pointer;font-size:12px;\"\\n                        onmouseover=\"this.style.background='rgba(255,255,255,0.1)'\"\\n                        onmouseout=\"this.style.background='rgba(255,255,255,0.03)'\"\\n                        onclick=\"window.DND_Dashboard_UI.showMiniItemActions('${t}', event)\">\\n                        <div style=\"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:180px;display:flex;flex-direction:column;\">\\n                            <span>${n[\"ç‰©å“åç§°\"]}</span>\\n                            <span style=\"font-size:10px;color:#666;\">${e} ${n[\"æ‰€å±äºº\"]?` Â· ğŸ‘¤${n[\"æ‰€å±äºº\"]}`:\"\"}</span>\\n                        </div>\\n                        <span style=\"color:#888;flex-shrink:0;\">x${n[\"æ•°é‡\"]}</span>\\n                    </div>\\n                `}),o+=\"</div>\",this.showItemDetailPopup(o,t.clientX,t.clientY)},filterInventory(){const{$:n}=a(),t=n(\"#dnd-inv-search\").val().toLowerCase(),e=n(\"#dnd-inv-filter\").val();n(\".dnd-inv-list-item\").each(function(){const a=n(this),r=(a.data(\"name\")||\"\").toLowerCase(),o=a.data(\"category\")||\"\";(!t||r.includes(t))&&(!e||o===e)?a.show():a.hide()})},showEquipmentPanel(n){const t=Rr.getTable(\"ITEM_Inventory\");if(!t)return void this.showItemDetailPopup('<div style=\"text-align:center;color:#888;\">âš”ï¸ æ— è£…å¤‡æ•°æ®</div>',n.clientX,n.clientY);const e=t.filter(n=>\"æ˜¯\"===n[\"å·²è£…å¤‡\"]||!0===n[\"å·²è£…å¤‡\"]||\"true\"===String(n[\"å·²è£…å¤‡\"]).toLowerCase());let a=`<div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid var(--dnd-border-gold);padding-bottom:5px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;\">\\n            <span>âš”ï¸ å·²è£…å¤‡</span>\\n            <span style=\"font-size:11px;color:#888;\">${e.length} ä»¶</span>\\n        </div>`;a+='<div style=\"max-height:350px;overflow-y:auto;display:flex;flex-direction:column;gap:4px;\">',0===e.length?a+='<div style=\"color:#666;text-align:center;padding:10px;\">å°šæœªè£…å¤‡ä»»ä½•ç‰©å“</div>':e.forEach(n=>{const t=(n[\"ç‰©å“ID\"]||n[\"ç‰©å“åç§°\"]||\"\").replace(/'/g,\"\\\\'\");a+=`\\n                    <div class=\"dnd-inv-list-item\" style=\"display:flex;justify-content:space-between;align-items:center;padding:6px 8px;background:rgba(197, 160, 89, 0.1);border:1px solid var(--dnd-border-gold);border-radius:4px;cursor:pointer;font-size:12px;\"\\n                        onmouseover=\"this.style.background='rgba(197, 160, 89, 0.2)'\"\\n                        onmouseout=\"this.style.background='rgba(197, 160, 89, 0.1)'\"\\n                        onclick=\"window.DND_Dashboard_UI.showMiniItemActions('${t}', event)\">\\n                        <div style=\"display:flex;flex-direction:column;overflow:hidden;max-width:180px;\">\\n                            <span style=\"color:var(--dnd-text-highlight);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\"><i class=\"fa-solid fa-shield-halved\"></i> ${n[\"ç‰©å“åç§°\"]}</span>\\n                            ${n[\"æ‰€å±äºº\"]?`<span style=\"font-size:10px;color:var(--dnd-accent-blue);\"><i class=\"fa-solid fa-user\"></i> ${n[\"æ‰€å±äºº\"]}</span>`:\"\"}\\n                        </div>\\n                        <span style=\"color:#888;flex-shrink:0;\">${n[\"ç±»åˆ«\"]||\"-\"}</span>\\n                    </div>\\n                `}),a+=\"</div>\",this.showItemDetailPopup(a,n.clientX,n.clientY)},showFactionPanel(n){const t=Rr.getTable(\"FACTION_Standing\");if(!t||0===t.length)return;let e=`\\n            <div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span>ğŸ›ï¸ åŠ¿åŠ›ä¸å£°æœ›</span>\\n                <span style=\"font-size:11px;color:#888;\">${t.length} ä¸ªåŠ¿åŠ›</span>\\n            </div>\\n            <div style=\"max-height:300px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;\">\\n        `;t.forEach(n=>{const t=parseInt(n[\"å…³ç³»ç­‰çº§\"])||0;let a='<i class=\"fa-solid fa-scale-balanced\"></i>',r=\"#ccc\",o=\"ä¸­ç«‹\",i=50;t>0?(a='<i class=\"fa-solid fa-handshake\"></i>',r=\"var(--dnd-accent-green)\",o=\"å‹å¥½\",i=Math.min(100,50+5*t)):t<0&&(a='<i class=\"fa-solid fa-skull\"></i>',r=\"var(--dnd-accent-red)\",o=\"æ•Œå¯¹\",i=Math.max(0,50+5*t));const d=n[\"å£°æœ›å€¼\"]||0;e+=`\\n                <div class=\"dnd-faction-item\">\\n                    <div class=\"dnd-faction-header\">\\n                        <span style=\"color:${r}\">${a} ${n[\"åŠ¿åŠ›åç§°\"]}</span>\\n                        <span style=\"font-size:11px;background:rgba(255,255,255,0.1);padding:1px 6px;border-radius:3px;\">${o} (${t})</span>\\n                    </div>\\n                    <div style=\"font-size:11px;color:#aaa;margin-top:2px;\">\\n                        ${n[\"åŠ¿åŠ›æè¿°\"]||\"æ— æè¿°\"}\\n                    </div>\\n                    <div style=\"display:flex;align-items:center;gap:8px;font-size:10px;color:#888;margin-top:4px;\">\\n                        <span>å£°æœ›: ${d}</span>\\n                        <div class=\"dnd-faction-rep-bar\" style=\"flex:1;\">\\n                            <div class=\"dnd-faction-rep-fill\" style=\"width:${i}%;background:${r};\"></div>\\n                        </div>\\n                    </div>\\n                </div>\\n            `}),e+=\"</div>\",this.showItemDetailPopup(e,n.clientX,n.clientY)},showQuestTooltip(t,e,a){n.info(\"showQuestTooltip è¢«è°ƒç”¨\",t[\"ä»»åŠ¡åç§°\"]);const r=\"å·²å®Œæˆ\"===t[\"çŠ¶æ€\"]?\"#3a6b4a\":\"å·²å¤±è´¥\"===t[\"çŠ¶æ€\"]?\"#8a2c2c\":\"#c5a059\",o=`\\n            <div style=\"border-bottom:1px solid var(--dnd-border-gold);padding-bottom:5px;margin-bottom:10px;font-weight:bold;color:var(--dnd-text-highlight);font-size:16px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span>ğŸ“œ ${t[\"ä»»åŠ¡åç§°\"]}</span>\\n                <span style=\"font-size:11px;background:${r};color:#fff;padding:2px 6px;border-radius:4px;\">${t[\"çŠ¶æ€\"]||\"è¿›è¡Œä¸­\"}</span>\\n            </div>\\n            \\n            <div style=\"font-size:13px;line-height:1.5;margin-bottom:15px;color:#ccc;\">\\n                ${t[\"ç›®æ ‡æè¿°\"]||\"æš‚æ— æè¿°\"}\\n            </div>\\n            \\n            ${t[\"å½“å‰è¿›åº¦\"]?`\\n            <div style=\"margin-bottom:10px;padding:6px 8px;background:rgba(197, 160, 89, 0.1);border-left:2px solid var(--dnd-border-gold);border-radius:2px;\">\\n                <div style=\"font-size:11px;color:#888;margin-bottom:2px;\">å½“å‰è¿›åº¦</div>\\n                <div style=\"font-size:12px;color:var(--dnd-text-main);\">${t[\"å½“å‰è¿›åº¦\"]}</div>\\n            </div>`:\"\"}\\n            \\n            <div style=\"font-size:12px;color:#aaa;background:rgba(255,255,255,0.05);padding:8px;border-radius:4px;\">\\n                <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:5px;\">\\n                    <div><strong>å‘å¸ƒè€…:</strong> ${t[\"å‘å¸ƒè€…\"]||\"-\"}</div>\\n                    <div><strong>ç±»å‹:</strong> ${t[\"ç±»å‹\"]||\"-\"}</div>\\n                    <div><strong>æ—¶é™:</strong> ${t[\"æ—¶é™\"]||\"æ— é™åˆ¶\"}</div>\\n                    <div><strong>éš¾åº¦:</strong> ${t[\"éš¾åº¦\"]||\"-\"}</div>\\n                </div>\\n                <div style=\"margin-top:8px;padding-top:8px;border-top:1px dashed #444;color:var(--dnd-text-highlight);\">\\n                    <strong>ğŸ† å¥–åŠ±:</strong> ${t[\"å¥–åŠ±\"]||\"-\"}\\n                </div>\\n            </div>\\n        `;this.showItemDetailPopup(o,e,a)}},co={_resourceTracker:{snapshots:{}},_turnResources:{action:1,bonus:1,reaction:1,movement:30},_targetingMode:{active:!1,type:null,source:null,range:0,skillName:null,callback:null},_actionQueue:[],_virtualPos:null,adjustTurnResource(n){\"movement\"===n?this._turnResources.movement+=30:void 0!==this._turnResources[n]&&this._turnResources[n]++,this.renderHUD(),Wr.showNotification(!0,`å·²æ·»åŠ èµ„æº: ${n}`)},resetActionEconomy(){const n=this.getControlledCharacter();let t=30;if(n&&n[\"é€Ÿåº¦\"]){const e=parseInt(n[\"é€Ÿåº¦\"]);isNaN(e)||(t=e)}const e=Rr.parseValue(n[\"èŒä¸šèµ„æº\"],\"resources\")||{},a=(n,t)=>{const a=Object.keys(e).find(t=>n.some(n=>t.toLowerCase().includes(n.toLowerCase())));if(a){const n=e[a].toString().split(\"/\");return parseInt(n[1])||parseInt(n[0])||t}return t};this._turnResources={action:a([\"æ¯è½®åŠ¨ä½œ\",\"Actions Per Turn\"],1),bonus:a([\"æ¯è½®é™„èµ \",\"Bonus Per Turn\"],1),reaction:a([\"æ¯è½®ååº”\",\"Reactions Per Turn\"],1),movement:t},this.renderHUD()},initResourceTracker(){const t=this.getControlledCharacter();if(!t)return;const e=t.CHAR_ID||t.PC_ID||t[\"å§“å\"];this._resourceTracker.snapshots[e]={spellSlots:JSON.parse(JSON.stringify(Rr.parseValue(t[\"æ³•æœ¯ä½\"],\"resources\")||{})),classResources:JSON.parse(JSON.stringify(Rr.parseValue(t[\"èŒä¸šèµ„æº\"],\"resources\")||{}))},n.info(\"Resource tracker initialized for\",t[\"å§“å\"])},calculateResourceConsumption(){const n=this.getControlledCharacter();if(!n)return null;const t=n.CHAR_ID||n.PC_ID||n[\"å§“å\"],e=this._resourceTracker.snapshots[t];if(!e)return null;const a=Rr.parseValue(n[\"æ³•æœ¯ä½\"],\"resources\")||{},r=Rr.parseValue(n[\"èŒä¸šèµ„æº\"],\"resources\")||{},o={spellSlots:{},classResources:{}};if(e.spellSlots)for(const[n,t]of Object.entries(e.spellSlots)){const e=t.toString().split(\"/\"),r=parseInt(e[0])||0,i=(a[n]||\"0/0\").toString().split(\"/\"),d=parseInt(i[0])||0;r>d&&(o.spellSlots[n]=r-d)}if(e.classResources)for(const[n,t]of Object.entries(e.classResources)){let e=parseInt(t);t.toString().includes(\"/\")&&(e=parseInt(t.toString().split(\"/\")[0])||0);let a=r[n]||0,i=parseInt(a);a.toString().includes(\"/\")&&(i=parseInt(a.toString().split(\"/\")[0])||0),!isNaN(e)&&!isNaN(i)&&e>i&&(o.classResources[n]=e-i)}return o},renderResourceConsumption(n){const t=this.calculateResourceConsumption();if(!t)return void n.html(\"\");const e=Object.keys(t.spellSlots).length>0,a=Object.keys(t.classResources).length>0;if(!e&&!a)return void n.html(\"\");let r='<div class=\"dnd-resource-consumption\" style=\"margin-top:10px;padding:8px;background:rgba(0,0,0,0.3);border-radius:4px;border:1px dashed rgba(255,255,255,0.1);\">\\n            <div style=\"font-size:11px;color:#aaa;margin-bottom:4px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span><i class=\"fa-solid fa-bolt\"></i> æœ¬åœºæˆ˜æ–—æ¶ˆè€—</span>\\n                <span class=\"dnd-clickable\" style=\"cursor:pointer;color:var(--dnd-text-dim);font-size:14px;line-height:1;\" title=\"é‡ç½®ç»Ÿè®¡\" onclick=\"window.DND_Dashboard_UI.initResourceTracker(); window.DND_Dashboard_UI.renderHUD();\"><i class=\"fa-solid fa-sync\"></i></span>\\n            </div>';if(e){r+='<div style=\"display:flex;flex-wrap:wrap;gap:5px;margin-bottom:4px;\">';for(const[n,e]of Object.entries(t.spellSlots))r+=`<span style=\"font-size:10px;color:#e74c3c;background:rgba(231, 76, 60, 0.1);padding:1px 4px;border-radius:2px;\">${n}: -${e}</span>`;r+=\"</div>\"}if(a){r+='<div style=\"display:flex;flex-wrap:wrap;gap:5px;\">';for(const[n,e]of Object.entries(t.classResources))r+=`<span style=\"font-size:10px;color:#e67e22;background:rgba(230, 126, 34, 0.1);padding:1px 4px;border-radius:2px;\">${n}: -${e}</span>`;r+=\"</div>\"}r+=\"</div>\",n.html(r)},parseDistance(n){if(!n)return 1;const t=String(n).toLowerCase();if(t.includes(\"æ¥è§¦\")||t.includes(\"touch\")||t.includes(\"self\")||t.includes(\"è‡ªèº«\"))return 1;const e=t.match(/(\\d+)/);if(e){const n=parseInt(e[1]);return Math.max(1,Math.ceil(n/5))}return 6},handleCastClick(n,t,e,a,r){const o=Rr.getTable(\"SYS_GlobalState\"),i=o&&o[0]&&\"æˆ˜æ–—ä¸­\"===o[0][\"æˆ˜æ–—æ¨¡å¼\"];if(this.hideDetailPopup(),i)this.startTargeting({type:a||\"skill\",rangeText:t,skillName:n,costType:r||\"Action\",callback:n=>this.executeAction(a||\"skill\",n,r||\"Action\")});else{let t=\"\";t=\"spell\"===a?\"0\"!==e&&\"æˆæ³•\"!==e&&e?`æˆ‘ä½¿ç”¨ ${e} ç¯æ³•æœ¯ä½æ–½æ”¾äº† ${n}`:`æˆ‘æ–½æ”¾äº†æˆæ³•ï¼š${n}`:`æˆ‘ä½¿ç”¨äº†æŠ€èƒ½ï¼š${n}`,this.fillChatInput(t)}},prepareCast(n,t,e){let r=0;if(e&&\"æˆæ³•\"!==e&&\"0\"!==e&&(r=parseInt(e)||1),0===r)return void this.handleCastClick(n,t,\"0\",\"spell\");const o=this.getControlledCharacter(),i=Rr.getMaxSpellSlotLevel(o)||9,d=Rr.parseValue(o[\"æ³•æœ¯ä½\"],\"resources\")||{},s=Math.max(r,i),{$:l}=a(),c=l(\"#dnd-detail-popup-el\");if(c.length){let e=`<div style=\"font-weight:bold;color:var(--dnd-text-highlight);margin-bottom:10px;text-align:center;\">âœ¨ é€‰æ‹©æ–½æ³•ç¯é˜¶ (${n})</div>`;e+='<div style=\"display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;\">';for(let a=r;a<=s;a++){const r=Object.keys(d).find(n=>parseInt(n)===a);let o=0;if(r){const n=d[r].toString().split(\"/\");o=parseInt(n[0])||0}const i=o<=0,s=n.replace(/'/g,\"\\\\'\");e+=`\\n                    <button class=\"dnd-clickable\" style=\"${i?\"background:rgba(0,0,0,0.3);border:1px solid #333;color:#666;padding:8px;border-radius:4px;cursor:not-allowed;\":\"background:rgba(255,255,255,0.05);border:1px solid #555;color:#ccc;padding:8px;border-radius:4px;cursor:pointer;font-weight:bold;\"}\" ${i?\"\":\"onmouseover=\\\"this.style.borderColor='var(--dnd-border-gold)';this.style.color='#fff';this.style.background='rgba(255,255,255,0.1)'\\\"\"} ${i?\"\":\"onmouseout=\\\"this.style.borderColor='#555';this.style.color='#ccc';this.style.background='rgba(255,255,255,0.05)'\\\"\"} ${i?\"\":`onclick=\"window.DND_Dashboard_UI.handleCastClick('${s}', '${t}', '${a}', 'spell')\"`}>\\n                        ${a} ç¯ ${i?\"(0)\":`(${o})`}\\n                    </button>\\n                `}e+=\"</div>\";const a=c.find(\"> div:not(:first-child)\");a.length?a.html(e):c.append('<div style=\"padding-right:20px;\">'+e+\"</div>\")}},startTargeting(t){n.debug(\"[Targeting] Start config:\",t);const{type:e,source:r,rangeText:o,skillName:i,costType:d}=t,s=this.parseDistance(o);if(\"move\"!==e&&d){const n=d.toLowerCase();if(this._turnResources[n]<=0)return void jr.warning(`âŒ æ— æ³•æ‰§è¡Œï¼š${d} èµ„æºå·²è€—å°½ï¼`)}this._targetingMode={active:!0,type:e||\"skill\",source:r||null,range:s,skillName:i||\"è¡ŒåŠ¨\",costType:d,callback:t.callback},this.renderHUD();const{window:l}=a(),c=\"move\"===e?\"è¯·é€‰æ‹©ç§»åŠ¨ç›®æ ‡ç‚¹\":`è¯·é€‰æ‹© ${i} çš„ç›®æ ‡`;this.showItemDetailPopup(`<div style=\"text-align:center;color:var(--dnd-accent-green);font-weight:bold;\">ğŸ¯ ${c}</div>`,l.innerWidth/2,100)},endTargeting(){this._targetingMode={active:!1,type:null,source:null,range:0},this.renderHUD(),this.hideDetailPopup()},executeAction(n,t,e){const{x:a,y:r,target:o,distance:i}=t,d=this.getControlledCharacter(),s=d?d[\"å§“å\"]:\"æˆ‘\",l=`${String.fromCharCode(64+a)}${r}`;let c=\"\";const p=(this._targetingMode.skillName||\"\").toLowerCase();let g=\"\";if(p.includes(\"dash\")||p.includes(\"ç–¾èµ°\")||p.includes(\"å†²åˆº\")){const n=parseInt(d[\"é€Ÿåº¦\"])||30;this._turnResources.movement+=n,g=` (ç–¾èµ°: +${n}å°ºç§»åŠ¨)`}if((p.includes(\"action surge\")||p.includes(\"åŠ¨ä½œå¦‚æ½®\"))&&(this._turnResources.action++,g=\" (åŠ¨ä½œå¦‚æ½®: +1 åŠ¨ä½œ)\"),\"move\"===n){const n=5*(i||0);if(this._turnResources.movement<n)return void jr.warning(`ç§»åŠ¨è·ç¦»ä¸è¶³ï¼å‰©ä½™: ${this._turnResources.movement}å°º, éœ€è¦: ${n}å°º`);this._turnResources.movement-=n,c=`ç§»åŠ¨åˆ°äº† ${l} (æ¶ˆè€— ${n}å°º)`,this._virtualPos={x:a,y:r}}else{let n=(e||\"Action\").toLowerCase();if((p.includes(\"action surge\")||p.includes(\"åŠ¨ä½œå¦‚æ½®\"))&&(n=\"free\"),void 0!==this._turnResources[n]){if(this._turnResources[n]<=0)return void jr.warning(`æ²¡æœ‰è¶³å¤Ÿçš„ ${e}ï¼`);this._turnResources[n]--}const t=this._targetingMode.skillName;c=o?`å¯¹ ${o} æ–½æ”¾äº† ã€${t}ã€‘${g}`:`åœ¨ ${l} æ–½æ”¾äº† ã€${t}ã€‘${g}`}this._actionQueue.push({type:n,data:t,desc:c,charName:s}),this.renderHUD()},commitActions(){if(0===this._actionQueue.length)return;const n=this._actionQueue[0].charName||\"æˆ‘\",t=this._actionQueue.map(n=>n.desc);let e=\"\";e=1===t.length?t[0]:t.join(\"ï¼Œç„¶å \");const a=`è½®åˆ°${n}çš„å›åˆæ—¶ï¼Œ${e}ã€‚`;this.fillChatInput(a),this.clearActions()},clearActions(){this._actionQueue=[],this._virtualPos=null,this.resetActionEconomy()},showCombatUnitDetail(n,t){const{$:e}=a(),r=n[\"HPçŠ¶æ€\"]||\"??/??\",o=\"æ•Œæ–¹\"===n[\"é˜µè¥\"]?\"var(--dnd-accent-red)\":\"var(--dnd-text-highlight)\",i=`\\n            <div style=\"border-bottom:1px solid ${o};padding-bottom:5px;margin-bottom:10px;font-weight:bold;color:${o};font-size:16px;display:flex;justify-content:space-between;\">\\n                <span>${n[\"å•ä½åç§°\"]}</span>\\n                <span style=\"font-size:12px;background:rgba(255,255,255,0.1);padding:2px 6px;border-radius:4px;color:#fff;\">${n[\"é˜µè¥\"]}</span>\\n            </div>\\n            \\n            <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px;font-size:13px;\">\\n                <div style=\"background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;\">\\n                    <div style=\"color:#888;font-size:11px;\">HP çŠ¶æ€</div>\\n                    <div style=\"font-weight:bold;color:#fff;\">${r}</div>\\n                </div>\\n                <div style=\"background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;\">\\n                    <div style=\"color:#888;font-size:11px;\">å…ˆæ”» / ä½ç½®</div>\\n                    <div style=\"font-weight:bold;color:#fff;\">${n[\"å…ˆæ”»/ä½ç½®\"]||\"-\"}</div>\\n                </div>\\n            </div>\\n\\n            <div style=\"margin-bottom:10px;\">\\n                <div style=\"color:#aaa;font-size:12px;margin-bottom:3px;\">é˜²å¾¡ / æŠ—æ€§</div>\\n                <div style=\"color:#fff;font-size:13px;background:rgba(255,255,255,0.05);padding:5px;border-radius:3px;\">${n[\"é˜²å¾¡/æŠ—æ€§\"]||\"æ— \"}</div>\\n            </div>\\n            \\n            <div style=\"margin-bottom:10px;\">\\n                <div style=\"color:#aaa;font-size:12px;margin-bottom:3px;\">é™„ç€çŠ¶æ€</div>\\n                <div style=\"color:#e6dcca;font-size:13px;background:rgba(255,255,255,0.05);padding:5px;border-radius:3px;\">${n[\"é™„ç€çŠ¶æ€\"]||\"æ— \"}</div>\\n            </div>\\n\\n            <div>\\n                <div style=\"color:#aaa;font-size:12px;margin-bottom:3px;\">å›åˆèµ„æº</div>\\n                <div style=\"color:#ccc;font-size:12px;line-height:1.4;\">${n[\"å›åˆèµ„æº\"]||\"-\"}</div>\\n            </div>\\n        `;this.showItemDetailPopup(i,t.clientX,t.clientY)},showCombatSkillList(n){console.log(\"[DND Dashboard] showCombatSkillList called\");const t=this.getControlledCharacter();if(!t)return void jr.warning(\"æœªæ‰¾åˆ°å½“å‰æ“æ§è§’è‰²æ•°æ®ã€‚\");const e=t.PC_ID||t.CHAR_ID||t[\"å§“å\"];let a=Rr.getCharacterSkills(e);if(a&&0!==a.length||!t[\"å§“å\"]||t[\"å§“å\"]===e||(a=Rr.getCharacterSkills(t[\"å§“å\"])),!a||0===a.length){const e=`<div style=\"padding:15px;text-align:center;\">\\n                <div style=\"font-weight:bold;color:var(--dnd-text-highlight);margin-bottom:10px;\"><i class=\"fa-solid fa-bolt\"></i> ${t[\"å§“å\"]}</div>\\n                <div style=\"color:#888;\">è¯¥è§’è‰²æš‚æ— å·²å­¦ä¹ çš„æŠ€èƒ½æˆ–æ³•æœ¯ã€‚</div>\\n            </div>`;return void this.showItemDetailPopup(e,n.clientX,n.clientY)}const r={\"åŠ¨ä½œ\":[],\"é™„èµ åŠ¨ä½œ\":[],\"ååº”\":[],\"å…¶ä»–\":[]};a&&a.forEach(n=>(n=>{const t=\"æ³•æœ¯\"===n[\"æŠ€èƒ½ç±»å‹\"],e=n[\"æŠ€èƒ½åç§°\"],a=(n[\"æ–½æ³•æ—¶é—´\"]||\"\").toLowerCase();let o=\"Action\";a.includes(\"bonus\")||a.includes(\"é™„èµ \")?o=\"Bonus\":a.includes(\"reaction\")||a.includes(\"ååº”\")?o=\"Reaction\":(a.includes(\"free\")||a.includes(\"è‡ªç”±\"))&&(o=\"Free\");const i={...n,_isSpell:t,_displayName:e,_costType:o};\"Bonus\"===o?r[\"é™„èµ åŠ¨ä½œ\"].push(i):\"Reaction\"===o?r[\"ååº”\"].push(i):r[\"åŠ¨ä½œ\"].push(i)})(n));let o=`<div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:10px;\"><i class=\"fa-solid fa-bolt\"></i> ${t[\"å§“å\"]} çš„æŠ€èƒ½</div>`;o+='<div style=\"max-height:300px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;\">';let i=!1;Object.keys(r).forEach(n=>{0!==r[n].length&&(i=!0,o+=`<div style=\"font-size:12px;color:#888;border-bottom:1px dashed #444;margin-top:5px;\">${n}</div>`,r[n].forEach(n=>{const t=n._displayName||\"æœªå‘½å\",e=t.replace(/'/g,\"\\\\'\").replace(/\"/g,'\"'),a=(n[\"å°„ç¨‹\"]||\"æ¥è§¦\").replace(/'/g,\"\\\\'\"),r=n._isSpell,i=r?'<i class=\"fa-solid fa-scroll\"></i>':'<i class=\"fa-solid fa-gavel\"></i>',d=n._costType,s=r?\"spell\":\"skill\",l=n[\"ç¯é˜¶\"];let c=\"\";c=r&&!(\"0\"===l||0===l||\"æˆæ³•\"===l||!l)?`window.DND_Dashboard_UI.prepareCast('${e}', '${a}', '${l}', '${d}')`:`window.DND_Dashboard_UI.handleCastClick('${e}', '${a}', '${l||\"\"}', '${s}', '${d}')`,o+=`\\n                    <div class=\"dnd-clickable\" style=\"padding:6px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;\"\\n                        onclick=\"${c}\">\\n                        <span style=\"color:var(--dnd-text-main);\">${i} ${t}</span>\\n                        <span style=\"font-size:10px;color:#aaa;\">${n[\"å°„ç¨‹\"]||\"-\"}</span>\\n                    </div>\\n                `}))}),i||(o+='<div style=\"color:#888;text-align:center;padding:10px;\">æ— æŠ€èƒ½æ˜¾ç¤º</div>'),o+=\"</div>\",this.showItemDetailPopup(o,n.clientX,n.clientY)}},po={prompts:{structure:n=>`ä½ æ˜¯ä¸€ä¸ªèµ„æ·±DNDåœ°ç‰¢æ¶æ„å¸ˆã€‚è¯·æ ¹æ®ä¸»é¢˜è®¾è®¡ä¸€ä¸ªç´§å‡‘ã€çœŸå®çš„åœ°ç‰¢å¹³é¢å›¾ç»“æ„ã€‚\\n\\nä¸»é¢˜ï¼š${n}\\n\\nå…³é”®è®¾è®¡åŸåˆ™ï¼š\\n1. **ç´§å‡‘è¿æ¥**ï¼šæˆ¿é—´ä¹‹é—´ä¸åº”è¯¥ç”¨é•¿é•¿çš„çº¿è¿æ¥ï¼Œè€Œåº”è¯¥ç‰©ç†ä¸Šç´§æŒ¨ç€ã€‚\\n2. **èµ°å»Šå³æˆ¿é—´**ï¼šèµ°å»Š(corridor)æœ¬èº«å°±æ˜¯ä¸€ä¸ªé•¿æ¡å½¢çš„æˆ¿é—´ï¼Œè§’è‰²å¯ä»¥ç«™åœ¨é‡Œé¢ã€‚ä¸è¦ç”¨æŠ½è±¡çš„çº¿ä»£è¡¨è·¯å¾„ã€‚\\n3. **æ— ç¼æ‹¼æ¥**ï¼šæˆ¿é—´å’Œèµ°å»Šçš„åæ ‡(x,y,width,height)åº”è¯¥è®¾è®¡å¾—è®©å®ƒä»¬è¾¹ç¼˜è´´åˆï¼Œå½¢æˆä¸€ä¸ªè¿é€šçš„æ•´ä½“åŒºåŸŸã€‚\\n4. **é—¨ä¸é€šé“**ï¼šæˆ¿é—´ä¹‹é—´çš„è¿æ¥é€šè¿‡å…±äº«å¢™å£ä¸Šçš„â€œé—¨â€æˆ–â€œå¼€å£â€å®ç°ã€‚\\n5. **ä¸è§„åˆ™å¸ƒå±€**ï¼šæ•´ä¸ªåœ°å›¾ä¸­åœ°ç‚¹çš„å¸ƒå±€ä¸ç”¨è§„åˆ™åˆ†å¸ƒï¼Œå³ä½¿æ˜¯äººé€ å»ºç­‘ï¼Œä¹Ÿå¯ä»¥æœ‰ä¸å¯¹ç§°å’Œä¸è§„åˆ™çš„å½¢çŠ¶ã€‚\\n\\nè¯·ç”ŸæˆJSONæ ¼å¼æ•°æ®ï¼š\\n1. mapName: åœ°å›¾åç§°\\n2. mapSize: { width: 800, height: 600 }\\n3. rooms: æˆ¿é—´åˆ—è¡¨ï¼ŒåŒ…å«ï¼š\\n   - id: ID\\n   - name: åç§°\\n   - type: ç±»å‹ (entrance/corridor/room/hall/secret_room)\\n   - shape: å½¢çŠ¶ (rectangular / circular / irregular / cave_blob) - æ³¨æ„ï¼šè‡ªç„¶æ´ç©´å¿…é¡»ç”¨ irregular æˆ– cave_blobï¼Œä¸è¦å…¨æ˜¯çŸ©å½¢\\n   - x, y, width, height: æ‰€åœ¨åŒºåŸŸçš„è¾¹ç•Œæ¡† (Bounding Box)ï¼Œå¯¹äºä¸è§„åˆ™å½¢çŠ¶ï¼Œè¿™æ˜¯å®ƒçš„æœ€å¤§èŒƒå›´\\n   - description: æè¿°\\n   - color: å»ºè®®çš„é¢œè‰²ä»£ç  (hex)\\n4. doors: é—¨/é€šé“åˆ—è¡¨ï¼ˆæ›¿ä»£åŸæ¥çš„pathsï¼‰ï¼ŒåŒ…å«ï¼š\\n   - x, y: é—¨çš„ä½ç½®\\n   - type: ç±»å‹ (open/door/secret_door/barred)\\n   - orientation: æ–¹å‘ (horizontal/vertical)\\n   - connects: [room_id_1, room_id_2]\\n5. features: å®¤å†…ç‰©ä½“åˆ—è¡¨ (column/statue/chest/trap/fountain/table...)\\n   - x, y: ä½ç½®\\n   - type: ç±»å‹\\n\\nè¯·ç”Ÿæˆä¸€ä¸ªè‡³å°‘åŒ…å«8-12ä¸ªåŒºåŸŸï¼ˆæˆ¿é—´+èµ°å»Šï¼‰çš„å¤æ‚ç»“æ„ï¼Œç¡®ä¿æœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªBossåŒºåŸŸã€‚èµ°å»Šåº”è¯¥è¿æ¥å¤šä¸ªæˆ¿é—´ã€‚\\n\\nåªè¿”å›JSONï¼Œä¸è¦å…¶ä»–è§£é‡Šã€‚`,svg:n=>`ä½ æ˜¯ä¸€ä¸ªé¡¶çº§DNDåœ°å›¾ç»˜åˆ¶å¤§å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ç»“æ„æ•°æ®ï¼Œç»˜åˆ¶ä¸€å¼ æå…·è‰ºæœ¯æ„Ÿçš„ã€**æ‰‹ç»˜é£æ ¼**çš„åœ°å›¾ã€‚\\n\\n${n}\\n\\næ ¸å¿ƒç»˜åˆ¶è¦æ±‚ï¼š\\n\\n0.  **å½¢æ€é©å‘½ï¼ˆå…³é”®éœ€æ±‚ï¼‰**ï¼š\\n    *   **æ‹’ç»çŸ©å½¢**ï¼šDNDåœ°å›¾ï¼ˆå°¤å…¶æ˜¯æ´ç©´ï¼‰ç»ä¸æ˜¯ä¸€ä¸ªä¸ªæ–¹å—æ‹¼èµ·æ¥çš„ï¼\\n    *   **æœ‰æœºå½¢çŠ¶**ï¼š\\n        - å¯¹äº \\`shape=\"cave_blob\"\\` æˆ– \\`irregular\\` çš„æˆ¿é—´ï¼Œå¿…é¡»ä½¿ç”¨ \\`<path>\\` ç»˜åˆ¶ä¸è§„åˆ™çš„ã€æœ‰æœºçš„æ›²çº¿è½®å»“ï¼Œæ¨¡æ‹Ÿè‡ªç„¶å²©å£ã€‚\\n        - å³ä½¿æ˜¯ \\`rectangular\\` æˆ¿é—´ï¼Œä¹Ÿè¦ç”»å¾—ç¨å¾®æ­ªæ–œä¸€ç‚¹ï¼Œä¸è¦ç”¨å®Œç¾çš„ \\`rect\\`ã€‚\\n    *   **å‚è€ƒè¾¹ç•Œ**ï¼šJSONä¸­çš„ \\`width/height\\` åªæ˜¯å¤§è‡´èŒƒå›´ï¼Œè¯·å¤§èƒ†åœ°åœ¨è¿™ä¸ªèŒƒå›´å†…ç»˜åˆ¶å¤šè¾¹å½¢æˆ–ä¸è§„åˆ™å½¢çŠ¶ã€‚\\n\\n1.  **è§£å†³â€œç®€ç¬”ç”»â€æ„Ÿï¼ˆçº¹ç†ä¸åšåº¦ï¼‰**ï¼š\\n    *   **å¢™å£**ï¼šä¸è¦åªç”»å•è–„çš„çº¿ï¼è¯·ä½¿ç”¨ **ç²—ç¬”è§¦ (stroke-width=\"4\"~\"6\")** æ¥è¡¨ç¤ºå¢™å£ï¼Œæˆ–è€…ä½¿ç”¨åŒçº¿æç»˜ã€‚å¢™å£é¢œè‰²åº”æ·±é‚ƒï¼ˆå¦‚æ·±ç‚­è‰² #2c3e50ï¼‰ã€‚\\n    *   **åœ°é¢çº¹ç†**ï¼šæ‹’ç»çº¯è‰²å¡«å……ï¼è¯·åœ¨ <defs> ä¸­å®šä¹‰çº¹ç†å›¾æ¡ˆ (<pattern>)ï¼Œä¾‹å¦‚ï¼š\\n        - \"floor-stone\": ç®€å•çš„çŸ³ç –çº¹ç†ã€‚\\n        - \"floor-hatch\": æ‰‹ç»˜æ’çº¿é˜´å½±ã€‚\\n        - \"grid-pattern\": 50x50 çš„æ·¡è‰²ç½‘æ ¼çº¿ (stroke=\"#000\" opacity=\"0.2\")ï¼Œæ¨¡æ‹Ÿæˆ˜æœ¯åœ°å›¾ã€‚\\n    *   **åº”ç”¨çº¹ç†**ï¼šå°†è¿™äº›çº¹ç†åº”ç”¨åˆ°æˆ¿é—´ (fill=\"url(#floor-stone)\")ã€‚\\n    *   **ç½‘æ ¼è¦†ç›–**ï¼šåœ¨æ‰€æœ‰æˆ¿é—´ä¹‹ä¸Šï¼ˆä½†åœ¨æ–‡å­—ä¹‹ä¸‹ï¼‰è¦†ç›–ä¸€å±‚ \"grid-pattern\"ï¼Œè¿™èƒ½ç¬é—´æå‡åœ°å›¾çš„ä¸“ä¸šåº¦å’Œæˆ˜æœ¯æ„Ÿï¼\\n\\n2.  **æ‰‹ç»˜é£æ ¼ä¸æ»¤é•œæ§åˆ¶ï¼ˆæ¨¡æ‹Ÿé“…ç¬”/çŸ³ç¬”ï¼‰**ï¼š\\n    *   **å®šä¹‰æ»¤é•œ**ï¼šè¯·åœ¨ <defs> ä¸­å®šä¹‰ \"pencil-effect\" æ»¤é•œã€‚\\n        - å¿…é¡»ä½¿ç”¨ **é«˜é¢‘å™ªå£°** (\\`baseFrequency=\"0.7\"\\` æˆ–æ›´é«˜) æ¥æ¨¡æ‹Ÿé“…ç¬”çš„é¢—ç²’æ„Ÿã€‚\\n        - ä½¿ç”¨ \\`feComposite\\` (operator=\"in\") å°†å™ªå£°å åŠ åˆ°çº¿æ¡ä¸Šï¼Œä½¿çº¿æ¡äº§ç”Ÿä¸è¿ç»­çš„çŸ³å¢¨è´¨æ„Ÿï¼Œè€Œä¸æ˜¯å•çº¯çš„æ‰­æ›²ã€‚\\n    *   **åº”ç”¨èŒƒå›´ï¼ˆå…³é”®ï¼‰**ï¼šå°† \\`filter=\"url(#pencil-effect)\"\\` åº”ç”¨åˆ°æ‰€æœ‰æˆ¿é—´è½®å»“ã€å¢™å£å’Œèµ°å»Šã€‚\\n    *   **æ–‡å­—ä¿æŠ¤ï¼ˆéå¸¸é‡è¦ï¼‰**ï¼š**ç»å¯¹ç¦æ­¢**å°†æ‰­æ›²æ»¤é•œåº”ç”¨åˆ° <text> æ ‡ç­¾ï¼æ–‡å­—å¿…é¡»ä¿æŒæ¸…æ™°é”åˆ©ï¼Œä¸èƒ½æ‰­æ›²ã€‚\\n\\n3.  **èƒŒæ™¯**ï¼š\\n    *   SVG ç¬¬ä¸€å±‚å¿…é¡»æ˜¯è¦†ç›–å…¨å›¾çš„ <rect>ï¼Œå¡«å…… \"parchment\" (ç¾Šçš®çº¸) é¢œè‰²æˆ–çº¹ç†ï¼Œ**ç»ä¸èƒ½é€æ˜**ã€‚\\n\\n4.  **æ’ç‰ˆä¸é€¼æ ¼ï¼ˆæå‡è´¨æ„Ÿçš„æ ¸å¿ƒï¼‰**ï¼š\\n    *   **å­—ä½“é­”æ³•**ï¼š\\n        - æ ‡é¢˜ä½¿ç”¨ \\`font-family=\"Cinzel\", serif\\`ï¼Œå­—å·å·¨å¤§ï¼Œå±…ä¸­æ˜¾ç¤ºåœ¨åœ°å›¾é¡¶éƒ¨ã€‚\\n        - æˆ¿é—´æ ‡ç­¾ä½¿ç”¨ \\`font-family=\"MedievalSharp\", cursive\\`ï¼Œé¢œè‰²ä½¿ç”¨æ·±çº¢æˆ–æ·±é‡‘ï¼Œå¢åŠ ç¥ç§˜æ„Ÿã€‚\\n        - è¯´æ˜æ–‡å­—ä½¿ç”¨ \\`font-family=\"Crimson Text\", serif\\`ã€‚\\n        - æ‰€æœ‰æ–‡å­—åº”ä¸ºä¸­æ–‡ã€‚\\n    *   **è£…é¥°è¾¹æ¡†**ï¼šä¸è¦è®©åœ°å›¾æ‚¬æµ®åœ¨çœŸç©ºä¸­ï¼è¯·ç”»ä¸€ä¸ª**åä¸½çš„è£…é¥°è¾¹æ¡†**ï¼ˆåŒçº¿ã€è§’è½èŠ±çº¹æˆ–å‡¯å°”ç‰¹ç»“é£æ ¼ï¼‰åŒ…å›´æ•´ä¸ªåœ°å›¾åŒºåŸŸã€‚\\n    *   **å›¾ä¾‹ä¸è£…é¥°**ï¼š\\n        - åœ¨è§’è½ç»˜åˆ¶ä¸€ä¸ªæå…¶ç²¾ç»†çš„**æŒ‡å—é’ˆ (Compass Rose)**ã€‚\\n        - æ·»åŠ â€œæ¯”ä¾‹å°ºâ€æ¡ã€‚\\n        - æ·»åŠ å¢¨æ°´æ±¡æ¸ã€ç¾Šçš®çº¸çš„ç ´æŸè¾¹ç¼˜æ•ˆæœã€‚\\n    *   **æ•´ä½“æ„å›¾**ï¼šåƒä¸€æœ¬ç²¾ç¾çš„å¥‡å¹»è®¾å®šé›†æ’å›¾ä¸€æ ·æ’ç‰ˆã€‚\\n\\n5.  **è§†è§‰ç»†èŠ‚**ï¼š\\n    *   **æˆ¿é—´è¿æ¥**ï¼šèµ°å»Šåº”æœ‰å®ä½“å®½åº¦ï¼Œä¸æˆ¿é—´è‡ªç„¶èåˆã€‚\\n    *   **å®¶å…·**ï¼šæ·»åŠ ç®€å•çš„å®¶å…·ç¬¦å·ï¼ˆåœ†åœˆä»£è¡¨æŸ±å­ï¼Œé•¿æ–¹å—ä»£è¡¨æ¡Œå­ï¼ŒXä»£è¡¨é™·é˜±ï¼‰ã€‚\\n\\nè¯·è¾“å‡ºå®Œæ•´çš„ SVG ä»£ç ã€‚\\n\\n**å…³é”®æ’ç‰ˆä¿®æ­£ï¼ˆé˜²æ­¢é‡å ï¼‰**ï¼š\\n*   **ViewBox æ‰©å±•**ï¼šè¾“å…¥çš„æˆ¿é—´åæ ‡æ˜¯åœ¨ 0,0 åˆ° 800,600 ä¹‹é—´ã€‚ä¸ºäº†æ”¾ä¸‹æ ‡é¢˜å’Œè¾¹æ¡†ï¼Œè¯·åŠ¡å¿…å°† SVG çš„ \\`viewBox\\` è®¾ç½®ä¸º **\\`-50 -150 900 850\\`** (æˆ–è€…ç±»ä¼¼çš„æ‰©å±•èŒƒå›´)ã€‚\\n*   **æ ‡é¢˜ä½ç½®**ï¼šå°†å¤§æ ‡é¢˜æ”¾ç½®åœ¨ \\`y = -80\\` å·¦å³çš„ä½ç½®ï¼ˆå³åœ°å›¾ä¸Šæ–¹ï¼‰ï¼Œ**ç»å¯¹ä¸è¦è¦†ç›–æˆ¿é—´**ï¼\\n*   **è¾¹æ¡†ä½ç½®**ï¼šè¾¹æ¡†åº”è¯¥åŒ…å›´æ•´ä¸ªè§†è§‰åŒºåŸŸã€‚\\n\\nä¸è¦ä½¿ç”¨markdownä»£ç å—ã€‚ç›´æ¥è¿”å› <svg ...> ... </svg>ã€‚`,battleStructure:(n,t,e)=>`ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„DNDæˆ˜æ–—åœ°å›¾ç¯å¢ƒè®¾è®¡å¸ˆã€‚è¯·æ ¹æ®ä¸»é¢˜è®¾è®¡ä¸€ä¸ª ${t}x${e} ç½‘æ ¼å¤§å°çš„æˆ˜æ–—é­é‡åœºæ™¯ã€‚\\n\\nä¸»é¢˜ï¼š${n}\\n\\nå…³é”®è¦æ±‚ï¼š\\n1. **æˆ˜æœ¯ä¸°å¯Œæ€§**ï¼šä¸ä»…ä»…æ˜¯ç©ºåœ°ã€‚åŒ…æ‹¬éšœç¢ç‰©ï¼ˆé˜»æŒ¡è§†çº¿/ç§»åŠ¨ï¼‰ã€å±é™©åœ°å½¢ï¼ˆä¼¤å®³/çŠ¶æ€ï¼‰ã€å›°éš¾åœ°å½¢ï¼ˆç§»åŠ¨æ¶ˆè€—åŠ å€ï¼‰å’Œæœ‰åˆ©ä½ç½®ï¼ˆé«˜åœ°/æ©ä½“ï¼‰ã€‚\\n2. **ç¯å¢ƒå™äº‹**ï¼šé€šè¿‡ç‰©ä½“æ”¾ç½®ä¼ è¾¾æ•…äº‹ï¼ˆä¾‹å¦‚ç¿»å€’çš„é©¬è½¦ã€ç¥­å›ã€è¥ç«ï¼‰ã€‚\\n3. **åæ ‡ç³»ç»Ÿ**ï¼šä½¿ç”¨ 1-based åæ ‡ç³» (x: 1-${t}, y: 1-${e})ã€‚\\n\\nè¯·ç”ŸæˆJSONæ ¼å¼æ•°æ®ï¼š\\n1. mapName: åœºæ™¯åç§°\\n2. dimensions: { width: ${t}, height: ${e} }\\n3. ground: åœ°é¢ç±»å‹ (grass / dirt / stone / wood_plank / water / lava / snow)\\n4. terrain_objects: åœ°å½¢ç‰©ä½“åˆ—è¡¨ï¼ŒåŒ…å«ï¼š\\n   - type: ç±»å‹ (tree / rock / wall / pillar / water_pool / furniture / rubble / bush / statue)\\n   - x, y: å·¦ä¸Šè§’åæ ‡\\n   - w, h: å æ®çš„æ ¼æ•° (å¯ä»¥æ˜¯éæ•´æ•°ï¼Œä½†å°½é‡è´´åˆç½‘æ ¼)\\n   - rotation: æ—‹è½¬è§’åº¦ (0, 90, 45...)\\n   - description: ç®€çŸ­æè¿° (e.g. \"å¤è€çš„æ©¡æ ‘\", \"ç ´ç¢çš„é›•åƒ\")\\n   - tactical: æˆ˜æœ¯å±æ€§ (cover: æ©ä½“, block: é˜»æŒ¡, difficult: å›°éš¾åœ°å½¢)\\n\\nåªè¿”å›JSONï¼Œä¸è¦å…¶ä»–è§£é‡Šã€‚`,battleSVG:n=>`ä½ æ˜¯ä¸€ä¸ªæ•°å­—è‰ºæœ¯åœ°å›¾ç»˜åˆ¶å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ç»“æ„æ•°æ®ï¼Œç»˜åˆ¶ä¸€å¼ **ä¿¯è§†è§†è§’ (Top-Down)** çš„é«˜ç²¾åº¦æˆ˜æ–—åœ°å›¾åº•å›¾ã€‚\\n\\n${n}\\n\\n**ç»˜å›¾è§„èŒƒ (SVG)**ï¼š\\n\\n1.  **å°ºå¯¸ä¸è§†å›¾**ï¼š\\n    *   å‡è®¾æ¯ä¸ªç½‘æ ¼å•ä½ (Unit) ä¸º 50åƒç´ ã€‚\\n    *   SVG \\`width\\` = dimensions.width * 50, \\`height\\` = dimensions.height * 50ã€‚\\n    *   \\`viewBox\\` = \"0 0 width height\"ã€‚\\n    *   **ä¸è¦ç”»ç½‘æ ¼çº¿ï¼** (Grid lines) - ç½‘æ ¼çº¿ç”±ä¸Šå±‚UIè´Ÿè´£ï¼Œä½ åªè´Ÿè´£ç”»åº•å›¾ã€‚\\n\\n2.  **è‰ºæœ¯é£æ ¼ (Art Style)**ï¼š\\n    *   **å†™å®æè´¨ + æ‰‹ç»˜è½®å»“**ï¼šåœ°é¢ä½¿ç”¨é«˜è´¨é‡çš„çº¹ç†å›¾æ¡ˆ (Patterns)ï¼Œç‰©ä½“ä½¿ç”¨æœ‰åšåº¦çš„è½®å»“çº¿ã€‚\\n    *   **å…‰å½±ä¸ç«‹ä½“æ„Ÿ**ï¼š\\n        - **å¿…é¡»ä½¿ç”¨æŠ•å½± (Drop Shadow)**ï¼šä¸ºæ‰€æœ‰ç›´ç«‹ç‰©ä½“ï¼ˆæ ‘ã€å¢™ã€æŸ±å­ï¼‰æ·»åŠ  \\`<filter>\\` æŠ•å½±æ•ˆæœï¼Œæ¨¡æ‹Ÿå…‰ç…§ï¼Œäº§ç”Ÿç«‹ä½“æ„Ÿã€‚\\n        - **ç¯å¢ƒå…‰é®è”½ (AO)**ï¼šåœ¨å¢™è§’æˆ–ç‰©ä½“åº•éƒ¨æ·»åŠ æ·±è‰²æ¸å˜ã€‚\\n    *   **è‰²å½©**ï¼šé¥±å’Œåº¦é€‚ä¸­ï¼Œä¸è¦å¤ªé²œè‰³ï¼Œç¨å¾®åå‘ \"Grim Dark\" æˆ– \"High Fantasy\" é£æ ¼ã€‚\\n\\n3.  **å›¾å±‚å¤„ç†**ï¼š\\n    *   **åº•å±‚ (Background)**ï¼šé“ºæ»¡å…¨å›¾çš„åŸºç¡€åœ°é¢çº¹ç†ï¼ˆè‰åœ°ã€çŸ³æ¿è·¯ç­‰ï¼‰ã€‚ä½¿ç”¨ <pattern> å®šä¹‰çº¹ç†ç»†èŠ‚ï¼Œé¿å…å•è‰²å¡«å……ã€‚\\n    *   **è£…é¥°å±‚ (Details)**ï¼šåœ¨åœ°é¢ä¸Šæ·»åŠ ä¸€äº›éšæœºå™ªç‚¹ã€å°çŸ³å­ã€è£‚ç¼ã€æ±¡æ¸ï¼Œæ‰“ç ´å•è°ƒã€‚\\n    *   **ç‰©ä½“å±‚ (Objects)**ï¼šç»˜åˆ¶ terrain_objectsã€‚\\n        - æ ‘æœ¨ï¼šç»˜åˆ¶æ ‘å† çš„ä¿¯è§†å›¾ï¼ˆé€šå¸¸æ˜¯ä¸è§„åˆ™åœ†å½¢ï¼‰ï¼Œå¸¦æœ‰å¶å­çº¹ç†ã€‚\\n        - å¢™å£/æŸ±å­ï¼šè¦æœ‰é¡¶éƒ¨å¹³é¢å’Œä¾§é¢æŠ•å½±ã€‚\\n        - æ°´é¢ï¼šä½¿ç”¨åŠé€æ˜è“è‰² + æ³¢çº¹æ»¤é•œã€‚\\n\\n4.  **æŠ€æœ¯ç»†èŠ‚**ï¼š\\n    *   åœ¨ <defs> ä¸­é¢„å®šä¹‰å¥½å¸¸ç”¨çš„æ»¤é•œ (Shadow, Glow) å’Œå›¾æ¡ˆ (Grass, Stone, Water)ã€‚\\n    *   æ‰€æœ‰åæ ‡éœ€ä¹˜ä»¥ 50 è½¬æ¢ä¸ºåƒç´ åæ ‡ã€‚\\n\\n5.  **è¾“å‡ºè¦æ±‚**ï¼š\\n    *   åªè¾“å‡º <svg> ä»£ç ã€‚\\n    *   ä¸éœ€è¦æ–‡å­—æ ‡ç­¾ã€‚\\n    *   ä¸éœ€è¦è¾¹æ¡†ã€‚\\n\\nç›´æ¥è¿”å› <svg ...> ... </svg>ã€‚`},checkStructure:n=>{const t=Rr.getTable(\"EXPLORATION_Map_Data\");if(!t)return null;const e=t.find(t=>t.LocationName===n);return e?e.MapStructureJSON:null},generateStructure:async(t,e)=>{const a=await to();if(!a.url||!a.key)throw new Error(\"è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key\");const r=`${t}ã€‚${e||\"\"}`,o=po.prompts.structure(r);n.info(\"[ExplorationMap] Generating structure for:\",t);let i=await no.generate([{role:\"user\",content:o}],{customConfig:a,maxTokens:4e3});const d=i.match(/```json\\s*([\\s\\S]*?)\\s*```/)||i.match(/```\\s*([\\s\\S]*?)\\s*```/);return d&&(i=d[1]),i=i.trim(),i.startsWith(\"{\")||(i=i.substring(i.indexOf(\"{\"))),i.endsWith(\"}\")||(i=i.substring(0,i.lastIndexOf(\"}\")+1)),JSON.parse(i),await po.saveStructure(t,i),i},saveStructure:async(t,e)=>{const a=Rr.getAllData(),r=Object.keys(a).find(n=>n.includes(\"EXPLORATION_Map_Data\")||a[n].name&&a[n].name.includes(\"æ¢ç´¢åœ°å›¾æ•°æ®\"));if(!r)return void n.error(\"Table EXPLORATION_Map_Data not found!\");const o=a[r];o.content||(o.content=[]);const i=o.content[0],d=i.indexOf(\"LocationName\"),s=i.indexOf(\"MapStructureJSON\"),l=i.indexOf(\"LastUpdated\");let c=o.content.slice(1).find(n=>n[d]===t);if(c)c[s]=e,c[l]=(new Date).toISOString();else{const n=new Array(i.length).fill(null);n[d]=t,n[s]=e,n[l]=(new Date).toISOString(),o.content.push(n)}await Lr.saveData(a)},generateSVG:async(a,r)=>{const o=await to();if(!o.url||!o.key)throw new Error(\"è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key\");const i=po.prompts.svg(r);n.info(\"[ExplorationMap] Generating SVG for:\",a);let d=await no.generate([{role:\"user\",content:i}],{customConfig:o,maxTokens:8192});const s=d.match(/```(?:xml|svg|html)?\\s*([\\s\\S]*?)\\s*```/i);s&&(d=s[1]);const l=d.indexOf(\"<svg\"),c=d.lastIndexOf(\"</svg>\");if(-1===l||-1===c)throw new Error(\"æœªèƒ½æå–æœ‰æ•ˆçš„ SVG ä»£ç \");return d=d.substring(l,c+6),d.match(/^<svg[^>]+xmlns=\"http\\:\\/\\/www\\.w3\\.org\\/2000\\/svg\"/)||(d=d.replace(/^<svg/,'<svg xmlns=\"http://www.w3.org/2000/svg\"')),await t.setSVG(a,d),await e.saveToChat(`map_${a}`,d),d},getMap:async(a,r,o=!1)=>{const i=`map_${a}`;if(!o){const n=e.getFromChat(i);if(n)return{type:\"svg\",content:n}}if(!o){const n=await t.getSVG(a);if(n)return{type:\"svg\",content:n}}let d=po.checkStructure(a);if(!d)try{n.info(\"Structure not found, generating new structure for:\",a),d=await po.generateStructure(a,r)}catch(n){return{type:\"error\",message:\"ç»“æ„ç”Ÿæˆå¤±è´¥: \"+n.message}}try{return{type:\"svg\",content:await po.generateSVG(a,d)}}catch(n){return{type:\"error\",message:\"ç»˜å›¾å¤±è´¥: \"+n.message}}},checkBattleStructure:n=>{const t=Rr.getTable(\"COMBAT_Map_Visuals\");if(!t)return null;const e=t.find(t=>t.SceneName===n);return e?e.VisualJSON:null},saveBattleStructure:async(t,e,a,r)=>{const o=Rr.getAllData(),i=Object.keys(o).find(n=>n.includes(\"COMBAT_Map_Visuals\")||o[n].name&&o[n].name.includes(\"æˆ˜æ–—åœ°å›¾ç»˜åˆ¶\"));if(!i)return void n.warn(\"Table COMBAT_Map_Visuals not found, skipping save.\");const d=o[i];d.content||(d.content=[]);const s=d.content[0],l=s.indexOf(\"SceneName\"),c=s.indexOf(\"VisualJSON\"),p=s.indexOf(\"GridSize\"),g=s.indexOf(\"LastUpdated\");let f=d.content.slice(1).find(n=>n[l]===t);const b=(new Date).toISOString(),m=`${a}x${r}`;if(f)f[c]=e,f[p]=m,f[g]=b;else{const n=new Array(s.length).fill(null);n[l]=t,n[c]=e,n[p]=m,n[g]=b,d.content.push(n)}await Lr.saveData(o)},getBattleMap:async(a,r,o,i,d=!1)=>{const s=`BATTLE_MAP_${a}_${o}x${i}`,l=`map_${s}`;if(!d){const n=e.getFromChat(l);if(n)return{type:\"svg\",content:n}}if(!d){const n=await t.getSVG(s);if(n)return{type:\"svg\",content:n}}const c=await to();if(!c.url||!c.key)throw new Error(\"è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® API Key\");try{let l=null;if(d||(l=po.checkBattleStructure(a),l&&n.info(\"[BattleMap] Loaded structure from table:\",a)),!l){n.info(\"[BattleMap] Generating new structure for:\",a);const t=po.prompts.battleStructure(a+\" \"+r,o,i);l=await no.generate([{role:\"user\",content:t}],{customConfig:c,maxTokens:2e3});const e=l.match(/```json\\s*([\\s\\S]*?)\\s*```/)||l.match(/```\\s*([\\s\\S]*?)\\s*```/);e&&(l=e[1]),l=l.trim(),l.startsWith(\"{\")||(l=l.substring(l.indexOf(\"{\"))),l.endsWith(\"}\")||(l=l.substring(0,l.lastIndexOf(\"}\")+1)),await po.saveBattleStructure(a,l,o,i)}n.info(\"[BattleMap] Generating SVG...\");const p=po.prompts.battleSVG(l);let g=await no.generate([{role:\"user\",content:p}],{customConfig:c,maxTokens:8192});const f=g.match(/```(?:xml|svg|html)?\\s*([\\s\\S]*?)\\s*```/i);f&&(g=f[1]);const b=g.indexOf(\"<svg\"),m=g.lastIndexOf(\"</svg>\");return-1!==b&&-1!==m&&(g=g.substring(b,m+6)),g.match(/^<svg[^>]+xmlns=\"http\\:\\/\\/www\\.w3\\.org\\/2000\\/svg\"/)||(g=g.replace(/^<svg/,'<svg xmlns=\"http://www.w3.org/2000/svg\"')),await t.setSVG(s,g),await e.saveToChat(`map_${s}`,g),{type:\"svg\",content:g}}catch(t){return n.error(\"[BattleMap] Generation failed\",t),{type:\"error\",message:t.message}}}},go={_mapZoom:{scale:1,panX:0,panY:0,isPanning:!1,lastTouchDist:0},bindMapZoom(n,e){const{$:i}=a(),d=this,s=this._mapZoom,l=n[0];n.css({\"user-select\":\"none\",\"touch-action\":\"none\"}),e.css(\"user-select\",\"none\"),t.getSetting(o.STORAGE_KEYS.MAP_ZOOM).then(n=>{s.scale=n&&parseFloat(n)||1,c()});const c=()=>{e.css({transform:`scale(${s.scale}) translate(${s.panX}px, ${s.panY}px)`,transformOrigin:\"center center\",transition:s.isPanning?\"none\":\"transform 0.2s ease-out\"}),p()};n.data(\"applyTransform\",c),0===n.find(\".dnd-map-zoom-indicator\").length&&n.append('<div class=\"dnd-map-zoom-indicator\" style=\"position:absolute;top:2px;right:4px;font-size:8px;color:rgba(255,255,255,0.6);background:rgba(0,0,0,0.4);padding:1px 3px;border-radius:2px;pointer-events:none;z-index:31;\">100%</div>');const p=()=>{n.find(\".dnd-map-zoom-indicator\").text(`${Math.round(100*s.scale)}%`)};let g=0,f=0,b=0,m=0,u=0,h=1,x=new Map,v=!1;const y=t=>{if(v)v=!1;else{if(x.delete(t.pointerId),l.releasePointerCapture)try{l.releasePointerCapture(t.pointerId)}catch(n){}if(0===x.size)s.isPanning=!1,n.css(\"cursor\",\"\"),r(o.STORAGE_KEYS.MAP_ZOOM,s.scale);else if(1===x.size){const n=x.values().next().value;s.isPanning=!0,g=n.x,f=n.y,b=s.panX,m=s.panY}}};n.off(\"mousedown mousemove mouseup touchstart touchmove touchend\"),l.addEventListener(\"pointerdown\",t=>{if(2===t.button)return;const e=document.elementFromPoint(t.clientX,t.clientY),a=i(e).closest(\".dnd-minimap-token\").length>0,r=d._targetingMode&&d._targetingMode.active;if(a||r)return v=!0,void console.log(\"[MapZoom] Drag disabled - isOnToken:\",a,\"isTargeting:\",r);if(v=!1,t.preventDefault(),t.stopPropagation(),x.set(t.pointerId,{x:t.clientX,y:t.clientY}),l.setPointerCapture)try{l.setPointerCapture(t.pointerId)}catch(n){}if(1===x.size)s.isPanning=!0,g=t.clientX,f=t.clientY,b=s.panX,m=s.panY,n.css(\"cursor\",\"grabbing\");else if(2===x.size){s.isPanning=!1;const n=Array.from(x.values()),t=n[0].x-n[1].x,e=n[0].y-n[1].y;u=Math.hypot(t,e),h=s.scale}}),l.addEventListener(\"pointermove\",n=>{if(!v&&x.has(n.pointerId))if(n.preventDefault(),x.set(n.pointerId,{x:n.clientX,y:n.clientY}),1===x.size&&s.isPanning){const t=n.clientX-g,e=n.clientY-f;s.panX=b+t/s.scale,s.panY=m+e/s.scale,c()}else if(2===x.size){const n=Array.from(x.values()),t=n[0].x-n[1].x,e=n[0].y-n[1].y,a=Math.hypot(t,e);if(u>0){const n=a/u;s.scale=Math.max(o.MAP_ZOOM.MIN,Math.min(o.MAP_ZOOM.MAX,h*n)),c()}}}),l.addEventListener(\"pointerup\",y),l.addEventListener(\"pointercancel\",y),l.addEventListener(\"pointerleave\",y),l.addEventListener(\"wheel\",n=>{n.preventDefault(),n.stopPropagation();const t=n.deltaY>0?-o.MAP_ZOOM.STEP:o.MAP_ZOOM.STEP;s.scale=Math.max(o.MAP_ZOOM.MIN,Math.min(o.MAP_ZOOM.MAX,s.scale+t)),c(),d._zoomSaveTimer&&clearTimeout(d._zoomSaveTimer),d._zoomSaveTimer=setTimeout(()=>r(o.STORAGE_KEYS.MAP_ZOOM,s.scale),500)},{passive:!1});let w=0;n.on(\"click\",n=>{const t=Date.now();t-w<300&&(s.scale=o.MAP_ZOOM.DEFAULT,s.panX=0,s.panY=0,c(),r(o.STORAGE_KEYS.MAP_ZOOM,s.scale)),w=t}),c()},async renderMiniMap(n){const{$:t}=a(),e=Rr.getTable(\"SYS_GlobalState\"),r=e&&e[0]?e[0]:{},o=\"æˆ˜æ–—ä¸­\"===r[\"æˆ˜æ–—æ¨¡å¼\"];let i=r[\"å½“å‰åœºæ™¯\"]||\"æœªçŸ¥åŒºåŸŸ\";const d=Rr.getTable(\"EXPLORATION_Map_Data\");if(d){const n=d.find(n=>{const t=n[\"å½“å‰æ˜¾ç¤ºåœ°å›¾\"];return\"æ˜¯\"===t||!0===t||\"True\"===t||\"true\"===t});n&&n.LocationName&&(i=n.LocationName)}if(!o){let e=n.find(\".dnd-exploration-inner\");0===e.length&&(n.empty(),n.css({position:\"relative\",background:\"#0a0a0c\",overflow:\"hidden\"}),e=t('<div class=\"dnd-exploration-inner\" style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;transform-origin:center center;\"></div>'),n.append(e),this.bindMapZoom(n,e));const a=\"dnd-exploration-map-loader\";e.is(\":empty\")&&e.html(`<div id=\"${a}\" style=\"display:flex;align-items:center;justify-content:center;color:#666;flex-direction:column;gap:5px;\">\\n                    <div class=\"dnd-spinner\" style=\"width:20px;height:20px;border:2px solid #333;border-top:2px solid var(--dnd-border-gold);border-radius:50%;animation:dnd-spin 1s infinite linear;\"></div>\\n                    <div style=\"font-size:10px;\">åŠ è½½åœ°å›¾...</div>\\n                </div>`);try{const t=await po.getMap(i,r[\"åœºæ™¯æè¿°\"]);if(\"svg\"===t.type){const a=t.content;e.html(a);const r=e.find(\"svg\");if(r.css({width:\"100%\",height:\"100%\",objectFit:\"contain\",pointerEvents:\"none\"}),setTimeout(()=>{try{const t=r[0].getAttribute(\"viewBox\");if(t){const[e,a,r,o]=t.split(/[\\s,]+/).map(parseFloat),i=r/o,d=n.width(),s=d/n.height();let l=1;l=s>i?s/i:i/s,l*=1.02,console.log(\"[MapZoom] Auto-Fit Scale:\",l,{containerRatio:s,svgRatio:i}),l>1&&(this._mapZoom.scale=l,this._mapZoom.panX=0,this._mapZoom.panY=0,n.data(\"applyTransform\")&&n.data(\"applyTransform\")())}}catch(n){console.warn(\"Auto-zoom failed\",n)}},50),0===n.find(\".dnd-map-controls\").length){const t=`\\n                            <div class=\"dnd-map-controls\" style=\"position:absolute;top:5px;right:5px;display:flex;gap:5px;opacity:0;transition:opacity 0.2s;z-index:10;\">\\n                                <button type=\"button\" onclick=\"window.DND_Dashboard_UI.regenerateMap('${i}', 'svg')\" title=\"ä¿æŒç»“æ„é‡ç»˜å›¾ç‰‡\" style=\"background:rgba(0,0,0,0.6);border:1px solid #555;color:#fff;border-radius:4px;padding:2px 6px;cursor:pointer;font-size:10px;\">ğŸ¨ é‡ç»˜</button>\\n                            </div>\\n                        `;n.append(t),n.hover(()=>n.find(\".dnd-map-controls\").css(\"opacity\",1),()=>n.find(\".dnd-map-controls\").css(\"opacity\",0))}}else\"error\"===t.type&&t.message.includes(\"ç»“æ„\")?e.html(`\\n                        <div style=\"text-align:center;color:#888;\">\\n                            <div style=\"font-size:24px;margin-bottom:5px;\">ğŸ—ºï¸</div>\\n                            <div style=\"font-size:10px;margin-bottom:10px;\">${t.message}</div>\\n                        </div>\\n                    `):e.html(`<div style=\"color:#e74c3c;font-size:10px;padding:10px;text-align:center;\">${t.message}</div>`)}catch(n){e.html(`<div style=\"color:#e74c3c;font-size:10px;\">åŠ è½½é”™è¯¯: ${n.message}</div>`)}return}const s=Rr.getTable(\"COMBAT_BattleMap\"),l=Rr.getTable(\"COMBAT_Encounter\");if(!s)return void n.html('<div style=\"color:#666;display:flex;align-items:center;justify-content:center;height:100%;\">æ— æˆ˜æ–—æ•°æ®</div>');const c=r[\"å½“å‰å›åˆ\"]||0,p=s.find(n=>\"Config\"===n[\"ç±»å‹\"]);let g=20,f=20;if(p&&p[\"åæ ‡\"]){const n=Rr.parseValue(p[\"åæ ‡\"],\"size\");n&&(g=n.w||20,f=n.h||20)}const b=Math.min(12,Math.max(6,Math.floor(180/Math.max(g,f)))),m=g*b,u=f*b,h=(180-m)/2,x=(180-u)/2;let v=n.find(\".dnd-minimap-inner\"),y=!1;if(0===v.length||parseFloat(v.data(\"cols\"))!==g||parseFloat(v.data(\"rows\"))!==f){n.empty(),y=!0,v=t(`<div class=\"dnd-minimap-inner\"\\n                style=\"position:absolute;left:${h}px;top:${x}px;width:${m}px;height:${u}px;background:#1a1a1c;\"\\n                data-cell-size=\"${b}\" data-cols=\"${g}\" data-rows=\"${f}\"></div>`),n.append(v);const e=`dnd-battle-bg-${i.replace(/\\s+/g,\"_\")}`;v.append(`<div id=\"${e}\" class=\"dnd-battle-bg-container\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;overflow:hidden;\"></div>`),po.getBattleMap(i,r[\"åœºæ™¯æè¿°\"],g,f,!1).then(n=>{if(\"svg\"===n.type){const t=v.find(`#${e}`);t.html(n.content),t.find(\"svg\").css({width:\"100%\",height:\"100%\",preserveAspectRatio:\"none\"})}});const a=`\\n                <svg class=\"dnd-minimap-grid\" width=\"${m}\" height=\"${u}\" style=\"position:absolute;top:0;left:0;pointer-events:none;opacity:0.3;z-index:5;\">\\n                    <defs>\\n                        <pattern id=\"miniGrid\" width=\"${b}\" height=\"${b}\" patternUnits=\"userSpaceOnUse\">\\n                            <path d=\"M ${b} 0 L 0 0 0 ${b}\" fill=\"none\" stroke=\"rgba(255,255,255,0.3)\" stroke-width=\"1\"/>\\n                        </pattern>\\n                    </defs>\\n                    <rect width=\"100%\" height=\"100%\" fill=\"url(#miniGrid)\"/>\\n                </svg>\\n            `;v.append(a),s.forEach(n=>{if([\"Token\",\"Config\"].includes(n[\"ç±»å‹\"]))return;const t=Rr.parseValue(n[\"åæ ‡\"],\"coord\");if(!t)return;const e=(void 0!==t.x?t.x:1)-1,a=(void 0!==t.y?t.y:1)-1,r=Rr.parseValue(n[\"å¤§å°\"],\"size\")||{w:1,h:1},o=e*b,i=a*b,d=r.w*b,s=r.h*b;let l=\"\";\"Wall\"===n[\"ç±»å‹\"]?l=`<div style=\"position:absolute;left:${o}px;top:${i}px;width:${d}px;height:${s}px;background:#3a3a3a;border:1px solid #555;z-index:1;\"></div>`:\"Terrain\"===n[\"ç±»å‹\"]?l=`<div style=\"position:absolute;left:${o}px;top:${i}px;width:${d}px;height:${s}px;background:rgba(46, 204, 113, 0.2);border:1px dashed rgba(46, 204, 113, 0.4);z-index:0;\"></div>`:\"Zone\"===n[\"ç±»å‹\"]&&(l=`<div style=\"position:absolute;left:${o}px;top:${i}px;width:${d}px;height:${s}px;background:rgba(155, 89, 182, 0.25);border:2px solid rgba(155, 89, 182, 0.5);border-radius:50%;z-index:2;\"></div>`),l&&v.append(l)});const o=this;v.on(\"click\",e=>{e.stopPropagation();const a=v[0].getBoundingClientRect(),r=e.clientX-a.left,i=e.clientY-a.top,d=t('<div class=\"dnd-map-ripple\"></div>');d.css({left:r+\"px\",top:i+\"px\",width:2*b+\"px\",height:2*b+\"px\",marginLeft:-b+\"px\",marginTop:-b+\"px\"}),v.append(d),setTimeout(()=>d.remove(),600);const s=o.getGridFromEvent(e,n,v);o.handleMapInteraction(s.x,s.y)}),this.bindMapZoom(n,v),n.append(`\\n                <div class=\"dnd-hud-overlay\" style=\"pointer-events:none;z-index:30;\">\\n                    <div style=\"position:absolute;top:2px;left:4px;font-size:9px;color:rgba(255,255,255,0.5);text-shadow:1px 1px 2px #000;\">A1</div>\\n                    <div style=\"position:absolute;bottom:2px;right:4px;font-size:9px;color:rgba(255,255,255,0.5);text-shadow:1px 1px 2px #000;\">${String.fromCharCode(64+Math.min(g,26))}${f}</div>\\n                    <div id=\"dnd-map-round-info\" style=\"position:absolute;bottom:2px;left:4px;font-size:9px;color:var(--dnd-text-highlight);background:rgba(0,0,0,0.5);padding:0 4px;border-radius:2px;\">ç¬¬ ${c} å›åˆ</div>\\n                    \\n                    \\x3c!-- Battle Map Controls --\\x3e\\n                    <div class=\"dnd-map-controls\" style=\"position:absolute;top:2px;right:2px;display:flex;gap:2px;pointer-events:auto;opacity:0.8;\">\\n                        <button type=\"button\" onclick=\"window.DND_Dashboard_UI.regenerateMap('${i}', 'svg')\" title=\"ç”Ÿæˆ/åˆ·æ–° æˆ˜æ–—åº•å›¾\" style=\"background:rgba(0,0,0,0.6);border:1px solid #444;color:#fff;border-radius:3px;padding:1px 4px;cursor:pointer;font-size:9px;\">ğŸ¨ AIåº•å›¾</button>\\n                    </div>\\n                </div>\\n            `)}else n.find(\"#dnd-map-round-info\").text(`ç¬¬ ${c} å›åˆ`);const w=s.filter(n=>\"Token\"===n[\"ç±»å‹\"]),k=new Set,S=Rr.getPartyData();w.forEach(n=>{const e=Rr.parseValue(n[\"åæ ‡\"],\"coord\");if(!e)return;const a=(void 0!==e.x?e.x:1)-1,r=(void 0!==e.y?e.y:1)-1,o=Rr.parseValue(n[\"å¤§å°\"],\"size\")||{w:1,h:1},i=l?l.find(t=>t[\"å•ä½åç§°\"]===n[\"å•ä½åç§°\"]):null,d=!!i&&\"æ•Œæ–¹\"===i[\"é˜µè¥\"],s=!!i&&\"æ˜¯\"===i[\"æ˜¯å¦ä¸ºå½“å‰è¡ŒåŠ¨è€…\"],c=Math.max(b*o.w-2,4),p=d?\"#c0392b\":\"#27ae60\",g=s?\"#ffdb85\":\"transparent\",f=\"dnd-token-\"+n[\"å•ä½åç§°\"].replace(/[^a-zA-Z0-9_\\u4e00-\\u9fa5]/g,\"_\");k.add(f);let m=v.find(`#${f}`);const u={left:a*b+1+\"px\",top:r*b+1+\"px\",width:c+\"px\",height:c+\"px\",background:p,borderColor:g};if(m.length>0)m.css(u),s&&!m.hasClass(\"active\")?m.addClass(\"active\"):!s&&m.hasClass(\"active\")&&m.removeClass(\"active\");else{let e=n[\"å•ä½åç§°\"];if(S){const t=S.find(t=>t[\"å§“å\"]===n[\"å•ä½åç§°\"]);t&&(e=t.CHAR_ID||t.PC_ID||t[\"å§“å\"])}const a=this.getNameInitial(n[\"å•ä½åç§°\"]),r=`token-content-${f}`;m=t(`<div id=\"${f}\" class=\"dnd-minimap-token ${s?\"active\":\"\"}\" title=\"${n[\"å•ä½åç§°\"]}\">\\n                    <div id=\"${r}\" style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;font-size:${Math.floor(.6*c)}px;text-shadow:0 0 2px #000;pointer-events:none;\">\\n                        ${a}\\n                    </div>\\n                </div>`),m.css(u),setTimeout(()=>this.loadAvatarAsync(e,r),0);const o=this;m.on(\"click\",t=>{if(t.stopPropagation(),o._targetingMode.active){const t=Rr.parseValue(n[\"åæ ‡\"],\"coord\");t&&o.handleMapInteraction(t.x||1,t.y||1)}else i&&o.showCombatUnitDetail(i,t)}),v.append(m)}}),v.find(\".dnd-minimap-token\").each(function(){const n=t(this).attr(\"id\");n&&!k.has(n)&&t(this).fadeOut(300,function(){t(this).remove()})}),v.find(\".dnd-map-overlay\").remove();const C=this.getControlledCharacter();let $={x:0,y:0},_=!1,z=null;if(l&&C){let n=l.find(n=>n[\"å•ä½åç§°\"]===C[\"å§“å\"]);if(!n&&C[\"å§“å\"]&&(n=l.find(n=>C[\"å§“å\"].includes(n[\"å•ä½åç§°\"])||n[\"å•ä½åç§°\"].includes(C[\"å§“å\"]))),n){const t=s.find(t=>\"Token\"===t[\"ç±»å‹\"]&&t[\"å•ä½åç§°\"]===n[\"å•ä½åç§°\"]);if(t){const n=Rr.parseValue(t[\"åæ ‡\"],\"coord\");n&&(z={x:n.x||1,y:n.y||1})}}}if(this._virtualPos){$={...this._virtualPos},_=!0;const n=($.x-1)*b,t=($.y-1)*b,e=`<div class=\"dnd-map-overlay\" style=\"position:absolute;left:${n}px;top:${t}px;width:${b}px;height:${b}px;border:2px dashed var(--dnd-text-highlight);border-radius:50%;background:rgba(255, 219, 133, 0.2);pointer-events:none;z-index:20;display:flex;align-items:center;justify-content:center;font-size:10px;color:#fff;\">ğŸ‘»</div>`;if(v.append(e),z){const e=`\\n                    <svg class=\"dnd-map-overlay\" width=\"${m}\" height=\"${u}\" style=\"position:absolute;top:0;left:0;pointer-events:none;z-index:15;\">\\n                        <line x1=\"${(z.x-1)*b+b/2}\" y1=\"${(z.y-1)*b+b/2}\" x2=\"${n+b/2}\" y2=\"${t+b/2}\" stroke=\"var(--dnd-text-highlight)\" stroke-width=\"1\" stroke-dasharray=\"4\"/>\\n                    </svg>\\n                `;v.append(e)}}else z&&($=z,_=!0);if(this._targetingMode.active&&_){const n=(this._targetingMode.range||1)*b,t=`<div class=\"dnd-map-overlay\" style=\"position:absolute;left:${($.x-1)*b+b/2-n}px;top:${($.y-1)*b+b/2-n}px;width:${2*n}px;height:${2*n}px;border:2px solid var(--dnd-accent-green);background:rgba(46, 204, 113, 0.1);border-radius:50%;pointer-events:none;z-index:25;box-shadow: 0 0 15px rgba(46, 204, 113, 0.3);\"></div>`;v.append(t)}},async regenerateMap(n,t){const{$:e}=a(),r=Rr.getTable(\"SYS_GlobalState\"),o=r&&r[0]&&\"æˆ˜æ–—ä¸­\"===r[0][\"æˆ˜æ–—æ¨¡å¼\"];let i=\"ç¡®å®šè¦é‡æ–°ç»˜åˆ¶åœ°å›¾å›¾ç‰‡å—ï¼Ÿç»“æ„å°†ä¿æŒä¸å˜ã€‚\";o&&(i=\"ç¡®å®šè¦é‡æ–°ç”Ÿæˆæˆ˜æ–—åœºæ™¯åº•å›¾å—ï¼Ÿè¿™éœ€è¦æ¶ˆè€— tokensã€‚\");if(!await jr.confirm(i,{title:\"é‡ç»˜åœ°å›¾\",confirmText:\"é‡ç»˜\",type:\"warning\"}))return;let d=e(\"#dnd-hud-minimap-content\");if(o){const n=e(\".dnd-minimap-inner\");n.length&&n.append('<div id=\"dnd-map-loading-overlay\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:100;display:flex;align-items:center;justify-content:center;color:#fff;\">\\n                    <div style=\"text-align:center;\">\\n                        <div class=\"dnd-spinner\" style=\"width:24px;height:24px;border:3px solid #333;border-top:3px solid var(--dnd-border-gold);border-radius:50%;animation:dnd-spin 1s infinite linear;margin:0 auto 5px;\"></div>\\n                        <div style=\"font-size:10px;\">AI æ­£åœ¨æ„ç­‘æˆ˜åœº...</div>\\n                    </div>\\n                 </div>')}else d.html('<div style=\"width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#ccc;flex-direction:column;gap:5px;\">\\n                <div class=\"dnd-spinner\" style=\"width:24px;height:24px;border:3px solid #333;border-top:3px solid var(--dnd-border-gold);border-radius:50%;animation:dnd-spin 1s infinite linear;\"></div>\\n                <div style=\"font-size:11px;\">AI æ­£åœ¨ç»˜å›¾...</div>\\n            </div>');try{const t=r&&r[0]?r[0][\"åœºæ™¯æè¿°\"]:\"\";if(o){const a=Rr.getTable(\"COMBAT_BattleMap\"),r=a?a.find(n=>\"Config\"===n[\"ç±»å‹\"]):null;let o=20,i=20;if(r&&r[\"åæ ‡\"]){const n=Rr.parseValue(r[\"åæ ‡\"],\"size\");n&&(o=n.w||20,i=n.h||20)}await po.getBattleMap(n,t,o,i,!0),e(\"#dnd-map-loading-overlay\").remove()}else{const e=!0;await po.getMap(n,t,e)}this.renderHUD()}catch(n){jr.error(\"ç”Ÿæˆå¤±è´¥: \"+n.message),this.renderHUD()}},handleMapInteraction(n,t){const e=this._targetingMode,r=Rr.getTable(\"COMBAT_Encounter\"),o=Rr.getTable(\"COMBAT_BattleMap\"),i=this.getControlledCharacter();if(e.active){let a=999,d={x:0,y:0};if(this._virtualPos)d={...this._virtualPos};else if(r&&i){let n=r.find(n=>n[\"å•ä½åç§°\"]===i[\"å§“å\"]);!n&&i[\"å§“å\"]&&(n=r.find(n=>i[\"å§“å\"].includes(n[\"å•ä½åç§°\"])||n[\"å•ä½åç§°\"].includes(i[\"å§“å\"])));const t=o?o.find(t=>\"Token\"===t[\"ç±»å‹\"]&&t[\"å•ä½åç§°\"]===(n?n[\"å•ä½åç§°\"]:\"\")):null;if(t){const n=Rr.parseValue(t[\"åæ ‡\"],\"coord\");n&&(d={x:n.x||1,y:n.y||1})}}const s=Math.abs(n-d.x),l=Math.abs(t-d.y);if(a=Math.max(s,l),a>e.range)return void jr.warning(`ç›®æ ‡è¶…å‡ºèŒƒå›´ï¼(è·ç¦»: ${5*a}å°º / å°„ç¨‹: ${5*e.range}å°º)`);let c=null;const p=o.find(e=>\"Token\"===e[\"ç±»å‹\"]&&e[\"åæ ‡\"]&&Rr.parseValue(e[\"åæ ‡\"],\"coord\").x===n&&Rr.parseValue(e[\"åæ ‡\"],\"coord\").y===t);return p&&(c=p[\"å•ä½åç§°\"]),e.callback&&e.callback({x:n,y:t,target:c,distance:a}),void this.endTargeting()}const d=`\\n            <div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:5px;\">\\n                ğŸ“ ä½ç½®: ${String.fromCharCode(64+n)}${t}\\n            </div>\\n            <div class=\"dnd-clickable\" style=\"padding:8px;cursor:pointer;border-radius:4px;background:rgba(46, 204, 113, 0.2);border:1px solid var(--dnd-accent-green);text-align:center;font-weight:bold;\"\\n                onclick=\"window.DND_Dashboard_UI.executeAction('move', { x: ${n}, y: ${t} }); window.DND_Dashboard_UI.hideDetailPopup();\">\\n                ğŸ‘£ ç§»åŠ¨åˆ°æ­¤\\n            </div>\\n        `,{$:s}=a(),l=s(\"#dnd-mini-hud\")[0].getBoundingClientRect();this.showItemDetailPopup(d,l.left+l.width/2,l.top+l.height/2)}},fo={handleSpellClick(n,t){t&&t.stopPropagation();const e=Rr.getKnownSpells();if(!e)return;const a=e.find(t=>t[\"æ³•æœ¯åç§°\"]===n);if(!a)return;const r=`\\n            <div style=\"color:var(--dnd-text-highlight);font-weight:bold;border-bottom:1px solid #444;margin-bottom:5px;padding-bottom:3px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span>${a[\"æ³•æœ¯åç§°\"]} <span style=\"font-size:10px;color:#888;font-weight:normal\">(${\"0\"===a[\"ç¯é˜¶\"]||0===a[\"ç¯é˜¶\"]?\"æˆæ³•\":a[\"ç¯é˜¶\"]+\"ç¯\"})</span></span>\\n                <button class=\"dnd-clickable\" style=\"background:var(--dnd-accent-green);border:none;color:#fff;padding:2px 8px;border-radius:3px;font-size:11px;cursor:pointer;\"\\n                    onclick=\"window.DND_Dashboard_UI.prepareCast(\\n                        '${a[\"æ³•æœ¯åç§°\"]}',\\n                        '${a[\"å°„ç¨‹\"]||\"æ¥è§¦\"}',\\n                        '${a[\"ç¯é˜¶\"]}'\\n                    )\">\\n                    <i class=\"fa-solid fa-bolt\"></i> æ–½æ”¾\\n                </button>\\n            </div>\\n            <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:5px;font-size:11px;color:#aaa;margin-bottom:8px;\">\\n                <div>æ—¶é—´: ${a[\"æ–½æ³•æ—¶é—´\"]||\"-\"}</div>\\n                <div>å°„ç¨‹: ${a[\"å°„ç¨‹\"]||\"-\"}</div>\\n                <div>æˆåˆ†: ${a[\"æˆåˆ†\"]||\"-\"}</div>\\n                <div>æŒç»­: ${a[\"æŒç»­æ—¶é—´\"]||\"-\"}</div>\\n            </div>\\n            <div style=\"line-height:1.4;color:#ccc;\">${a[\"æ•ˆæœæè¿°\"]||\"æ— æè¿°\"}</div>\\n        `;this.showItemDetailPopup(r,t.clientX,t.clientY)},formatSpellSlots(n,t=!1){try{const{$:e}=a();if(0===e(\"#dnd-spell-styles\").length){const n='\\n                    <style id=\"dnd-spell-styles\">\\n                        .dnd-spell-group {\\n                            border: 1px solid var(--dnd-border-gold);\\n                            border-radius: 4px;\\n                            padding: 8px 4px 4px 4px;\\n                            position: relative;\\n                            display: inline-flex;\\n                            flex-direction: column;\\n                            align-items: center;\\n                            margin-right: 10px;\\n                            margin-top: 8px;\\n                            background: rgba(0,0,0,0.2);\\n                            min-width: 34px;\\n                            vertical-align: top;\\n                        }\\n                        .dnd-spell-group.mini {\\n                            min-width: 24px;\\n                            padding: 6px 3px 3px 3px;\\n                            margin-right: 5px;\\n                            margin-top: 6px;\\n                        }\\n                        .dnd-spell-level-label {\\n                            position: absolute;\\n                            top: -9px;\\n                            left: 50%;\\n                            transform: translateX(-50%);\\n                            background: var(--dnd-bg-panel);\\n                            padding: 0 4px;\\n                            font-size: 10px;\\n                            color: var(--dnd-text-dim);\\n                            font-family: var(--dnd-font-serif);\\n                            line-height: 14px;\\n                        }\\n                        .dnd-spell-group.mini .dnd-spell-level-label {\\n                            top: -7px;\\n                            font-size: 8px;\\n                            line-height: 10px;\\n                            padding: 0 2px;\\n                        }\\n                        .dnd-spell-pips {\\n                            display: flex;\\n                            flex-wrap: wrap;\\n                            gap: 3px;\\n                            justify-content: center;\\n                            max-width: 28px; /* Force wrapping for 4 items (2x2) */\\n                        }\\n                        .dnd-spell-group.mini .dnd-spell-pips {\\n                            gap: 2px;\\n                            max-width: 18px;\\n                        }\\n                        .dnd-spell-pip {\\n                            width: 10px;\\n                            height: 10px;\\n                            background: #222;\\n                            border: 1px solid #000;\\n                            box-shadow: inset 0 0 2px #000;\\n                            transition: all 0.2s;\\n                        }\\n                        .dnd-spell-group.mini .dnd-spell-pip {\\n                            width: 6px;\\n                            height: 6px;\\n                        }\\n                        .dnd-spell-pip.available {\\n                            background: linear-gradient(135deg, #3498db, #2980b9);\\n                            border-color: #5dade2;\\n                            box-shadow: 0 0 5px rgba(52, 152, 219, 0.6);\\n                        }\\n                    </style>\\n                ';e(\"head\").append(n)}const r=Rr.parseValue(n,\"resources\");if(!r)return\"\";const o=n=>({1:\"I\",2:\"II\",3:\"III\",4:\"IV\",5:\"V\",6:\"VI\",7:\"VII\",8:\"VIII\",9:\"IX\"}[n]||n);let i='<div style=\"display:flex;flex-wrap:wrap;\">';return Object.keys(r).sort((n,t)=>parseInt(n)-parseInt(t)).forEach(n=>{const e=r[n].toString().split(\"/\"),a=parseInt(e[0])||0,d=parseInt(e[1])||0;if(0===d)return;const s=parseInt(n)||n.replace(\"çº§\",\"\"),l=o(s);let c=\"\";for(let n=0;n<d;n++){const t=n<a;c+=`<div class=\"dnd-spell-pip ${t?\"available\":\"\"}\" title=\"${t?\"å¯ç”¨\":\"å·²æ¶ˆè€—\"}\"></div>`}i+=`\\n                    <div class=\"dnd-spell-group ${t?\"mini\":\"\"}\" title=\"${n}æ³•æœ¯ä½: ${a}/${d}\">\\n                        <div class=\"dnd-spell-level-label\">${l}</div>\\n                        <div class=\"dnd-spell-pips\">${c}</div>\\n                    </div>\\n                `}),i+=\"</div>\",i}catch(n){return console.error(\"Spell slot format error:\",n),'<span style=\"color:#8a2c2c\">èµ„æºè§£æé”™è¯¯</span>'}},showSpellBook(n){const t=Rr.getKnownSpells();if(!t)return;const e={};t.forEach(n=>{const t=\"0\"===n[\"ç¯é˜¶\"]||0===n[\"ç¯é˜¶\"]?\"æˆæ³•\":n[\"ç¯é˜¶\"]+\"ç¯\";e[t]||(e[t]=[]),e[t].push(n)});let a='<div style=\"font-weight:bold;color:#aab;border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:10px;\"><i class=\"fa-solid fa-book\"></i> æ³•æœ¯ä¹¦</div>';a+=`\\n            <div style=\"display:flex;gap:5px;margin-bottom:10px;\">\\n                <input type=\"text\" id=\"dnd-spell-search\" placeholder=\"æœç´¢æ³•æœ¯...\" style=\"flex:1;background:#1a1a1c;border:1px solid #444;color:#ccc;padding:4px 8px;border-radius:4px;font-size:12px;\" oninput=\"window.DND_Dashboard_UI.filterSpells()\">\\n                <select id=\"dnd-spell-filter\" style=\"background:#1a1a1c;border:1px solid #444;color:#ccc;padding:4px;border-radius:4px;font-size:12px;\" onchange=\"window.DND_Dashboard_UI.filterSpells()\">\\n                    <option value=\"\">å…¨éƒ¨ç¯é˜¶</option>\\n                    ${Object.keys(e).sort().map(n=>`<option value=\"${n}\">${n}</option>`).join(\"\")}\\n                </select>\\n            </div>\\n        `,a+='<div style=\"max-height:300px;overflow-y:auto;\" id=\"dnd-spell-list\">',Object.keys(e).sort().forEach(n=>{a+=`<div class=\"dnd-spell-group-header\" data-level=\"${n}\" style=\"color:var(--dnd-text-highlight);font-size:12px;margin:8px 0 4px 0;border-bottom:1px dashed #444;\">${n}</div>`,e[n].forEach(t=>{const e=\"æ˜¯\"===t[\"å·²å‡†å¤‡\"]||!0===t[\"å·²å‡†å¤‡\"]||\"æˆæ³•\"===n,r=e?'<i class=\"fa-solid fa-check\"></i>':'<i class=\"fa-regular fa-circle\"></i>',o=(t[\"æ³•æœ¯åç§°\"]||\"\").replace(/'/g,\"\\\\'\");a+=`\\n                    <div class=\"dnd-spell-item\" data-name=\"${t[\"æ³•æœ¯åç§°\"]}\" data-level=\"${n}\" style=\"display:flex;justify-content:space-between;padding:4px 0;font-size:12px;cursor:pointer;\"\\n                        onmouseover=\"this.style.background='rgba(255,255,255,0.05)'\"\\n                        onmouseout=\"this.style.background='transparent'\"\\n                        onclick=\"window.DND_Dashboard_UI.handleSpellClick('${o}', event)\">\\n                        <span style=\"color:${e?\"#e6dcca\":\"#888\"}\">${r} ${t[\"æ³•æœ¯åç§°\"]}</span>\\n                        <span style=\"color:#666;font-size:10px;\">${t[\"æ–½æ³•æ—¶é—´\"]}</span>\\n                    </div>\\n                `})}),a+=\"</div>\",this.showItemDetailPopup(a,n.clientX,n.clientY)},filterSpells(){const{$:n}=a(),t=n(\"#dnd-spell-search\").val().toLowerCase(),e=n(\"#dnd-spell-filter\").val();n(\".dnd-spell-item\").each(function(){const a=n(this),r=(a.data(\"name\")||\"\").toLowerCase(),o=a.data(\"level\")||\"\";(!t||r.includes(t))&&(!e||o===e)?a.show():a.hide()}),n(\".dnd-spell-group-header\").each(function(){const t=n(this).data(\"level\");n(`.dnd-spell-item[data-level=\"${t}\"]:visible`).length>0?n(this).show():n(this).hide()})}},bo={showQuickDice(n){const t=this.getDicePoolData(),e=t?t.length:0,a=e>=15?\"good\":e>=6?\"warning\":\"low\";let r=`\\n            <div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid #555;padding-bottom:5px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;\">\\n                <span>ğŸ² å¿«é€ŸæŠ•æ·</span>\\n                <span style=\"font-size:11px;color:${\"good\"===a?\"var(--dnd-accent-green)\":\"warning\"===a?\"#e67e22\":\"var(--dnd-accent-red)\"};background:rgba(0,0,0,0.3);padding:2px 6px;border-radius:3px;\">\\n                    æ± : ${e} (${\"good\"===a?\"å……è¶³\":\"warning\"===a?\"é€‚ä¸­\":\"ä¸è¶³\"})\\n                </span>\\n            </div>\\n            \\n            \\x3c!-- éª°å­æ± å¯è§†åŒ– --\\x3e\\n            <div style=\"background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;margin-bottom:12px;\">\\n                <div style=\"font-size:11px;color:#888;margin-bottom:6px;display:flex;justify-content:space-between;\">\\n                    <span>é¢„æŠ•éª°å­æ± </span>\\n                    <span onclick=\"window.DND_Dashboard_UI.refreshDicePool()\" style=\"cursor:pointer;color:var(--dnd-text-highlight);\">ğŸ”„ è¡¥å……</span>\\n                </div>\\n                <div style=\"display:flex;gap:3px;flex-wrap:wrap;max-height:60px;overflow-y:auto;\">\\n                    ${t&&t.length>0?t.slice(0,20).map((n,t)=>{const e=n.D20||n[7]||\"?\",a=20==e,r=1==e,o=a?\"var(--dnd-accent-green)\":r?\"var(--dnd-accent-red)\":\"rgba(255,255,255,0.1)\",i=a||r?\"#fff\":\"var(--dnd-text-main)\";return`<div title=\"D20:${e} D12:${n.D12||n[6]||\"?\"} D10:${n.D10||n[5]||\"?\"}\" \\n                            style=\"width:22px;height:22px;background:${o};border:1px solid #555;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:10px;color:${i};font-weight:bold;cursor:help;\">\\n                            ${e}\\n                        </div>`}).join(\"\"):'<div style=\"color:#666;font-size:11px;\">éª°å­æ± ä¸ºç©º</div>'}\\n                </div>\\n                <div style=\"font-size:10px;color:#666;margin-top:4px;\">æ˜¾ç¤º D20 å€¼ (æ‚¬åœæŸ¥çœ‹å…¶ä»–éª°å­)</div>\\n            </div>\\n            \\n            \\x3c!-- å¿«é€ŸæŠ•æ·æŒ‰é’® --\\x3e\\n            <div class=\"dnd-dice-grid\">\\n                ${[4,6,8,10,12,20].map(n=>`\\n                    <button class=\"dnd-dice-btn\" data-sides=\"${n}\" onclick=\"window.DND_Dashboard_UI.rollDice(${n}, event)\">\\n                        D${n}\\n                    </button>\\n                `).join(\"\")}\\n            </div>\\n            \\n            \\x3c!-- D100 å•ç‹¬ä¸€è¡Œ --\\x3e\\n            <div style=\"margin-top:8px;\">\\n                <button class=\"dnd-dice-btn\" data-sides=\"100\" style=\"\\n                    width:100%;\\n                    background:linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(155, 89, 182, 0.1));\\n                    border:1px solid #9b59b6;\\n                    color:#bb8fce;\\n                    padding:8px;\\n                    border-radius:4px;\\n                    cursor:pointer;\\n                    transition:all 0.2s;\\n                    font-size:12px;\\n                \" onmouseover=\"this.style.background='rgba(155, 89, 182, 0.3)'\" \\n                onmouseout=\"this.style.background='linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(155, 89, 182, 0.1))'\"\\n                onclick=\"window.DND_Dashboard_UI.rollDice(100, event)\">\\n                    ğŸ¯ D100 (ç™¾åˆ†éª°)\\n                </button>\\n            </div>\\n            \\n            \\x3c!-- è‡ªå®šä¹‰æŠ•æ· --\\x3e\\n            <div class=\"dnd-dice-custom-area\">\\n                <div style=\"font-size:11px;color:#888;margin-bottom:5px;\">è‡ªå®šä¹‰æŠ•æ·</div>\\n                <div class=\"dnd-dice-input-row\">\\n                    <input type=\"text\" id=\"dnd-custom-dice\" placeholder=\"2d6+3\" class=\"dnd-dice-input\">\\n                    <button onclick=\"window.DND_Dashboard_UI.rollCustomDice()\" class=\"dnd-dice-submit-btn\">æŠ•æ·</button>\\n                </div>\\n            </div>\\n        `;this.showItemDetailPopup(r,n.clientX,n.clientY)},getDicePoolData(){const t=Rr.getAPI();if(!t||!t.exportTableAsJson)return[];try{const n=t.exportTableAsJson();if(!n)return[];const e=\"string\"==typeof n?JSON.parse(n):n,a=Object.keys(e).find(n=>{const t=e[n];return t.name&&(\"ğŸ² éª°å­æ± \"===t.name||t.name.includes(\"éª°å­æ± \"))});if(!a)return[];const r=e[a];if(!r.content||r.content.length<2)return[];const o=r.content[0];return r.content.slice(1).map(n=>{const t={};return o.forEach((e,a)=>{e&&(t[e]=n[a])}),n.forEach((n,e)=>t[e]=n),t})}catch(t){return n.error(\"è·å–éª°å­æ± æ•°æ®å¤±è´¥:\",t),[]}},async refreshDicePool(){const{$:n,window:t}=a(),e=n(\"#dnd-detail-popup-el\").find(\".dnd-dice-pool-visual\");e.length&&e.html('<div style=\"text-align:center;color:#888;padding:10px;\">ğŸ”„ è¡¥å……ä¸­...</div>'),Lr.isRefilling=!1,await Lr.checkAndRefill(),setTimeout(()=>{const n=this._lastClickPos||{x:t.innerWidth/2,y:100};this.hideDetailPopup(),this.showQuickDice({clientX:n.x,clientY:n.y})},500)},rollDice(n,t){const{$:e}=a();if(t&&t.target){const n=e(t.target).closest(\".dnd-dice-btn\");n.length&&(n.addClass(\"dnd-dice-rolling\"),setTimeout(()=>n.removeClass(\"dnd-dice-rolling\"),500))}const r=Math.floor(Math.random()*n)+1;let o=\"\",i=\"\";20===n&&20===r?(i=\"dnd-nat20-result\",o=`<div style=\"text-align:center;padding:20px;\">\\n                <div class=\"dnd-dice-result-number\" style=\"font-size:56px;color:var(--dnd-accent-green);text-shadow:0 0 30px rgba(46, 204, 113, 0.8), 0 0 60px rgba(46, 204, 113, 0.4);animation:dnd-nat20-glow 0.8s ease-in-out infinite alternate;\">âœ¨ ${r} âœ¨</div>\\n                <div class=\"dnd-text-reveal\" style=\"font-size:16px;color:var(--dnd-text-highlight);margin-top:8px;font-weight:bold;text-transform:uppercase;letter-spacing:2px;\">å¤§æˆåŠŸï¼NATURAL 20!</div>\\n            </div>`):20===n&&1===r?(i=\"dnd-nat1-result\",o=`<div style=\"text-align:center;padding:20px;\">\\n                <div class=\"dnd-dice-result-number\" style=\"font-size:56px;color:var(--dnd-accent-red);text-shadow:0 0 30px rgba(192, 57, 43, 0.8), 0 0 60px rgba(192, 57, 43, 0.4);animation:dnd-shake 0.5s ease-in-out;\">ğŸ’€ ${r} ğŸ’€</div>\\n                <div class=\"dnd-text-reveal\" style=\"font-size:16px;color:#e74c3c;margin-top:8px;font-weight:bold;\">å¤§å¤±è´¥... NATURAL 1</div>\\n            </div>`):o=`<div style=\"text-align:center;padding:15px;\">\\n                <div class=\"dnd-dice-result-number\" style=\"font-size:42px;color:var(--dnd-text-highlight);text-shadow:0 0 15px rgba(255, 219, 133, 0.3);\">ğŸ² ${r}</div>\\n                <div style=\"font-size:12px;color:#888;margin-top:5px;\">D${n} æŠ•æ·ç»“æœ</div>\\n            </div>`;const d=e(\"#dnd-detail-popup-el\");if(d.length){const n=e(`<div class=\"dnd-roll-result ${i}\" style=\"margin-bottom:10px;background:linear-gradient(135deg, rgba(0,0,0,0.5), rgba(0,0,0,0.3));border-radius:8px;border:1px solid var(--dnd-border-gold);box-shadow:0 4px 15px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.05);\">${o}</div>`);d.find(\".dnd-roll-result\").remove(),d.find(\"> div\").first().after(n),n.css({opacity:0,transform:\"scale(0.5) rotateX(-20deg)\",transformOrigin:\"center center\"}),setTimeout(()=>{n.css({opacity:1,transform:\"scale(1) rotateX(0deg)\",transition:\"all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55)\"})},10)}},rollCustomDice(){const{$:n}=a(),t=n(\"#dnd-custom-dice\").val().trim();if(t)try{const e=/^(\\d*)d(\\d+)([+-]\\d+)?$/i,a=t.match(e);if(!a)return void jr.warning(\"æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨å¦‚ 2d6+3 çš„æ ¼å¼\");const r=parseInt(a[1])||1,o=parseInt(a[2]),i=parseInt(a[3])||0;if(r>20||o>100)return void jr.warning(\"éª°å­æ•°é‡ä¸èƒ½è¶…è¿‡20ï¼Œé¢æ•°ä¸èƒ½è¶…è¿‡100\");const d=[];let s=0;for(let n=0;n<r;n++){const n=Math.floor(Math.random()*o)+1;d.push(n),s+=n}s+=i;const l=d.join(\" + \"),c=i>0?` + ${i}`:i<0?` - ${Math.abs(i)}`:\"\",p=`<div style=\"text-align:center;padding:15px;\">\\n                <div style=\"font-size:32px;color:var(--dnd-text-highlight);\">ğŸ² ${s}</div>\\n                <div style=\"font-size:11px;color:#888;margin-top:5px;\">${t.toUpperCase()}: (${l})${c}</div>\\n            </div>`,g=n(\"#dnd-detail-popup-el\");if(g.length){g.find(\".dnd-roll-result\").remove();const t=n(`<div class=\"dnd-roll-result\" style=\"margin-bottom:10px;background:rgba(0,0,0,0.4);border-radius:6px;border:1px solid var(--dnd-border-gold);\">${p}</div>`);g.find(\"> div\").first().after(t),t.css({opacity:0,transform:\"scale(0.8)\"}),setTimeout(()=>{t.css({opacity:1,transform:\"scale(1)\",transition:\"all 0.3s ease-out\"})},10)}}catch(n){jr.error(\"æŠ•æ·å¤±è´¥: \"+n.message)}},quickBarState:!1,_quickBarCloseHandler:null,toggleQuickBar(n=null){const{$:t}=a();this.quickBarState=null!==n?n:!this.quickBarState;const e=t(\"#dnd-quick-bar\"),r=t(\"#dnd-quick-trigger\");this.quickBarState?(e.addClass(\"visible\"),r.text(\"â—€\")):(e.removeClass(\"visible\"),r.text(\"â–¶\"))},async renderQuickBar(e=null){const{$:r}=a(),i=r(\"#dnd-quick-bar\");if(!i.length)return;const d=t=>{t||(t=[]),n.debug(\"Rendering quick bar with items:\",t.length);let e=\"\";t.forEach((n,t)=>{const a=n.data.name||\"???\",r=a.substring(0,4);e+=`\\n                    <div class=\"dnd-quick-slot dnd-hover-lift\" title=\"${a}\" onclick=\"window.DND_Dashboard_UI.executeQuickSlot(${t})\">\\n                        ${r}\\n                        <div class=\"dnd-quick-slot-remove\" onclick=\"event.stopPropagation(); window.DND_Dashboard_UI.removeQuickSlot(${t})\">âœ•</div>\\n                    </div>\\n                `}),e+='\\n                <div class=\"dnd-quick-slot add-btn dnd-clickable\" title=\"æ·»åŠ å¿«æ·æ–¹å¼\" onclick=\"window.DND_Dashboard_UI.showQuickSlotSelector()\">\\n                    +\\n                </div>\\n            ',i.html(e)};if(e)d(e);else{d(this._cachedQuickSlots||[]);try{const n=await t.getSetting(o.STORAGE_KEYS.QUICK_SLOTS);let e=[];n&&(e=\"string\"==typeof n?JSON.parse(n):n),this._cachedQuickSlots=e,d(e)}catch(t){n.error(\"Quick slots load error\",t)}}},showQuickSlotSelector(){const{$:n}=a(),t=Rr.getTable(\"ITEM_Inventory\")||[],e=this.getControlledCharacter(),r=e?e.PC_ID||e.CHAR_ID||e[\"å§“å\"]:null,o=(r?Rr.getCharacterSkills(r):[]).filter(n=>\"æ³•æœ¯\"!==n[\"æŠ€èƒ½ç±»å‹\"]),i=r?Rr.getKnownSpells(r):[],d=n=>null==n?\"\":String(n).replace(/'/g,\"\\\\'\").replace(/\"/g,'\"'),s=`\\n            <div style=\"font-weight:bold;color:var(--dnd-text-highlight);border-bottom:1px solid #555;padding-bottom:10px;margin-bottom:15px;text-align:center;\">\\n                æ·»åŠ å¿«æ·æ–¹å¼\\n            </div>\\n            \\n            <div style=\"display:flex;gap:10px;margin-bottom:15px;border-bottom:1px solid rgba(255,255,255,0.1);\">\\n                <div class=\"dnd-tab-btn active\" data-tab=\"items\" onclick=\"window.DND_Dashboard_UI.switchQuickTab('items')\" style=\"padding:8px 15px;cursor:pointer;border-bottom:2px solid var(--dnd-border-gold);\">ğŸ’ ç‰©å“</div>\\n                <div class=\"dnd-tab-btn\" data-tab=\"skills\" onclick=\"window.DND_Dashboard_UI.switchQuickTab('skills')\" style=\"padding:8px 15px;cursor:pointer;border-bottom:2px solid transparent;color:#888;\">âœ¨ æŠ€èƒ½</div>\\n                <div class=\"dnd-tab-btn\" data-tab=\"spells\" onclick=\"window.DND_Dashboard_UI.switchQuickTab('spells')\" style=\"padding:8px 15px;cursor:pointer;border-bottom:2px solid transparent;color:#888;\">ğŸ“œ æ³•ä¹¦</div>\\n            </div>\\n            \\n            <div id=\"dnd-quick-tab-items\" class=\"dnd-quick-tab-content\" style=\"max-height:300px;overflow-y:auto;display:flex;flex-direction:column;gap:5px;\">\\n                ${t.map(n=>{const t=n[\"ç‰©å“åç§°\"],e=n[\"ç‰©å“ID\"]||t;return`<div class=\"dnd-clickable\" style=\"padding:8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;\"\\n                            data-type=\"item\" data-name=\"${d(t)}\" data-id=\"${d(e)}\" data-icon=\"ğŸ’\" data-level=\"\"\\n                            onclick=\"window.DND_Dashboard_UI.handleAddClick(this)\">${t}</div>`}).join(\"\")||'<div style=\"text-align:center;color:#666\">æ— ç‰©å“</div>'}\\n            </div>\\n            \\n            <div id=\"dnd-quick-tab-skills\" class=\"dnd-quick-tab-content\" style=\"max-height:300px;overflow-y:auto;display:none;flex-direction:column;gap:5px;\">\\n                ${o.map(n=>{const t=n[\"æŠ€èƒ½åç§°\"],e=n[\"ç¯é˜¶\"]||n[\"ç­‰çº§\"]||\"\",a=e&&\"0\"!==e&&\"æˆæ³•\"!==e?`(${e}ç¯)`:\"\";return`<div class=\"dnd-clickable\" style=\"padding:8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;display:flex;justify-content:space-between;\"\\n                            data-type=\"skill\" data-name=\"${d(t)}\" data-id=\"\" data-icon=\"âœ¨\" data-level=\"${d(e)}\"\\n                            onclick=\"window.DND_Dashboard_UI.handleAddClick(this)\">\\n                            <span>${t}</span> <span style=\"font-size:11px;color:#888;\">${a}</span>\\n                            </div>`}).join(\"\")||'<div style=\"text-align:center;color:#666\">æ— æŠ€èƒ½</div>'}\\n            </div>\\n            \\n            <div id=\"dnd-quick-tab-spells\" class=\"dnd-quick-tab-content\" style=\"max-height:300px;overflow-y:auto;display:none;flex-direction:column;gap:5px;\">\\n                ${i.map(n=>{const t=n[\"æ³•æœ¯åç§°\"],e=\"0\"===n[\"ç¯é˜¶\"]||0===n[\"ç¯é˜¶\"]?\"æˆæ³•\":n[\"ç¯é˜¶\"]+\"ç¯\";return`<div class=\"dnd-clickable\" style=\"padding:8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;display:flex;justify-content:space-between;\"\\n                            data-type=\"skill\" data-name=\"${d(t)}\" data-id=\"\" data-icon=\"ğŸ“œ\" data-level=\"${d(n[\"ç¯é˜¶\"])}\"\\n                            onclick=\"window.DND_Dashboard_UI.handleAddClick(this)\">\\n                            <span>${t}</span><span style=\"color:#888;font-size:11px;\">${e}</span>\\n                            </div>`}).join(\"\")||'<div style=\"text-align:center;color:#666\">æ— æ³•æœ¯</div>'}\\n            </div>\\n        `,{window:l}=a(),c=l.innerWidth||n(l).width(),p=l.innerHeight||n(l).height();this.showItemDetailPopup(s,c/2-150,p/2-200)},switchQuickTab(n){const{$:t}=a();t(\".dnd-tab-btn\").css({borderBottomColor:\"transparent\",color:\"#888\"}).removeClass(\"active\"),t(`.dnd-tab-btn[data-tab=\"${n}\"]`).css({borderBottomColor:\"var(--dnd-border-gold)\",color:\"#fff\"}).addClass(\"active\"),t(\".dnd-quick-tab-content\").hide(),t(`#dnd-quick-tab-${n}`).css(\"display\",\"flex\")},handleAddClick(t){const{$:e}=a(),r=e(t);n.info(\"handleAddClick triggered for:\",r.data(\"name\")),this.addQuickSlot(r.data(\"type\"),r.data(\"name\"),r.data(\"id\"),r.data(\"icon\"),r.data(\"level\"))},async addQuickSlot(e,i,d,s,l){const c={name:i=i||\"æœªå‘½å\",id:d=String(d||\"\"),icon:s=s||\"â“\",level:l=String(l||\"\")};n.info(\"[DND Dashboard] Adding quick slot:\",e,c);let p=[];if(this._cachedQuickSlots)p=[...this._cachedQuickSlots];else try{const n=await t.getSetting(o.STORAGE_KEYS.QUICK_SLOTS);n&&(p=\"string\"==typeof n?JSON.parse(n):n)}catch(t){n.error(\"Load Error:\",t)}p.push({type:e,data:c}),this._cachedQuickSlots=p,this.renderQuickBar(p),this.hideDetailPopup(),r(o.STORAGE_KEYS.QUICK_SLOTS,JSON.stringify(p)).then(()=>n.info(\"Quick slots saved async\")).catch(t=>{n.error(\"Save failed:\",t),jr.error(\"ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è¿æ¥\")});const{$:g}=a(),f=g(\"#dnd-mini-hud\"),b=g('<div style=\"position:absolute;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(46, 204, 113, 0.9);color:white;padding:5px 10px;border-radius:4px;font-size:12px;z-index:9999;\">å·²æ·»åŠ </div>');f.append(b),setTimeout(()=>b.fadeOut(500,()=>b.remove()),1e3)},async removeQuickSlot(n){if(!await jr.confirm(\"ç¡®å®šè¦ç§»é™¤æ­¤å¿«æ·æ–¹å¼å—ï¼Ÿ\",{title:\"ç§»é™¤å¿«æ·æ–¹å¼\",confirmText:\"ç§»é™¤\",type:\"danger\"}))return;let e=this._cachedQuickSlots||[];if(0===e.length)try{const n=await t.getSetting(o.STORAGE_KEYS.QUICK_SLOTS);n&&(e=\"string\"==typeof n?JSON.parse(n):n)}catch(n){}e.splice(n,1),this._cachedQuickSlots=e,this.renderQuickBar(e),r(o.STORAGE_KEYS.QUICK_SLOTS,JSON.stringify(e))},executeQuickSlot(n){t.getSetting(o.STORAGE_KEYS.QUICK_SLOTS).then(t=>{if(!t)return;const e=(\"string\"==typeof t?JSON.parse(t):t)[n];if(e)if(\"item\"===e.type){const n=`æˆ‘ä½¿ç”¨äº† ${e.data.name}`;this.fillChatInput(n)}else if(\"skill\"===e.type||\"spell\"===e.type){const n=e.data.level,t=parseInt(n);if(!isNaN(t)&&t>0&&\"æˆæ³•\"!==n&&\"0\"!==n){const{$:n,window:r}=a(),o=r.innerWidth||n(r).width(),i=r.innerHeight||n(r).height(),d=\"spell\"===e.type;let s=`<div style=\"font-weight:bold;color:var(--dnd-text-highlight);margin-bottom:10px;text-align:center;\">${d?`âœ¨ é€‰æ‹©æ–½æ³•ç¯é˜¶ (${e.data.name})`:`âœ¨ é€‰æ‹©æŠ€èƒ½ç­‰çº§ (${e.data.name})`}</div>`;s+='<div style=\"display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;\">';const l=t||1;let c=9;if(d){const n=Rr.getPartyData(),t=n.find(n=>\"PC\"===n.type||n.isPC)||n[0],e=Rr.getMaxSpellSlotLevel(t);e>0&&(c=e),c=Math.max(l,c)}for(let n=l;n<=c;n++){s+=`\\n                            <button class=\"dnd-clickable\" style=\"background:rgba(255,255,255,0.05);border:1px solid #555;color:#ccc;padding:8px;border-radius:4px;cursor:pointer;font-weight:bold;\"\\n                                onclick=\"window.DND_Dashboard_UI.fillChatInput('${d?`æˆ‘ä½¿ç”¨ ${n} ç¯æ³•æœ¯ä½æ–½æ”¾äº† ${e.data.name}`:`æˆ‘ä»¥ ${n} çº§ä½¿ç”¨äº†æŠ€èƒ½ï¼š${e.data.name}`}'); window.DND_Dashboard_UI.hideDetailPopup();\">\\n                                ${n} ${d?\"ç¯\":\"çº§\"}\\n                            </button>\\n                        `}s+=\"</div>\",this.showItemDetailPopup(s,o/2-100,i/2-100)}else{const n=\"spell\"===e.type?\"æ–½æ”¾äº†æˆæ³•\":\"ä½¿ç”¨äº†æŠ€èƒ½\";this.fillChatInput(`æˆ‘${n}ï¼š${e.data.name}`)}}})}},mo=Object.assign({},{updateDynamicBackground:n=>{if(!n)return;const t=document.body;qr.destroyAll(),qr.init(t,n.type,n)}},Fr,Jr,Qr,io,so,oo,lo,co,go,fo,bo);try{const{window:n}=a();n?(console.log(\"[DND Dashboard] Exposing UIRenderer to global window (Module Scope)\"),n.DND_Dashboard_UI=mo):(console.warn(\"[DND Dashboard] globalWin not found, using local window\"),window.DND_Dashboard_UI=mo)}catch(K){console.error(\"[DND Dashboard] Failed to expose UIRenderer:\",K)}!function(){let r=0;const i=()=>{n.info(\"init() å¼€å§‹æ‰§è¡Œ\");const{$:s,getDB:l}=a();if(n.debug(\"jQuery çŠ¶æ€:\",!!s,s?s.fn.jquery:\"N/A\"),!s)return n.warn(\"jQuery not found, retrying in 500ms...\"),void setTimeout(i,500);const c=()=>{const a=l();n.debug(\"tryInit - API çŠ¶æ€:\",!!a,\"body å­˜åœ¨:\",!!s(\"body\").length),s(\"body\").length?(n.info(\"å¼€å§‹æ¸²æŸ“ UI...\"),d(),s(document).off(\"mousedown.dndClick\").on(\"mousedown.dndClick\",\".dnd-clickable, .dnd-btn, button, .dnd-nav-item, .dnd-char-card, .dnd-item-card, .dnd-mini-char\",function(){const n=s(this);n.removeClass(\"dnd-clicking\"),n[0].offsetWidth,n.addClass(\"dnd-clicking\")}).on(\"animationend\",\".dnd-clicking\",function(){s(this).removeClass(\"dnd-clicking\")}),mo.init(),Ur.init(),Xr.init(),t.getSetting(o.STORAGE_KEYS.PRESET_CONFIG).then(t=>{if(t)try{const e=\"string\"==typeof t?JSON.parse(t):t;Object.assign(o.PRESET_SWITCHING,e),n.info(\"å·²ä» IndexedDB åŠ è½½é…ç½®:\",e);const a=Rr.getTable(\"SYS_GlobalState\");a&&a[0]&&Wr.checkCombatStateChange(\"æˆ˜æ–—ä¸­\"===a[0][\"æˆ˜æ–—æ¨¡å¼\"])}catch(t){n.error(\"Config load error:\",t)}}),e.setNotifyCallback((n,t,e)=>{const a=jr[n]?n:\"info\";jr[a](t,e)}),setTimeout(()=>e.init(),1e3),a?(console.log(\"[DND Dashboard] Connected to Database API\"),setTimeout(()=>t.migrateFromLocalStorage(),5e3),setTimeout(Lr.checkAndRefill,3e3),a.registerTableUpdateCallback&&(a.registerTableUpdateCallback(Or.handleUpdate),setTimeout(mo.renderHUD,1e3))):r<30&&(r++,setTimeout(c,1e3))):setTimeout(c,500)};c()},{$:s}=a();if(s)s(document).ready(i);else{(window.parent||window).addEventListener(\"load\",i)}}()})();",
  "info": "ä½œè€…:Niccole\n\néœ€è¦ç¥è¯å†ä¸´æ•°æ®åº“æ’ä»¶\néœ€è¦é…å¥—æ¨¡æ¿\né¢„è®¾åˆ‡æ¢éœ€æ±‚æ•°æ®åº“ç‰ˆæœ¬10.8ä»¥ä¸Š",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}