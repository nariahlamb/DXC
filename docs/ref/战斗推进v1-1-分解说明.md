# 战斗推进 v1-1（分解说明）

## 1. 文件定位

- 文件名：`战斗推进v1-1.json`
- 根结构：数组，当前长度为 `1`。
- 数组第 `0` 项是“战斗推进”预设对象。

## 2. 预设对象结构

关键字段：

- `name`: `战斗推进`
- `promptGroup`: 10 段提示词链
- `finalSystemDirective`: 末尾补充指令
- `mainPrompt`: 战斗输入上下文引导
- `systemPrompt`: DND5E 战斗轮规则主文本（长度约 7.5k）
- `extractTags`: `用户输入,recall`
- `minLength`: `0`
- `contextTurnCount`: `5`
- `loopSettings`: 回环配置（当前总时长为 0，即不限制）

## 3. `promptGroup` 分解

结构与默认召回预设一致，也是 10 段：

- `mainSlot=A`：输入组织段
- `mainSlot=B`：战斗规则总规范段

核心差异：

- B 段聚焦 DND5E 战斗轮处理，不是索引召回器。
- 输出要求固定为：
  - `<thought>`：完整计算与判断过程
  - `<content><用户输入>...</用户输入><recall>...</recall></content>`

## 4. 战斗处理逻辑摘要

- 先判断是否进入战斗轮（遭遇表、战斗模式、前文状态）。
- 按先攻顺序处理各单位行动。
- 骰子结果要求从“骰子池表”按序取值，而非随机生成。
- 每轮末输出战斗总结与记忆召回编码。

## 5. 与模板/脚本的配合关系

- 强依赖 `DND仪表盘配套模板.json` 的战斗相关表（遭遇、地图、骰子池等）。
- 强依赖数据库脚本的表读写与回合推进能力。
- `extractTags` 同时包含 `用户输入` 与 `recall`，说明该预设输出会被双通道消费。

## 6. 使用注意

- 该预设本质是“战斗结算器提示词包”。
- 如果你的场景不是 DND5E 或没有骰子池表，建议新建专用变体，不建议直接复用。
- 与默认索引召回预设相比，此预设更偏“规则执行”，而不是“记忆索引召回”。

