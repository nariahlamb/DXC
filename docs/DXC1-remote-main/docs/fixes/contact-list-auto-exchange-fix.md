# 智能终端联系人列表逻辑优化

## 优化目标

用户希望"周围的人"列表能够根据NPC的物理位置(是否在场)自动更新,而"关注的人"列表则由用户手动选择性加入。

## 核心修改内容

### 1. 联系人筛选逻辑优化

**文件**: `components/game/modals/social/ContactsView.tsx`  
**修改内容**: 重新定义 "关注" 与 "周围" 的判定标准。

```typescript
// "关注的人": 仅显示用户手动标记为特别关注的NPC
const following = useMemo(() =\u003e contacts.filter(c =\u003e c.特别关注), [contacts]);

// "周围的人": 仅显示当前在场(即物理距离较近)的NPC
const nearby = useMemo(() =\u003e contacts.filter(c =\u003e c.是否在场), [contacts]);
```

### 2. 扩大有效联系人范围

**文件**: `components/game/modals/SocialPhoneModal.tsx`  
**修改内容**: 修改 `validContacts` 的定义,确保在发起群聊或搜索联系人时,能够包含当前在场的所有人。

```typescript
// 有效联系人包含: 已交换过联系方式的人 OR 特别关注的人 OR 当前在场的人
const validContacts = contacts.filter(c =\u003e c.已交换联系方式 || c.特别关注 || c.是否在场);
```

### 3. 去除冗余的自动标记逻辑

**文件**: `hooks/useGameLogic.ts`  
**修改内容**: 撤销了之前的"对话后自动交换联系方式"的逻辑。现在对话本身不会永久改变NPC的联系人状态,只有当NPC在场或被手动关注时,才会出现在相应列表中。这符合用户希望"选择性加入关注名单"的需求。

## 最终效果

修复后的行为如下:

1.  **自动发现**: 当玩家进入一个有NPC的场景时,这些NPC会**自动**出现在终端的"周围的人"列表中。
2.  **手动关注**: 玩家可以从"周围的人"中选择心仪的NPC,将其标记为"特别关注"。被关注的NPC会出现在"关注的人"列表中,且即使他们不在此场景内,玩家也可以随时在列表中找到他们。
3.  **列表清理**: 如果玩家没有关注某个NPC,且该NPC离开了当前场景,那么该NPC会从"周围的人"列表中消失,保持终端界面的整洁。
4.  **持续对话**: 即使NPC不在场且未被关注,之前的对话记录依然保存在"消息"标签页中,方便回顾。

## 测试建议

1.  去往一个有NPC的场景,确认"周围的人"列表中正确显示了场上的所有NPC。
2.  离开该场景,确认刚才不在场且未关注的NPC已从列表中消失。
3.  在场时将某个NPC设为"特别关注",然后离开场景,确认该NPC依然保留在"关注的人"列表中。
