# 数据库默认索引召回预设（分解说明）

## 1. 文件定位

- 文件名：`数据库默认索引召回预设.json`
- 根结构：数组，当前长度为 `1`。
- 数组第 `0` 项为完整预设对象。

## 2. 预设对象结构

主要字段：

- `name`: 预设名（当前为“默认”）。
- `promptGroup`: 提示词片段数组（10 段）。
- `finalSystemDirective`: 最终系统指令补充。
- `mainPrompt`: 主提示（A 段）。
- `systemPrompt`: 任务规则主文本（B 段，最长）。
- `rateMain/ratePersonal/rateErotic/rateCuckold`: 采样权重配置。
- `extractTags`: 输出提取标签（当前 `recall`）。
- `contextExtractTags/contextExcludeTags`: 上下文标签筛选。
- `minLength`: 最小长度阈值（500）。
- `contextTurnCount`: 读取历史轮次（3）。
- `loopSettings`: 循环推进配置（含延迟、时长、重试等）。

## 3. `promptGroup` 分解

共 10 段，角色顺序为：

- `SYSTEM`
- `USER`
- `assistant`
- `USER`（`mainSlot=A`，`isMain=true`）
- `assistant`
- `USER`（`mainSlot=B`，`isMain2=true`）
- `assistant`
- `assistant`
- `USER`
- `assistant`

解释：

- A 段（`mainPrompt`）主要用于输入背景、前文、总结大纲占位。
- B 段（`systemPrompt`）定义完整执行规约（输出格式、回合流程、评分与终止条件）。

## 4. 占位符语义（该预设可见）

- `$U`：用户基础设定
- `$C`：角色卡/角色设定
- `$1`：背景附加内容
- `$7`：前文上下文
- `$5`：总结大纲
- `$8`：本轮用户输入

## 5. 工作机制（简化）

1. 读取背景与历史摘要。
2. 生成多草稿剧情方向并做索引召回。
3. 对召回编码做真实性校验和数量控制。
4. 输出 `<recall>编码列表</recall>`，供后续剧情生成使用。

## 6. 使用注意

- 该预设是“索引召回型”预设，不是直接剧情输出预设。
- `extractTags=recall` 说明下游只关心召回编码标签。
- `promptGroup` 内含较多“强化指令”片段，迁移到其他环境时建议人工审查后再用。

