# SillyTavern 脚本与模板总索引

## 🎯 一句话总览

这套参考文件可以理解为：`数据库主脚本（业务中枢） + 仪表盘脚本（可视前端） + 模板（数据契约） + 两个预设（AI 行为策略）`。


## 📦 文件职责地图

1. `sillytavern数据库脚本.js`
- 主业务引擎。
- 负责表格数据、自动填表、剧情推进、世界书同步、外部导入。
- 对外暴露 `AutoCardUpdaterAPI`。

2. `酒馆助手脚本-DND沉浸式仪表盘 v1.9.0.json`
- UI 层脚本包（压缩版）。
- 依赖 `AutoCardUpdaterAPI` 读写数据并渲染 HUD、弹窗、快捷栏、骰子面板。

3. `DND仪表盘配套模板.json`
- 数据结构契约。
- 定义所有 `sheet_*` 表头、更新规则、导出规则、顺序。

4. `数据库默认索引召回预设.json`
- 记忆索引召回策略。
- 输出重点是 `<recall>` 编码列表，供后续剧情生成使用。

5. `战斗推进v1-1.json`
- DND5E 战斗轮推进策略。
- 输出 `<用户输入>` 战斗结果 + `<recall>` 记忆编码。


## 🔗 关系图（结构层）

```text
┌──────────────────────────────┐
│ DND仪表盘配套模板.json        │
│ (表结构/规则契约)             │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│ sillytavern数据库脚本.js      │
│ (数据与业务中枢 + API)         │
└──────────────┬───────────────┘
               │ AutoCardUpdaterAPI
               ▼
┌──────────────────────────────┐
│ 酒馆助手脚本-DND沉浸式仪表盘    │
│ v1.9.0.json (UI 展示层)        │
└──────────────────────────────┘

数据库脚本内部还会消费：
  - 数据库默认索引召回预设.json
  - 战斗推进v1-1.json
用于剧情推进/战斗推进的提示词工作流。
```


## 🔄 关系图（运行时数据流）

```text
用户输入
  ↓
数据库脚本读取当前表数据 + 历史上下文
  ↓
按场景选择预设：
  - 索引召回预设 -> 得到 recall 编码
  - 战斗推进预设 -> 得到战斗轮结果 + recall
  ↓
数据库脚本写回：
  - 聊天楼层结构化数据
  - 世界书条目（按配置）
  - 配置存储（酒馆 settings / IndexedDB）
  ↓
仪表盘脚本通过 AutoCardUpdaterAPI 刷新显示
```


## 🧩 关键耦合点

1. 模板字段名耦合
- 模板里 `sheet_*` 的列名/结构被数据库脚本和仪表盘共同依赖。
- 随意删列或重命名会导致解析失败或 UI 缺字段。

2. API 耦合
- 仪表盘脚本依赖数据库脚本暴露的 `AutoCardUpdaterAPI`。
- 若数据库脚本改 API 方法名，仪表盘会直接失效。

3. 预设输出格式耦合
- 数据库脚本会按预设约定标签解析内容（如 `recall`、`用户输入`）。
- 预设改格式时，需要同步调整脚本解析逻辑。


## 🗂️ 建议阅读顺序

1. `SillyTavern脚本模板-总索引.md`（本文件）
2. `sillytavern数据库脚本-分解说明.md`
3. `DND仪表盘配套模板-分解说明.md`
4. `酒馆助手脚本-DND沉浸式仪表盘 v1.9.0-分解说明.md`
5. `数据库默认索引召回预设-分解说明.md`
6. `战斗推进v1-1-分解说明.md`


## ✅ 你可以怎么用这套索引

1. 想改 UI：先看仪表盘说明，再确认 API 是否已有。
2. 想改数据结构：先改模板，再评估数据库脚本与仪表盘受影响点。
3. 想改 AI 行为：优先改两个预设，必要时再改数据库脚本解析逻辑。

## 🧭 DXC 串联导航（新增）

- `DXC记忆索引召回与DND战斗系统-说明书式导航.md`
- 用途：把 `docs/ref` 参考依据与 DXC 当前实现按“记忆 / 召回 / DND / 战斗”四条主链串联，便于后续优化升级直接定位。
