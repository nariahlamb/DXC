{"id":"ISS-DSC-20260213-143958-001","title":"将流式回调改为增量 chunk 协议（delta），并在 UI 端按增量拼接，避免反复全量拷贝。","status":"completed","priority":3,"context":"[performance/streaming-render] utils/aiDispatch.ts:218 | 流式阶段每次 emit 都传整段 fullText，UI 侧再整体 setState，文本越长成本越高，容易出现对话生成过程卡顿。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-001-001","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","started_at":"2026-02-13T14:51:22.221Z","queued_at":"2026-02-13T14:54:10.696Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-002","title":"新增 stream 行为测试：验证 delta/fullText 语义、调用频率和最终 flush 一致性。","status":"completed","priority":3,"context":"[test/coverage-gap] tests/aiDispatch.test.ts:97 | 当前 aiDispatch 测试仅覆盖 timeout/abort，未覆盖 onStream 在长文本场景的调用语义与性能回归。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-002-002","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-003","title":"将 `lastAIResponse` 的更新策略切换为增量 append + requestAnimationFrame 节流。","status":"completed","priority":3,"context":"[performance/state-update-frequency] hooks/gameLogic/useGameLogicCore.ts:7575 | 上层 onStream 回调直接 setLastAIResponse(chunk)，其中 chunk 为全量文本；长输出时 React 重渲染压力明显。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-003-003","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-004","title":"为记忆召回加入异步缓存层和脏标记，避免每轮全量投影。","status":"completed","priority":3,"context":"[performance/prompt-assembly-cost] utils/aiContext.ts:808 | 构建 MEMORY_CONTEXT 时同步执行投影与检索，且位于主 Prompt 组装路径，回合频繁时会直接抬高首 token 延迟。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-004-004","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-005","title":"为不同服务引入并发槽或独立队列，减少 memory 慢请求对其它服务的阻塞。","status":"completed","priority":3,"context":"[performance/queue-throughput] utils/microserviceQueue.ts:78 | 队列采用单线程串行 await next.task()，当 memory 请求慢时会拖住后续 state/world 任务。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-005-005","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-006","title":"替换为括号平衡提取器，确保嵌套结构下命令数组完整。","status":"completed","priority":3,"context":"[bug/command-extraction] utils/aiJson.ts:279 | `\"tavern_commands\":s*([[^]]*])` 只匹配到首个 `]`，命令里有数组字段时容易截断，导致指令丢失。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-006-006","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-007","title":"新增 aiJson 单测覆盖：嵌套数组命令、SSE 包装、repair path 与错误输入。","status":"completed","priority":3,"context":"[test/parser-coverage] tests/aiServices.memoryRetry.test.ts:12 | 现有 memory retry 测试 mock 掉 extractServiceCommands，无法发现真实解析路径中的格式回归。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-007-007","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DSC-20260213-143958-008","title":"对 state 服务输入做字段白名单与压缩序列化，减少非必要上下文。","status":"completed","priority":3,"context":"[performance/payload-size] hooks/gameLogic/useGameLogicCore.ts:4331 | state 服务输入直接塞入 角色/任务/背包/战斗等大对象，且 JSON pretty-print 输出，token 体积和序列化成本偏高。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-008-008","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:19:45.115Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:19:45.115Z"}
{"id":"ISS-DSC-20260213-143958-009","title":"保留已配对成功的命令，缺失部分按 turn 精确补齐，避免全量回退。","status":"completed","priority":3,"context":"[bug/memory-pairing] hooks/gameLogic/useGameLogicCore.ts:5777 | 当前策略在 summary/outline 数量不等时直接触发全量 fallback，已生成的有效配对不会被复用。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-009-009","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:19:45.115Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:19:45.115Z","completed_at":"2026-02-13T15:19:45.115Z"}
{"id":"ISS-DSC-20260213-143958-010","title":"拆分为 input-builder / service-runner / command-guard / apply-transaction 子模块。","status":"completed","priority":3,"context":"[maintainability/module-coupling] hooks/gameLogic/useGameLogicCore.ts:4119 | 同一模块同时承担输入构建、服务编排、命令过滤、事务应用和回滚策略，定位“卡顿 + 格式 + 记忆表”问题成本高。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-010-010","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:34:28.2334902Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:19:45.115Z","completed_at":"2026-02-13T15:34:28.2334902Z"}
{"id":"ISS-DSC-20260213-143958-011","title":"新增队列测试：优先级顺序、慢任务阻塞、drain 行为与异常隔离。","status":"completed","priority":2,"context":"[test/queue-coverage] utils/microserviceQueue.ts:13 | createMicroserviceQueue 为关键调度器，但未见对应测试，队头阻塞或优先级反转风险不可见。","bound_solution_id":"SOL-ISS-DSC-20260213-143958-011-011","created_at":"2026-02-13T14:45:49.459Z","updated_at":"2026-02-13T15:06:23.839Z","planned_at":"2026-02-13T14:45:49.459Z","queued_at":"2026-02-13T14:54:10.696Z","started_at":"2026-02-13T15:06:23.839Z","completed_at":"2026-02-13T15:06:23.839Z"}
{"id":"ISS-DBP-20260213-160951-001","title":"主对话请求缺少超时，可能导致处理中状态无限挂起","status":"completed","priority":3,"context":"[dialog-main-flow/timeout-missing] utils/aiGenerate.ts:34 | 为 story 请求默认注入 timeoutMs，并支持设置覆盖。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-001-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
{"id":"ISS-DBP-20260213-160951-002","title":"OpenAI 兼容流式读取缺少 idle watchdog，半开连接可长期阻塞","status":"completed","priority":3,"context":"[ai-transport-streaming/stream-hang-risk] utils/aiDispatch.ts:305 | reader.read 循环增加 idle 超时并绑定 AbortController。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-002-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
{"id":"ISS-DBP-20260213-160951-003","title":"流式 thinking 提取对累计全文重复解析，存在 O(n^2) 卡顿风险","status":"completed","priority":3,"context":"[ai-transport-streaming/quadratic-cpu-risk] hooks/gameLogic/useGameLogicCore.ts:7410 | 改增量解析或仅在流结束后做完整 thinking 解析。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-003-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
{"id":"ISS-DBP-20260213-160951-004","title":"AM 召回请求无超时且串行执行，放大首包延迟","status":"completed","priority":3,"context":"[dialog-main-flow/latency-amplifier] hooks/gameLogic/useGameLogicCore.ts:7318 | 为召回请求设置短超时并允许降级跳过。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-004-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
{"id":"ISS-DBP-20260213-160951-005","title":"首回合 IP 补全请求无超时，延迟主流程释放","status":"completed","priority":3,"context":"[dialog-main-flow/post-response-blocking] hooks/gameLogic/useGameLogicCore.ts:7445 | IP 补全后台化，或设置独立短超时。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-005-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
{"id":"ISS-DBP-20260213-160951-006","title":"论坛自动生成无超时，in-flight 锁可长时间占用","status":"completed","priority":3,"context":"[context-and-phone-performance/availability-risk] hooks/gameLogic/useGameLogicCore.ts:8366 | phone 生成链路统一传入 signal 与 timeoutMs。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-006-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
{"id":"ISS-DBP-20260213-160951-007","title":"phone 生成调用分散且大多不可取消，易形成悬挂请求","status":"completed","priority":3,"context":"[context-and-phone-performance/unbounded-requests] hooks/gameLogic/useGameLogicCore.ts:7787 | 引入 phone request scope controller，统一取消策略。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:42:31.705Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:42:31.705Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-007-001"}
{"id":"ISS-DBP-20260213-160951-008","title":"Prompt 拼装无硬预算，易生成超大上下文并拖慢响应","status":"completed","priority":3,"context":"[context-and-phone-performance/prompt-bloat] utils/aiPrompt.ts:280 | 增加 token/字符预算与模块裁剪。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T17:21:32.750Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","started_at":"2026-02-13T17:21:32.750Z","completed_at":"2026-02-13T17:21:32.750Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-008-001"}
{"id":"ISS-DBP-20260213-160951-012","title":"配置层缺少 story/phone/world 超时字段，无法运营调优","status":"completed","priority":2,"context":"[dialog-main-flow/operability-gap] types/ai.ts:14 | 在 GlobalAISettings/AppSettings 增加通用请求超时配置。","created_at":"2026-02-13T16:38:13.87Z","updated_at":"2026-02-13T16:38:13.87Z","planned_at":"2026-02-13T16:38:13.87Z","queued_at":"2026-02-13T16:38:13.87Z","bound_solution_id":"SOL-ISS-DBP-20260213-160951-012-001","started_at":"2026-02-13T16:38:13.87Z","completed_at":"2026-02-13T16:38:13.87Z"}
