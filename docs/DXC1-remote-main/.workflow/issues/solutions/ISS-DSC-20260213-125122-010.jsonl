{"id":"SOL-ISS-DSC-20260213-125122-010-s010","description":"修复 SettingsModal 测试中的 act 警告与噪声日志，提升测试稳定性与信噪比。","approach":"调整测试输入与异步等待策略：将触发 parse 警告的无效数据替换为可解析边界数据，并用 waitFor/act 包裹异步更新与定时器推进，确保输出日志可控。","tasks":[{"id":"T1","title":"Stabilize async updates in SettingsModal tests","scope":"components/game/modals/SettingsModal.test.tsx","action":"Update","description":"对 Storage 与 debounce 场景改为显式异步等待，消除未包裹 act 的状态更新警告。","modification_points":[{"file":"components/game/modals/SettingsModal.test.tsx","target":"imports 与 storage/debounce 用例","change":"引入 waitFor，使用 async test + act/waitFor 包裹异步状态变化和计时器推进"}],"implementation":["将受异步 effect 影响的用例改为 async，并在关键断言前使用 waitFor。","在 debounce 用例中统一使用 act 包裹 vi.advanceTimersByTime 与后续状态刷新。","确保每个异步分支都有完成信号断言，避免悬空更新触发警告。"],"test":{"unit":["Storage 视图渲染异步稳定","自动保存 debounce 用例无 act 警告"],"commands":["npx vitest run components/game/modals/SettingsModal.test.tsx --testTimeout=60000"],"coverage_target":0.75},"acceptance":{"criteria":["SettingsModal.test.tsx 中 waitFor 使用次数 >= 1","异步相关用例（Storage/debounce）均为 async","act warning 关键字匹配次数 = 0"],"verification":["执行命令: npx vitest run components/game/modals/SettingsModal.test.tsx --testTimeout=60000 2>&1 | rg -n \"not wrapped in act\"，应返回 0 行","执行命令: npx vitest run components/game/modals/SettingsModal.test.tsx --testTimeout=60000"]},"commit":{"type":"test","scope":"settings-modal","message_template":"test(settings-modal): wrap async state updates with waitFor/act","breaking":false},"depends_on":[],"estimated_minutes":25,"priority":1},{"id":"T2","title":"Reduce noisy warning logs in test data","scope":"components/game/modals/SettingsModal.test.tsx","action":"Fix","description":"替换触发无意义 warning 的输入并增加日志约束断言，保持测试输出干净。","modification_points":[{"file":"components/game/modals/SettingsModal.test.tsx","target":"storage payload setup 与通用 beforeEach/afterEach","change":"将无效 JSON 输入替换为可解析边界数据；按需 mock/断言 console.warn 与 console.error"}],"implementation":["把 danmachi_settings 的无效 JSON 改为可解析但字段不完整的数据，仍覆盖容错路径。","在测试内对 console.warn/console.error 进行受控监听，过滤并断言仅出现预期日志。","确保非预期日志出现时测试失败，防止噪声回归。"],"test":{"unit":["容错场景下无非预期 console.error","测试输出不包含空 src 噪声与 parse 警告"],"commands":["npx vitest run components/game/modals/SettingsModal.test.tsx --testTimeout=60000"],"coverage_target":0.78},"acceptance":{"criteria":["测试运行日志中 \"scan settings parse failed\" 匹配次数 = 0","测试运行日志中 \"An empty string\" 匹配次数 = 0","console.error 非预期调用次数 = 0"],"verification":["执行命令: npx vitest run components/game/modals/SettingsModal.test.tsx --testTimeout=60000 2>&1 | rg -n \"scan settings parse failed|An empty string\"，应返回 0 行","执行命令: npx vitest run components/game/modals/SettingsModal.test.tsx --testTimeout=60000"]},"commit":{"type":"test","scope":"settings-modal","message_template":"test(settings-modal): remove noisy logs from stability tests","breaking":false},"depends_on":["T1"],"estimated_minutes":25,"priority":1}],"analysis":{"risk":"low","impact":"medium","complexity":"low"},"score":0.9,"is_bound":true,"created_at":"2026-02-13T13:24:34.243Z","bound_at":"2026-02-13T13:25:22.165Z"}
