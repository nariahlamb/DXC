{"id":"SOL-ISS-DSC-005-e505","description":"为 SettingsModal 增加关键交互测试（存储扫描/导入失败/保存）","approach":"采用组件级测试覆盖高风险分支，mock localStorage 与 file import 行为","tasks":[{"id":"T1","title":"Add SettingsModal storage scan tests","scope":"components/game/modals","action":"Add","description":"新增 SettingsModal.test.tsx 覆盖 storage 扫描统计与容错。","modification_points":[{"file":"components/game/modals/SettingsModal.test.tsx","target":"new test file","change":"新增 scanStorage 行为测试"}],"implementation":["mock localStorage key/value 列表","断言统计字段与条目类型识别","覆盖 JSON parse 失败分支不崩溃"],"test":{"unit":["scanStorage summary rendering","invalid JSON tolerance"],"integration":[],"commands":["npm test -- components/game/modals/SettingsModal.test.tsx","npm run build"],"coverage_target":0.75},"acceptance":{"criteria":["至少覆盖 2 类存档 key 与 1 类坏 JSON 输入","测试断言 localStorage 读取次数与预期一致"],"verification":["执行目标测试并通过","构建通过"]},"priority":2},{"id":"T2","title":"Add import/export/save interaction tests","scope":"components/game/modals/SettingsModal.test.tsx","action":"Add","description":"覆盖配置导入失败提示与保存回调触发。","modification_points":[{"file":"components/game/modals/SettingsModal.test.tsx","target":"interaction cases","change":"新增 import error + save callback 场景"}],"implementation":["mock FileReader 返回非法 JSON","断言错误提示/状态回退","触发保存并校验 onSaveSettings 调用 payload"],"test":{"unit":["import invalid config handled","save callback invoked once"],"integration":[],"commands":["npm test -- components/game/modals/SettingsModal.test.tsx"],"coverage_target":0.7},"acceptance":{"criteria":["导入失败场景触发可见错误状态且不中断 modal","保存动作 onSaveSettings 调用次数=1 且 payload 包含 aiConfig"],"verification":["测试断言通过"]},"depends_on":["T1"],"priority":2}],"analysis":{"risk":"low","impact":"high","complexity":"medium"},"score":0.86,"is_bound":true,"created_at":"2026-02-06T14:08:56.616Z","bound_at":"2026-02-06T14:08:57.408Z"}
