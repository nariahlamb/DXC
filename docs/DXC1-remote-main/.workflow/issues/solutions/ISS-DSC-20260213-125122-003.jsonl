{"id":"SOL-ISS-DSC-20260213-125122-003-b3k4","description":"修复主菜单设置中变量编辑误触发开局的问题，变量修改仅作用于主菜单预览态。","approach":"将 Home 场景下 SettingsModal 的 onUpdateGameState 从 onStart 改为本地预览状态更新；确保只有用户明确点击开始/继续时才触发 onStart。","tasks":[{"id":"T1","title":"Update Home preview game state channel","scope":"components/Home.tsx","action":"Update","description":"在 Home 增加独立预览状态容器，接收设置面板变量编辑结果。","modification_points":[{"file":"components/Home.tsx","target":"Home component state section","change":"新增 previewGameState 状态并用于 SettingsModal gameState 输入"}],"implementation":["将 createNewGameState 初始化结果存入 useState，而不是每次 render 直接创建","确保 SettingsModal 使用 previewGameState 作为变量编辑对象","保留 onNewGame/onLoadGame/onStart 的现有入口行为"],"test":{"unit":["变量编辑后仅更新 previewGameState"],"integration":["Home 菜单不自动跳转到游戏界面"],"commands":["npx tsc --noEmit"],"coverage_target":0.7},"acceptance":{"criteria":["SettingsModal 变量编辑触发 onUpdateGameState 时，onStart 调用次数=0","previewGameState 在 1 次变量提交后产生 1 次有效状态更新"],"verification":["执行命令: npx vitest run tests/ui/homeSettingsVariableEdit.test.tsx","执行命令: rg -n \"onUpdateGameState\" components/Home.tsx"],"manual_checks":["主菜单打开设置-变量调试-应用修改后停留在主菜单"]},"commit":{"type":"fix","scope":"home-settings","message_template":"fix(home): decouple variable editor from game start callback","breaking":false},"depends_on":[],"estimated_minutes":25,"priority":1},{"id":"T2","title":"Fix SettingsModal callback wiring in Home","scope":"components/Home.tsx","action":"Fix","description":"重连 SettingsModal onUpdateGameState 回调，禁止变量编辑直连 onStart。","modification_points":[{"file":"components/Home.tsx","target":"SettingsModal props around onUpdateGameState","change":"将 onUpdateGameState 改为 setPreviewGameState"}],"implementation":["替换 onUpdateGameState 传参为预览态更新函数","确认其他设置项保存和关闭回调不受影响","补充必要注释说明主菜单场景与游戏内场景的回调差异"],"test":{"unit":["回调替换后 onStart 仅由菜单按钮触发"],"integration":["变量编辑路径不触发路由/模式切换"],"commands":["npx vitest run tests/ui/homeSettingsVariableEdit.test.tsx"],"coverage_target":0.75},"acceptance":{"criteria":["变量编辑点击应用修改后 onStart 调用次数保持 0","手动点击开始或继续时 onStart 调用次数=1"],"verification":["执行命令: npx vitest run tests/ui/homeSettingsVariableEdit.test.tsx --reporter=basic","执行命令: npx tsc --noEmit"],"manual_checks":["快速继续按钮功能仍可进入游戏"]},"commit":{"type":"fix","scope":"home","message_template":"fix(home): prevent settings variable edit from auto-start","breaking":false},"depends_on":["T1"],"estimated_minutes":20,"priority":1},{"id":"T3","title":"Add regression tests for variable-edit start guard","scope":"tests/ui","action":"Add","description":"新增主菜单设置变量编辑回归测试，覆盖误开局场景。","modification_points":[{"file":"tests/ui/homeSettingsVariableEdit.test.tsx","target":"new test suite","change":"新增 onStart 调用次数断言与预览态更新断言"}],"implementation":["mock Home 组件并传入 onStart spy","模拟进入 SettingsModal VARIABLES 视图并点击应用修改","断言 onStart 未触发且预览态发生更新"],"test":{"unit":["误触发开局回归测试"],"integration":["主菜单设置工作流回归"],"commands":["npx vitest run tests/ui/homeSettingsVariableEdit.test.tsx","npx tsc --noEmit"],"coverage_target":0.8},"acceptance":{"criteria":["新增测试至少 2 条（误触发防护/正常开局）","回归测试命令执行通过率=100%"],"verification":["执行命令: npx vitest run tests/ui/homeSettingsVariableEdit.test.tsx","执行命令: npx tsc --noEmit"],"manual_checks":["主菜单设置入口回归"]},"commit":{"type":"test","scope":"home-settings","message_template":"test(home): cover variable editor start misfire regression","breaking":false},"depends_on":["T2"],"estimated_minutes":30,"priority":2}],"analysis":{"risk":"low","impact":"high","complexity":"low"},"score":0.93,"is_bound":true,"created_at":"2026-02-13T13:22:50.703Z","bound_at":"2026-02-13T13:23:17.033Z"}
