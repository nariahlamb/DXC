{"id":"SOL-ISS-DBP-20260213-160951-008-001","description":"主对话 Prompt 增加硬预算裁剪，避免超大上下文导致本地序列化和传输卡死。","approach":"在 aiGenerate 增加 applyPromptBudget，并在 story/phone/world/map 请求前统一裁剪；同时在 aiDispatch 里将 custom 默认关闭 stream，并把 timeout 计时移到请求体构建后。","tasks":[{"id":"T1","title":"Prompt 预算裁剪","scope":"utils/aiGenerate.ts","action":"Refactor","description":"新增 total/system/user 预算与 head-tail 截断策略。","priority":1},{"id":"T2","title":"超时计时点后移","scope":"utils/aiDispatch.ts","action":"Fix","description":"timeout 从“函数入口”改为“请求发送前”启动。","priority":1},{"id":"T3","title":"custom 禁用流式","scope":"utils/aiDispatch.ts","action":"Fix","description":"custom provider 默认非流式，规避 SSE 兼容性挂起。","priority":1}],"analysis":{"risk":"medium","impact":"high","complexity":"medium"},"score":0.9,"is_bound":true,"created_at":"2026-02-13T17:21:32.750Z","bound_at":"2026-02-13T17:21:32.750Z"}
