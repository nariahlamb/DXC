{"id":"SOL-ISS-DSC-004-d404","description":"补齐 useGameLogic 核心行为测试（world update / command queue / phone sync）","approach":"基于现有 hook 测试模式增量添加高价值场景，用 mock 隔离 AI 与存储副作用","tasks":[{"id":"T1","title":"Add world update scheduler tests","scope":"tests/useGameLogic.*.test.tsx","action":"Add","description":"覆盖回合推进触发 world update 与 nextTurn 重置行为。","modification_points":[{"file":"tests/useGameLogic.legacy-save.test.tsx","target":"describe blocks","change":"新增 scheduler 场景"}],"implementation":["构造含 interval/nextTurn 的状态","推进 turn 并断言 handler 调用与下次回合更新","验证去重逻辑避免重复触发"],"test":{"unit":["world scheduler due 触发一次","同一 nextTurn 不重复触发"],"integration":[],"commands":["npm test -- tests/useGameLogic.legacy-save.test.tsx","npm run build"],"coverage_target":0.8},"acceptance":{"criteria":["新增至少 2 个 world scheduler 断言场景并稳定通过","回归执行 3 次无 flaky"],"verification":["单测文件执行通过","构建通过"]},"priority":2},{"id":"T2","title":"Add command queue and phone sync tests","scope":"tests/useGameLogic.legacy-save.test.tsx","action":"Add","description":"覆盖 command queue 消费与 phone sync plan 入队触发条件。","modification_points":[{"file":"tests/useGameLogic.legacy-save.test.tsx","target":"mock AI response flow","change":"增加 command 与 phone sync 断言"}],"implementation":["mock AI response 含 tavern_commands 与 phone_sync_plan","断言 queue 消费后 state 更新","断言仅在配置启用时触发 sync"],"test":{"unit":["command queue correctly mutates state","phone sync gated by config"],"integration":[],"commands":["npm test -- tests/useGameLogic.legacy-save.test.tsx"],"coverage_target":0.75},"acceptance":{"criteria":["新增 command+sync 相关断言 >= 3 条","断言覆盖 enabled/disabled 双分支"],"verification":["执行指定测试命令通过"]},"depends_on":["T1"],"priority":2}],"analysis":{"risk":"low","impact":"high","complexity":"medium"},"score":0.87,"is_bound":true,"created_at":"2026-02-06T14:08:52.625Z","bound_at":"2026-02-06T14:08:54.350Z"}
