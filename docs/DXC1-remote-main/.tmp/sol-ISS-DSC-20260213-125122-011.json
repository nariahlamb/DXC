{
  "description": "统一技能/魔法消耗格式化为共享 formatter，消除 CharacterView 与 SkillsContent 重复实现。",
  "tasks": [
    {
      "id": "T1",
      "title": "新增共享技能消耗 formatter",
      "scope": "utils",
      "action": "Add",
      "description": "创建统一格式化函数，覆盖 string/object/number/null 输入并输出一致文本。",
      "modification_points": [
        {
          "file": "utils/skillFormat.ts",
          "target": "新建 formatter",
          "change": "导出 formatSkillCost 并定义输入类型"
        },
        {
          "file": "types",
          "target": "技能消耗类型",
          "change": "补充/复用 cost 类型定义"
        }
      ],
      "implementation": [
        "定义格式化规则：优先输出资源键值，空值过滤，保持稳定顺序。",
        "兼容旧对象字段（体力/精神/法利/物品）与字符串输入。",
        "返回可直接渲染文本，避免组件层重复拼接。"
      ],
      "test": {
        "unit": [
          "string cost",
          "object cost",
          "empty/null cost",
          "number cost"
        ],
        "commands": [
          "npx vitest run tests/utils/skillFormat.test.ts --testTimeout=60000",
          "npx tsc --noEmit"
        ]
      },
      "acceptance": {
        "criteria": [
          "formatter 单测不少于 8 条并全部通过。",
          "同一输入在任意调用点输出完全一致（字符级一致）。"
        ],
        "verification": [
          "执行 npx vitest run tests/utils/skillFormat.test.ts --testTimeout=60000 并通过。",
          "执行 npx tsc --noEmit 返回 0。"
        ]
      },
      "priority": 1
    },
    {
      "id": "T2",
      "title": "替换 CharacterView 与 SkillsContent 本地 formatCost",
      "scope": "components/game",
      "action": "Update",
      "description": "删除两处重复 formatCost 定义并改为调用共享 formatter。",
      "modification_points": [
        {
          "file": "components/game/views/CharacterView.tsx",
          "target": "const formatCost",
          "change": "删除本地函数并导入 formatSkillCost"
        },
        {
          "file": "components/game/character/SkillsContent.tsx",
          "target": "const formatCost",
          "change": "删除本地函数并导入 formatSkillCost"
        }
      ],
      "implementation": [
        "清理组件内重复实现并统一 import。",
        "保持现有 UI 文案结构，仅替换格式化来源。",
        "处理 null 返回，避免渲染空占位。"
      ],
      "test": {
        "unit": [
          "shared formatter usage in two components"
        ],
        "commands": [
          "powershell -Command \"(rg --line-number 'const formatCost = \\(cost: any\\)' components/game/views/CharacterView.tsx components/game/character/SkillsContent.tsx | Measure-Object).Count\"",
          "npx vitest run tests/utils/skillFormat.test.ts --testTimeout=60000"
        ]
      },
      "acceptance": {
        "criteria": [
          "上述两个组件中的本地 formatCost 定义数从 2 降至 0。",
          "两个组件渲染同一消耗对象时文本完全一致。"
        ],
        "verification": [
          "执行 `rg -n \"const formatCost = \\(cost\" components/game/views/CharacterView.tsx components/game/character/SkillsContent.tsx` 返回 0。",
          "执行 `npx vitest run tests/utils/skillFormat.test.ts --testTimeout=60000` 并通过。",
          "执行 `npx tsc --noEmit` 返回 0。"
        ]
      },
      "depends_on": [
        "T1"
      ],
      "priority": 1
    },
    {
      "id": "T3",
      "title": "新增技能消耗渲染回归测试",
      "scope": "tests/components",
      "action": "Add",
      "description": "补充 CharacterView/SkillsContent 对齐测试，验证重构后显示保持一致。",
      "modification_points": [
        {
          "file": "tests/components/skillCostRendering.test.tsx",
          "target": "新建测试",
          "change": "覆盖技能与魔法消耗展示一致性"
        },
        {
          "file": "components/game/views/CharacterView.tsx",
          "target": "消耗展示节点",
          "change": "必要时补充 data-testid 便于断言"
        },
        {
          "file": "components/game/character/SkillsContent.tsx",
          "target": "消耗展示节点",
          "change": "必要时补充 data-testid 便于断言"
        }
      ],
      "implementation": [
        "构造统一测试 fixture（体力/精神/法利组合消耗）。",
        "分别渲染两个组件并断言消耗文本一致。",
        "回归验证空消耗输入不渲染脏文本。"
      ],
      "test": {
        "unit": [
          "cross-component cost rendering parity"
        ],
        "commands": [
          "npx vitest run tests/components/skillCostRendering.test.tsx --testTimeout=60000",
          "npm test",
          "npm run build"
        ]
      },
      "acceptance": {
        "criteria": [
          "新增渲染回归测试不少于 4 条断言。",
          "npm test 与 npm run build 全部通过。"
        ],
        "verification": [
          "执行 npx vitest run tests/components/skillCostRendering.test.tsx --testTimeout=60000 并通过。",
          "执行 npm run build 并通过。"
        ]
      },
      "depends_on": [
        "T2"
      ],
      "priority": 2
    }
  ],
  "exploration_context": null,
  "analysis": {
    "risk": "low",
    "impact": "medium",
    "complexity": "medium"
  },
  "score": 0.94
}
