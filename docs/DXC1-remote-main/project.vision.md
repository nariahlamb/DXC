# Project Vision

## What
构建一个基于“微服务模式”的**多 AI 协同系统**，将 DXC 项目的单一叙事智能拆解为多个异步运行的专业化 AI 代理（主叙事、记忆总结、社交互动、世界模拟、NPC 决策、智能终端）。系统采用前端异步编排架构，确保主叙事窗口的快速响应，同时在后台并行处理复杂的世界逻辑和数据同步。

## Why
目前的单体 AI 模式承担了过多的职责（叙事、状态更新、记忆管理），导致响应延迟高、逻辑偶尔混乱，且难以扩展深度功能。通过解耦，我们可以：
1.  **提升响应速度**：主叙事 AI 只需专注于文本生成，无需等待繁重的状态计算。
2.  **增强沉浸感**：专业化的 AI（如世界模拟、社交互动）可以提供更深度的环境反馈和 NPC 行为，而不干扰主剧情流程。
3.  **实现复杂功能**：独立运行的“智能终端”和“表格记忆”模块能提供类似真实手机通讯与可追溯事实归档体验。

## Target Users
追求深度沉浸体验的文字冒险游戏玩家，特别是喜欢复杂 NPC 交互、真实世界模拟和《地错》IP 的用户。

## Success Criteria
- **异步响应架构**: 实现主叙事优先响应（流式或快速返回），其他 AI 任务（记忆、状态、社交）在后台异步完成并静默更新状态。
- **角色分工明确**:
  - **主叙事 AI**: 专注剧情文本生成。
  - **记忆服务 AI**: 通过 `append_log_summary` / `append_log_outline` 实时写入表格记忆。
  - **社交互动 AI**: 解析玩家意图，更新 NPC 好感度与关系。
  - **世界模拟 AI**: 管理 `gameState`（时间、天气、环境）。
  - **NPC 决策 AI**: 驱动 NPC 的独立行动和决策。
  - **智能终端 AI**: 独立处理私聊、短信和模拟手机界面交互。
- **数据一致性**: 各个异步 AI 产出的数据（如时间流逝、物品获得）能准确同步到全局游戏状态中，不发生冲突。
- **无感集成**: 后台任务的执行不阻塞 UI，不造成界面卡顿。

## Constraints
- **技术栈**: 保持 React + Vite 架构，使用前端异步请求（如 Web Workers 或异步 Promise 链）进行编排。
- **资源限制**: 优化 API 调用频率，避免 Token 消耗失控（考虑合并请求或使用轻量模型处理简单任务）。
- **兼容性**: 必须兼容现有的存档结构和 UI 布局。

## Technical Preferences

### Preferred
- **前端编排 (Client-side Orchestration)**: 利用 React 的异步能力管理多路 AI 请求。
- **结构化通信**: 所有 AI 代理均通过 JSON 格式交换数据，严格定义 Schema。
- **SillyTavern 模式**: 参考 SillyTavern 的 Extras/Plugins 架构设计思想，将功能模块化。

### To Avoid
- **阻塞式等待**: 严禁主叙事等待所有后台任务完成后才显示内容。
- **过度微服务化**: 避免引入复杂的后端容器编排（如 K8s），保持架构轻量，易于部署。

## Inspirations
- **SillyTavern**: 其分层架构（主生成 + 额外处理插件）是本项目的核心参考。
- **微服务架构**: 职责单一、松耦合的设计理念。

## Non-Goals
- **后端重写**: 不引入全新的后端语言（如 Python/Go）重写服务层，除非绝对必要。
- **UI 风格重构**: 本阶段专注于 AI 逻辑架构，UI 风格维持现状（Hestia Blue）。

---

*Vision built interactively on 2026-02-02*
*Ready for: Orchestrator → Architecture → Roadmap*
